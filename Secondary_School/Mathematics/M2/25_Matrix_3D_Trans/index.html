<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Matrix Transformations | M2 Matrix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Outfit", sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        overflow: hidden;
      }
      .glass {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .matrix-input {
        background: transparent;
        border: none;
        text-align: center;
        color: white;
        width: 100%;
        font-family: monospace;
        font-size: 0.8rem;
      }
    </style>
  </head>
  <body>
    <div class="absolute top-4 left-4 z-10 glass p-6 rounded-2xl max-w-sm">
      <!-- Language Toggle -->
      <div class="absolute top-4 right-4">
        <button
          id="lang-btn"
          class="px-2 py-1 bg-slate-800 border border-slate-600 rounded-full text-[10px] font-bold text-emerald-400 hover:bg-slate-700 hover:text-white transition flex items-center gap-1"
        >
          <i class="fa-solid fa-language"></i>
          <span id="lang-text">中文</span>
        </button>
      </div>

      <h1
        id="app-title"
        class="text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-indigo-400 mb-2"
      >
        3D Transform
      </h1>
      <p id="app-subtitle" class="text-xs text-slate-300 mb-4">
        Matrix M · Vector v
      </p>

      <div class="space-y-6">
        <div>
          <h3
            id="label-matrix"
            class="text-xs font-bold text-slate-400 uppercase mb-2"
          >
            Transformation Matrix M
          </h3>
          <div
            class="grid grid-cols-3 gap-1 bg-slate-900/50 p-2 rounded-xl border border-slate-700"
          >
            <!-- Row 1 -->
            <input
              type="number"
              step="0.5"
              value="1"
              id="m11"
              class="matrix-input hover:bg-slate-800 rounded"
            />
            <input
              type="number"
              step="0.5"
              value="0"
              id="m12"
              class="matrix-input hover:bg-slate-800 rounded"
            />
            <input
              type="number"
              step="0.5"
              value="0"
              id="m13"
              class="matrix-input hover:bg-slate-800 rounded"
            />

            <!-- Row 2 -->
            <input
              type="number"
              step="0.5"
              value="0"
              id="m21"
              class="matrix-input hover:bg-slate-800 rounded"
            />
            <input
              type="number"
              step="0.5"
              value="1"
              id="m22"
              class="matrix-input hover:bg-slate-800 rounded"
            />
            <input
              type="number"
              step="0.5"
              value="0"
              id="m23"
              class="matrix-input hover:bg-slate-800 rounded"
            />

            <!-- Row 3 -->
            <input
              type="number"
              step="0.5"
              value="0"
              id="m31"
              class="matrix-input hover:bg-slate-800 rounded"
            />
            <input
              type="number"
              step="0.5"
              value="0"
              id="m32"
              class="matrix-input hover:bg-slate-800 rounded"
            />
            <input
              type="number"
              step="0.5"
              value="1"
              id="m33"
              class="matrix-input hover:bg-slate-800 rounded"
            />
          </div>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <button
            id="btn-identity"
            onclick="setMatrix('identity')"
            class="px-3 py-2 bg-slate-800 rounded hover:bg-slate-700 text-xs text-slate-300"
          >
            Identity
          </button>
          <button
            id="btn-scale"
            onclick="setMatrix('scale')"
            class="px-3 py-2 bg-slate-800 rounded hover:bg-slate-700 text-xs text-slate-300"
          >
            Scale (2x)
          </button>
          <button
            id="btn-shear"
            onclick="setMatrix('shear')"
            class="px-3 py-2 bg-slate-800 rounded hover:bg-slate-700 text-xs text-slate-300"
          >
            Shear X
          </button>
          <button
            id="btn-rotate"
            onclick="setMatrix('rotateZ')"
            class="px-3 py-2 bg-slate-800 rounded hover:bg-slate-700 text-xs text-slate-300"
          >
            Rotate Z
          </button>
        </div>

        <p id="label-cube" class="text-[10px] text-center text-slate-500">
          The Unit Cube (Wireframe) shows the transformation.
        </p>
      </div>
    </div>

    <div id="canvas-container" class="w-screen h-screen"></div>

    <script>
      // Bilingual
      const translations = {
        en: {
          title: "3D Transform",
          subtitle: "Matrix M · Vector v",
          matrix: "Transformation Matrix M",
          bIdentity: "Identity",
          bScale: "Scale (2x)",
          bShear: "Shear X",
          bRotate: "Rotate Z",
          cube: "The Unit Cube (Wireframe) shows the transformation.",
          langBtn: "中文",
        },
        zh: {
          title: "3D 矩陣變換",
          subtitle: "矩陣 M · 向量 v",
          matrix: "變換矩陣 M",
          bIdentity: "單位矩陣",
          bScale: "放大 (2x)",
          bShear: "推移 X",
          bRotate: "旋轉 Z",
          cube: "單位立方體 (線框) 顯示變換效果。",
          langBtn: "English",
        },
      };

      let currentLang = "en";

      function updateLanguage() {
        const t = translations[currentLang];
        document.getElementById("lang-text").textContent = t.langBtn;
        document.getElementById("app-title").textContent = t.title;
        document.getElementById("app-subtitle").textContent = t.subtitle;
        document.getElementById("label-matrix").textContent = t.matrix;
        document.getElementById("btn-identity").textContent = t.bIdentity;
        document.getElementById("btn-scale").textContent = t.bScale;
        document.getElementById("btn-shear").textContent = t.bShear;
        document.getElementById("btn-rotate").textContent = t.bRotate;
        document.getElementById("label-cube").textContent = t.cube;
      }

      document.getElementById("lang-btn").addEventListener("click", () => {
        currentLang = currentLang === "en" ? "zh" : "en";
        updateLanguage();
      });

      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0f172a);
      const camera = new THREE.PerspectiveCamera(
        50,
        window.innerWidth / window.innerHeight,
        0.1,
        100
      );
      camera.position.set(4, 4, 6);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document
        .getElementById("canvas-container")
        .appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      scene.add(new THREE.GridHelper(10, 10, 0x334155, 0x1e293b));
      scene.add(new THREE.AxesHelper(2));
      scene.add(new THREE.AmbientLight(0xffffff, 0.8));

      // Objects
      // 1. Original Unit Cube (Ghost)
      const ghostGeo = new THREE.BoxGeometry(1, 1, 1);
      const ghostEdges = new THREE.EdgesGeometry(ghostGeo);
      const ghost = new THREE.LineSegments(
        ghostEdges,
        new THREE.LineBasicMaterial({
          color: 0xffffff,
          opacity: 0.2,
          transparent: true,
        })
      );
      // Center the cube corner at 0,0,0 ?? No, standard usually centered at 0.
      // Let's offset geometries so corner is at origin to see basis vectors easier?
      // nah, center is fine. But transformation usually applies to points.
      scene.add(ghost);

      // 2. Transformed Cube
      // We will transform the mesh matrix directly
      const boxGeo = new THREE.BoxGeometry(1, 1, 1);
      const boxEdges = new THREE.EdgesGeometry(boxGeo);
      const box = new THREE.LineSegments(
        boxEdges,
        new THREE.LineBasicMaterial({ color: 0x38bdf8, linewidth: 2 })
      );
      // Add solid inner
      const boxSolid = new THREE.Mesh(
        boxGeo,
        new THREE.MeshBasicMaterial({
          color: 0x38bdf8,
          opacity: 0.1,
          transparent: true,
        })
      );
      box.add(boxSolid);

      // Basis Vectors
      const basisGroup = new THREE.Group();
      const arrowX = new THREE.ArrowHelper(
        new THREE.Vector3(1, 0, 0),
        new THREE.Vector3(0, 0, 0),
        1,
        0xf43f5e
      );
      const arrowY = new THREE.ArrowHelper(
        new THREE.Vector3(0, 1, 0),
        new THREE.Vector3(0, 0, 0),
        1,
        0x10b981
      );
      const arrowZ = new THREE.ArrowHelper(
        new THREE.Vector3(0, 0, 1),
        new THREE.Vector3(0, 0, 0),
        1,
        0x3b82f6
      );
      basisGroup.add(arrowX);
      basisGroup.add(arrowY);
      basisGroup.add(arrowZ);
      scene.add(basisGroup);

      // We want to apply the matrix transform to the 'basisGroup' and 'box'
      // But ArrowHelper scale handling is tricky.
      // Better to manually update direction and length of arrows.

      scene.add(box);

      function getMatrix() {
        return new THREE.Matrix4().set(
          parseFloat(document.getElementById("m11").value),
          parseFloat(document.getElementById("m12").value),
          parseFloat(document.getElementById("m13").value),
          0,
          parseFloat(document.getElementById("m21").value),
          parseFloat(document.getElementById("m22").value),
          parseFloat(document.getElementById("m23").value),
          0,
          parseFloat(document.getElementById("m31").value),
          parseFloat(document.getElementById("m32").value),
          parseFloat(document.getElementById("m33").value),
          0,
          0,
          0,
          0,
          1
        );
      }

      function update() {
        const m = getMatrix();

        // Update Box
        box.matrix.copy(m);
        box.matrixAutoUpdate = false;

        // Update Basis Vectors manually
        const e1 = new THREE.Vector3(1, 0, 0).applyMatrix4(m);
        const e2 = new THREE.Vector3(0, 1, 0).applyMatrix4(m);
        const e3 = new THREE.Vector3(0, 0, 1).applyMatrix4(m);

        if (e1.length() > 0.01) {
          arrowX.setDirection(e1.clone().normalize());
          arrowX.setLength(e1.length());
        }
        if (e2.length() > 0.01) {
          arrowY.setDirection(e2.clone().normalize());
          arrowY.setLength(e2.length());
        }
        if (e3.length() > 0.01) {
          arrowZ.setDirection(e3.clone().normalize());
          arrowZ.setLength(e3.length());
        }
      }

      window.setMatrix = (type) => {
        const presets = {
          identity: [1, 0, 0, 0, 1, 0, 0, 0, 1],
          scale: [2, 0, 0, 0, 2, 0, 0, 0, 2],
          shear: [1, 1, 0, 0, 1, 0, 0, 0, 1],
          rotateZ: [0, -1, 0, 1, 0, 0, 0, 0, 1],
        };
        const p = presets[type];
        document.getElementById("m11").value = p[0];
        document.getElementById("m12").value = p[1];
        document.getElementById("m13").value = p[2];
        document.getElementById("m21").value = p[3];
        document.getElementById("m22").value = p[4];
        document.getElementById("m23").value = p[5];
        document.getElementById("m31").value = p[6];
        document.getElementById("m32").value = p[7];
        document.getElementById("m33").value = p[8];
        update();
      };

      document
        .querySelectorAll("input")
        .forEach((i) => i.addEventListener("input", update));
      update();
      updateLanguage();

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
