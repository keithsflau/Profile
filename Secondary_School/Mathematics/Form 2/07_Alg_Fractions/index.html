<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fraction Simplifier | S2 Math</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Outfit", sans-serif;
      }
    </style>
  </head>
  <body class="bg-amber-50 text-slate-800 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      const App = () => {
        // Factors for Numerator and Denominator
        const [numFactors, setNumFactors] = useState([]);
        const [denFactors, setDenFactors] = useState([]);
        const [solved, setSolved] = useState(false);

        const generate = () => {
          // Generate a random algebraic fraction problem
          // e.g. (18 x^3 y) / (12 x y^2)
          // Expanded: 2*3*3 * x*x*x * y
          // Expanded: 2*2*3 * x * y*y

          const factors = ["2", "3", "5", "x", "y"];
          const makeSet = () => {
            const arr = [];
            const len = 4 + Math.floor(Math.random() * 4);
            for (let i = 0; i < len; i++)
              arr.push({
                id: Math.random(),
                val: factors[Math.floor(Math.random() * factors.length)],
                active: true,
              });
            return arr;
          };

          setNumFactors(makeSet());
          setDenFactors(makeSet());
          setSolved(false);
        };

        useEffect(() => generate(), []);

        const [selectedId, setSelectedId] = useState(null); // ID of first selected factor
        const [selectedLoc, setSelectedLoc] = useState(null); // 'num' or 'den'

        const clickFactor = (loc, id, val) => {
          if (!selectedId) {
            // First selection
            setSelectedId(id);
            setSelectedLoc(loc);
          } else {
            // Second selection
            if (selectedLoc === loc) {
              // Same location, deselect or switch
              setSelectedId(id);
              setSelectedLoc(loc);
            } else {
              // Different location, attempt cancel
              const otherList = loc === "num" ? numFactors : denFactors; // wait, otherList is WHERE ID IS? No.
              // We need to find value of First Selection

              // Let's simplified logic: find matched value
              // Find object of first
              let firstObj = null;
              if (selectedLoc === "num")
                firstObj = numFactors.find((f) => f.id === selectedId);
              else firstObj = denFactors.find((f) => f.id === selectedId);

              if (firstObj.val === val) {
                // Match! Cancel both
                setNumFactors((prev) =>
                  prev.map((f) =>
                    f.id === id || f.id === selectedId
                      ? { ...f, active: false }
                      : f
                  )
                );
                setDenFactors((prev) =>
                  prev.map((f) =>
                    f.id === id || f.id === selectedId
                      ? { ...f, active: false }
                      : f
                  )
                );
                setSelectedId(null);
                setSelectedLoc(null);
              } else {
                // No Match, reset
                setSelectedId(null);
                setSelectedLoc(null);
                // Shake animation?
              }
            }
          }
        };

        // Check if solved (no matching pairs remain)
        useEffect(() => {
          const activeNum = numFactors
            .filter((f) => f.active)
            .map((f) => f.val);
          const activeDen = denFactors
            .filter((f) => f.active)
            .map((f) => f.val);

          let possibleData = false;
          // Check if any item in activeNum is in activeDen
          for (let v of activeNum) {
            if (activeDen.includes(v)) {
              possibleData = true;
              break;
            }
          }
          setSolved(
            !possibleData && (activeNum.length > 0 || activeDen.length > 0)
          ); // Solved if no pairs left
        }, [numFactors, denFactors]);

        return (
          <div className="p-8 max-w-4xl mx-auto min-h-screen flex flex-col items-center">
            <header className="mb-8 text-center">
              <div className="text-amber-600 font-bold uppercase text-xs tracking-widest mb-2">
                Unit 4: Algebra & Estimation
              </div>
              <h1 className="text-4xl font-extrabold text-slate-900">
                Fraction Simplifier
              </h1>
              <p className="text-slate-500">
                Cancel common factors from Numerator and Denominator.
              </p>
            </header>

            <div className="w-full max-w-2xl bg-white p-12 rounded-3xl shadow-xl border border-amber-100 flex flex-col items-center">
              <div className="text-xs font-bold text-slate-400 uppercase mb-4">
                Click matches to cancel them
              </div>

              {/* Fraction Container */}
              <div className="flex flex-col items-center gap-4 text-3xl font-mono font-bold">
                {/* Numerator */}
                <div className="flex flex-wrap justify-center gap-2 p-4 min-h-[80px] w-full">
                  {numFactors.map((f) => (
                    <button
                      key={f.id}
                      onClick={() =>
                        f.active && clickFactor("num", f.id, f.val)
                      }
                      disabled={!f.active}
                      className={`w-12 h-12 rounded-lg flex items-center justify-center border-2 transition-all duration-300
                                            ${
                                              !f.active
                                                ? "opacity-20 bg-slate-100 border-slate-200"
                                                : selectedId === f.id
                                                ? "bg-amber-100 border-amber-500 scale-110 shadow-lg"
                                                : "bg-white border-slate-200 hover:border-amber-300 shadow-sm"
                                            }
                                        `}
                    >
                      {f.val}
                    </button>
                  ))}
                  {numFactors.filter((f) => f.active).length === 0 && (
                    <span className="text-slate-300">1</span>
                  )}
                </div>

                {/* Divider Line */}
                <div className="w-full h-1 bg-slate-800 rounded"></div>

                {/* Denominator */}
                <div className="flex flex-wrap justify-center gap-2 p-4 min-h-[80px] w-full">
                  {denFactors.map((f) => (
                    <button
                      key={f.id}
                      onClick={() =>
                        f.active && clickFactor("den", f.id, f.val)
                      }
                      disabled={!f.active}
                      className={`w-12 h-12 rounded-lg flex items-center justify-center border-2 transition-all duration-300
                                            ${
                                              !f.active
                                                ? "opacity-20 bg-slate-100 border-slate-200"
                                                : selectedId === f.id
                                                ? "bg-amber-100 border-amber-500 scale-110 shadow-lg"
                                                : "bg-white border-slate-200 hover:border-amber-300 shadow-sm"
                                            }
                                        `}
                    >
                      {f.val}
                    </button>
                  ))}
                  {denFactors.filter((f) => f.active).length === 0 && (
                    <span className="text-slate-300">1</span>
                  )}
                </div>
              </div>

              {solved && (
                <div className="mt-8 animate-fade-in-up text-center">
                  <div className="text-emerald-500 font-bold text-xl mb-4">
                    <i className="fa-solid fa-check-circle mr-2"></i> Fully
                    Simplified!
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl inline-block mb-4">
                    <div className="text-lg font-bold text-slate-600">
                      {numFactors
                        .filter((f) => f.active)
                        .map((f) => f.val)
                        .join(" • ") || "1"}
                    </div>
                    <div className="w-full h-px bg-slate-400 my-1"></div>
                    <div className="text-lg font-bold text-slate-600">
                      {denFactors
                        .filter((f) => f.active)
                        .map((f) => f.val)
                        .join(" • ") || "1"}
                    </div>
                  </div>
                  <button
                    onClick={generate}
                    className="block w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 transition shadow-lg"
                  >
                    New Problem
                  </button>
                </div>
              )}
            </div>

            <footer className="mt-8">
              <a
                href="../index.html"
                className="text-amber-600 hover:text-amber-700 font-bold"
              >
                <i className="fa-solid fa-arrow-left mr-2"></i> Back to
                Dashboard
              </a>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
