<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Probability Spinner | S2 Math</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Outfit", sans-serif;
      }
      @keyframes spin-slow {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(3600deg);
        }
      }
      .spinning {
        animation: spin-slow 4s cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
      }
    </style>
  </head>
  <body class="bg-indigo-900 text-white min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useRef } = React;

      const App = () => {
        const [segments, setSegments] = useState([
          { label: "Red", color: "#ef4444", count: 0 },
          { label: "Blue", color: "#3b82f6", count: 0 },
          { label: "Green", color: "#22c55e", count: 0 },
          { label: "Yellow", color: "#eab308", count: 0 },
        ]);
        const [spinning, setSpinning] = useState(false);
        const [result, setResult] = useState(null);
        const [rotation, setRotation] = useState(0);
        const spinnerRef = useRef(null);

        const numSegments = segments.length;
        const sliceAngle = 360 / numSegments;
        const cx = 150,
          cy = 150,
          r = 130;

        const spin = () => {
          if (spinning) return;
          setSpinning(true);
          setResult(null);

          // Random extra rotation (multiple full spins + random stop)
          const extraSpins = 5 + Math.random() * 5; // 5-10 full rotations
          const randomAngle = Math.random() * 360;
          const totalRotation = rotation + extraSpins * 360 + randomAngle;

          setRotation(totalRotation);

          setTimeout(() => {
            // Determine which segment the pointer lands on
            // Pointer is at TOP (0 degrees / 360). The wheel rotates clockwise.
            // Final angle mod 360 tells us where segment 0 ends up relative to pointer.
            // Segment 0 starts at -90deg (top). Need to invert logic.
            const normalizedAngle = (360 - (totalRotation % 360) + 90) % 360; // Angle where pointer points into wheel
            const landedIndex =
              Math.floor(normalizedAngle / sliceAngle) % numSegments;

            const updated = [...segments];
            updated[landedIndex].count++;
            setSegments(updated);
            setResult(segments[landedIndex]);
            setSpinning(false);
          }, 4000);
        };

        const reset = () => {
          setSegments(segments.map((s) => ({ ...s, count: 0 })));
          setResult(null);
        };

        // Generate pie slices
        const slices = segments.map((seg, i) => {
          const startAngle = i * sliceAngle - 90; // Start from top
          const endAngle = startAngle + sliceAngle;

          const startRad = (startAngle * Math.PI) / 180;
          const endRad = (endAngle * Math.PI) / 180;

          const x1 = cx + r * Math.cos(startRad);
          const y1 = cy + r * Math.sin(startRad);
          const x2 = cx + r * Math.cos(endRad);
          const y2 = cy + r * Math.sin(endRad);

          const largeArc = sliceAngle > 180 ? 1 : 0;
          const pathD = `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;

          // Label position
          const midAngle = ((startAngle + endAngle) / 2) * (Math.PI / 180);
          const lx = cx + r * 0.6 * Math.cos(midAngle);
          const ly = cy + r * 0.6 * Math.sin(midAngle);

          return { ...seg, pathD, lx, ly };
        });

        const totalSpins = segments.reduce((s, seg) => s + seg.count, 0);

        return (
          <div className="p-8 max-w-4xl mx-auto min-h-screen flex flex-col items-center">
            <header className="mb-8 text-center">
              <div className="text-indigo-400 font-bold uppercase text-xs tracking-widest mb-2">
                Unit 6: Data Handling
              </div>
              <h1 className="text-4xl font-extrabold text-white">
                Probability Spinner
              </h1>
              <p className="text-slate-400">
                Experimental vs Theoretical Probability.
              </p>
            </header>

            <div className="flex flex-col lg:flex-row gap-12 items-center w-full">
              {/* Spinner */}
              <div className="relative shrink-0">
                {/* Pointer */}
                <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2 z-10">
                  <div className="w-0 h-0 border-l-[15px] border-r-[15px] border-t-[25px] border-l-transparent border-r-transparent border-t-white drop-shadow-lg"></div>
                </div>

                <svg
                  width="300"
                  height="300"
                  className="drop-shadow-2xl transition-transform duration-[4000ms] ease-out"
                  style={{ transform: `rotate(${rotation}deg)` }}
                >
                  {slices.map((s, i) => (
                    <g key={i}>
                      <path
                        d={s.pathD}
                        fill={s.color}
                        stroke="white"
                        strokeWidth="2"
                      />
                      <text
                        x={s.lx}
                        y={s.ly}
                        textAnchor="middle"
                        dominantBaseline="middle"
                        className="fill-white text-sm font-bold pointer-events-none"
                      >
                        {s.label}
                      </text>
                    </g>
                  ))}
                  <circle cx={cx} cy={cy} r="15" fill="white" />
                </svg>
              </div>

              {/* Controls & Stats */}
              <div className="flex-1 w-full max-w-sm flex flex-col gap-6">
                <button
                  onClick={spin}
                  disabled={spinning}
                  className={`w-full py-4 rounded-2xl text-xl font-extrabold transition-all ${
                    spinning
                      ? "bg-slate-600 cursor-not-allowed"
                      : "bg-gradient-to-r from-pink-500 to-violet-500 hover:scale-105 shadow-lg"
                  }`}
                >
                  {spinning ? (
                    <>
                      <i className="fa-solid fa-spinner animate-spin mr-2"></i>{" "}
                      Spinning...
                    </>
                  ) : (
                    <>
                      <i className="fa-solid fa-play mr-2"></i> SPIN!
                    </>
                  )}
                </button>

                {result && (
                  <div className="bg-white/10 p-4 rounded-xl text-center animate-pulse border border-white/20">
                    <div className="text-xs uppercase text-slate-400">
                      Result
                    </div>
                    <div
                      className="text-2xl font-bold"
                      style={{ color: result.color }}
                    >
                      {result.label}
                    </div>
                  </div>
                )}

                {/* Results Table */}
                <div className="bg-white/5 rounded-xl border border-white/10 overflow-hidden">
                  <div className="grid grid-cols-3 bg-white/10 text-xs font-bold uppercase text-slate-400 p-3">
                    <div>Segment</div>
                    <div className="text-center">Count</div>
                    <div className="text-right">Exp. Prob</div>
                  </div>
                  {segments.map((s, i) => (
                    <div
                      key={i}
                      className="grid grid-cols-3 p-3 border-t border-white/5 items-center"
                    >
                      <div className="flex items-center gap-2">
                        <div
                          className="w-3 h-3 rounded-sm"
                          style={{ backgroundColor: s.color }}
                        ></div>
                        <span>{s.label}</span>
                      </div>
                      <div className="text-center font-bold">{s.count}</div>
                      <div className="text-right font-mono text-sm">
                        {totalSpins > 0
                          ? ((s.count / totalSpins) * 100).toFixed(1) + "%"
                          : "â€“"}
                      </div>
                    </div>
                  ))}
                </div>

                <div className="flex justify-between text-sm bg-white/10 p-4 rounded-xl">
                  <span>
                    Total Spins: <strong>{totalSpins}</strong>
                  </span>
                  <button
                    onClick={reset}
                    className="text-rose-400 hover:text-rose-300 font-bold"
                  >
                    <i className="fa-solid fa-rotate-left mr-1"></i> Reset
                  </button>
                </div>

                <div className="text-xs text-slate-400 bg-white/5 p-3 rounded-lg border border-white/10">
                  <strong>Theoretical:</strong> Each segment has P = 1/
                  {numSegments} = {(100 / numSegments).toFixed(1)}%. As spins
                  increase, experimental probability approaches theoretical.
                </div>
              </div>
            </div>

            <footer className="mt-8">
              <a
                href="../index.html"
                className="text-indigo-400 hover:text-indigo-300 font-bold"
              >
                <i className="fa-solid fa-arrow-left mr-2"></i> Back to
                Dashboard
              </a>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
