<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE ICT - Two's Complement Visualizer</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .mono {
        font-family: "JetBrains Mono", monospace;
      }
      .bit-switch {
        transition: all 0.2s;
        cursor: pointer;
      }
      .bit-switch:hover {
        transform: translateY(-2px);
      }
      .glow {
        box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
      }
      .glow-red {
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // --- LUCIDE ICON SHIM ---
      const LucideIcon = ({ name, size = 24, className = "" }) => {
        const formatName = (n) =>
          n
            .split("-")
            .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
            .join("");
        const iconName = formatName(name);

        const [svgHtml, setSvgHtml] = useState("");

        useEffect(() => {
          if (
            window.lucide &&
            window.lucide.icons &&
            window.lucide.icons[iconName] &&
            typeof window.lucide.icons[iconName].toSvg === "function"
          ) {
            setSvgHtml(
              window.lucide.icons[iconName].toSvg({
                width: size,
                height: size,
                class: className,
              })
            );
          }
        }, [name, size, className, iconName]);

        return (
          <span
            dangerouslySetInnerHTML={{ __html: svgHtml }}
            style={{ display: "inline-flex" }}
          />
        );
      };
      const Binary = (p) => <LucideIcon name="binary" {...p} />;
      const AlertTriangle = (p) => <LucideIcon name="alert-triangle" {...p} />;
      const Info = (p) => <LucideIcon name="info" {...p} />;
      // --- END SHIM ---

      const Bit = ({ val, onChange, label, isSign }) => (
        <div className="flex flex-col items-center gap-2">
          <div
            onClick={onChange}
            className={`w-12 h-16 rounded-lg flex items-center justify-center text-2xl font-bold mono bit-switch select-none border-2
                        ${
                          val
                            ? isSign
                              ? "bg-red-500/20 border-red-500 text-red-400 glow-red"
                              : "bg-cyan-500/20 border-cyan-500 text-cyan-400 glow"
                            : "bg-slate-800 border-slate-700 text-slate-600"
                        }
                    `}
          >
            {val ? 1 : 0}
          </div>
          <span className="text-xs text-slate-500 font-mono">{label}</span>
        </div>
      );

      const ByteDisplay = ({ value, onChange, readOnly = false }) => {
        const bits = value.toString(2).padStart(8, "0").split("").map(Number);
        const toggleBit = (idx) => {
          if (readOnly) return;
          const newBits = [...bits];
          newBits[idx] = newBits[idx] ? 0 : 1;
          onChange(parseInt(newBits.join(""), 2));
        };
        const signedValue = (val) => (val > 127 ? val - 256 : val);

        return (
          <div className="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
            <div className="flex gap-2 justify-center mb-6">
              {bits.map((b, i) => (
                <Bit
                  key={i}
                  val={b}
                  onChange={() => toggleBit(i)}
                  label={i === 0 ? "-128" : Math.pow(2, 7 - i)}
                  isSign={i === 0}
                />
              ))}
            </div>
            <div className="grid grid-cols-2 gap-4 text-center">
              <div className="p-3 bg-slate-800 rounded-lg">
                <div className="text-xs text-slate-500 uppercase tracking-wider mb-1">
                  Unsigned
                </div>
                <div className="text-xl font-mono text-cyan-400">{value}</div>
              </div>
              <div className="p-3 bg-slate-800 rounded-lg">
                <div className="text-xs text-slate-500 uppercase tracking-wider mb-1">
                  Signed (2's Comp)
                </div>
                <div className="text-xl font-mono text-white">
                  {signedValue(value)}
                </div>
              </div>
            </div>
          </div>
        );
      };

      const App = () => {
        const [numA, setNumA] = useState(0);
        const [numB, setNumB] = useState(0);
        const [mode, setMode] = useState("explore");

        const sum = numA + numB;
        const truncatedSum = sum & 255;
        const checkOverflow = (a, b, res) => {
          const signA = (a >> 7) & 1;
          const signB = (b >> 7) & 1;
          const signR = (res >> 7) & 1;
          return signA === signB && signA !== signR;
        };
        const isOverflow = checkOverflow(numA, numB, truncatedSum);

        return (
          <div className="min-h-screen bg-slate-900 text-slate-200 p-8 flex flex-col items-center">
            <header className="mb-10 text-center max-w-2xl">
              <div className="inline-flex items-center justify-center p-3 bg-blue-500/10 rounded-full mb-4">
                <Binary className="w-8 h-8 text-blue-400" />
              </div>
              <h1 className="text-3xl font-bold text-white mb-2">
                Two's Complement Visualizer
              </h1>
            </header>

            <div className="w-full max-w-3xl space-y-6">
              <div className="flex justify-center gap-4 mb-8">
                <button
                  onClick={() => {
                    setMode("explore");
                    setNumB(0);
                  }}
                  className={`px-6 py-2 rounded-full font-semibold transition-all ${
                    mode === "explore"
                      ? "bg-cyan-600 text-white shadow-lg shadow-cyan-500/25"
                      : "bg-slate-800 text-slate-400"
                  }`}
                >
                  Single Number
                </button>
                <button
                  onClick={() => setMode("add")}
                  className={`px-6 py-2 rounded-full font-semibold transition-all ${
                    mode === "add"
                      ? "bg-cyan-600 text-white shadow-lg shadow-cyan-500/25"
                      : "bg-slate-800 text-slate-400"
                  }`}
                >
                  Binary Addition
                </button>
              </div>

              <div className="relative">
                <div className="absolute -left-12 top-1/2 -translate-y-1/2 text-slate-500 font-mono text-xl">
                  A
                </div>
                <ByteDisplay value={numA} onChange={setNumA} />
              </div>

              {mode === "add" && (
                <div className="space-y-6 slide-in">
                  <div className="flex justify-center text-slate-500 text-2xl font-bold">
                    +
                  </div>
                  <div className="relative">
                    <div className="absolute -left-12 top-1/2 -translate-y-1/2 text-slate-500 font-mono text-xl">
                      B
                    </div>
                    <ByteDisplay value={numB} onChange={setNumB} />
                  </div>
                  <div className="border-t-2 border-slate-700 my-8"></div>
                  <div className="relative">
                    <div className="absolute -left-12 top-1/2 -translate-y-1/2 text-slate-500 font-mono text-xl">
                      =
                    </div>
                    <ByteDisplay
                      value={truncatedSum}
                      readOnly={true}
                      onChange={() => {}}
                    />
                    <div
                      className={`mt-6 p-4 rounded-xl border flex flex-col items-center justify-center text-center transition-colors ${
                        isOverflow
                          ? "bg-red-900/20 border-red-500/50"
                          : "bg-green-900/20 border-green-500/50"
                      }`}
                    >
                      <div className="text-xs uppercase tracking-wider font-bold mb-1 flex items-center gap-2">
                        {isOverflow ? (
                          <AlertTriangle size={16} className="text-red-500" />
                        ) : (
                          <Info size={16} className="text-green-500" />
                        )}
                        <span
                          className={
                            isOverflow ? "text-red-400" : "text-green-400"
                          }
                        >
                          Status
                        </span>
                      </div>
                      <div
                        className={`text-lg font-bold ${
                          isOverflow ? "text-red-300" : "text-slate-300"
                        }`}
                      >
                        {isOverflow ? "Overflow Detected!" : "Valid Result"}
                      </div>
                    </div>
                  </div>
                </div>
              )}
              {mode === "explore" && (
                <div className="mt-8 p-6 bg-slate-800 rounded-lg border border-slate-700">
                  <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <Info className="w-5 h-5 text-cyan-400" /> Concept Guide
                  </h3>
                  <ul className="space-y-2 text-sm text-slate-300 list-disc list-inside">
                    <li>
                      The{" "}
                      <strong className="text-red-400">
                        Most Significant Bit (MSB)
                      </strong>{" "}
                      is the Sign Bit (-128).
                    </li>
                    <li>
                      If MSB is 0, the number is positive. If 1, it is negative.
                    </li>
                    <li>
                      To find the negative value manually: "Invert all bits and
                      add 1".
                    </li>
                    <li>
                      Range of 8-bit Two's Complement:{" "}
                      <strong className="text-white">-128 to +127</strong>.
                    </li>
                  </ul>
                </div>
              )}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
