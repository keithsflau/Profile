<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE 2025 Paper 1B Q10 - While Loop Tracer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #0f172a;
        color: #e2e8f0;
      }
      .mono {
        font-family: "JetBrains Mono", monospace;
      }
      .flowchart-box {
        background: #f8f9fa;
        border-radius: 12px;
      }
      .node-active {
        animation: glow 0.5s ease-in-out infinite alternate;
      }
      @keyframes glow {
        from {
          filter: drop-shadow(0 0 5px #8b5cf6);
        }
        to {
          filter: drop-shadow(0 0 12px #7c3aed);
        }
      }
      .line-active {
        stroke: #8b5cf6 !important;
        stroke-width: 3 !important;
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8">
    <div id="root" class="w-full max-w-6xl mx-auto"></div>
    <script type="text/babel">
      const { useState, useRef } = React;

      // While Loop Flowchart based on exam question
      const WhileLoopFlowchart = ({ activeStep, activeLine }) => {
        const W = 280,
          H = 420;
        const cx = W / 2;
        const isActive = (s) => activeStep === s;
        const stroke = (s) => (isActive(s) ? "#7c3aed" : "#374151");
        const fill = (s) => (isActive(s) ? "#ede9fe" : "#fff");
        const lineClass = (l) => (activeLine === l ? "line-active" : "");

        return (
          <div className="flowchart-box p-4" style={{ width: W, height: H }}>
            <svg
              width={W - 32}
              height={H - 16}
              viewBox={`0 0 ${W - 32} ${H - 16}`}
            >
              {/* Start */}
              <ellipse
                cx={cx - 16}
                cy="25"
                rx="40"
                ry="18"
                fill={fill(1)}
                stroke={stroke(1)}
                strokeWidth="2"
                className={isActive(1) ? "node-active" : ""}
              />
              <text
                x={cx - 16}
                y="30"
                textAnchor="middle"
                fontSize="13"
                fill="#1f2937"
                fontWeight="bold"
              >
                Start
              </text>

              {/* Line: Start -> i=0 */}
              <line
                x1={cx - 16}
                y1="43"
                x2={cx - 16}
                y2="60"
                stroke="#374151"
                strokeWidth="2"
                className={lineClass(1)}
                markerEnd="url(#arrWL)"
              />

              {/* i = 0 */}
              <rect
                x={cx - 66}
                y="65"
                width="100"
                height="35"
                rx="3"
                fill={fill(2)}
                stroke={stroke(2)}
                strokeWidth="2"
                className={isActive(2) ? "node-active" : ""}
              />
              <text
                x={cx - 16}
                y="88"
                textAnchor="middle"
                fontSize="13"
                fill="#1f2937"
                fontWeight="bold"
              >
                i ← 0
              </text>

              {/* Line: i=0 -> While condition */}
              <line
                x1={cx - 16}
                y1="100"
                x2={cx - 16}
                y2="120"
                stroke="#374151"
                strokeWidth="2"
                className={lineClass(2)}
                markerEnd="url(#arrWL)"
              />

              {/* While i < n (Decision) */}
              <polygon
                points={`${cx - 16},125 ${cx + 44},165 ${cx - 16},205 ${
                  cx - 76
                },165`}
                fill={fill(3)}
                stroke={stroke(3)}
                strokeWidth="2"
                className={isActive(3) ? "node-active" : ""}
              />
              <text
                x={cx - 16}
                y="162"
                textAnchor="middle"
                fontSize="12"
                fill="#1f2937"
                fontWeight="bold"
              >
                i &lt; n ?
              </text>
              <text
                x={cx - 16}
                y="176"
                textAnchor="middle"
                fontSize="10"
                fill="#6b7280"
              >
                (while)
              </text>

              {/* Yes -> Process */}
              <line
                x1={cx - 16}
                y1="205"
                x2={cx - 16}
                y2="225"
                stroke="#22c55e"
                strokeWidth="2"
                className={lineClass(3)}
                markerEnd="url(#arrG)"
              />
              <text
                x={cx - 8}
                y="218"
                fontSize="10"
                fill="#22c55e"
                fontWeight="bold"
              >
                Yes
              </text>

              {/* No -> End */}
              <line
                x1={cx + 44}
                y1="165"
                x2={cx + 90}
                y2="165"
                stroke="#ef4444"
                strokeWidth="2"
              />
              <text
                x={cx + 55}
                y="158"
                fontSize="10"
                fill="#ef4444"
                fontWeight="bold"
              >
                No
              </text>
              <line
                x1={cx + 90}
                y1="165"
                x2={cx + 90}
                y2="370"
                stroke="#ef4444"
                strokeWidth="2"
              />
              <line
                x1={cx + 90}
                y1="370"
                x2={cx - 16}
                y2="370"
                stroke="#ef4444"
                strokeWidth="2"
                markerEnd="url(#arrR)"
              />

              {/* Process: sum = sum + A[i] */}
              <rect
                x={cx - 86}
                y="230"
                width="140"
                height="35"
                rx="3"
                fill={fill(4)}
                stroke={stroke(4)}
                strokeWidth="2"
                className={isActive(4) ? "node-active" : ""}
              />
              <text
                x={cx - 16}
                y="253"
                textAnchor="middle"
                fontSize="12"
                fill="#1f2937"
                fontWeight="bold"
              >
                sum ← sum + A[i]
              </text>

              {/* Line: Process -> i++ */}
              <line
                x1={cx - 16}
                y1="265"
                x2={cx - 16}
                y2="285"
                stroke="#374151"
                strokeWidth="2"
                className={lineClass(4)}
                markerEnd="url(#arrWL)"
              />

              {/* i = i + 1 */}
              <rect
                x={cx - 66}
                y="290"
                width="100"
                height="35"
                rx="3"
                fill={fill(5)}
                stroke={stroke(5)}
                strokeWidth="2"
                className={isActive(5) ? "node-active" : ""}
              />
              <text
                x={cx - 16}
                y="313"
                textAnchor="middle"
                fontSize="13"
                fill="#1f2937"
                fontWeight="bold"
              >
                i ← i + 1
              </text>

              {/* Loop back to while */}
              <line
                x1={cx - 16}
                y1="325"
                x2={cx - 16}
                y2="340"
                stroke="#374151"
                strokeWidth="2"
              />
              <line
                x1={cx - 16}
                y1="340"
                x2={cx - 110}
                y2="340"
                stroke="#374151"
                strokeWidth="2"
              />
              <line
                x1={cx - 110}
                y1="340"
                x2={cx - 110}
                y2="165"
                stroke="#374151"
                strokeWidth="2"
              />
              <line
                x1={cx - 110}
                y1="165"
                x2={cx - 76}
                y2="165"
                stroke="#374151"
                strokeWidth="2"
                markerEnd="url(#arrWL)"
              />

              {/* End */}
              <ellipse
                cx={cx - 16}
                cy="380"
                rx="40"
                ry="18"
                fill={fill(6)}
                stroke={stroke(6)}
                strokeWidth="2"
                className={isActive(6) ? "node-active" : ""}
              />
              <text
                x={cx - 16}
                y="385"
                textAnchor="middle"
                fontSize="13"
                fill="#1f2937"
                fontWeight="bold"
              >
                End
              </text>

              <defs>
                <marker
                  id="arrWL"
                  markerWidth="8"
                  markerHeight="8"
                  refX="6"
                  refY="3"
                  orient="auto"
                >
                  <path d="M0,0 L0,6 L6,3 z" fill="#374151" />
                </marker>
                <marker
                  id="arrG"
                  markerWidth="8"
                  markerHeight="8"
                  refX="6"
                  refY="3"
                  orient="auto"
                >
                  <path d="M0,0 L0,6 L6,3 z" fill="#22c55e" />
                </marker>
                <marker
                  id="arrR"
                  markerWidth="8"
                  markerHeight="8"
                  refX="6"
                  refY="3"
                  orient="auto"
                >
                  <path d="M0,0 L0,6 L6,3 z" fill="#ef4444" />
                </marker>
              </defs>
            </svg>
          </div>
        );
      };

      const App = () => {
        const [n, setN] = useState(4);
        const [array, setArray] = useState([3, 7, 2, 5]);
        const [step, setStep] = useState(0);
        const [vars, setVars] = useState({ i: 0, sum: 0 });
        const [trace, setTrace] = useState([]);
        const [isRunning, setIsRunning] = useState(false);
        const timerRef = useRef(null);

        const runTrace = () => {
          if (isRunning) return;
          setIsRunning(true);
          setStep(0);
          setVars({ i: 0, sum: 0 });
          setTrace([]);

          const A = array.slice(0, n);
          const steps = [];

          // Start
          steps.push({ step: 1, i: "-", sum: "-", log: "Start" });
          // i = 0
          steps.push({ step: 2, i: 0, sum: 0, log: "i ← 0, sum ← 0" });

          let i = 0,
            sum = 0;
          while (i < n) {
            // Check condition
            steps.push({ step: 3, i, sum, log: `i < n? ${i} < ${n} = Yes` });
            // sum = sum + A[i]
            sum = sum + A[i];
            steps.push({
              step: 4,
              i,
              sum,
              log: `sum ← sum + A[${i}] = ${sum}`,
            });
            // i++
            i++;
            steps.push({ step: 5, i, sum, log: `i ← i + 1 = ${i}` });
          }
          // Final check
          steps.push({
            step: 3,
            i,
            sum,
            log: `i < n? ${i} < ${n} = No → Exit`,
          });
          // End
          steps.push({ step: 6, i, sum, log: `End. Final sum = ${sum}` });

          let idx = 0;
          timerRef.current = setInterval(() => {
            if (idx >= steps.length) {
              clearInterval(timerRef.current);
              setIsRunning(false);
              return;
            }
            setStep(steps[idx].step);
            setVars({ i: steps[idx].i, sum: steps[idx].sum });
            setTrace((prev) => [...prev, steps[idx].log]);
            idx++;
          }, 700);
        };

        return (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="space-y-4">
              <div className="text-center">
                <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-900/30 border border-purple-500/30 text-purple-400 font-bold">
                  HKDSE 2025 Paper 1B Q10
                </div>
                <h1 className="text-2xl font-bold text-white mt-2">
                  While Loop Tracer
                </h1>
              </div>

              <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                <div className="mb-4">
                  <label className="text-xs text-purple-400 font-bold block mb-1">
                    Array A (comma separated):
                  </label>
                  <input
                    type="text"
                    value={array.join(", ")}
                    onChange={(e) =>
                      setArray(
                        e.target.value
                          .split(",")
                          .map((x) => parseInt(x.trim()) || 0)
                      )
                    }
                    className="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 font-mono"
                  />
                </div>
                <div className="mb-4">
                  <label className="text-xs text-purple-400 font-bold block mb-1">
                    n (array length to process):
                  </label>
                  <input
                    type="number"
                    value={n}
                    onChange={(e) => setN(parseInt(e.target.value) || 1)}
                    className="w-24 bg-slate-900 border border-slate-600 rounded px-3 py-2 font-mono text-center"
                  />
                </div>
                <button
                  onClick={runTrace}
                  disabled={isRunning}
                  className={`w-full py-3 rounded-lg font-bold ${
                    isRunning
                      ? "bg-slate-700 text-slate-500"
                      : "bg-purple-600 hover:bg-purple-500 text-white"
                  }`}
                >
                  {isRunning ? "Tracing..." : "▶ Trace While Loop"}
                </button>
              </div>

              <div className="bg-slate-900 p-4 rounded-xl border border-slate-700">
                <div className="grid grid-cols-2 gap-4 mb-4">
                  <div className="bg-slate-800 p-3 rounded-lg text-center">
                    <div className="text-xs text-slate-400">i</div>
                    <div className="text-3xl font-mono text-purple-400">
                      {vars.i}
                    </div>
                  </div>
                  <div className="bg-slate-800 p-3 rounded-lg text-center">
                    <div className="text-xs text-slate-400">sum</div>
                    <div className="text-3xl font-mono text-green-400">
                      {vars.sum}
                    </div>
                  </div>
                </div>

                <div className="mb-4">
                  <div className="text-xs text-slate-400 mb-2">
                    Array State:
                  </div>
                  <div className="flex gap-2">
                    {array.slice(0, n).map((val, idx) => (
                      <div
                        key={idx}
                        className={`w-12 h-12 flex items-center justify-center rounded border-2 font-mono font-bold ${
                          vars.i !== "-" && idx === vars.i
                            ? "bg-purple-600 border-purple-400 text-white"
                            : vars.i !== "-" && idx < vars.i
                            ? "bg-green-900/50 border-green-600 text-green-400"
                            : "bg-slate-800 border-slate-600 text-slate-300"
                        }`}
                      >
                        {val}
                      </div>
                    ))}
                  </div>
                </div>

                <div className="h-40 overflow-y-auto bg-slate-950 p-2 rounded font-mono text-xs space-y-1">
                  {trace.map((l, i) => (
                    <div
                      key={i}
                      className="border-l-2 border-purple-500/50 pl-2 text-slate-300"
                    >
                      ▸ {l}
                    </div>
                  ))}
                  {trace.length === 0 && (
                    <span className="text-slate-600 italic">Ready...</span>
                  )}
                </div>
              </div>
            </div>

            <div className="flex justify-center items-start">
              <WhileLoopFlowchart activeStep={step} />
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
