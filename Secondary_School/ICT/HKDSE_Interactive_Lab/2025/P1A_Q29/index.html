<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE 2025 Paper 1A Q29 - 流程圖 M1 vs M2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans TC", "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      /* Flowchart overrides for paper style */
      .mermaid .node rect,
      .mermaid .node polygon,
      .mermaid .node circle,
      .mermaid .node path {
        fill: #ffffff;
        stroke: #000000;
        stroke-width: 2px;
      }
      .mermaid .edgePath .path {
        stroke: #000000 !important;
        stroke-width: 2px !important;
      }
      .mermaid .marker {
        fill: #000000 !important;
        stroke: #000000 !important;
      }

      /* Active state overrides */
      g.activeNode > rect,
      g.activeNode > polygon,
      g.activeNode > circle,
      g.activeNode > path {
        fill: #fef3c7 !important;
        stroke: #f59e0b !important;
        stroke-width: 3px !important;
        filter: drop-shadow(0 0 5px #fbbf24);
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div id="root" class="w-full max-w-6xl"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // Initialize mermaid
      mermaid.initialize({
        startOnLoad: false,
        theme: "base",
        flowchart: {
          curve: "linear",
          padding: 20,
          nodeSpacing: 50,
          rankSpacing: 50,
        },
        themeVariables: {
          primaryColor: "#ffffff",
          primaryBorderColor: "#000000",
          lineColor: "#000000",
          fontFamily: '"Noto Sans TC", "Inter", sans-serif',
        },
      });

      const MermaidDiagram = ({ id, chartDefinition, activeStep }) => {
        const containerRef = useRef(null);

        useEffect(() => {
          if (containerRef.current) {
            // Uniquely identify each render to avoid conflicts
            const uniqueId = `${id}-${Date.now()}`;

            // Inject class for active step
            // We append the styling to the chart definition
            let highlightStyle = "";
            if (activeStep > 0) {
              highlightStyle = `\nclass N${activeStep} activeNode;`;
            }

            const finalChart = `
              ${chartDefinition}
              classDef activeNode fill:#fef3c7,stroke:#f59e0b,stroke-width:3px;
              classDef hidden width:0px,height:0px,opacity:0;
              ${highlightStyle}
            `;

            // Reset container
            containerRef.current.innerHTML = "";

            // Using mermaid.render which returns an object { svg }
            // We need a temporary element ID for mermaid to render into (it removes it after, usually, but creates a specific ID div)
            try {
              mermaid.render(uniqueId, finalChart).then((result) => {
                containerRef.current.innerHTML = result.svg;
              });
            } catch (e) {
              console.error("Mermaid render error:", e);
            }
          }
        }, [id, chartDefinition, activeStep]);

        return (
          <div ref={containerRef} className="flex justify-center w-full" />
        );
      };

      const App = () => {
        const [m1Step, setM1Step] = useState(0);
        const [m2Step, setM2Step] = useState(0);
        const [m1State, setM1State] = useState({ N: 0, output: 0 });
        const [m2State, setM2Step_State] = useState({ N: 0, output: 0 });
        const [isRunning, setIsRunning] = useState(false);
        const [finished, setFinished] = useState(false);
        const timerRef = useRef(null);

        // M1 Graph Definition
        // Do-While
        const m1Chart = `
          flowchart TD
            Start(( )):::hidden --> N1
            N1[N ← N - 5] --> N2[/輸出<br/>一罐汽水/]
            N2 --> N3{N > 4}
            N3 -- 是 --> N1
            N3 -- 否 --> End(( )):::hidden
            linkStyle default stroke-width:2px,fill:none,stroke:black;
        `;

        // M2 Graph Definition
        // While
        const m2Chart = `
          flowchart TD
            Start(( )):::hidden --> N1
            N1{N > 4} -- 是 --> N2[N ← N - 5]
            N2 --> N3[/輸出<br/>一罐汽水/]
            N3 --> N1
            N1 -- 否 --> End(( )):::hidden
            linkStyle default stroke-width:2px,fill:none,stroke:black;
        `;

        const runTrace = () => {
          if (isRunning) return;
          setIsRunning(true);
          setFinished(false);
          setM1Step(0);
          setM2Step(0);
          setM1State({ N: 0, output: 0 });
          setM2Step_State({ N: 0, output: 0 });

          const m1Sequence = [
            { step: 1, N: -5, output: 0 },
            { step: 2, N: -5, output: 1 },
            { step: 3, N: -5, output: 1 },
            { step: 0, N: -5, output: 1 },
          ];

          const m2Sequence = [
            { step: 1, N: 0, output: 0 },
            { step: 0, N: 0, output: 0 },
          ];

          let i = 0;
          timerRef.current = setInterval(() => {
            if (i >= Math.max(m1Sequence.length, m2Sequence.length)) {
              clearInterval(timerRef.current);
              setIsRunning(false);
              setFinished(true);
              return;
            }
            if (i < m1Sequence.length) {
              setM1Step(m1Sequence[i].step);
              setM1State({ N: m1Sequence[i].N, output: m1Sequence[i].output });
            }
            if (i < m2Sequence.length) {
              setM2Step(m2Sequence[i].step);
              setM2Step_State({
                N: m2Sequence[i].N,
                output: m2Sequence[i].output,
              });
            }
            i++;
          }, 1200);
        };

        return (
          <div className="space-y-6 w-full max-w-5xl mx-auto">
            <header className="text-center">
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-cyan-900/30 border border-cyan-500/30 text-cyan-400 font-bold mb-4">
                <span className="w-2 h-2 rounded-full bg-cyan-400 animate-pulse"></span>
                HKDSE 2025 Paper 1A Q29
              </div>

              <div className="bg-slate-800/80 p-6 rounded-2xl border border-slate-700 text-left mb-6">
                <h2 className="text-xl font-bold text-white mb-3">
                  題目 Question
                </h2>
                <p className="text-slate-300 mb-2">
                  假設 N = 0。以下哪句是正確的？
                </p>
                <p className="text-slate-400 text-sm">
                  Assume N = 0. Which of the following statements is correct?
                </p>
                <div className="grid grid-cols-2 gap-4 mt-4 text-sm">
                  <div
                    className={`p-3 rounded ${
                      finished && m1State.output === 1 && m2State.output === 1
                        ? "bg-red-900/30 text-red-400"
                        : "text-slate-400"
                    }`}
                  >
                    A. 兩部機都輸出 1 罐汽水
                  </div>
                  <div
                    className={`p-3 rounded ${
                      finished && m1State.output === 0 && m2State.output === 0
                        ? "bg-red-900/30 text-red-400"
                        : "text-slate-400"
                    }`}
                  >
                    B. 兩部機都不輸出汽水
                  </div>
                  <div
                    className={`p-3 rounded border ${
                      finished && m1State.output === 1 && m2State.output === 0
                        ? "bg-green-900/30 text-green-400 border-green-500"
                        : "border-transparent text-slate-400"
                    }`}
                  >
                    <span className="font-bold">
                      C. 只有 M1 輸出 1 罐汽水 ✓
                    </span>
                  </div>
                  <div
                    className={`p-3 rounded ${
                      finished && m1State.output === 0 && m2State.output === 1
                        ? "bg-red-900/30 text-red-400"
                        : "text-slate-400"
                    }`}
                  >
                    D. 只有 M2 輸出 1 罐汽水
                  </div>
                </div>
              </div>
            </header>

            <div className="grid md:grid-cols-2 gap-8">
              {/* M1 Column */}
              <div className="flex flex-col items-center">
                <h3 className="text-lg font-bold text-white mb-2">M1</h3>
                <div className="bg-white p-4 rounded-lg w-full max-w-[400px] min-h-[450px] flex items-start justify-center overflow-hidden">
                  <MermaidDiagram
                    id="m1-chart"
                    chartDefinition={m1Chart}
                    activeStep={m1Step}
                  />
                </div>
                <div className="mt-4 bg-slate-800 p-3 rounded-lg w-full max-w-[350px]">
                  <div className="text-sm text-slate-400">M1 狀態</div>
                  <div className="text-lg font-mono">
                    N = <span className="text-yellow-400">{m1State.N}</span> |
                    輸出 ={" "}
                    <span className="text-green-400">{m1State.output}</span>
                  </div>
                </div>
              </div>

              {/* M2 Column */}
              <div className="flex flex-col items-center">
                <h3 className="text-lg font-bold text-white mb-2">M2</h3>
                <div className="bg-white p-4 rounded-lg w-full max-w-[400px] min-h-[450px] flex items-start justify-center overflow-hidden">
                  <MermaidDiagram
                    id="m2-chart"
                    chartDefinition={m2Chart}
                    activeStep={m2Step}
                  />
                </div>
                <div className="mt-4 bg-slate-800 p-3 rounded-lg w-full max-w-[350px]">
                  <div className="text-sm text-slate-400">M2 狀態</div>
                  <div className="text-lg font-mono">
                    N = <span className="text-yellow-400">{m2State.N}</span> |
                    輸出 ={" "}
                    <span className="text-orange-400">{m2State.output}</span>
                  </div>
                </div>
              </div>
            </div>

            <div className="text-center pt-8">
              <button
                onClick={runTrace}
                disabled={isRunning}
                className={`px-8 py-3 rounded-full font-bold text-lg transition-all ${
                  isRunning
                    ? "bg-slate-700 text-slate-500"
                    : "bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/30"
                }`}
              >
                {isRunning ? "追蹤中..." : "▶ 開始追蹤 (N=0)"}
              </button>
            </div>

            {finished && (
              <div className="text-center p-6 bg-green-900/20 border border-green-500/30 rounded-xl animate-pulse mt-8">
                <p className="text-green-300 font-bold text-xl mb-2">
                  分析結果 Result
                </p>
                <div className="text-slate-300 space-y-2">
                  <p>
                    <strong>M1 (Do-While)</strong>：先執行 N=N-5
                    (-5)，輸出，然後檢查 -5 &gt; 4 (否)。
                    <br />
                    結果：輸出 1 罐汽水。
                  </p>
                  <p>
                    <strong>M2 (While)</strong>：先檢查 0 &gt; 4 (否)。
                    <br />
                    結果：條件不成立，完全無輸出。
                  </p>
                </div>
                <p className="text-yellow-400 font-bold mt-4 text-lg">
                  答案 Answer: C
                </p>
              </div>
            )}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
