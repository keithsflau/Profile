<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE 2025 Paper 1B Q6 - Array Manipulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .array-cell {
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .highlight-source {
        border-color: #3b82f6;
        background-color: rgba(59, 130, 246, 0.2);
        transform: scale(1.1);
      }
      .highlight-target {
        border-color: #22c55e;
        background-color: rgba(34, 197, 94, 0.2);
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div id="root" class="w-full max-w-5xl"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const LucideIcon = ({ name, size = 20, className = "" }) => {
        const formatName = (n) =>
          n
            .split("-")
            .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
            .join("");
        const iconName = formatName(name);
        const [svgHtml, setSvgHtml] = useState("");
        useEffect(() => {
          if (window.lucide?.icons[iconName]?.toSvg) {
            setSvgHtml(
              window.lucide.icons[iconName].toSvg({
                width: size,
                height: size,
                class: className,
              })
            );
          }
        }, [name]);
        return (
          <span
            dangerouslySetInnerHTML={{ __html: svgHtml }}
            style={{ display: "inline-flex" }}
          />
        );
      };

      const ArrayVisualizer = ({
        initialArray,
        algorithm,
        title,
        description,
        codeValues,
      }) => {
        const [s1] = useState(initialArray);
        const [s2, setS2] = useState(Array(5).fill(""));
        const [step, setStep] = useState(-1); // -1: ready, 0-4: steps, 5: complete
        const [isPlaying, setIsPlaying] = useState(false);
        const timerRef = useRef(null);

        const reset = () => {
          setS2(Array(5).fill(""));
          setStep(-1);
          setIsPlaying(false);
          clearInterval(timerRef.current);
        };

        const nextStep = () => {
          setStep((prev) => {
            const next = prev + 1;
            if (next >= 5) {
              setIsPlaying(false);
              clearInterval(timerRef.current);
              return 5; // Done
            }

            // Logic execution based on algorithm type
            setS2((prevS2) => {
              const newS2 = [...prevS2];
              if (algorithm === "reverse") {
                // s2[4-i] = s1[i]
                newS2[4 - next] = s1[next];
              } else if (algorithm === "shift") {
                // Part B: Cyclic Shift
                // i=0..3: s2[i] = s1[i+1]
                // Step 4 (last step): s2[4] = ch (s1[0])
                if (next < 4) {
                  newS2[next] = s1[next + 1];
                } else {
                  newS2[4] = s1[0];
                }
              }
              return newS2;
            });
            return next;
          });
        };

        const togglePlay = () => {
          if (isPlaying) {
            clearInterval(timerRef.current);
            setIsPlaying(false);
          } else {
            if (step >= 5) reset(); // Auto reset if finished
            setIsPlaying(true);
            timerRef.current = setInterval(nextStep, 1000);
          }
        };

        // Auto-stop when done
        useEffect(() => {
          if (step >= 5) {
            clearInterval(timerRef.current);
            setIsPlaying(false);
          }
        }, [step]);

        // Helper for rendering code highlights
        const getCodeHighlight = (lineIndex) => {
          if (step === -1 || step === 5) return "";
          // Simplified mapping: just highlight the loop body when running
          return "bg-yellow-900/40 text-yellow-200 font-bold";
        };

        return (
          <div className="bg-slate-800/50 p-6 rounded-2xl border border-slate-700 flex flex-col gap-6 w-full">
            <div className="flex justify-between items-start">
              <div>
                <h3 className="text-xl font-bold text-white flex items-center gap-2">
                  <LucideIcon name="code-2" className="text-blue-400" />
                  {title}
                </h3>
                <p className="text-slate-400 text-sm mt-1">{description}</p>
              </div>
              <div className="flex gap-2">
                <button
                  onClick={reset}
                  className="p-2 rounded bg-slate-700 hover:bg-slate-600 text-slate-300 transition-colors"
                >
                  <LucideIcon name="rotate-ccw" size={18} />
                </button>
                <button
                  onClick={togglePlay}
                  className={`px-4 py-2 rounded font-bold text-white flex items-center gap-2 transition-all ${
                    isPlaying
                      ? "bg-red-600 hover:bg-red-500"
                      : "bg-green-600 hover:bg-green-500"
                  }`}
                >
                  {isPlaying ? (
                    <>
                      <LucideIcon name="pause" size={18} /> Pause
                    </>
                  ) : step >= 5 ? (
                    <>
                      <LucideIcon name="play" size={18} /> Replay
                    </>
                  ) : (
                    <>
                      <LucideIcon name="play" size={18} /> Start
                    </>
                  )}
                </button>
              </div>
            </div>

            {/* Arrays */}
            <div className="flex flex-col gap-8 items-center py-4">
              {/* Array s1 */}
              <div className="flex gap-2 relative">
                <span className="absolute -left-10 top-2 font-mono text-slate-400 font-bold">
                  s1
                </span>
                {s1.map((val, idx) => (
                  <div
                    key={idx}
                    className={`w-12 h-12 md:w-16 md:h-16 flex items-center justify-center rounded border-2 text-xl md:text-2xl font-bold font-mono transition-all array-cell ${
                      step >= 0 &&
                      step < 5 &&
                      ((algorithm === "reverse" && idx === step) ||
                        (algorithm === "shift" &&
                          ((step < 4 && idx === step + 1) ||
                            (step === 4 && idx === 0))))
                        ? "highlight-source text-blue-400 border-blue-500"
                        : "bg-slate-900 border-slate-700 text-slate-500"
                    }`}
                  >
                    {val}
                  </div>
                ))}
              </div>

              <LucideIcon
                name="arrow-down"
                className="text-slate-600"
                size={32}
              />

              {/* Array s2 */}
              <div className="flex gap-2 relative">
                <span className="absolute -left-10 top-2 font-mono text-slate-400 font-bold">
                  s2
                </span>
                {s2.map((val, idx) => (
                  <div
                    key={idx}
                    className={`w-12 h-12 md:w-16 md:h-16 flex items-center justify-center rounded border-2 text-xl md:text-2xl font-bold font-mono transition-all array-cell ${
                      step >= 0 &&
                      step < 5 &&
                      ((algorithm === "reverse" && idx === 4 - step) ||
                        (algorithm === "shift" &&
                          ((step < 4 && idx === step) ||
                            (step === 4 && idx === 4))))
                        ? "highlight-target text-green-400 border-green-500 scale-110 shadow-[0_0_15px_rgba(34,197,94,0.4)]"
                        : "bg-slate-900 border-slate-700 text-white"
                    }`}
                  >
                    {val}
                  </div>
                ))}
              </div>
            </div>

            {/* Code Block Display */}
            <div className="bg-black/40 p-4 rounded-xl font-mono text-xs md:text-sm border border-slate-700 overflow-x-auto">
              {algorithm === "reverse" ? (
                <>
                  <div className="text-slate-500">
                    # Part (a) - Python Version
                  </div>
                  <div
                    className={
                      step >= 0 && step < 5
                        ? "text-yellow-300"
                        : "text-slate-400"
                    }
                  >
                    for i in range(0, 5):{" "}
                    <span className="text-slate-500 ml-4">
                      // Current i = {step >= 0 && step < 5 ? step : "-"}
                    </span>
                  </div>
                  <div
                    className={`pl-4 ${
                      step >= 0 && step < 5
                        ? "text-green-400 font-bold"
                        : "text-slate-400"
                    }`}
                  >
                    s2[4-i] = s1[i]{" "}
                    <span className="text-slate-500 ml-4">
                      // s2[{step >= 0 && step < 5 ? 4 - step : "-"}] = '
                      {step >= 0 && step < 5 ? s1[step] : "-"}'
                    </span>
                  </div>
                </>
              ) : (
                <>
                  <div className="text-slate-500">
                    # Part (b) - Python Version
                  </div>
                  <div className="text-slate-400">
                    ch = s1[0]{" "}
                    <span className="text-slate-500 ml-4">// ch = 'S'</span>
                  </div>
                  <div
                    className={
                      step >= 0 && step < 4
                        ? "text-yellow-300"
                        : "text-slate-400"
                    }
                  >
                    for i in range(0, 4):{" "}
                    <span className="text-slate-500 ml-4">
                      // Current i = {step >= 0 && step < 4 ? step : "-"}
                    </span>
                  </div>
                  <div
                    className={`pl-4 ${
                      step >= 0 && step < 4
                        ? "text-green-400 font-bold"
                        : "text-slate-400"
                    }`}
                  >
                    s2[i] = s1[i+1]{" "}
                    <span className="text-slate-500 ml-4">
                      // s2[{step >= 0 && step < 4 ? step : "-"}] = '
                      {step >= 0 && step < 4 ? s1[step + 1] : "-"}'
                    </span>
                  </div>
                  <div
                    className={
                      step === 4 ? "text-green-400 font-bold" : "text-slate-400"
                    }
                  >
                    s2[4] = ch{" "}
                    <span className="text-slate-500 ml-4">// s2[4] = 'S'</span>
                  </div>
                </>
              )}
            </div>
          </div>
        );
      };

      const App = () => {
        return (
          <div className="space-y-6 animate-fade-in w-full max-w-4xl mx-auto p-4 flex flex-col items-center">
            <header className="text-center space-y-4 max-w-3xl w-full">
              <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-900/30 border border-indigo-500/30 text-indigo-400 text-sm font-bold">
                <span className="w-2 h-2 rounded-full bg-indigo-400 animate-pulse"></span>
                HKDSE 2025 Paper 1B Q6
              </div>
              <h1 className="text-2xl font-bold text-white">
                Array Algorithm Tracing (陣列演算法)
              </h1>
              <p className="text-slate-400 text-sm">
                Reverse Order vs Cyclic Shift Logic
              </p>
            </header>

            <ArrayVisualizer
              initialArray={["S", "T", "E", "A", "M"]}
              algorithm="reverse"
              title="Part (a): Reverse Copy"
              description="Copies elements from s1 to s2 in reverse order."
            />

            <ArrayVisualizer
              initialArray={["S", "T", "E", "A", "M"]}
              algorithm="shift"
              title="Part (b): Cyclic Shift Left"
              description="Shifts all elements left by 1, moving the first element to the end."
            />
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
