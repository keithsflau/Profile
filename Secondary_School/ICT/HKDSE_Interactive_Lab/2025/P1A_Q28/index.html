<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE 2025 Paper 1A Q28 - Flowchart Tracer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .node {
        transition: all 0.3s;
      }
      .active-node {
        box-shadow: 0 0 15px 5px rgba(234, 179, 8, 0.5);
        border-color: #eab308;
        transform: scale(1.05);
        background-color: rgba(234, 179, 8, 0.1);
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div id="root" class="w-full max-w-6xl"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // Lucide Icon Shim
      const LucideIcon = ({ name, size = 20, className = "" }) => {
        const formatName = (n) =>
          n
            .split("-")
            .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
            .join("");
        const iconName = formatName(name);
        const [svgHtml, setSvgHtml] = useState("");
        useEffect(() => {
          if (window.lucide?.icons[iconName]?.toSvg) {
            setSvgHtml(
              window.lucide.icons[iconName].toSvg({
                width: size,
                height: size,
                class: className,
              })
            );
          }
        }, [name]);
        return (
          <span
            dangerouslySetInnerHTML={{ __html: svgHtml }}
            style={{ display: "inline-flex" }}
          />
        );
      };

      const Flowchart = ({ type, activeStep, state }) => {
        const isM1 = type === "M1";

        const Node = ({ id, text, shape, top, left }) => (
          <div
            className={`absolute flex items-center justify-center text-center p-2 text-xs md:text-sm font-bold border-2 node z-10 
                  ${
                    activeStep === id
                      ? "active-node text-yellow-300"
                      : "bg-slate-800 border-slate-600 text-slate-300"
                  }
                  ${
                    shape === "rect"
                      ? "rounded"
                      : shape === "diamond"
                      ? "rotate-45 w-16 h-16 [&>span]:-rotate-45"
                      : "rounded-full"
                  }`}
            style={{
              top,
              left,
              width: shape !== "diamond" ? "100px" : undefined,
              height: shape !== "diamond" ? "40px" : undefined,
            }}
          >
            <span>{text}</span>
          </div>
        );

        return (
          <div className="relative w-64 h-80 bg-slate-900 rounded-xl border border-slate-700 shadow-xl overflow-hidden">
            <div className="absolute top-2 left-2 font-bold text-slate-500">
              {type}
            </div>

            {/* Connections (SVG Lines) */}
            <svg
              className="absolute inset-0 w-full h-full stroke-slate-600 pointer-events-none"
              style={{ strokeWidth: 2 }}
            >
              <line x1="50%" y1="12%" x2="50%" y2="25%" />
              <line x1="50%" y1="35%" x2="50%" y2="50%" />

              {/* Loop Lines */}
              {isM1 ? (
                <>
                  <line x1="75%" y1="50%" x2="90%" y2="50%" />
                  <line x1="90%" y1="50%" x2="90%" y2="25%" />
                  <line x1="90%" y1="25%" x2="65%" y2="25%" />
                </>
              ) : (
                <>
                  <line x1="50%" y1="88%" x2="90%" y2="88%" />
                  <line x1="90%" y1="88%" x2="90%" y2="25%" />
                  <line x1="90%" y1="25%" x2="65%" y2="25%" />
                </>
              )}
            </svg>

            <Node id={1} text="Start" shape="oval" top="2%" left="30%" />
            <Node id={2} text="Input N" shape="rect" top="15%" left="30%" />
            <Node id={3} text="N > 4?" shape="diamond" top="30%" left="35%" />

            {isM1 ? (
              <>
                <Node id={4} text="Output" shape="rect" top="55%" left="30%" />
                <Node id={5} text="N=N-5" shape="rect" top="75%" left="30%" />
              </>
            ) : (
              <>
                <Node id={4} text="N=N-5" shape="rect" top="55%" left="30%" />
                <Node id={5} text="Output" shape="rect" top="75%" left="30%" />
              </>
            )}

            <div className="absolute bottom-2 left-2 font-mono text-xs text-green-400">
              N: {state.N} | Count: {state.count}
            </div>
          </div>
        );
      };

      const App = () => {
        const [m1State, setM1State] = useState({
          step: 1,
          N: 10,
          count: 0,
          finished: false,
        });
        const [m2State, setM2State] = useState({
          step: 1,
          N: 10,
          count: 0,
          finished: false,
        });
        const timerRef = useRef(null);

        const trace = () => {
          // Reset
          setM1State({ step: 1, N: 10, count: 0, finished: false });
          setM2State({ step: 1, N: 10, count: 0, finished: false });

          let n1 = 10,
            c1 = 0,
            s1 = 1;
          let n2 = 10,
            c2 = 0,
            s2 = 1;

          // Sequence for M1: 1->2->3->(Yes)->4(Out)->5(Calc)->3...
          // Sequence for M2: 1->2->3->(Yes)->4(Calc)->5(Out)->3...

          // We'll create a simple timeline for both
          const steps = []; // Array of states to replay

          const addStep = (currS1, currN1, currC1, currS2, currN2, currC2) => {
            steps.push({
              m1: { step: currS1, N: currN1, count: currC1 },
              m2: { step: currS2, N: currN2, count: currC2 },
            });
          };

          // Initial
          addStep(1, 10, 0, 1, 10, 0);

          // Trace Logic Generation (Pre-calculated for animation smoothness)
          // Step 2: Input N
          addStep(2, 10, 0, 2, 10, 0);

          // Step 3: Check N > 4
          addStep(3, 10, 0, 3, 10, 0);

          // Loop 1
          // M1: 4 (Out) -> 5 (Calc)
          // M2: 4 (Calc) -> 5 (Out)
          addStep(4, 10, 1, 4, 5, 0); // M1 Out+=1, M2 N-=5
          addStep(5, 5, 1, 5, 5, 1); // M1 N-=5, M2 Out+=1

          // Loop Check
          addStep(3, 5, 1, 3, 5, 1);

          // Loop 2
          addStep(4, 5, 2, 4, 0, 1); // M1 Out+=1, M2 N-=5
          addStep(5, 0, 2, 5, 0, 2); // M1 N-=5, M2 Out+=1

          // Loop Check
          addStep(3, 0, 2, 3, 0, 2);

          // End (Step 0 or null)
          steps.push({
            m1: { step: 0, N: 0, count: 2, finished: true },
            m2: { step: 0, N: 0, count: 2, finished: true },
          });

          // Replay
          let i = 0;
          if (timerRef.current) clearInterval(timerRef.current);
          timerRef.current = setInterval(() => {
            if (i >= steps.length) {
              clearInterval(timerRef.current);
              return;
            }
            setM1State(steps[i].m1);
            setM2State(steps[i].m2);
            i++;
          }, 800);
        };

        return (
          <div className="space-y-8 animate-fade-in w-full max-w-5xl mx-auto p-4 md:p-8 text-center">
            <header className="space-y-2">
              <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-cyan-900/30 border border-cyan-500/30 text-cyan-400 text-sm font-bold mb-4">
                <span className="w-2 h-2 rounded-full bg-cyan-400 animate-pulse"></span>
                HKDSE 2025 Paper 1A Q28
              </div>
              <h1 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 to-orange-500">
                Flowchart Tracer
              </h1>
              <p className="text-slate-400 max-w-xl mx-auto">
                Trace the algorithms M1 and M2 with N = 10. How many cans of
                soda?
              </p>
            </header>

            <div className="flex flex-col md:flex-row justify-center gap-8 items-center">
              <Flowchart type="M1" activeStep={m1State.step} state={m1State} />
              <Flowchart type="M2" activeStep={m2State.step} state={m2State} />
            </div>

            <div className="flex flex-col items-center gap-4">
              <button
                onClick={trace}
                className="px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-full shadow-lg shadow-blue-500/30 flex items-center gap-2 transition-all hover:scale-105"
              >
                <LucideIcon name="play" />
                Trace Execution (Start)
              </button>

              <div className="bg-slate-900 border border-slate-700 p-6 rounded-2xl w-full max-w-2xl flex justify-around">
                <div className="text-center">
                  <div className="text-slate-400 text-sm mb-1">M1 Output</div>
                  <div className="text-3xl font-bold text-yellow-400">
                    {m1State.count}
                  </div>
                </div>
                <div className="w-px bg-slate-700"></div>
                <div className="text-center">
                  <div className="text-slate-400 text-sm mb-1">M2 Output</div>
                  <div className="text-3xl font-bold text-orange-400">
                    {m2State.count}
                  </div>
                </div>
              </div>

              {m1State.finished && m2State.finished && (
                <div className="animate-fade-in bg-green-900/20 border border-green-500/30 px-8 py-4 rounded-xl text-green-300 font-bold">
                  Both algorithms output 2 cans. Correct Answer: C
                </div>
              )}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
