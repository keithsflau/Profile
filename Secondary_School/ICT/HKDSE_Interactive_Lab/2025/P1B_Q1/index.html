<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE 2025 Paper 1B Q1 - Spreadsheet Logic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .cell-input {
        background: transparent;
        width: 100%;
        height: 100%;
        outline: none;
        text-align: center;
      }
      .cell-header {
        background-color: #1e293b;
        color: #94a3b8;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #334155;
      }
      .cell-data {
        background-color: #0f172a;
        border: 1px solid #334155;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
      }
      .cell-highlight {
        border: 2px solid #3b82f6 !important;
        background-color: #1e3a8a !important;
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div id="root" class="w-full max-w-6xl"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // Lucide Icon Shim
      const LucideIcon = ({ name, size = 20, className = "" }) => {
        const formatName = (n) =>
          n
            .split("-")
            .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
            .join("");
        const iconName = formatName(name);
        const [svgHtml, setSvgHtml] = useState("");
        useEffect(() => {
          if (window.lucide?.icons[iconName]?.toSvg) {
            setSvgHtml(
              window.lucide.icons[iconName].toSvg({
                width: size,
                height: size,
                class: className,
              })
            );
          }
        }, [name]);
        return (
          <span
            dangerouslySetInnerHTML={{ __html: svgHtml }}
            style={{ display: "inline-flex" }}
          />
        );
      };

      const Spreadsheet = ({ formulaA, formulaB, onUpdateA, onUpdateB }) => {
        // Mock Data
        const data = [
          { id: 1, name: "Au Chi Man", t1: 67, t2: 88, t3: 45, avg: 66.7 },
          { id: 2, name: "Chan Ka Ka", t1: 37, t2: 20, t3: 29, avg: 28.7 },
          { id: 3, name: "Chan Wing Hong", t1: 88, t2: 60, t3: 90, avg: 79.3 },
          { id: 4, name: "Chan Yi Ling", t1: 70, t2: 45, t3: 97, avg: 70.7 },
        ];

        const stats = [
          { mark: 30, count: 1 },
          { mark: 50, count: 4 },
          { mark: 75, count: 22 },
        ];

        return (
          <div className="w-full bg-slate-900 border border-slate-700 rounded-lg overflow-hidden flex flex-col md:flex-row text-xs md:text-sm">
            {/* Left: Main Table */}
            <div className="flex-1 overflow-x-auto p-4 border-r border-slate-700">
              <div className="grid grid-cols-[30px_1fr_40px_40px_40px_60px] w-[500px]">
                {/* Headers */}
                <div className="cell-header"></div>
                <div className="cell-header">B (Name)</div>
                <div className="cell-header">C</div>
                <div className="cell-header">D</div>
                <div className="cell-header">E</div>
                <div className="cell-header bg-green-900/30 text-green-400">
                  F (Avg)
                </div>

                {/* Row 1 */}
                <div className="cell-header">1</div>
                <div className="cell-data text-slate-400">Name</div>
                <div className="cell-data text-slate-400">Test1</div>
                <div className="cell-data text-slate-400">Test2</div>
                <div className="cell-data text-slate-400">Test3</div>
                <div className="cell-data text-slate-400">Average</div>

                {/* Data Rows */}
                {data.map((row, idx) => (
                  <React.Fragment key={row.id}>
                    <div className="cell-header">{idx + 2}</div>
                    <div className="cell-data justify-start pl-2">
                      {row.name}
                    </div>
                    <div className="cell-data">{row.t1}</div>
                    <div className="cell-data">{row.t2}</div>
                    <div className="cell-data">{row.t3}</div>
                    <div
                      className={`cell-data font-bold ${
                        idx === 0 ? "cell-highlight" : ""
                      }`}
                    >
                      {idx === 0 ? (
                        onUpdateA ? (
                          <input
                            autoFocus
                            type="text"
                            className="cell-input text-white font-bold bg-blue-900/50"
                            placeholder="Formula?"
                            value={formulaA}
                            onChange={(e) => onUpdateA(e.target.value)}
                          />
                        ) : (
                          row.avg
                        )
                      ) : (
                        row.avg
                      )}
                    </div>
                  </React.Fragment>
                ))}
              </div>
            </div>

            {/* Right: Stats Table */}
            <div className="w-full md:w-1/3 p-4 bg-slate-800/50">
              <h4 className="text-slate-400 font-bold mb-2 text-center border-b border-slate-600 pb-2">
                Stats
              </h4>
              <div className="grid grid-cols-[40px_60px_1fr]">
                <div className="cell-header"></div>
                <div className="cell-header ">G (Mark)</div>
                <div className="cell-header bg-yellow-900/30 text-yellow-400">
                  H (Count)
                </div>

                <div className="cell-header">1</div>
                <div className="cell-data text-[10px] leading-tight text-center">
                  Avg &lt;=
                </div>
                <div className="cell-data text-[10px] leading-tight text-center">
                  No. of Students
                </div>

                {stats.map((s, idx) => (
                  <React.Fragment key={idx}>
                    <div className="cell-header">{idx + 2}</div>
                    <div className="cell-data">{s.mark}</div>
                    <div
                      className={`cell-data font-bold ${
                        idx === 0 ? "cell-highlight" : ""
                      }`}
                    >
                      {idx === 0 ? (
                        onUpdateB ? (
                          <input
                            type="text"
                            className="cell-input text-white font-bold bg-blue-900/50"
                            placeholder="Formula?"
                            value={formulaB}
                            onChange={(e) => onUpdateB(e.target.value)}
                          />
                        ) : (
                          s.count
                        )
                      ) : (
                        s.count
                      )}
                    </div>
                  </React.Fragment>
                ))}
              </div>
            </div>
          </div>
        );
      };

      const App = () => {
        const [inputA, setInputA] = useState("");
        const [inputB, setInputB] = useState("");
        const [feedbackA, setFeedbackA] = useState(null);
        const [feedbackB, setFeedbackB] = useState(null);

        const checkA = () => {
          const f = inputA.toUpperCase().replace(/\s/g, "");
          if (f === "=AVERAGE(C2:E2)" || f === "=(C2+D2+E2)/3") {
            setFeedbackA({
              correct: true,
              msg: "Correct! The average function is ideal.",
            });
          } else {
            setFeedbackA({
              correct: false,
              msg: "Try =AVERAGE(range) or arithmetic mean.",
            });
          }
        };

        const checkB = () => {
          const f = inputB.toUpperCase().replace(/\s/g, "");
          // Accept variants of COUNTIF
          // Standard: =COUNTIF($F$2:$F$36,"<="&G2)
          if (
            f.includes("COUNTIF") &&
            f.includes("F$2:F$36") &&
            f.includes('"<="&G2')
          ) {
            setFeedbackB({
              correct: true,
              msg: "Excellent! You used absolute referencing and logic correctly.",
            });
          } else if (
            f.includes("COUNTIF") &&
            (f.includes("<=") || f.includes("&G2"))
          ) {
            setFeedbackB({
              correct: true,
              msg: 'Close enough! Key logic is COUNTIF(Range, "<=" & Cell).',
            });
          } else {
            setFeedbackB({
              correct: false,
              msg: 'Use COUNTIF. Remember to combine operator "<=" with cell G2 using &.',
            });
          }
        };

        return (
          <div className="space-y-6 animate-fade-in w-full max-w-5xl mx-auto p-4 flex flex-col items-center">
            <header className="text-center space-y-4 max-w-3xl w-full">
              <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-900/30 border border-indigo-500/30 text-indigo-400 text-sm font-bold">
                <span className="w-2 h-2 rounded-full bg-indigo-400 animate-pulse"></span>
                HKDSE 2025 Paper 1B Q1
              </div>
              <h1 className="text-2xl font-bold text-white">
                Spreadsheet Logic (電子試算表)
              </h1>
            </header>

            {/* Task A */}
            <div className="w-full bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
              <h3 className="text-lg font-bold text-slate-200 mb-2 flex items-center gap-2">
                <span className="bg-green-500 text-black w-6 h-6 rounded flex items-center justify-center text-sm">
                  a
                </span>
                Calculate Average (計算平均分)
              </h3>
              <p className="text-slate-400 text-sm mb-4">
                Enter the formula in <strong>F2</strong> to calculate the
                average mark of the three tests.
                <br />
                <span className="text-xs opacity-70">
                  在 F2 輸入公式以計算三次測驗的平均分。
                </span>
              </p>

              <div className="mb-4">
                <Spreadsheet formulaA={inputA} onUpdateA={setInputA} />
              </div>

              <div className="flex gap-4 items-center">
                <button
                  onClick={checkA}
                  className="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-all"
                >
                  Check F2
                </button>
                {feedbackA && (
                  <div
                    className={`flex items-center gap-2 ${
                      feedbackA.correct ? "text-green-400" : "text-red-400"
                    }`}
                  >
                    <LucideIcon name={feedbackA.correct ? "check" : "x"} />
                    <span className="font-bold">{feedbackA.msg}</span>
                  </div>
                )}
              </div>
            </div>

            {/* Task B */}
            <div className="w-full bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
              <h3 className="text-lg font-bold text-slate-200 mb-2 flex items-center gap-2">
                <span className="bg-yellow-500 text-black w-6 h-6 rounded flex items-center justify-center text-sm">
                  b
                </span>
                Count Students (統計人數)
              </h3>
              <p className="text-slate-400 text-sm mb-4">
                Enter formula in <strong>H2</strong> to count students with
                average marks (F2:F36) &le; mark in G2.
                <br />
                <span className="text-xs opacity-70">
                  在 H2 輸入公式，統計平均分 (F2:F36) 小於或等於 G2 的學生人數。
                </span>
              </p>

              <div className="mb-4">
                <Spreadsheet formulaB={inputB} onUpdateB={setInputB} />
              </div>

              <div className="flex gap-4 items-center">
                <button
                  onClick={checkB}
                  className="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-all"
                >
                  Check H2
                </button>
                {feedbackB && (
                  <div
                    className={`flex items-center gap-2 ${
                      feedbackB.correct ? "text-green-400" : "text-red-400"
                    }`}
                  >
                    <LucideIcon name={feedbackB.correct ? "check" : "x"} />
                    <span className="font-bold">{feedbackB.msg}</span>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
