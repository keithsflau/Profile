<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ex07: 2014 Q1 - Menu Ordering System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div id="root" class="max-w-4xl mx-auto"></div>
    <script type="text/babel">
      const { useState } = React;
      const {
        Utensils,
        AlertCircle,
        CheckCircle,
        Calculator,
        FileSpreadsheet,
      } = lucide;

      const TEXT = {
        en: {
          title: "HKDSE 2014 Q1: Lunch Order System",
          subtitle:
            "Spreadsheet operations: Data Validation and Order Calculations.",
          menu_title: "School Lunch Menu",
          orders: "Class Orders",
          item: "Item",
          price: "Price",
          qty: "Quantity",
          subtotal: "Subtotal",
          total: "Total Amount",
          setA: "Set A: Chicken Rice",
          setB: "Set B: Beef Noodles",
          setC: "Set C: Veggie Pasta",
          validation_error:
            "Error: Please enter a valid NUMBER (e.g., 5, not 'five').",
          range_error: "Error: Quantity must be non-negative.",
          instruction:
            "Enter quantities for each set. Try examining 'valid' vs 'invalid' inputs.",
          status_valid: "Valid Input",
          status_invalid: "Invalid Input",
        },
        tc: {
          title: "HKDSE 2014 Q1: 午餐訂購系統",
          subtitle: "試算表操作：數據驗證與訂單計算。",
          menu_title: "學校午餐餐單",
          orders: "班級訂單",
          item: "項目",
          price: "價格",
          qty: "數量",
          subtotal: "小計",
          total: "總金額",
          setA: "套餐 A: 雞皇飯",
          setB: "套餐 B: 牛肉麵",
          setC: "套餐 C: 雜菜意粉",
          validation_error: "錯誤: 請輸入有效的 數字 (例如 5，而不是 'five')。",
          range_error: "錯誤: 數量必須為非負數。",
          instruction: "輸入每個套餐的數量。嘗試測試 '有效' 與 '無效' 的輸入。",
          status_valid: "輸入有效",
          status_invalid: "輸入無效",
        },
      };

      const MENU = [
        { id: "A", price: 25 },
        { id: "B", price: 28 },
        { id: "C", price: 22 },
      ];

      const App = () => {
        const [lang, setLang] = useState("en");
        // Quantities as strings initially to allow invalid input testing
        const [inputs, setInputs] = useState({ A: "0", B: "0", C: "0" });
        const [errors, setErrors] = useState({ A: null, B: null, C: null });

        const t = TEXT[lang];

        const handleChange = (id, val) => {
          setInputs({ ...inputs, [id]: val });

          // Validation Logic (Spreadsheet style)
          let error = null;
          const num = Number(val);

          if (val.trim() === "") {
            // Empty is ok (treated as 0)
          } else if (isNaN(num)) {
            error = t.validation_error;
          } else if (!Number.isInteger(num)) {
            error = "Error: Integer required.";
          } else if (num < 0) {
            error = t.range_error;
          }

          setErrors((prev) => ({ ...prev, [id]: error }));
        };

        const calculateTotal = () => {
          let sum = 0;
          let valid = true;
          MENU.forEach((item) => {
            const val = Number(inputs[item.id]);
            if (errors[item.id] || isNaN(val)) valid = false;
            else sum += val * item.price;
          });
          return valid ? `$${sum}` : "ERROR";
        };

        const getItemName = (id) => {
          if (id === "A") return t.setA;
          if (id === "B") return t.setB;
          if (id === "C") return t.setC;
        };

        return (
          <div className="min-h-screen bg-slate-900 p-4">
            <header className="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
              <div>
                <h1 className="text-2xl font-bold text-white flex items-center gap-2">
                  <Utensils className="text-orange-400" /> {t.title}
                </h1>
                <p className="text-slate-400 mt-1">{t.subtitle}</p>
              </div>
              <button
                onClick={() => setLang((l) => (l === "en" ? "tc" : "en"))}
                className="px-3 py-1 bg-slate-800 rounded border border-slate-600"
              >
                {lang === "en" ? "中文" : "ENG"}
              </button>
            </header>

            <p className="text-center text-slate-300 mb-6">{t.instruction}</p>

            <div className="max-w-3xl mx-auto bg-white text-slate-900 rounded-xl shadow-2xl overflow-hidden">
              <div className="bg-green-600 p-4 text-white flex justify-between items-center">
                <h2 className="font-bold text-xl flex items-center gap-2">
                  <FileSpreadsheet /> {t.menu_title}
                </h2>
                <span className="text-sm opacity-80 font-mono">
                  ExamMode: Start
                </span>
              </div>

              <div className="p-6">
                <table className="w-full text-left border-collapse">
                  <thead>
                    <tr className="border-b-2 border-slate-200 text-slate-500 uppercase text-xs tracking-wider">
                      <th className="p-3">{t.item}</th>
                      <th className="p-3 text-right">{t.price}</th>
                      <th className="p-3 w-48">{t.qty} (Input)</th>
                      <th className="p-3 text-right">{t.subtotal}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {MENU.map((item) => {
                      const val = Number(inputs[item.id]);
                      const isErr = !!errors[item.id];
                      const sub = isErr ? "---" : val * item.price;
                      return (
                        <tr
                          key={item.id}
                          className="border-b border-slate-100 hover:bg-slate-50"
                        >
                          <td className="p-3 font-medium">
                            <span className="inline-block w-6 h-6 bg-slate-200 rounded text-center mr-2">
                              {item.id}
                            </span>
                            {getItemName(item.id)}
                          </td>
                          <td className="p-3 text-right font-mono">
                            ${item.price}
                          </td>
                          <td className="p-3 relative">
                            <input
                              type="text"
                              value={inputs[item.id]}
                              onChange={(e) =>
                                handleChange(item.id, e.target.value)
                              }
                              className={`w-full p-2 border rounded font-mono focus:outline-none focus:ring-2 ${
                                isErr
                                  ? "border-red-500 ring-red-200 bg-red-50"
                                  : "border-slate-300 ring-blue-100"
                              }`}
                            />
                            {isErr && (
                              <div className="absolute top-12 left-0 z-10 bg-red-600 text-white text-xs p-2 rounded shadow-lg w-64 flex items-start gap-2 animate-bounce">
                                <AlertCircle
                                  size={14}
                                  className="min-w-[14px] mt-0.5"
                                />
                                {errors[item.id]}
                              </div>
                            )}
                          </td>
                          <td className="p-3 text-right font-mono font-bold text-slate-700">
                            {sub === "---" ? sub : `$${sub}`}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                  <tfoot>
                    <tr className="bg-slate-100">
                      <td
                        colSpan="3"
                        className="p-4 text-right font-bold text-lg"
                      >
                        {t.total}:
                      </td>
                      <td className="p-4 text-right font-bold text-2xl text-green-600 font-mono">
                        {calculateTotal()}
                      </td>
                    </tr>
                  </tfoot>
                </table>

                <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800">
                  <strong>Teacher's Note (Validation Type):</strong> <br />
                  This simulation uses <code>Data Type Check</code> (Number vs
                  Text) and <code>Range Check</code> (Non-negative). In Excel,
                  this is configured via <em>Data {">"} Data Validation</em>.
                </div>
              </div>
            </div>
          </div>
        );
      };
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
