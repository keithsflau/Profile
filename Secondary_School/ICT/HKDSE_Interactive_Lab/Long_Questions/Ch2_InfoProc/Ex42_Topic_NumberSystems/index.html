<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE ICT Ch2 - 2's Complement & Number Systems</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@400;700&family=Fira+Code:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans TC", "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .font-mono {
        font-family: "Fira Code", monospace;
      }
      .bit-btn {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .bit-btn:active {
        transform: scale(0.95);
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div id="root" class="w-full max-w-5xl"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      const createLucideIcon = (name) => {
        const iconData = window.lucide?.icons[name];
        if (!iconData)
          return (props) => React.createElement("span", props, "?");

        const toCamel = (s) => s.replace(/-./g, (x) => x[1].toUpperCase());
        const formatAttrs = (a) => {
          const n = {};
          for (const k in a) {
            if (k === "class") n.className = a[k];
            else if (k.includes("-")) n[toCamel(k)] = a[k];
            else n[k] = a[k];
          }
          return n;
        };

        return ({ color, size, strokeWidth, className, ...props }) => {
          return React.createElement(
            "svg",
            {
              width: size || 24,
              height: size || 24,
              stroke: color || "currentColor",
              strokeWidth: strokeWidth || 2,
              fill: "none",
              strokeLinecap: "round",
              strokeLinejoin: "round",
              className: `lucide lucide-${name.toLowerCase()} ${
                className || ""
              }`.trim(),
              xmlns: "http://www.w3.org/2000/svg",
              viewBox: "0 0 24 24",
              ...props,
            },
            iconData.map(([tag, attrs], i) =>
              React.createElement(tag, { ...formatAttrs(attrs), key: i })
            )
          );
        };
      };

      const Icons = {
        Binary: createLucideIcon("Binary"),
        Calculator: createLucideIcon("Calculator"),
        RefreshCw: createLucideIcon("RefreshCw"),
        ArrowRight: createLucideIcon("ArrowRight"),
        CheckCircle2: createLucideIcon("CheckCircle2"),
        XCircle: createLucideIcon("XCircle"),
        HelpCircle: createLucideIcon("HelpCircle"),
        BrainCircuit: createLucideIcon("BrainCircuit"),
      };

      const Icon = ({ name, ...props }) => {
        const Cmp = Icons[name];
        return Cmp ? <Cmp {...props} /> : null;
      };

      const App = () => {
        const [bits, setBits] = useState([0, 0, 0, 0, 0, 0, 0, 0]); // 8-bit
        const [mode, setMode] = useState("explorer"); // 'explorer' or 'quiz'

        // Quiz State
        const [quizTarget, setQuizTarget] = useState(0);
        const [quizType, setQuizType] = useState("unsigned"); // 'unsigned' or 'signed'
        const [quizFeedback, setQuizFeedback] = useState(null);

        const toggleBit = (idx) => {
          const newBits = [...bits];
          newBits[idx] = newBits[idx] ? 0 : 1;
          setBits(newBits);
          if (mode === "quiz") setQuizFeedback(null);
        };

        const values = useMemo(() => {
          // Unsigned
          const unsigned = parseInt(bits.join(""), 2);

          // Signed (2's Complement)
          // Value = -1 * MSB * 128 + sum(rest)
          let signed = 0;
          if (bits[0] === 1) {
            // Negative
            // Strategy: -128 + value of remaining 7 bits
            const rest = parseInt(bits.slice(1).join(""), 2);
            signed = -128 + rest;
          } else {
            signed = unsigned;
          }

          // Hex
          const hex = unsigned.toString(16).toUpperCase().padStart(2, "0");

          return { unsigned, signed, hex };
        }, [bits]);

        const generateQuiz = () => {
          const type = Math.random() > 0.5 ? "signed" : "unsigned";
          setQuizType(type);

          let target;
          if (type === "signed") {
            target = Math.floor(Math.random() * 256) - 128; // -128 to 127
          } else {
            target = Math.floor(Math.random() * 256); // 0 to 255
          }
          setQuizTarget(target);
          setBits([0, 0, 0, 0, 0, 0, 0, 0]);
          setQuizFeedback(null);
          setMode("quiz");
        };

        const checkAnswer = () => {
          const current =
            quizType === "signed" ? values.signed : values.unsigned;
          if (current === quizTarget) {
            setQuizFeedback("correct");
          } else {
            setQuizFeedback("incorrect");
          }
        };

        return (
          <div className="w-full space-y-6">
            {/* Header */}
            <header className="flex items-center justify-between bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-lg">
              <div className="flex items-center gap-4">
                <div className="p-3 bg-purple-600 rounded-xl shadow-lg shadow-purple-500/20">
                  <Icon name="Binary" size={32} className="text-white" />
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-white">
                    8-bit Number System Lab
                  </h1>
                  <p className="text-slate-400 text-sm">
                    HKDSE ICT Information Processing (Ch 2)
                  </p>
                </div>
              </div>
              <div className="flex gap-2 bg-slate-900 p-1 rounded-lg border border-slate-700">
                <button
                  onClick={() => setMode("explorer")}
                  className={`px-4 py-2 rounded font-bold text-sm transition ${
                    mode === "explorer"
                      ? "bg-purple-600 text-white"
                      : "text-slate-400 hover:text-white"
                  }`}
                >
                  Explorer
                </button>
                <button
                  onClick={generateQuiz}
                  className={`px-4 py-2 rounded font-bold text-sm transition ${
                    mode === "quiz"
                      ? "bg-pink-600 text-white"
                      : "text-slate-400 hover:text-white"
                  }`}
                >
                  Quiz Mode
                </button>
              </div>
            </header>

            {/* Quiz Instructions */}
            {mode === "quiz" && (
              <div className="bg-pink-900/20 border border-pink-500/30 p-6 rounded-2xl text-center animate-in fade-in slide-in-from-top-4">
                <h3 className="text-pink-400 font-bold text-lg mb-2 flex items-center justify-center gap-2">
                  <Icon name="BrainCircuit" /> Challenge
                </h3>
                <p className="text-white text-xl mb-4">
                  Represent{" "}
                  <span className="text-yellow-400 font-mono text-2xl font-bold">
                    {quizTarget}
                  </span>{" "}
                  as a{" "}
                  <span className="underline decoration-pink-500">
                    {quizType === "signed" ? "Signed (2's Comp)" : "Unsigned"}
                  </span>{" "}
                  8-bit integer.
                </p>

                <div className="flex justify-center gap-4">
                  <button
                    onClick={checkAnswer}
                    className="px-6 py-2 bg-pink-600 hover:bg-pink-500 text-white rounded-lg font-bold shadow-lg transition"
                  >
                    Check Answer
                  </button>
                  <button
                    onClick={generateQuiz}
                    className="px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold transition"
                  >
                    Next Question
                  </button>
                </div>

                {quizFeedback && (
                  <div
                    className={`mt-4 text-lg font-bold flex items-center justify-center gap-2 ${
                      quizFeedback === "correct"
                        ? "text-green-400"
                        : "text-red-400"
                    }`}
                  >
                    {quizFeedback === "correct" ? (
                      <>
                        <Icon name="CheckCircle2" /> Correct!
                      </>
                    ) : (
                      <>
                        <Icon name="XCircle" /> Try Again!
                      </>
                    )}
                  </div>
                )}
              </div>
            )}

            {/* Bit Interaction Area */}
            <div className="bg-base-panel p-8 rounded-2xl border border-slate-700 shadow-xl overflow-hidden relative">
              {/* Powers of 2 Labels */}
              <div className="grid grid-cols-8 gap-2 md:gap-4 mb-2">
                {bits.map((_, i) => (
                  <div key={`label-${i}`} className="text-center">
                    <div className="text-xs text-slate-500 font-mono mb-1">
                      2<sup>{7 - i}</sup>
                    </div>
                    <div className="text-[10px] text-slate-600 font-mono">
                      {Math.pow(2, 7 - i)}
                    </div>
                  </div>
                ))}
              </div>

              {/* Bit Buttons */}
              <div className="grid grid-cols-8 gap-2 md:gap-4 mb-8">
                {bits.map((bit, i) => (
                  <button
                    key={`bit-${i}`}
                    onClick={() => toggleBit(i)}
                    className={`
                                bit-btn aspect-[3/4] rounded-lg font-mono text-3xl md:text-5xl font-bold flex items-center justify-center border-b-4
                                ${
                                  bit
                                    ? i === 0 &&
                                      (mode === "explorer" ||
                                        quizType === "signed")
                                      ? "bg-orange-600 border-orange-800 text-white shadow-[0_0_15px_rgba(234,88,12,0.5)]"
                                      : "bg-cyan-500 border-cyan-700 text-white shadow-[0_0_15px_rgba(6,182,212,0.5)]"
                                    : "bg-slate-700 border-slate-900 text-slate-600 hover:bg-slate-600 hover:text-slate-400"
                                }
                            `}
                  >
                    {bit}
                  </button>
                ))}
              </div>

              {/* MSB Indicator */}
              <div className="absolute top-8 left-8 md:top-10 md:left-12 -translate-x-1/2 -translate-y-full">
                <span className="text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded border border-slate-600">
                  MSB
                </span>
              </div>
              <div className="absolute top-8 right-8 md:top-10 md:right-12 translate-x-1/2 -translate-y-full">
                <span className="text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded border border-slate-600">
                  LSB
                </span>
              </div>

              {/* Explorer Mode Analysis */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 pt-6 border-t border-slate-700">
                {/* Unsigned Panel */}
                <div
                  className={`p-4 rounded-xl border transition-all ${
                    quizType === "unsigned" && mode === "quiz"
                      ? "bg-pink-900/10 border-pink-500 ring-2 ring-pink-500/20"
                      : "bg-slate-800 border-slate-700"
                  }`}
                >
                  <div className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">
                    Unsigned Decimal
                  </div>
                  <div className="flex items-baseline gap-2">
                    <span className="text-3xl font-mono text-white">
                      {values.unsigned}
                    </span>
                    <span className="text-xs text-slate-500">10</span>
                  </div>
                  <div className="mt-2 text-[10px] text-slate-500 font-mono">
                    {bits
                      .map((b, i) => (b ? `${Math.pow(2, 7 - i)}` : null))
                      .filter(Boolean)
                      .join(" + ") || "0"}
                  </div>
                </div>

                {/* Signed Panel */}
                <div
                  className={`p-4 rounded-xl border transition-all ${
                    quizType === "signed" && mode === "quiz"
                      ? "bg-pink-900/10 border-pink-500 ring-2 ring-pink-500/20"
                      : "bg-slate-800 border-orange-900/30"
                  }`}
                >
                  <div className="flex justify-between items-start mb-2">
                    <span className="text-xs font-bold text-orange-400 uppercase tracking-wider">
                      Signed (2's Comp)
                    </span>
                    {bits[0] === 1 && (
                      <span className="text-[10px] px-1.5 py-0.5 bg-red-900 text-red-200 rounded">
                        Negative
                      </span>
                    )}
                  </div>
                  <div className="flex items-baseline gap-2">
                    <span className="text-3xl font-mono text-white">
                      {values.signed}
                    </span>
                    <span className="text-xs text-slate-500">10</span>
                  </div>
                  <div className="mt-2 text-[10px] text-slate-500 font-mono">
                    {bits[0]
                      ? `-128 + ${values.unsigned - 128}`
                      : "Sign Bit = 0 (Positive)"}
                  </div>
                </div>

                {/* Hex Panel */}
                <div className="p-4 rounded-xl bg-slate-800 border border-slate-700">
                  <div className="text-xs font-bold text-green-400 uppercase tracking-wider mb-2">
                    Hexadecimal
                  </div>
                  <div className="flex items-baseline gap-2">
                    <span className="text-3xl font-mono text-white tracking-widest">
                      {values.hex}
                    </span>
                    <span className="text-xs text-slate-500">16</span>
                  </div>
                  <div className="mt-2 text-[10px] text-slate-500">
                    4 bits = 1 Hex Digit
                  </div>
                </div>
              </div>
            </div>

            {/* Educational Notes */}
            <div className="grid md:grid-cols-2 gap-4">
              <div className="p-4 bg-slate-800/50 rounded-lg border border-slate-700 text-sm text-slate-300">
                <strong className="text-white block mb-1">
                  Unsigned Range:
                </strong>
                0 to 255 (2<sup>8</sup> - 1)
              </div>
              <div className="p-4 bg-slate-800/50 rounded-lg border border-slate-700 text-sm text-slate-300">
                <strong className="text-white block mb-1">
                  Signed (2's Comp) Range:
                </strong>
                -128 to +127
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
