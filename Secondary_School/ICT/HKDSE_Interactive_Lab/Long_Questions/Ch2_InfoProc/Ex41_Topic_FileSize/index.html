<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE ICT Ch2 - Multimedia File Size Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@400;700&family=Fira+Code:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans TC", "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .font-mono {
        font-family: "Fira Code", monospace;
      }
      .input-group {
        width: 100%;
      }
      .input-field {
        background-color: #1e293b;
        border: 1px solid #334155;
        color: white;
        padding: 0.5rem;
        border-radius: 0.5rem;
        width: 100%;
        transition: all 0.2s;
      }
      .input-field:focus {
        outline: none;
        border-color: #0ea5e9;
        box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
      }
      .formula-step {
        animation: fadeIn 0.5s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div id="root" class="w-full max-w-5xl"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      // --- Robust Lucide Icon Wrapper ---
      const createLucideIcon = (name) => {
        if (
          !window.lucide ||
          !window.lucide.icons ||
          !window.lucide.icons[name]
        ) {
          console.warn(`Icon ${name} not found in lucide.icons`);
          return (props) =>
            React.createElement(
              "span",
              { ...props, style: { color: "red" } },
              "?"
            );
        }

        const [tag, attrs, children] = window.lucide.icons[name];

        const toCamel = (s) => s.replace(/-./g, (x) => x[1].toUpperCase());
        const formatAttrs = (a) => {
          const n = {};
          for (const k in a) {
            if (k === "class") n.className = a[k];
            else if (k.includes("-")) n[toCamel(k)] = a[k];
            else n[k] = a[k];
          }
          return n;
        };

        return ({ color, size, strokeWidth, className, ...props }) => {
          const mergedAttrs = {
            ...formatAttrs(attrs),
            width: size || 24,
            height: size || 24,
            stroke: color || "currentColor",
            strokeWidth: strokeWidth || 2,
            className: `lucide lucide-${name.toLowerCase()} ${
              className || ""
            }`.trim(),
            ...props,
          };

          return React.createElement(
            tag,
            mergedAttrs,
            children
              ? children.map(([cTag, cAttrs], i) =>
                  React.createElement(cTag, { ...formatAttrs(cAttrs), key: i })
                )
              : null
          );
        };
      };

      // Create specific icon components
      const CalculatorIcon = createLucideIcon("Calculator");
      const ImageIcon = createLucideIcon("Image");
      const MusicIcon = createLucideIcon("Music");
      const FileDigitIcon = createLucideIcon("FileDigit");
      const MonitorIcon = createLucideIcon("Monitor");
      const MicIcon = createLucideIcon("Mic");
      const HardDriveIcon = createLucideIcon("HardDrive");

      const Icons = {
        Calculator: CalculatorIcon,
        Image: ImageIcon,
        Music: MusicIcon,
        FileDigit: FileDigitIcon,
        Monitor: MonitorIcon,
        Mic: MicIcon,
        HardDrive: HardDriveIcon,
      };

      const Icon = ({ name, ...props }) => {
        const Component = Icons[name];
        if (!Component) return null;
        return <Component {...props} />;
      };

      const App = () => {
        const [mode, setMode] = useState("image"); // 'image' or 'audio'

        // Image State
        const [imgW, setImgW] = useState(1920);
        const [imgH, setImgH] = useState(1080);
        const [imgDepth, setImgDepth] = useState(24); // bits
        const [imgCompression, setImgCompression] = useState(1); // 1 = uncompressed

        // Audio State
        const [sampleRate, setSampleRate] = useState(44100); // Hz
        const [bitDepth, setBitDepth] = useState(16); // bits
        const [channels, setChannels] = useState(2); // 1=Mono, 2=Stereo
        const [duration, setDuration] = useState(60); // seconds

        // Calculation Logic
        const imageResult = useMemo(() => {
          const rawBits = BigInt(imgW) * BigInt(imgH) * BigInt(imgDepth);
          const rawBytes = Number(rawBits) / 8;
          const sizeBytes = rawBytes / imgCompression;

          return {
            rawBits,
            rawBytes,
            sizeBytes,
            sizeKB: sizeBytes / 1024,
            sizeMB: sizeBytes / (1024 * 1024),
          };
        }, [imgW, imgH, imgDepth, imgCompression]);

        const audioResult = useMemo(() => {
          const rawBits =
            BigInt(sampleRate) *
            BigInt(bitDepth) *
            BigInt(channels) *
            BigInt(Math.floor(duration));
          const rawBytes = Number(rawBits) / 8;

          return {
            rawBits,
            rawBytes,
            sizeKB: rawBytes / 1024,
            sizeMB: rawBytes / (1024 * 1024),
          };
        }, [sampleRate, bitDepth, channels, duration]);

        return (
          <div className="w-full space-y-8">
            {/* Header */}
            <header className="flex flex-col md:flex-row items-center justify-between bg-slate-800/50 p-6 rounded-2xl border border-slate-700 backdrop-blur-sm">
              <div className="flex items-center gap-4 mb-4 md:mb-0">
                <div className="p-3 bg-blue-600 rounded-xl shadow-lg shadow-blue-500/20">
                  <Icon name="Calculator" size={32} className="text-white" />
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-white tracking-tight">
                    Multimedia File Size Calculator
                  </h1>
                  <p className="text-slate-400 text-sm">
                    HKDSE ICT Information Processing (Ch 2)
                  </p>
                </div>
              </div>

              <div className="flex bg-slate-900 p-1 rounded-lg border border-slate-700">
                <button
                  onClick={() => setMode("image")}
                  className={`flex items-center gap-2 px-6 py-2 rounded-md font-bold transition-all ${
                    mode === "image"
                      ? "bg-blue-600 text-white shadow-lg"
                      : "text-slate-400 hover:text-white"
                  }`}
                >
                  <Icon name="Image" size={18} />
                  Bitmap Image
                </button>
                <button
                  onClick={() => setMode("audio")}
                  className={`flex items-center gap-2 px-6 py-2 rounded-md font-bold transition-all ${
                    mode === "audio"
                      ? "bg-green-600 text-white shadow-lg"
                      : "text-slate-400 hover:text-white"
                  }`}
                >
                  <Icon name="Music" size={18} />
                  Digital Audio
                </button>
              </div>
            </header>

            {/* Main Calculation Area */}
            <div className="grid lg:grid-cols-2 gap-8">
              {/* Visualizer / formula View */}
              <div className="bg-slate-800 rounded-2xl border border-slate-700 p-8 shadow-xl flex flex-col relative overflow-hidden">
                <div className="absolute top-0 right-0 p-4 opacity-10">
                  <Icon
                    name={mode === "image" ? "Monitor" : "Mic"}
                    size={120}
                  />
                </div>

                <h2 className="text-xl font-bold text-white mb-6 flex items-center gap-2">
                  <Icon name="FileDigit" className="text-blue-400" />
                  Calculation Process
                </h2>

                <div className="flex-1 overflow-y-auto space-y-6 font-mono text-sm">
                  {mode === "image" ? (
                    <>
                      <div className="space-y-2 formula-step">
                        <p className="text-slate-400">
                          Step 1: Calculate Total Pixels
                        </p>
                        <div className="p-4 bg-slate-900 rounded-lg border border-slate-600">
                          <div className="flex justify-between text-slate-300">
                            <span>Width × Height</span>
                            <span>= Pixels</span>
                          </div>
                          <div className="flex justify-between text-xl font-bold text-white mt-2 border-t border-slate-700 pt-2">
                            <span>
                              {imgW} × {imgH}
                            </span>
                            <span className="text-blue-400">
                              = {parseInt(imgW * imgH).toLocaleString()} px
                            </span>
                          </div>
                        </div>
                      </div>

                      <div
                        className="space-y-2 formula-step"
                        style={{ animationDelay: "0.1s" }}
                      >
                        <p className="text-slate-400">
                          Step 2: Calculate Raw Bits
                        </p>
                        <div className="p-4 bg-slate-900 rounded-lg border border-slate-600">
                          <div className="flex justify-between text-slate-300">
                            <span>Pixels × Color Depth</span>
                            <span>= Bits</span>
                          </div>
                          <div className="flex justify-between text-xl font-bold text-white mt-2 border-t border-slate-700 pt-2">
                            <span>
                              {(imgW * imgH).toLocaleString()} × {imgDepth}
                            </span>
                            <span className="text-blue-400">
                              = {Number(imageResult.rawBits).toLocaleString()}{" "}
                              bits
                            </span>
                          </div>
                        </div>
                      </div>

                      <div
                        className="space-y-2 formula-step"
                        style={{ animationDelay: "0.2s" }}
                      >
                        <p className="text-slate-400">
                          Step 3: Convert to Bytes (÷8)
                        </p>
                        <div className="p-4 bg-slate-900 rounded-lg border border-slate-600">
                          <div className="flex justify-between text-slate-300">
                            <span>Bits ÷ 8</span>
                            <span>= Bytes</span>
                          </div>
                          <div className="flex justify-between text-xl font-bold text-white mt-2 border-t border-slate-700 pt-2">
                            <span>
                              {Number(imageResult.rawBits).toLocaleString()} ÷ 8
                            </span>
                            <span className="text-green-400">
                              = {imageResult.rawBytes.toLocaleString()} B
                            </span>
                          </div>
                        </div>
                      </div>

                      <div
                        className="space-y-2 formula-step"
                        style={{ animationDelay: "0.3s" }}
                      >
                        <p className="text-slate-400">
                          Step 4: Convert to KB/MB (÷1024)
                        </p>
                        <div className="p-4 bg-gradient-to-r from-blue-900/40 to-slate-900 rounded-lg border border-blue-500/50">
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <div className="text-xs text-slate-400 mb-1">
                                Size (KB)
                              </div>
                              <div className="text-2xl font-bold text-white">
                                {imageResult.sizeKB.toFixed(2)} KB
                              </div>
                            </div>
                            <div>
                              <div className="text-xs text-slate-400 mb-1">
                                Size (MB)
                              </div>
                              <div className="text-2xl font-bold text-yellow-400">
                                {imageResult.sizeMB.toFixed(2)} MB
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </>
                  ) : (
                    <>
                      <div className="space-y-2 formula-step">
                        <p className="text-slate-400">Formula Breakdown</p>
                        <div className="p-4 bg-slate-900 rounded-lg border border-slate-600">
                          <div className="text-center text-slate-300 text-lg mb-2">
                            Sample Rate × Depth × Channels × Duration
                          </div>
                          <div className="text-center text-xs text-slate-500">
                            (Hz) × (bits) × (n) × (sec)
                          </div>
                        </div>
                      </div>

                      <div
                        className="space-y-2 formula-step"
                        style={{ animationDelay: "0.1s" }}
                      >
                        <p className="text-slate-400">Values Substitution</p>
                        <div className="p-4 bg-slate-900 rounded-lg border border-slate-600">
                          <div className="flex flex-col gap-2">
                            <div className="flex justify-between border-b border-slate-700 pb-2">
                              <span>Sample Rate</span>
                              <span className="text-white">
                                {sampleRate.toLocaleString()} Hz
                              </span>
                            </div>
                            <div className="flex justify-between border-b border-slate-700 pb-2">
                              <span>Bit Depth</span>
                              <span className="text-white">
                                {bitDepth} bits
                              </span>
                            </div>
                            <div className="flex justify-between border-b border-slate-700 pb-2">
                              <span>Channels</span>
                              <span className="text-white">
                                {channels === 1 ? "1 (Mono)" : "2 (Stereo)"}
                              </span>
                            </div>
                            <div className="flex justify-between">
                              <span>Duration</span>
                              <span className="text-white">{duration} s</span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div
                        className="space-y-2 formula-step"
                        style={{ animationDelay: "0.2s" }}
                      >
                        <p className="text-slate-400">Total Calculation</p>
                        <div className="p-4 bg-slate-900 rounded-lg border border-slate-600">
                          <div className="text-right text-slate-400 text-xs mb-1">
                            Total Bits
                          </div>
                          <div className="text-right text-white font-bold mb-3">
                            {Number(audioResult.rawBits).toLocaleString()} bits
                          </div>

                          <div className="text-right text-slate-400 text-xs mb-1">
                            Total Bytes (÷8)
                          </div>
                          <div className="text-right text-green-400 font-bold">
                            {audioResult.rawBytes.toLocaleString()} B
                          </div>
                        </div>
                      </div>

                      <div
                        className="space-y-2 formula-step"
                        style={{ animationDelay: "0.3s" }}
                      >
                        <p className="text-slate-400">Final Result</p>
                        <div className="p-4 bg-gradient-to-r from-green-900/40 to-slate-900 rounded-lg border border-green-500/50">
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <div className="text-xs text-slate-400 mb-1">
                                Size (KB)
                              </div>
                              <div className="text-2xl font-bold text-white">
                                {audioResult.sizeKB.toFixed(2)} KB
                              </div>
                            </div>
                            <div>
                              <div className="text-xs text-slate-400 mb-1">
                                Size (MB)
                              </div>
                              <div className="text-2xl font-bold text-yellow-400">
                                {audioResult.sizeMB.toFixed(2)} MB
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </>
                  )}
                </div>
              </div>

              {/* Controls Area */}
              <div className="bg-base-panel p-8 rounded-2xl border border-slate-700 h-fit">
                <h3 className="text-lg font-bold text-white mb-6">
                  Input Parameters
                </h3>

                {mode === "image" ? (
                  <div className="space-y-6">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-xs text-slate-400 mb-2">
                          Width (px)
                        </label>
                        <input
                          type="number"
                          value={imgW}
                          onChange={(e) => setImgW(Number(e.target.value))}
                          className="input-field"
                          min="1"
                        />
                      </div>
                      <div>
                        <label className="block text-xs text-slate-400 mb-2">
                          Height (px)
                        </label>
                        <input
                          type="number"
                          value={imgH}
                          onChange={(e) => setImgH(Number(e.target.value))}
                          className="input-field"
                          min="1"
                        />
                      </div>
                    </div>

                    <div>
                      <label className="block text-xs text-slate-400 mb-2">
                        Color Depth
                      </label>
                      <div className="grid grid-cols-3 gap-2">
                        {[1, 8, 24].map((d) => (
                          <button
                            key={d}
                            onClick={() => setImgDepth(d)}
                            className={`p-2 rounded border text-sm font-bold transition ${
                              imgDepth === d
                                ? "bg-blue-600 border-blue-400 text-white"
                                : "bg-slate-800 border-slate-600 text-slate-400"
                            }`}
                          >
                            {d}-bit
                          </button>
                        ))}
                      </div>
                      <div className="mt-2 text-xs text-slate-500">
                        {imgDepth === 1
                          ? "Monochrome (Black/White)"
                          : imgDepth === 8
                          ? "256 Colors / Grayscale"
                          : "True Color (RGB)"}
                      </div>
                    </div>

                    <div className="pt-6 border-t border-slate-700">
                      <div className="flex items-center justify-between mb-2">
                        <label className="text-xs text-slate-400">
                          Common Resolutions
                        </label>
                      </div>
                      <div className="flex flex-wrap gap-2">
                        <button
                          onClick={() => {
                            setImgW(1920);
                            setImgH(1080);
                          }}
                          className="px-3 py-1 bg-slate-800 hover:bg-slate-700 rounded text-xs text-white border border-slate-600"
                        >
                          Full HD
                        </button>
                        <button
                          onClick={() => {
                            setImgW(3840);
                            setImgH(2160);
                          }}
                          className="px-3 py-1 bg-slate-800 hover:bg-slate-700 rounded text-xs text-white border border-slate-600"
                        >
                          4K
                        </button>
                        <button
                          onClick={() => {
                            setImgW(800);
                            setImgH(600);
                          }}
                          className="px-3 py-1 bg-slate-800 hover:bg-slate-700 rounded text-xs text-white border border-slate-600"
                        >
                          SVGA
                        </button>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="space-y-6">
                    <div>
                      <label className="block text-xs text-slate-400 mb-2">
                        Sampling Rate (Hz)
                      </label>
                      <select
                        value={sampleRate}
                        onChange={(e) => setSampleRate(Number(e.target.value))}
                        className="input-field appearance-none cursor-pointer"
                      >
                        <option value="44100">44,100 Hz (CD Quality)</option>
                        <option value="48000">48,000 Hz (DVD)</option>
                        <option value="96000">96,000 Hz (High Res)</option>
                        <option value="22050">22,050 Hz (Radio)</option>
                        <option value="8000">8,000 Hz (Telephone)</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-xs text-slate-400 mb-2">
                        Bit Resolution (Depth)
                      </label>
                      <div className="grid grid-cols-2 gap-2">
                        {[8, 16, 24, 32].map((d) => (
                          <button
                            key={d}
                            onClick={() => setBitDepth(d)}
                            className={`p-2 rounded border text-sm font-bold transition ${
                              bitDepth === d
                                ? "bg-green-600 border-green-400 text-white"
                                : "bg-slate-800 border-slate-600 text-slate-400"
                            }`}
                          >
                            {d}-bit
                          </button>
                        ))}
                      </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-xs text-slate-400 mb-2">
                          Channels
                        </label>
                        <div className="flex bg-slate-900 rounded-lg p-1 border border-slate-700">
                          <button
                            onClick={() => setChannels(1)}
                            className={`flex-1 py-1 text-xs rounded transition-all ${
                              channels === 1
                                ? "bg-slate-700 text-white shadow"
                                : "text-slate-500"
                            }`}
                          >
                            Mono (1)
                          </button>
                          <button
                            onClick={() => setChannels(2)}
                            className={`flex-1 py-1 text-xs rounded transition-all ${
                              channels === 2
                                ? "bg-slate-700 text-white shadow"
                                : "text-slate-500"
                            }`}
                          >
                            Stereo (2)
                          </button>
                        </div>
                      </div>
                      <div>
                        <label className="block text-xs text-slate-400 mb-2">
                          Duration (Seconds)
                        </label>
                        <input
                          type="number"
                          value={duration}
                          onChange={(e) => setDuration(Number(e.target.value))}
                          className="input-field"
                          min="1"
                        />
                      </div>
                    </div>
                  </div>
                )}

                <div className="mt-8 pt-6 border-t border-slate-700">
                  <div className="flex items-start gap-3 p-4 bg-yellow-900/20 border border-yellow-600/30 rounded-lg">
                    <Icon
                      name="HardDrive"
                      className="text-yellow-500 shrink-0"
                      size={20}
                    />
                    <div className="text-xs text-slate-300">
                      <strong>Exam Tip:</strong> Calculation steps often carry
                      marks. Show raw bits/bytes before dividing by 1024.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
