<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ex09: 2014 Q4 - Database Keys & Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div id="root" class="max-w-3xl mx-auto"></div>
    <script type="text/babel">
      const { useState } = React;
      const { Key, Fingerprint, Lock, ShieldCheck, Database, ArrowRight } =
        lucide;

      const TEXT = {
        en: {
          title: "HKDSE 2014 Q4: Database Security & Keys",
          subtitle: "Design a secure Login System using Primary Keys and SQL.",
          step1: "1. Select a Primary Key",
          step2: "2. Construct Login SQL",
          step3: "3. System Validation",
          fields: ["Name", "Email", "Class", "Phone"],
          pk_hint: "Choose a field that is UNIQUE and NOT NULL.",
          sql_hint: "Fill in the blanks to verify user credentials.",
          success: "System Secure! Access Granted.",
          fail: "Security Risk Detected.",
          why_fail: {
            Name: "Names can be duplicated (e.g. two John Smiths).",
            Class: "Many students belong to the same class.",
            Phone: "Phone numbers can change or be shared.",
            Email: "Correct! Emails are unique per user.",
          },
          login_btn: "Attempt Login",
        },
        tc: {
          title: "HKDSE 2014 Q4: 數據庫安全與鍵",
          subtitle: "使用主鍵 (Primary Key) 和 SQL 設計安全登入系統。",
          step1: "1. 選擇主鍵",
          step2: "2. 構建登入 SQL",
          step3: "3. 系統驗證",
          fields: [
            "姓名 (Name)",
            "電郵 (Email)",
            "班別 (Class)",
            "電話 (Phone)",
          ],
          pk_hint: "選擇一個 唯一 (Unique) 且 非空 (Not Null) 的欄位。",
          sql_hint: "填充空格以驗證用戶憑證。",
          success: "系統安全！准許進入。",
          fail: "檢測到安全風險。",
          why_fail: {
            Name: "姓名可能重複 (例如兩個陳大文)。",
            Class: "許多學生屬於同一班別。",
            Phone: "電話號碼可能會更改或共用。",
            Email: "正確！每個用戶的電郵都是唯一的。",
          },
          login_btn: "嘗試登入",
        },
      };

      const App = () => {
        const [lang, setLang] = useState("en");
        const [selectedPK, setSelectedPK] = useState("");
        const [sqlField, setSqlField] = useState("");
        const [sqlOp, setSqlOp] = useState("=");
        const [status, setStatus] = useState("idle"); // idle, success, fail
        const t = TEXT[lang];

        const validate = () => {
          const isPkCorrect =
            selectedPK.includes("Email") || selectedPK.includes("電郵");
          const isSqlCorrect =
            sqlField.toUpperCase() === "EMAIL" ||
            sqlField.includes("Email") ||
            sqlField.includes("電郵");

          if (isPkCorrect && isSqlCorrect) {
            setStatus("success");
          } else {
            setStatus("fail");
          }
        };

        const getFailReason = () => {
          if (!selectedPK) return "Please select a Primary Key.";
          const key = Object.keys(t.why_fail).find(
            (k) => selectedPK.includes(k) || t.why_fail[k] === selectedPK
          );
          // Simple mapping for demo
          if (selectedPK.includes("Name") || selectedPK.includes("姓名"))
            return t.why_fail.Name;
          if (selectedPK.includes("Class") || selectedPK.includes("班別"))
            return t.why_fail.Class;
          if (selectedPK.includes("Phone") || selectedPK.includes("電話"))
            return t.why_fail.Phone;
          if (selectedPK.includes("Email") || selectedPK.includes("電郵"))
            return null;
          return "Invalid Configuration";
        };

        return (
          <div className="min-h-screen bg-slate-900 p-4">
            <header className="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-900 rounded-lg">
                  <Key className="text-blue-400" />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-white">{t.title}</h1>
                  <p className="text-sm text-slate-400">{t.subtitle}</p>
                </div>
              </div>
              <button
                onClick={() => setLang((l) => (l === "en" ? "tc" : "en"))}
                className="btn-lang px-3 py-1 rounded border border-slate-600 text-slate-300"
              >
                {lang === "en" ? "中文" : "ENG"}
              </button>
            </header>

            <div className="space-y-8">
              {/* Step 1: Select PK */}
              <section className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                <h2 className="text-lg font-bold text-green-400 mb-4 flex gap-2 items-center">
                  <Database size={20} /> {t.step1}
                </h2>
                <p className="text-slate-400 mb-4 text-sm">{t.pk_hint}</p>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  {t.fields.map((f) => (
                    <button
                      key={f}
                      onClick={() => setSelectedPK(f)}
                      className={`p-4 rounded-lg border-2 text-center transition-all ${
                        selectedPK === f
                          ? "border-blue-500 bg-blue-900/30 text-white"
                          : "border-slate-600 bg-slate-900 text-slate-400 hover:border-slate-500"
                      }`}
                    >
                      {f}
                    </button>
                  ))}
                </div>
                {selectedPK &&
                  (selectedPK.includes("Email") ||
                  selectedPK.includes("電郵") ? (
                    <div className="mt-4 text-green-400 text-sm flex items-center gap-2">
                      <ShieldCheck size={16} /> {t.why_fail.Email}
                    </div>
                  ) : (
                    <div className="mt-4 text-red-400 text-sm flex items-center gap-2">
                      <Lock size={16} /> {getFailReason()}
                    </div>
                  ))}
              </section>

              {/* Step 2: SQL */}
              <section className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                <h2 className="text-lg font-bold text-yellow-400 mb-4 flex gap-2 items-center">
                  <Fingerprint size={20} /> {t.step2}
                </h2>
                <div className="bg-slate-900 p-4 rounded font-mono text-sm md:text-base border border-slate-600">
                  <span className="text-purple-400">SELECT</span> *{" "}
                  <span className="text-purple-400">FROM</span> Users <br />
                  <span className="text-purple-400">WHERE</span>
                  <input
                    type="text"
                    placeholder="Field?"
                    value={sqlField}
                    onChange={(e) => setSqlField(e.target.value)}
                    className="mx-2 bg-slate-800 border-b border-white text-white w-24 text-center focus:outline-none"
                  />
                  {sqlOp} 'user_input' <br />
                  <span className="text-purple-400">AND</span> Password =
                  'hash_value'
                </div>
              </section>

              {/* Step 3: Action */}
              <div className="flex justify-end">
                <button
                  onClick={validate}
                  className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3 px-8 rounded-full shadow-lg flex items-center gap-2 transition-transform active:scale-95"
                >
                  {t.login_btn} <ArrowRight size={20} />
                </button>
              </div>

              {/* Result Modal/Overlay */}
              {status !== "idle" && (
                <div
                  className={`p-6 rounded-xl border ${
                    status === "success"
                      ? "bg-green-900/20 border-green-500/50"
                      : "bg-red-900/20 border-red-500/50"
                  } animation-fade-in`}
                >
                  <div className="flex items-center gap-4">
                    {status === "success" ? (
                      <ShieldCheck className="text-green-500" size={40} />
                    ) : (
                      <AlertCircle className="text-red-500" size={40} />
                    )}
                    <div>
                      <h3
                        className={`text-xl font-bold ${
                          status === "success"
                            ? "text-green-400"
                            : "text-red-400"
                        }`}
                      >
                        {status === "success" ? t.success : t.fail}
                      </h3>
                      {status === "fail" && (
                        <p className="text-slate-400 text-sm mt-1">
                          {getFailReason() || "Check SQL Syntax (Field Name)."}
                        </p>
                      )}
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
