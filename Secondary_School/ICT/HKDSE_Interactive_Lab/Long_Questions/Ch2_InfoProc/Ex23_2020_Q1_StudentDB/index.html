<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HKDSE 2020 Paper 1B Q1 - Student Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: sans-serif;
      }
    </style>
  </head>
  <body class="p-4 flex justify-center min-h-screen">
    <div id="root" class="w-full max-w-4xl"></div>
    <script type="text/babel">
      const { useState } = React;
      const createLucideIcon = (name) => {
        const iconData = window.lucide?.icons[name];
        if (!iconData) return (props) => <span>?</span>;
        return ({ size, className, ...props }) =>
          React.createElement(
            "svg",
            {
              width: size || 24,
              height: size || 24,
              fill: "none",
              stroke: "currentColor",
              strokeWidth: 2,
              strokeLinecap: "round",
              strokeLinejoin: "round",
              className: `lucide lucide-${name.toLowerCase()} ${
                className || ""
              }`,
              viewBox: "0 0 24 24",
              ...props,
            },
            iconData.map(([tag, attrs], i) =>
              React.createElement(tag, { ...attrs, key: i })
            )
          );
      };
      const Icon = ({ name, ...p }) => {
        const C = createLucideIcon(name);
        return <C {...p} />;
      };

      const TEXT = {
        en: {
          title: "HKDSE 2020 Q1: Student Database",
          subtitle: "SQL Logic & Data Handling",
          scenario:
            "Scenario: A school database 'STUDENT' stores test marks. We need to handle data queries and missing values (Absence).",
          table: "Table: STUDENT",
          code: "CODE",
          name: "SNAME",
          test1: "TEST1",
          test2: "TEST2",
          query: "SQL Query Simulator",
          sql1: "SELECT * FROM STUDENT WHERE TEST1 > 80",
          sql2: "SELECT SNAME, (TEST1+TEST2)/2 AS AVG FROM STUDENT",
          sql3: "SELECT SNAME FROM STUDENT WHERE TEST1 = -1",
          run: "Run Query",
          absLogic: "Absence Handling Logic",
          absDesc:
            "Student 'Lee Lai Lai' was absent for Test 2. How should we calculate the average?",
          m1: "Method 1: Treat Absence as 0",
          m2: "Method 2: Treat Absence as -1 (Ignored)",
          calc: "Calculate Class Average (Test 2)",
          result: "Result:",
          expl0: "Using 0: Average = (97+98+64+47+0+54)/6 = 60.0. (Biased Low)",
          expl1:
            "Using Filter (-1): Average = (97+98+64+47+54)/5 = 72.0. (Fair Representation)",
          correct:
            "Correct! Filtering out the absent student gives a truer class average.",
          issue:
            "Problem: Gives a falsely low average, punishing the class for an absence.",
        },
        tc: {
          title: "HKDSE 2020 Q1: 學生數據庫",
          subtitle: "SQL 邏輯與數據處理",
          scenario:
            "情境：學校數據庫 'STUDENT' 儲存測驗分數。我們需要處理數據查詢和缺失值（缺席）。",
          table: "表格：STUDENT",
          code: "代碼 (CODE)",
          name: "姓名 (SNAME)",
          test1: "測驗1",
          test2: "測驗2",
          query: "SQL 查詢模擬器",
          sql1: "SELECT * FROM STUDENT WHERE TEST1 > 80",
          sql2: "SELECT SNAME, (TEST1+TEST2)/2 AS AVG FROM STUDENT",
          sql3: "SELECT SNAME FROM STUDENT WHERE TEST1 = -1",
          run: "執行查詢",
          absLogic: "缺席處理邏輯",
          absDesc: "學生 'Lee Lai Lai' 缺席了測驗 2。我們應如何計算平均分？",
          m1: "方法 1：將缺席視為 0",
          m2: "方法 2：將缺席視為 -1 (忽略)",
          calc: "計算全班平均分 (測驗 2)",
          result: "結果：",
          expl0: "使用 0：平均 = (97+98+64+47+0+54)/6 = 60.0. (偏低)",
          expl1: "使用過濾 (-1)：平均 = (97+98+64+47+54)/5 = 72.0. (公平反映)",
          correct: "正確！過濾掉缺席學生能反映真實的班級平均水平。",
          issue: "問題：給出錯誤的低平均分，因缺席而懲罰全班。",
        },
      };

      const STUDENT_DATA = [
        { code: "1A01", name: "Wong Ka Ka", t1: 90, t2: 97 },
        { code: "1A02", Chan: "Chan Tai Man", t1: 65, t2: 98 },
        { code: "1A03", name: "Li Lai Kit", t1: 39, t2: 64 },
        { code: "1A04", name: "Ho Tin Man", t1: 89, t2: 47 },
        { code: "1B01", name: "Lee Lai Lai", t1: 67, t2: -1 }, // Absent
        { code: "1B02", name: "Cheung Hoi Yan", t1: 56, t2: 54 },
      ];

      const App = () => {
        const [lang, setLang] = useState("en");
        const t = TEXT[lang];
        const [queryResult, setQueryResult] = useState(null);
        const [absMode, setAbsMode] = useState(null); // 0 or -1

        const runSQL = (type) => {
          if (type === 1) {
            setQueryResult(
              STUDENT_DATA.filter((s) => s.t1 > 80).map(
                (s) => `${s.name} (${s.t1})`
              )
            );
          } else if (type === 2) {
            setQueryResult(
              STUDENT_DATA.map((s) => {
                const v2 = s.t2 === -1 ? 0 : s.t2;
                return `${s.name}: ${((s.t1 + v2) / 2).toFixed(1)}`;
              })
            );
          } else if (type === 3) {
            setQueryResult(
              STUDENT_DATA.filter((s) => s.t2 === -1).map((s) => s.name)
            );
          }
        };

        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center bg-slate-800 p-4 rounded-xl border border-slate-700">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-yellow-600 rounded-lg">
                  <Icon name="Database" className="text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-white">{t.title}</h1>
                  <p className="text-slate-400 text-xs">{t.subtitle}</p>
                </div>
              </div>
              <button
                onClick={() => setLang((l) => (l === "en" ? "tc" : "en"))}
                className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-bold border border-slate-500"
              >
                {lang === "en" ? "中文" : "English"}
              </button>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Table View */}
              <div className="bg-slate-900 border border-slate-700 rounded-xl p-4">
                <h2 className="text-white font-bold mb-4 flex items-center gap-2">
                  <Icon name="Table" /> {t.table}
                </h2>
                <div className="overflow-x-auto">
                  <table className="w-full text-sm text-left text-slate-400">
                    <thead className="text-xs text-slate-200 uppercase bg-slate-800">
                      <tr>
                        <th className="px-4 py-3">{t.code}</th>
                        <th className="px-4 py-3">{t.name}</th>
                        <th className="px-4 py-3">{t.test1}</th>
                        <th className="px-4 py-3">{t.test2}</th>
                      </tr>
                    </thead>
                    <tbody>
                      {STUDENT_DATA.map((s, i) => (
                        <tr
                          key={i}
                          className="border-b border-slate-800 hover:bg-slate-800/50"
                        >
                          <td className="px-4 py-2 font-mono">{s.code}</td>
                          <td className="px-4 py-2">{s.name || s.Chan}</td>
                          <td className="px-4 py-2">{s.t1}</td>
                          <td className="px-4 py-2 text-red-400 font-bold">
                            {s.t2 === -1 ? "ABS (-1)" : s.t2}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>

              {/* Interactive Modules */}
              <div className="space-y-6">
                {/* SQL Simulator */}
                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                  <h3 className="text-blue-400 font-bold mb-2 flex items-center gap-2">
                    <Icon name="Search" /> {t.query}
                  </h3>
                  <div className="space-y-2">
                    <button
                      onClick={() => runSQL(1)}
                      className="w-full text-left p-2 bg-slate-900 rounded border border-slate-600 hover:border-blue-500 text-xs font-mono text-slate-300"
                    >
                      {t.sql1}
                    </button>
                    <button
                      onClick={() => runSQL(3)}
                      className="w-full text-left p-2 bg-slate-900 rounded border border-slate-600 hover:border-blue-500 text-xs font-mono text-slate-300"
                    >
                      {t.sql3} (Find Absent)
                    </button>
                  </div>
                  {queryResult && (
                    <div className="mt-3 p-3 bg-black/30 rounded border border-blue-500/30 font-mono text-sm text-green-400">
                      <strong>Result:</strong> {queryResult.join(", ")}
                    </div>
                  )}
                </div>

                {/* Absence Logic */}
                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                  <h3 className="text-orange-400 font-bold mb-2 flex items-center gap-2">
                    <Icon name="Calculator" /> {t.absLogic}
                  </h3>
                  <p className="text-xs text-slate-400 mb-3">{t.absDesc}</p>

                  <div className="grid grid-cols-2 gap-2 mb-3">
                    <button
                      onClick={() => setAbsMode(0)}
                      className={`p-2 rounded text-xs font-bold border ${
                        absMode === 0
                          ? "bg-red-600 border-red-500 text-white"
                          : "bg-slate-700 border-slate-600 text-slate-300"
                      }`}
                    >
                      {t.m1}
                    </button>
                    <button
                      onClick={() => setAbsMode(-1)}
                      className={`p-2 rounded text-xs font-bold border ${
                        absMode === -1
                          ? "bg-green-600 border-green-500 text-white"
                          : "bg-slate-700 border-slate-600 text-slate-300"
                      }`}
                    >
                      {t.m2}
                    </button>
                  </div>

                  {absMode !== null && (
                    <div
                      className={`p-3 rounded text-sm ${
                        absMode === -1
                          ? "bg-green-900/40 text-green-300 border border-green-500"
                          : "bg-red-900/40 text-red-300 border border-red-500"
                      }`}
                    >
                      <div className="font-bold flex items-center gap-2">
                        <Icon name={absMode === -1 ? "Check" : "X"} size={16} />
                        {t.result} {absMode === 0 ? "60.0" : "72.0"}
                      </div>
                      <div className="mt-1 text-xs opacity-90">
                        {absMode === 0 ? t.expl0 : t.expl1}
                      </div>
                      <div className="mt-2 font-bold text-xs uppercase tracking-wider">
                        {absMode === 0 ? t.issue : t.correct}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      };
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
