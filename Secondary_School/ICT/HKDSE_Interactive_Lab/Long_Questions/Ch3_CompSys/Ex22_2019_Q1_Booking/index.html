<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HKDSE 2019 Paper 1B Q1 - Clinic Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: sans-serif;
      }
      .slot {
        transition: all 0.3s;
      }
      .slot.booked {
        background-color: #ef4444;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .blink-update {
        animation: flash 1s;
      }
      @keyframes flash {
        0% {
          background-color: #fbbf24;
        }
        100% {
          background-color: inherit;
        }
      }
    </style>
  </head>
  <body class="p-4 flex justify-center min-h-screen">
    <div id="root" class="w-full max-w-4xl"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const createLucideIcon = (name) => {
        const iconData = window.lucide?.icons[name];
        if (!iconData) return (props) => <span>?</span>;
        return ({ size, className, ...props }) =>
          React.createElement(
            "svg",
            {
              width: size || 24,
              height: size || 24,
              fill: "none",
              stroke: "currentColor",
              strokeWidth: 2,
              strokeLinecap: "round",
              strokeLinejoin: "round",
              className: `lucide lucide-${name.toLowerCase()} ${
                className || ""
              }`,
              viewBox: "0 0 24 24",
              ...props,
            },
            iconData.map(([tag, attrs], i) =>
              React.createElement(tag, { ...attrs, key: i })
            )
          );
      };
      const Icon = ({ name, ...p }) => {
        const C = createLucideIcon(name);
        return <C {...p} />;
      };

      const TEXT = {
        en: {
          title: "HKDSE 2019 Q1: Clinic Booking System",
          subtitle: "Real-time Processing & Concurrency",
          scenario:
            "Scenario: A government web-based system for booking clinic appointments. It must handle simultaneous access from multiple citizens.",
          view: "Access Method:",
          web: "Web Browser",
          app: "Mobile App",
          slots: "Available Appointments (Today)",
          book: "Book",
          booked: "Full",
          yours: "Booked by You",
          feed: "Live System Activity Log",
          sysMsg: "System: Multi-user environment active...",
          benefit:
            "Concept Check: What is the benefit of a Real-time System here?",
          ans1: "Citizens know immediately if a slot is available.",
          ans2: "It saves data storage space.",
          correct: "Correct! Real-time updates prevent double-booking.",
          incorrect: "Incorrect. Think about user convenience.",
          reset: "Reset Simulation",
        },
        tc: {
          title: "HKDSE 2019 Q1: 診所預約系統",
          subtitle: "實時處理與並發性",
          scenario:
            "情境：政府的網上診所預約系統。它必須處理來自多個市民的同時存取。",
          view: "存取方式：",
          web: "網頁瀏覽器",
          app: "流動應用程式",
          slots: "可預約時段 (今日)",
          book: "預約",
          booked: "已滿",
          yours: "你已預約",
          feed: "系統實時活動日誌",
          sysMsg: "系統：多用戶環境已啟動...",
          benefit: "概念檢查：實時系統的主要好處是什麼？",
          ans1: "市民可即時知道時段是否可用。",
          ans2: "它可以節省數據儲存空間。",
          correct: "正確！實時更新可防止重複預約。",
          incorrect: "不正確。請考慮用戶便利性。",
          reset: "重置模擬",
        },
      };

      const App = () => {
        const [lang, setLang] = useState("en");
        const t = TEXT[lang];
        const [view, setView] = useState("web");
        const [slots, setSlots] = useState(
          Array(8)
            .fill(null)
            .map((_, i) => ({ id: i, time: `${9 + i}:00`, status: "open" }))
        );
        const [logs, setLogs] = useState([]);
        const [feedback, setFeedback] = useState(null);

        // Simulation of other users
        useEffect(() => {
          const timer = setInterval(() => {
            setSlots((prev) => {
              const openSlots = prev.filter((s) => s.status === "open");
              if (openSlots.length > 0 && Math.random() > 0.6) {
                const target =
                  openSlots[Math.floor(Math.random() * openSlots.length)];
                setLogs((l) => [
                  `[${new Date().toLocaleTimeString()}] Citizen #85${Math.floor(
                    Math.random() * 99
                  )} booked ${target.time}`,
                  ...l.slice(0, 4),
                ]);
                return prev.map((s) =>
                  s.id === target.id ? { ...s, status: "booked" } : s
                );
              }
              return prev;
            });
          }, 2000);
          return () => clearInterval(timer);
        }, []);

        const book = (id) => {
          setSlots((prev) =>
            prev.map((s) => (s.id === id ? { ...s, status: "yours" } : s))
          );
          setLogs((l) => [
            `[${new Date().toLocaleTimeString()}] You booked ${
              slots.find((s) => s.id === id).time
            }`,
            ...l.slice(0, 4),
          ]);
        };

        const reset = () => {
          setSlots(
            Array(8)
              .fill(null)
              .map((_, i) => ({ id: i, time: `${9 + i}:00`, status: "open" }))
          );
          setLogs([]);
          setFeedback(null);
        };

        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center bg-slate-800 p-4 rounded-xl border border-slate-700">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-red-600 rounded-lg">
                  <Icon name="Activity" className="text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-white">{t.title}</h1>
                  <p className="text-slate-400 text-xs">{t.subtitle}</p>
                </div>
              </div>
              <button
                onClick={() => setLang((l) => (l === "en" ? "tc" : "en"))}
                className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-bold border border-slate-500"
              >
                {lang === "en" ? "中文" : "English"}
              </button>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Simulation View */}
              <div className="lg:col-span-2 space-y-4">
                <div className="flex justify-between items-center">
                  <h2 className="text-slate-300 font-bold">{t.view}</h2>
                  <div className="flex bg-slate-800 rounded-lg p-1">
                    <button
                      onClick={() => setView("web")}
                      className={`px-4 py-1 rounded ${
                        view === "web"
                          ? "bg-slate-600 text-white"
                          : "text-slate-400"
                      }`}
                    >
                      {t.web}
                    </button>
                    <button
                      onClick={() => setView("app")}
                      className={`px-4 py-1 rounded ${
                        view === "app"
                          ? "bg-slate-600 text-white"
                          : "text-slate-400"
                      }`}
                    >
                      {t.app}
                    </button>
                  </div>
                </div>

                {/* Device Frame */}
                <div
                  className={`border-4 border-slate-700 rounded-xl bg-white overflow-hidden text-slate-800 transition-all ${
                    view === "app"
                      ? "mx-auto w-[320px] min-h-[500px] border-x-[12px] border-y-[24px] rounded-[32px]"
                      : "w-full h-auto"
                  }`}
                >
                  <div className="bg-blue-600 p-4 text-white flex justify-between items-center">
                    <span className="font-bold">GovHK Clinic</span>
                    <Icon name="Menu" />
                  </div>
                  <div className="p-4 bg-slate-100 min-h-[400px]">
                    <h3 className="font-bold mb-4">{t.slots}</h3>
                    <div className="space-y-2">
                      {slots.map((slot) => (
                        <div
                          key={slot.id}
                          className={`p-3 rounded-lg flex justify-between items-center bg-white shadow-sm border ${
                            slot.status === "yours"
                              ? "border-green-500 bg-green-50"
                              : ""
                          }`}
                        >
                          <span className="font-mono font-bold text-lg">
                            {slot.time}
                          </span>
                          {slot.status === "open" ? (
                            <button
                              onClick={() => book(slot.id)}
                              className="px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-500 text-sm font-bold"
                            >
                              {t.book}
                            </button>
                          ) : (
                            <span
                              className={`text-sm font-bold ${
                                slot.status === "yours"
                                  ? "text-green-600"
                                  : "text-red-500"
                              }`}
                            >
                              {slot.status === "yours" ? t.yours : t.booked}
                            </span>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>

              {/* Logs & Concept */}
              <div className="space-y-6">
                <div className="bg-slate-900 border border-slate-700 rounded-xl p-4 min-h-[200px]">
                  <h3 className="text-green-400 font-mono text-sm mb-2 flex items-center gap-2">
                    <Icon name="Terminal" size={14} /> {t.feed}
                  </h3>
                  <div className="space-y-1 font-mono text-xs text-slate-400">
                    <div className="text-yellow-500">{t.sysMsg}</div>
                    {logs.map((l, i) => (
                      <div key={i} className="animate-fade-in">
                        {l}
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-slate-800 p-5 rounded-xl border border-slate-700">
                  <h3 className="text-white font-bold mb-3 flex items-center gap-2">
                    <Icon name="Brain" className="text-purple-400" />{" "}
                    {t.benefit}
                  </h3>
                  <div className="space-y-2">
                    <button
                      onClick={() =>
                        setFeedback({ correct: true, msg: t.correct })
                      }
                      className="w-full text-left p-3 rounded bg-slate-900 hover:bg-slate-700 border border-slate-600 text-slate-300 text-sm"
                    >
                      {t.ans1}
                    </button>
                    <button
                      onClick={() =>
                        setFeedback({ correct: false, msg: t.incorrect })
                      }
                      className="w-full text-left p-3 rounded bg-slate-900 hover:bg-slate-700 border border-slate-600 text-slate-300 text-sm"
                    >
                      {t.ans2}
                    </button>
                  </div>
                  {feedback && (
                    <div
                      className={`mt-3 p-3 rounded text-sm font-bold ${
                        feedback.correct
                          ? "bg-green-900/50 text-green-300"
                          : "bg-red-900/50 text-red-300"
                      }`}
                    >
                      {feedback.msg}
                    </div>
                  )}
                </div>
                <button
                  onClick={reset}
                  className="w-full py-2 bg-slate-700 text-white rounded border border-slate-600 hover:bg-slate-600 text-sm"
                >
                  {t.reset}
                </button>
              </div>
            </div>
          </div>
        );
      };
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
