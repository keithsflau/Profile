<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HKDSE 2015 Paper 1B Q1 - Drone Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: sans-serif;
      }
      .drone-view {
        background: linear-gradient(to bottom, #3b82f6, #60a5fa);
        position: relative;
        overflow: hidden;
      }
      .drone {
        transition: all 0.5s ease-out;
      }
      .signal-bar {
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body class="p-4 flex justify-center min-h-screen">
    <div id="root" class="w-full max-w-4xl"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const createLucideIcon = (name) => {
        const iconData = window.lucide?.icons[name];
        if (!iconData) return (props) => <span>?</span>;
        return ({ size, className, ...props }) =>
          React.createElement(
            "svg",
            {
              width: size || 24,
              height: size || 24,
              fill: "none",
              stroke: "currentColor",
              strokeWidth: 2,
              strokeLinecap: "round",
              strokeLinejoin: "round",
              className: `lucide lucide-${name.toLowerCase()} ${
                className || ""
              }`,
              viewBox: "0 0 24 24",
              ...props,
            },
            iconData.map(([tag, attrs], i) =>
              React.createElement(tag, { ...attrs, key: i })
            )
          );
      };
      const Icon = ({ name, ...p }) => {
        const C = createLucideIcon(name);
        return <C {...p} />;
      };

      const TEXT = {
        en: {
          title: "HKDSE 2015 Q1: Drone Control System",
          subtitle: "Network Connections & Interface Design",
          mission: "Mission Briefing",
          mission1: "Mission 1: Backyard Photography (Range: 50m)",
          mission2: "Mission 2: Mountain Rescue (Range: 5km)",
          connectWifi: "Connect via Wi-Fi (Router)",
          connect4G: "Connect via Mobile Network (4G/5G)",
          status: "System Status",
          range: "Max Range",
          latency: "Latency",
          bandwidth: "Video Quality",
          start: "Launch Drone",
          abort: "Abort Mission",
          wifiDesc:
            "Direct connection or via Router. High speed, Low latency, Short range.",
          mobileDesc:
            "Connection via ISP towers. Unlimited range (with coverage), Higher latency, Data costs.",
          success: "Mission Success! Connection stable.",
          failRange: "Mission Failed! Signal lost (Out of Range).",
          failQuality:
            "Mission Failed! Video feed too laggy for precision flying.",
          currentMode: "Current Connection:",
          controls: "Touch Interface Controls",
        },
        tc: {
          title: "HKDSE 2015 Q1: 無人機控制系統",
          subtitle: "網絡連接與介面設計",
          mission: "任務簡報",
          mission1: "任務 1：後院攝影（範圍：50米）",
          mission2: "任務 2：山區搜救（範圍：5公里）",
          connectWifi: "連接 Wi-Fi（路由器）",
          connect4G: "連接流動網絡（4G/5G）",
          status: "系統狀態",
          range: "最大範圍",
          latency: "延遲",
          bandwidth: "視頻畫質",
          start: "發射無人機",
          abort: "中止任務",
          wifiDesc: "直接連接或通過路由器。高速、低延遲、短距離。",
          mobileDesc:
            "通過 ISP 發射塔連接。無限範圍（有覆蓋情況下）、較高延遲、數據成本。",
          success: "任務成功！連接穩定。",
          failRange: "任務失敗！信號丟失（超出範圍）。",
          failQuality: "任務失敗！視頻傳輸延遲過高，無法精確飛行。",
          currentMode: "當前連接：",
          controls: "觸控介面控制",
        },
      };

      const MODES = {
        wifi: { range: 100, latency: 20, quality: "4K", color: "green" },
        mobile: { range: 10000, latency: 150, quality: "720p", color: "blue" },
      };

      const App = () => {
        const [lang, setLang] = useState("en");
        const t = TEXT[lang];
        const [mode, setMode] = useState("wifi"); // wifi, mobile
        const [mission, setMission] = useState(1); // 1 or 2
        const [flying, setFlying] = useState(false);
        const [result, setResult] = useState(null); // 'success', 'fail-range', 'fail-quality'
        const [dronePos, setDronePos] = useState(0);

        const launch = () => {
          setFlying(true);
          setResult(null);
          setDronePos(0);

          // Simulate Flight
          setTimeout(() => {
            const dict = MODES[mode];
            const distance = mission === 1 ? 50 : 5000;

            if (distance > dict.range) {
              setResult("fail");
              setFlying(false);
            } else {
              setDronePos(80); // Fly out
              setTimeout(() => {
                setResult("success");
                setFlying(false);
              }, 1500);
            }
          }, 1000);
        };

        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center bg-slate-800 p-4 rounded-xl border border-slate-700">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-600 rounded-lg">
                  <Icon name="Plane" className="text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-white">{t.title}</h1>
                  <p className="text-slate-400 text-xs">{t.subtitle}</p>
                </div>
              </div>
              <button
                onClick={() => setLang((l) => (l === "en" ? "tc" : "en"))}
                className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-bold border border-slate-500"
              >
                {lang === "en" ? "中文" : "English"}
              </button>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Control Panel */}
              <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 space-y-6">
                {/* Mission Select */}
                <div>
                  <h2 className="text-slate-300 font-bold mb-2 flex items-center gap-2">
                    <Icon name="Map" size={16} /> {t.mission}
                  </h2>
                  <div className="space-y-2">
                    <button
                      onClick={() => {
                        setMission(1);
                        setResult(null);
                      }}
                      className={`w-full p-3 rounded text-left border ${
                        mission === 1
                          ? "bg-blue-900/50 border-blue-500 text-blue-300"
                          : "bg-slate-900 border-slate-700 text-slate-500"
                      }`}
                    >
                      {t.mission1}
                    </button>
                    <button
                      onClick={() => {
                        setMission(2);
                        setResult(null);
                      }}
                      className={`w-full p-3 rounded text-left border ${
                        mission === 2
                          ? "bg-orange-900/50 border-orange-500 text-orange-300"
                          : "bg-slate-900 border-slate-700 text-slate-500"
                      }`}
                    >
                      {t.mission2}
                    </button>
                  </div>
                </div>

                {/* Connection Mode */}
                <div>
                  <h2 className="text-slate-300 font-bold mb-2 flex items-center gap-2">
                    <Icon name="Wifi" size={16} /> {t.currentMode}
                  </h2>
                  <div className="grid grid-cols-2 gap-2">
                    <button
                      onClick={() => setMode("wifi")}
                      className={`p-3 rounded border font-bold flex flex-col items-center gap-2 ${
                        mode === "wifi"
                          ? "bg-green-600 text-white border-green-500"
                          : "bg-slate-700 text-slate-400 border-slate-600"
                      }`}
                    >
                      <Icon name="Wifi" /> {lang === "en" ? "Wi-Fi" : "Wi-Fi"}
                    </button>
                    <button
                      onClick={() => setMode("mobile")}
                      className={`p-3 rounded border font-bold flex flex-col items-center gap-2 ${
                        mode === "mobile"
                          ? "bg-blue-600 text-white border-blue-500"
                          : "bg-slate-700 text-slate-400 border-slate-600"
                      }`}
                    >
                      <Icon name="Signal" /> {lang === "en" ? "4G/5G" : "4G/5G"}
                    </button>
                  </div>
                  <p className="text-xs text-slate-400 mt-2 italic">
                    {mode === "wifi" ? t.wifiDesc : t.mobileDesc}
                  </p>
                </div>

                {/* Launch */}
                <button
                  onClick={launch}
                  disabled={flying}
                  className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex justify-center items-center gap-2 ${
                    flying
                      ? "bg-slate-600 opacity-50"
                      : "bg-red-600 hover:bg-red-500 text-white"
                  }`}
                >
                  <Icon
                    name={flying ? "Loader2" : "Rocket"}
                    className={flying ? "animate-spin" : ""}
                  />
                  {flying ? "..." : t.start}
                </button>

                {/* Feedback */}
                {result && (
                  <div
                    className={`p-4 rounded-lg border flex items-center gap-3 ${
                      result === "success"
                        ? "bg-green-900/50 border-green-500 text-green-300"
                        : "bg-red-900/50 border-red-500 text-red-300"
                    }`}
                  >
                    <Icon
                      name={
                        result === "success" ? "CheckCircle" : "AlertTriangle"
                      }
                      size={24}
                    />
                    <div>
                      <div className="font-bold">
                        {result === "success" ? "SUCCESS" : "FAILURE"}
                      </div>
                      <div className="text-sm">
                        {result === "success" ? t.success : t.failRange}
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* Visualizer */}
              <div className="space-y-6">
                {/* Drone View */}
                <div className="bg-slate-900 rounded-xl border border-slate-700 h-64 drone-view flex items-end justify-center pb-4 relative">
                  <div className="absolute top-4 left-4 text-white/80 text-xs font-mono bg-black/30 p-2 rounded">
                    CAM: {MODES[mode].quality}
                    <br />
                    PING: {MODES[mode].latency}ms
                    <br />
                    DIST:{" "}
                    {mission === 1
                      ? flying
                        ? ((dronePos / 80) * 50).toFixed(0)
                        : 0
                      : flying
                      ? ((dronePos / 80) * 5).toFixed(1)
                      : 0}{" "}
                    {mission === 1 ? "m" : "km"}
                  </div>
                  <div
                    className="drone relative"
                    style={{
                      transform: `translateY(-${
                        flying ? dronePos : 0
                      }px) scale(${flying ? 0.5 : 1})`,
                    }}
                  >
                    <Icon
                      name="Aperture"
                      size={64}
                      className="text-white/90 animate-spin-slow"
                    />
                    <div
                      className={`absolute -top-4 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full ${
                        flying ? "bg-green-500 animate-ping" : "bg-red-500"
                      }`}
                    ></div>
                  </div>
                  <div className="absolute bottom-0 w-full h-12 bg-green-800/80 skew-x-12 origin-bottom"></div>
                </div>

                {/* Stats */}
                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                  <h3 className="text-slate-400 font-bold mb-3">{t.status}</h3>
                  <div className="grid grid-cols-3 gap-4 text-center">
                    <div className="bg-slate-700 p-2 rounded">
                      <div className="text-xs text-slate-400">{t.range}</div>
                      <div className="text-white font-mono">
                        {mode === "wifi" ? "100m" : "Unlimited"}
                      </div>
                    </div>
                    <div className="bg-slate-700 p-2 rounded">
                      <div className="text-xs text-slate-400">{t.latency}</div>
                      <div className="text-white font-mono">
                        {MODES[mode].latency}ms
                      </div>
                    </div>
                    <div className="bg-slate-700 p-2 rounded">
                      <div className="text-xs text-slate-400">
                        {t.bandwidth}
                      </div>
                      <div className="text-green-400 font-mono">
                        {MODES[mode].quality}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
