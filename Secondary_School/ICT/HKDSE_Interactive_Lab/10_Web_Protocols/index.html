<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HKDSE ICT - Web Security & Auth</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }
      .slide-up {
        animation: slide-up 0.3s ease-out;
      }
      @keyframes slide-up {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .msg-bubble {
        max-width: 80%;
        border-radius: 12px;
        padding: 10px;
        margin-bottom: 8px;
        font-size: 14px;
      }
      .msg-sent {
        background: #3b82f6;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 2px;
      }
      .msg-received {
        background: #334155;
        color: white;
        margin-right: auto;
        border-bottom-left-radius: 2px;
      }
    </style>
  </head>
  <body class="min-h-screen p-8 bg-slate-900 flex justify-center items-center">
    <div id="root" class="w-full max-w-4xl"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // --- LUCIDE ICON SHIM ---
      const LucideIcon = ({ name, size = 24, className = "" }) => {
        const formatName = (n) =>
          n
            .split("-")
            .map((p) => p.charAt(0).toUpperCase() + p.slice(1))
            .join("");
        const iconName = formatName(name);

        const [svgHtml, setSvgHtml] = useState("");

        useEffect(() => {
          if (
            window.lucide &&
            window.lucide.icons &&
            window.lucide.icons[iconName] &&
            typeof window.lucide.icons[iconName].toSvg === "function"
          ) {
            setSvgHtml(
              window.lucide.icons[iconName].toSvg({
                width: size,
                height: size,
                class: className,
              })
            );
          }
        }, [name, size, className, iconName]);

        return (
          <span
            dangerouslySetInnerHTML={{ __html: svgHtml }}
            style={{ display: "inline-flex" }}
          />
        );
      };
      const Lock = (p) => <LucideIcon name="lock" {...p} />;
      const ShieldCheck = (p) => <LucideIcon name="shield-check" {...p} />;
      const Key = (p) => <LucideIcon name="key" {...p} />;
      const User = (p) => <LucideIcon name="user" {...p} />;
      const ArrowRight = (p) => <LucideIcon name="arrow-right" {...p} />;
      const MessageSquare = (p) => <LucideIcon name="message-square" {...p} />;
      const AlertTriangle = (p) => <LucideIcon name="alert-triangle" {...p} />;
      const CheckCircle = (p) => <LucideIcon name="check-circle" {...p} />;
      // --- END SHIM ---

      const AuthSim = () => {
        const [step, setStep] = useState(1);
        const [otp, setOtp] = useState("");
        const [generatedOtp, setGeneratedOtp] = useState(null);

        const generateOTP = () => {
          const code = Math.floor(100000 + Math.random() * 900000);
          setGeneratedOtp(code);
          setStep(2);
        };

        const verifyOTP = () => {
          if (parseInt(otp) === generatedOtp) setStep(3);
          else alert("Invalid OTP");
        };

        return (
          <div className="bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden flex flex-col md:flex-row min-h-[400px]">
            <div className="flex-1 p-8 flex flex-col justify-center">
              <div className="mb-8">
                <div className="w-12 h-12 bg-cyan-600 rounded-xl flex items-center justify-center mb-4">
                  <Lock className="text-white" />
                </div>
                <h2 className="text-2xl font-bold text-white">Secure Login</h2>
                <p className="text-slate-400 text-sm">
                  Two-Factor Authentication (2FA)
                </p>
              </div>
              {step === 1 && (
                <div className="space-y-4 slide-up">
                  <input
                    type="text"
                    placeholder="Username"
                    className="w-full bg-slate-900 border border-slate-600 rounded p-3 text-white"
                  />
                  <input
                    type="password"
                    placeholder="Password"
                    className="w-full bg-slate-900 border border-slate-600 rounded p-3 text-white"
                  />
                  <button
                    onClick={generateOTP}
                    className="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded transition-colors"
                  >
                    Login
                  </button>
                </div>
              )}
              {step === 2 && (
                <div className="space-y-4 slide-up">
                  <div className="bg-yellow-900/30 text-yellow-200 text-sm p-3 rounded border border-yellow-500/30 flex gap-2">
                    <AlertTriangle size={16} /> Enter the code sent to your
                    device.
                  </div>
                  <input
                    type="text"
                    placeholder="000000"
                    value={otp}
                    onChange={(e) => setOtp(e.target.value)}
                    maxLength={6}
                    className="w-full bg-slate-900 border border-slate-600 rounded p-3 text-white text-center font-mono text-xl tracking-widest"
                  />
                  <button
                    onClick={verifyOTP}
                    className="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded transition-colors"
                  >
                    Verify
                  </button>
                </div>
              )}
              {step === 3 && (
                <div className="text-center slide-up">
                  <div className="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <CheckCircle size={32} className="text-white" />
                  </div>
                  <h3 className="text-xl font-bold text-white">
                    Authenticated!
                  </h3>
                  <button
                    onClick={() => {
                      setStep(1);
                      setOtp("");
                    }}
                    className="mt-4 text-slate-400 hover:text-white underline"
                  >
                    Logout
                  </button>
                </div>
              )}
            </div>
            <div className="w-full md:w-80 bg-slate-950 border-l border-slate-800 p-6 flex flex-col items-center relative">
              <div className="absolute top-4 text-slate-600 text-xs font-bold uppercase tracking-widest">
                User's Device
              </div>
              <div className="mt-8 w-64 h-[500px] bg-black rounded-[30px] border-4 border-slate-700 relative overflow-hidden flex flex-col">
                <div className="bg-slate-900 flex-1 p-4 pt-8">
                  <div className="text-center text-slate-500 text-xs mb-4">
                    Messages
                  </div>
                  {generatedOtp && (
                    <div className="msg-bubble msg-received slide-up">
                      <div className="font-bold mb-1 flex items-center gap-1">
                        <ShieldCheck size={12} /> SecureSys
                      </div>
                      Your verification code is:{" "}
                      <span className="text-cyan-400 font-mono font-bold text-lg">
                        {generatedOtp}
                      </span>
                      . Do not share this code.
                    </div>
                  )}
                </div>
                <div className="h-12 bg-black flex items-center justify-center">
                  <div className="w-12 h-1 bg-slate-700 rounded-full"></div>
                </div>
              </div>
              <div className="mt-4 p-4 bg-slate-800 rounded-lg text-xs text-slate-300 w-full">
                <strong>Paper 1B Q2a:</strong> One-Time Password (OTP)
                characteristics:
                <ul className="list-disc pl-4 mt-1 space-y-1">
                  <li>Valid for only one login session.</li>
                  <li>Expires after a short time.</li>
                </ul>
              </div>
            </div>
          </div>
        );
      };

      const PKISim = () => {
        const [state, setState] = useState("start");
        return (
          <div className="bg-slate-800 rounded-2xl border border-slate-700 p-8 mt-8">
            <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2">
              <Key className="text-yellow-400" /> PKI: Sending Document
            </h3>
            <div className="flex flex-col md:flex-row items-center justify-between gap-8 relative">
              <div className="text-center w-32">
                <div className="w-16 h-16 bg-pink-600 rounded-full flex items-center justify-center mx-auto mb-2 relative">
                  <User className="text-white" size={32} />
                  <div className="absolute -bottom-1 -right-1 bg-slate-900 border border-slate-600 rounded-full p-1">
                    <span className="text-[10px] bg-green-500 text-black px-1 rounded font-bold">
                      Eva
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => setState("sending")}
                  disabled={state !== "start"}
                  className="text-xs bg-slate-700 px-3 py-1 rounded text-white hover:bg-slate-600 disabled:opacity-50"
                >
                  Send Doc
                </button>
              </div>
              <div className="flex-1 h-32 relative border-b-2 border-dashed border-slate-600 flex items-center justify-center">
                <div
                  className={`absolute transition-all duration-1000 flex flex-col items-center ${
                    state === "start"
                      ? "left-0"
                      : state === "sending"
                      ? "left-1/2 -translate-x-1/2"
                      : "left-[90%]"
                  }`}
                >
                  <div
                    className={`w-12 h-16 bg-white rounded border flex items-center justify-center transition-colors ${
                      state === "sending" || state === "encrypted"
                        ? "bg-yellow-100 border-yellow-500"
                        : ""
                    }`}
                  >
                    {state === "sending" || state === "encrypted" ? (
                      <Lock size={20} className="text-yellow-600" />
                    ) : (
                      <MessageSquare size={20} className="text-slate-800" />
                    )}
                  </div>
                  <div className="text-[10px] mt-1 text-slate-400 whitespace-nowrap">
                    {state === "start"
                      ? "Raw Doc"
                      : state === "sending"
                      ? "Encrypted"
                      : "Decrypted"}
                  </div>
                </div>
                {state === "sending" && (
                  <div className="absolute top-0 text-center animate-bounce">
                    <div className="bg-yellow-900 text-yellow-200 text-xs px-2 py-1 rounded mb-1 flex items-center gap-1">
                      <Key size={10} /> Paul's Public Key
                    </div>
                    <ArrowRight className="rotate-90 mx-auto text-yellow-500" />
                  </div>
                )}
              </div>
              <div className="text-center w-32">
                <div className="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-2 relative">
                  <User className="text-white" size={32} />
                  <div className="absolute -bottom-1 -right-1 bg-slate-900 border border-slate-600 rounded-full p-1">
                    <span className="text-[10px] bg-blue-400 text-black px-1 rounded font-bold">
                      Paul
                    </span>
                  </div>
                </div>
                {state === "sending" && (
                  <button
                    onClick={() => setState("decrypted")}
                    className="text-xs bg-green-600 px-3 py-1 rounded text-white font-bold animate-pulse"
                  >
                    Decrypt
                  </button>
                )}
                {state === "decrypted" && (
                  <div className="text-xs text-green-400 font-bold">
                    Reading...
                  </div>
                )}
              </div>
            </div>
            <div className="mt-8 p-4 bg-slate-900 rounded-lg text-sm text-slate-300">
              <strong className="text-yellow-400">Mechanism (Q2b):</strong>
              <ul className="list-disc pl-4 mt-2 space-y-2">
                <li>
                  Eva encrypts the document using{" "}
                  <span className="text-white font-bold underline">
                    Paul's Public Key
                  </span>
                  .
                </li>
                <li>
                  Only Paul can decrypt it using{" "}
                  <span className="text-white font-bold underline">
                    Paul's Private Key
                  </span>
                  .
                </li>
                <li>This ensures confidentiality.</li>
              </ul>
            </div>
          </div>
        );
      };

      const App = () => (
        <div>
          <header className="mb-8 text-center">
            <h1 className="text-3xl font-bold text-white mb-2">
              Web Security Lab
            </h1>
            <p className="text-slate-400">
              Paper 1B Q2: Authentication & Encryption
            </p>
          </header>
          <AuthSim />
          <PKISim />
        </div>
      );

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
