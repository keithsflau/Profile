<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Acids & Alkalis Lab | é…¸é¹¼æ»´å®šæ¨¡æ“¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .liquid-transition {
        transition: height 0.2s linear, background-color 0.5s ease;
      }

      /* Glassware shapes */
      .burette {
        width: 40px;
        height: 300px;
        border-left: 2px solid rgba(255, 255, 255, 0.5);
        border-right: 2px solid rgba(255, 255, 255, 0.5);
        border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 0 0 4px 4px;
        position: relative;
        overflow: hidden;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
      }
      .burette::after {
        /* Graduations */
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 10px;
        height: 100%;
        background-image: repeating-linear-gradient(
          white 0 1px,
          transparent 1px 10%
        );
        opacity: 0.5;
      }

      .flask {
        width: 120px;
        height: 140px;
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 4px 4px 40px 40px; /* Conical-ish */
        position: relative;
        overflow: hidden;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
      }
    </style>
  </head>

  <body class="bg-slate-900 text-white min-h-screen flex flex-col">
    <!-- Header -->
    <header
      class="bg-pink-900/20 border-b border-pink-900/50 px-6 py-4 flex justify-between items-center z-10"
    >
      <div class="flex items-center gap-4">
        <a
          href="../index.html"
          class="text-pink-300 hover:text-white transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 19l-7-7m0 0l7-7m-7 7h18"
            />
          </svg>
        </a>
        <h1 class="text-xl font-bold text-pink-400">
          Titration Master
          <span class="text-slate-500 font-medium text-sm ml-2">é…¸é¹¼æ»´å®š</span>
        </h1>
      </div>
      <div class="flex gap-4 items-center">
        <span class="text-xs text-slate-400">Target: Neutralize the Acid</span>
      </div>
    </header>

    <main
      class="flex-grow flex flex-col md:flex-row items-center justify-center gap-12 p-8 relative overflow-hidden"
    >
      <!-- Controls Left -->
      <div
        class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700/50 backdrop-blur-sm w-full max-w-xs z-10"
      >
        <h3
          class="text-xs font-bold text-pink-400 uppercase tracking-widest mb-4"
        >
          Setup
        </h3>

        <div class="mb-6">
          <label class="block text-xs text-slate-400 mb-2"
            >Indicator (æŒ‡ç¤ºåŠ‘)</label
          >
          <select
            id="indicator-select"
            onchange="resetSim()"
            class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm focus:border-pink-500 outline-none"
          >
            <option value="universal">Universal Indicator (é€šç”¨æŒ‡ç¤ºåŠ‘)</option>
            <option value="methyl">Methyl Orange (ç”²åŸºæ©™)</option>
            <option value="phenol">Phenolphthalein (é…šé…ž)</option>
            <option value="litmus">Litmus (çŸ³è•Š)</option>
          </select>
        </div>

        <div class="mb-6">
          <label class="block text-xs text-slate-400 mb-2"
            >Acid Strength (Initial pH)</label
          >
          <div
            class="flex items-center justify-between text-sm font-mono text-pink-300 font-bold bg-slate-900 p-2 rounded"
          >
            <span>pH: <span id="ph-display">1.0</span></span>
          </div>
        </div>

        <button
          onclick="resetSim()"
          class="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded text-sm text-white transition-colors"
        >
          Reset Experiment
        </button>
      </div>

      <!-- Apparatus Center -->
      <div class="relative flex flex-col items-center z-0">
        <!-- Burette (Alkali) -->
        <div class="flex flex-col items-center">
          <span class="text-xs text-blue-300 mb-1">NaOH (Alkali)</span>
          <div class="burette">
            <div
              id="burette-liquid"
              class="absolute bottom-0 w-full bg-slate-200/20 liquid-transition"
              style="height: 100%"
            ></div>
          </div>
          <!-- Tap Mechanism -->
          <div class="relative mt-[-2px] z-20 flex flex-col items-center">
            <div class="w-2 h-4 bg-slate-500"></div>
            <!-- Tip -->
            <div
              class="w-8 h-8 rounded-full bg-slate-700 border-2 border-slate-500 cursor-pointer flex items-center justify-center hover:bg-slate-600 active:scale-95 transition-all shadow-lg select-none"
              onmousedown="startDrip()"
              onmouseup="stopDrip()"
              onmouseleave="stopDrip()"
              id="tap-btn"
            >
              <div
                class="w-1 h-6 bg-slate-400 rounded-full transform rotate-90 transition-transform"
                id="tap-handle"
              ></div>
            </div>
            <span class="text-[10px] text-slate-400 mt-1">Hold to Drip</span>
          </div>
        </div>

        <!-- Drip Animation Zone -->
        <div class="h-24 w-0.5 relative">
          <div
            id="drop"
            class="w-3 h-3 bg-blue-200 rounded-full absolute top-0 -left-[5px] opacity-0 transition-opacity"
          ></div>
        </div>

        <!-- Flask (Acid + Indicator) -->
        <div class="flex flex-col items-center mt-[-10px]">
          <div class="flask relative">
            <!-- Liquid -->
            <div
              id="flask-liquid"
              class="absolute bottom-0 w-full h-[40%] bg-red-500/80 liquid-transition opacity-90 flex items-end justify-center"
            >
              <!-- Bubbles/Swirl visual could go here -->
            </div>
          </div>
          <div class="w-32 h-2 bg-slate-700/50 rounded-full mt-2 blur-sm"></div>
          <!-- Shadow -->
          <span class="text-xs text-red-300 mt-2">HCl (Acid) + Indicator</span>
        </div>
      </div>

      <!-- Info/Results Right -->
      <div
        class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700/50 backdrop-blur-sm w-full max-w-xs z-10 min-h-[200px] flex flex-col items-center justify-center text-center"
      >
        <div id="status-icon" class="text-4xl mb-4">ðŸ§ª</div>
        <h3 class="text-lg font-bold text-white mb-2" id="status-title">
          Ready
        </h3>
        <p class="text-sm text-slate-400" id="status-desc">
          Hold the tap to release Alkali into the Acid. Watch the color change.
        </p>
      </div>
    </main>

    <script>
      // State
      let ph = 1.0;
      let volumeAcid = 50; // mL
      let volumeBaseAdded = 0;
      let molarityAcid = 0.1;
      let molarityBase = 0.1;
      let isDripping = false;
      let dripInterval = null;

      // Constants
      const INDICATORS = {
        universal: (ph) => {
          if (ph < 3) return "#ef4444"; // Red
          if (ph < 6) return "#f97316"; // Orange
          if (ph < 7) return "#eab308"; // Yellow
          if (ph == 7) return "#22c55e"; // Green
          if (ph < 11) return "#3b82f6"; // Blue
          return "#a855f7"; // Purple
        },
        methyl: (ph) => {
          if (ph < 3.1) return "#ef4444"; // Red
          if (ph > 4.4) return "#eab308"; // Yellow
          return "#f97316"; // Orange mix
        },
        phenol: (ph) => {
          if (ph < 8.3) return "rgba(255,255,255,0.1)"; // Colorless (simulated as clear/white tint)
          if (ph > 10) return "#ec4899"; // Pink/Magenta
          return "#fce7f3"; // Pale pink
        },
        litmus: (ph) => {
          if (ph < 7) return "#ef4444"; // Red
          if (ph > 7) return "#3b82f6"; // Blue
          return "#8b5cf6"; // Purple neutral
        },
      };

      // DOM
      const liquid = document.getElementById("flask-liquid");
      const phDisplay = document.getElementById("ph-display");
      const tapHandle = document.getElementById("tap-handle");
      const drop = document.getElementById("drop");

      function startDrip() {
        if (isDripping) return;
        isDripping = true;
        tapHandle.style.transform = "rotate(0deg)"; // Vertical

        dripInterval = setInterval(() => {
          animateDrop();
          addBase(0.5); // 0.5 mL per tick
        }, 200);
      }

      function stopDrip() {
        isDripping = false;
        tapHandle.style.transform = "rotate(90deg)";
        clearInterval(dripInterval);
      }

      function animateDrop() {
        // Simple CSS animation trigger
        drop.style.transition = "none";
        drop.style.top = "0px";
        drop.style.opacity = "1";

        setTimeout(() => {
          drop.style.transition = "all 0.15s ease-in";
          drop.style.top = "100px"; // Hit flask
          setTimeout(() => {
            drop.style.opacity = "0";
          }, 150);
        }, 10);
      }

      function addBase(amount) {
        volumeBaseAdded += amount;

        // Calculate new pH
        // Moles H+ initial = 0.1 * 0.050 = 0.005 moles
        // Moles OH- added = 0.1 * (volBase/1000)

        const molesH = molarityAcid * (volumeAcid / 1000);
        const molesOH = molarityBase * (volumeBaseAdded / 1000);
        const totalVol = (volumeAcid + volumeBaseAdded) / 1000;

        let newPH;

        if (molesH > molesOH) {
          const remainingH = (molesH - molesOH) / totalVol;
          newPH = -Math.log10(remainingH);
        } else if (molesOH > molesH) {
          const remainingOH = (molesOH - molesH) / totalVol;
          const pOH = -Math.log10(remainingOH);
          newPH = 14 - pOH;
        } else {
          newPH = 7.0;
        }

        // Cap extremely low/high values valid for simplistic ranges
        if (newPH < 0) newPH = 0;
        if (newPH > 14) newPH = 14;

        ph = newPH;
        updateVisuals();
      }

      function updateVisuals() {
        // Update Text
        phDisplay.innerText = ph.toFixed(2);

        // Update Flask Color based on indicator
        const ind = document.getElementById("indicator-select").value;
        const color = INDICATORS[ind](ph);

        liquid.style.backgroundColor = color;

        // Special case for Phenolphthalein colorless
        if (ind === "phenol" && ph < 8.3) {
          liquid.style.backgroundColor = "#e2e8f0"; // Slight grey/clear look
          liquid.style.opacity = "0.3";
        } else {
          liquid.style.opacity = "0.9";
        }

        // Update Level
        // Visually increase liquid height slightly
        const baseHeight = 40; // %
        const addedHeight = (volumeBaseAdded / 50) * 10; // max add 10% height
        liquid.style.height = baseHeight + addedHeight + "%";

        // Update Burette liquid
        const startH = 100;
        const drained = (volumeBaseAdded / 100) * 100; // if 100ml burette
        document.getElementById("burette-liquid").style.height =
          Math.max(0, startH - drained) + "%";

        checkStatus();
      }

      function checkStatus() {
        const ind = document.getElementById("indicator-select").value;
        const title = document.getElementById("status-title");
        const desc = document.getElementById("status-desc");
        const icon = document.getElementById("status-icon");

        if (Math.abs(ph - 7.0) < 0.2) {
          title.innerText = "Neutralized!";
          desc.innerText = "The solution is neutral (pH ~7). Excellent work!";
          icon.innerText = "ðŸŽ‰";
          title.className = "text-lg font-bold text-green-400 mb-2";
        } else if (ph > 11) {
          title.innerText = "Basic / Alkali";
          desc.innerText = "The solution is now strongly alkaline.";
          icon.innerText = "ðŸ”µ";
          title.className = "text-lg font-bold text-blue-400 mb-2";
        } else if (ph < 3) {
          title.innerText = "Acidic";
          desc.innerText = "Still adding alkali...";
          icon.innerText = "ðŸ”´";
          title.className = "text-lg font-bold text-red-400 mb-2";
        }
      }

      function resetSim() {
        ph = 1.0;
        volumeBaseAdded = 0;
        updateVisuals();
        document.getElementById("status-title").innerText = "Ready";
        document.getElementById("status-desc").innerText =
          "Hold the tap to release Alkali.";
        document.getElementById("status-icon").innerText = "ðŸ§ª";
        document.getElementById("status-title").className =
          "text-lg font-bold text-white mb-2";
        document.getElementById("burette-liquid").style.height = "100%";
      }

      // Init
      updateVisuals();
    </script>
  </body>
</html>
