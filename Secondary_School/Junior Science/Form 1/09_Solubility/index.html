<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solubility Curves | Junior Science</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Outfit", sans-serif;
        background: #fffbeb;
      }
      .crystal {
        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        animation: grow 2s ease-out forwards;
      }
      @keyframes grow {
        from {
          transform: scale(0);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 0.8;
        }
      }
    </style>
  </head>
  <body class="bg-amber-50 text-slate-800 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const App = () => {
        const chartRef = useRef(null);
        const [temp, setTemp] = useState(20); // User adjustable temp
        const [selectedSalt, setSelectedSalt] = useState("KNO3");
        const [soluteAdded, setSoluteAdded] = useState(20); // g per 100g water
        const [state, setState] = useState("Unsaturated"); // Unsaturated, Saturated, Supersaturated
        const [crystals, setCrystals] = useState(0);

        // Solubility Data (approximate equations)
        const getSolubility = (t, salt) => {
          if (salt === "KNO3") return 13 + 0.5 * t + 0.01 * t * t; // Potassium Nitrate (Curve goes up fast)
          if (salt === "NaCl") return 35 + 0.02 * t; // Sodium Chloride (Flat)
          if (salt === "CuSO4") return 15 + 0.25 * t + 0.005 * t * t; // Copper Sulfate
          return 0;
        };

        useEffect(() => {
          const limit = getSolubility(temp, selectedSalt);
          if (soluteAdded < limit) {
            setState("Unsaturated");
            setCrystals(0);
          } else if (Math.abs(soluteAdded - limit) < 2) {
            setState("Saturated");
            setCrystals(0);
          } else {
            setState("Crystallizing");
            // Amount crystallized
            setCrystals(Math.floor((soluteAdded - limit) / 2)); // Arbitrary scale factor
          }

          // Render Chart
          if (chartRef.current) {
            // Destroy old if needed (handled by Chart.js generally but re-render logic here)
            const ctx = chartRef.current.getContext("2d");

            const dataPoints = [];
            for (let i = 0; i <= 100; i += 10) {
              dataPoints.push({ x: i, y: getSolubility(i, selectedSalt) });
            }

            // Reset chart (simple way for this snippet)
            if (window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
              type: "line",
              data: {
                datasets: [
                  {
                    label: `Solubility of ${selectedSalt}`,
                    data: dataPoints,
                    borderColor:
                      selectedSalt === "KNO3"
                        ? "#f59e0b"
                        : selectedSalt === "NaCl"
                        ? "#3b82f6"
                        : "#10b981",
                    tension: 0.3,
                    fill: false,
                  },
                  {
                    label: "Your Solution",
                    data: [{ x: temp, y: soluteAdded }],
                    pointBackgroundColor: "#ef4444",
                    pointRadius: 8,
                    type: "scatter",
                  },
                ],
              },
              options: {
                responsive: true,
                scales: {
                  x: {
                    type: "linear",
                    position: "bottom",
                    title: { display: true, text: "Temperature (°C)" },
                    min: 0,
                    max: 100,
                  },
                  y: {
                    title: { display: true, text: "Solubility (g/100g water)" },
                    min: 0,
                    max: 200,
                  },
                },
                animation: false,
              },
            });
          }
        }, [temp, soluteAdded, selectedSalt]);

        return (
          <div className="p-8 max-w-6xl mx-auto">
            <header className="mb-8">
              <span className="text-amber-600 font-bold uppercase text-xs tracking-wider">
                Form 1 Science • Water
              </span>
              <h1 className="text-4xl font-extrabold text-slate-800">
                Solubility Curve Explorer
              </h1>
            </header>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
              {/* Chart Area */}
              <div className="bg-white p-6 rounded-3xl shadow-lg border border-amber-100">
                <canvas ref={chartRef} height={300}></canvas>
              </div>

              {/* Controls & Beaker Visual */}
              <div className="space-y-6">
                {/* Controls */}
                <div className="bg-white p-6 rounded-3xl shadow-sm border border-fuchsia-50 space-y-6">
                  <div>
                    <label className="block text-sm font-bold text-slate-500 mb-2">
                      Select Salt
                    </label>
                    <div className="flex gap-2">
                      {["KNO3", "NaCl", "CuSO4"].map((salt) => (
                        <button
                          key={salt}
                          onClick={() => setSelectedSalt(salt)}
                          className={`px-4 py-2 rounded-lg font-bold transition-colors ${
                            selectedSalt === salt
                              ? "bg-amber-500 text-white"
                              : "bg-slate-100 text-slate-600"
                          }`}
                        >
                          {salt}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-slate-500 mb-2">
                      Temperature: {temp}°C
                    </label>
                    <input
                      type="range"
                      min="0"
                      max="100"
                      value={temp}
                      onChange={(e) => setTemp(Number(e.target.value))}
                      className="w-full accent-amber-500"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-slate-500 mb-2">
                      Solute Amount: {soluteAdded}g
                    </label>
                    <input
                      type="range"
                      min="0"
                      max="200"
                      value={soluteAdded}
                      onChange={(e) => setSoluteAdded(Number(e.target.value))}
                      className="w-full accent-amber-500"
                    />
                  </div>
                </div>

                {/* Beaker Simulation */}
                <div className="bg-slate-100 p-6 rounded-3xl border border-slate-200 flex items-center justify-center h-[300px] relative overflow-hidden">
                  <div className="absolute top-2 left-2 px-3 py-1 bg-white rounded-full text-xs font-bold border">
                    Status:{" "}
                    <span
                      className={`${
                        state === "Unsaturated"
                          ? "text-blue-500"
                          : state === "Saturated"
                          ? "text-green-500"
                          : "text-amber-600"
                      }`}
                    >
                      {state}
                    </span>
                  </div>

                  {/* Beaker */}
                  <div className="w-40 h-52 border-x-4 border-b-4 border-slate-300 rounded-b-xl bg-white/50 relative flex justify-center items-end">
                    <div
                      className="absolute bottom-0 w-full bg-blue-100/50 transition-all duration-300"
                      style={{ height: "80%" }}
                    >
                      {/* Dissolved particles (Dots) */}
                      <div
                        className="absolute inset-0 opacity-50"
                        style={{
                          backgroundImage:
                            "radial-gradient(#3b82f6 1px, transparent 1px)",
                          backgroundSize: `${Math.max(
                            200 - soluteAdded,
                            5
                          )}px ${Math.max(200 - soluteAdded, 5)}px`,
                        }}
                      ></div>
                    </div>

                    {/* Crystals forming at bottom */}
                    {crystals > 0 && (
                      <div className="flex flex-wrap justify-center items-end w-full h-[30%] mb-2 gap-1 z-10 transition-all">
                        {[...Array(Math.min(crystals, 20))].map((_, i) => (
                          <div
                            key={i}
                            className={`crystal w-4 h-4 ${
                              selectedSalt === "CuSO4"
                                ? "bg-blue-600"
                                : selectedSalt === "KNO3"
                                ? "bg-white border border-slate-200"
                                : "bg-slate-200"
                            }`}
                          ></div>
                        ))}
                        {crystals > 20 && (
                          <span className="text-xs font-bold text-slate-500 bg-white/80 px-1 rounded">
                            +{crystals - 20} more
                          </span>
                        )}
                      </div>
                    )}

                    {/* Thermometer in beaker */}
                    <div className="absolute right-4 bottom-0 h-[220px] w-2 bg-yellow-100 border border-slate-400">
                      <div
                        className="absolute bottom-0 w-full bg-red-500 transition-all"
                        style={{ height: `${temp}%` }}
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <footer className="mt-12 text-center">
              <a
                href="../index.html"
                className="text-amber-600/50 hover:text-amber-600 transition font-bold"
              >
                <i className="fa-solid fa-arrow-left mr-2"></i> Back to
                Dashboard
              </a>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
