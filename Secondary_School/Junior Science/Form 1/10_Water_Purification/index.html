<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Water Purification City | Junior Science</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Outfit", sans-serif;
        background: #ecfeff;
      }
      .facility-slot {
        transition: all 0.3s;
        border: 2px dashed #94a3b8;
      }
      .facility-slot.correct {
        border: 2px solid #22c55e;
        background: #dcfce7;
      }

      .water-pipe {
        height: 20px;
        background: #bae6fd;
        position: relative;
        overflow: hidden;
      }
      .water-flow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.5),
          transparent
        );
        animation: flow 1s linear infinite;
      }
      @keyframes flow {
        from {
          transform: translateX(-100%);
        }
        to {
          transform: translateX(100%);
        }
      }
    </style>
  </head>
  <body class="bg-cyan-50 text-slate-800 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      const stages = [
        {
          id: "screen",
          name: "Screening",
          icon: "fa-table-cells-large",
          desc: "Removes large objects like branches.",
        },
        {
          id: "sedi",
          name: "Sedimentation",
          icon: "fa-layer-group",
          desc: "Alum added to clump particles to sink.",
        },
        {
          id: "filter",
          name: "Filtration",
          icon: "fa-filter",
          desc: "Removes fine insoluble particles.",
        },
        {
          id: "chlor",
          name: "Chlorination",
          icon: "fa-flask",
          desc: "Kills bacteria and germs.",
        },
        {
          id: "fluor",
          name: "Fluoridation",
          icon: "fa-tooth",
          desc: "Protects teeth from decay.",
        },
      ];

      // Correct order: Screen -> Sedi -> Filter -> Chlor -> Fluor
      const correctOrder = ["screen", "sedi", "filter", "chlor", "fluor"];

      const App = () => {
        const [placed, setPlaced] = useState([null, null, null, null, null]);
        const [completed, setCompleted] = useState(false);

        const handleDragStart = (e, id) => {
          e.dataTransfer.setData("type", id);
        };

        const handleDrop = (e, index) => {
          const type = e.dataTransfer.getData("type");

          // Simple validation: strictly enforce order or allow re-arrange?
          // Let's allow putting anything anywhere but validate at end or visually indicate correctness immediately?
          // Visual Immediate:
          const newPlaced = [...placed];
          newPlaced[index] = type;
          setPlaced(newPlaced);

          // Check completion
          if (newPlaced.every((p, i) => p === correctOrder[i])) {
            setCompleted(true);
          }
        };

        const handleDragOver = (e) => e.preventDefault();

        return (
          <div className="p-8 max-w-7xl mx-auto flex flex-col h-screen">
            <header className="text-center mb-10">
              <span className="text-cyan-600 font-bold uppercase text-xs tracking-widest">
                Form 1 Science • Water
              </span>
              <h1 className="text-4xl font-extrabold text-slate-800">
                Water Treatment City
              </h1>
              <p className="text-slate-500">
                Build the correct purification pipeline to supply safe drinking
                water.
              </p>
            </header>

            {/* Game Area */}
            <div className="flex-grow flex flex-col items-center">
              {/* Pipeline Visual */}
              <div className="flex items-center w-full justify-center mb-12 overflow-x-auto pb-4">
                {/* Lake Source */}
                <div className="flex flex-col items-center mx-2">
                  <div className="w-24 h-24 bg-blue-400 rounded-full flex items-center justify-center text-white text-3xl shadow-lg border-4 border-blue-200">
                    <i className="fa-solid fa-water"></i>
                  </div>
                  <span className="font-bold mt-2">Reservoir</span>
                </div>

                {/* Slots */}
                {placed.map((item, index) => {
                  const isCorrect = item === correctOrder[index];
                  const stageInfo = item
                    ? stages.find((s) => s.id === item)
                    : null;

                  return (
                    <React.Fragment key={index}>
                      <div className="water-pipe w-16 md:w-24 rounded-full mx-[-5px] z-0">
                        {item && <div className="water-flow"></div>}
                      </div>

                      <div
                        onDrop={(e) => handleDrop(e, index)}
                        onDragOver={handleDragOver}
                        className={`facility-slot z-10 w-40 h-48 rounded-2xl flex flex-col items-center justify-center p-4 text-center cursor-pointer shadow-md ${
                          isCorrect ? "correct" : "bg-white hover:bg-slate-50"
                        }`}
                      >
                        {stageInfo ? (
                          <>
                            <div
                              className={`w-12 h-12 rounded-full flex items-center justify-center text-xl text-white mb-2 ${
                                isCorrect ? "bg-green-500" : "bg-red-400"
                              }`}
                            >
                              <i className={`fa-solid ${stageInfo.icon}`}></i>
                            </div>
                            <h3 className="font-bold text-sm">
                              {stageInfo.name}
                            </h3>
                            <p className="text-xs text-slate-500 mt-1 leading-tight">
                              {stageInfo.desc}
                            </p>
                            {isCorrect && (
                              <i className="fa-solid fa-check text-green-500 mt-2"></i>
                            )}
                          </>
                        ) : (
                          <span className="text-slate-400 font-bold text-sm border-dashed border-2 p-2 rounded">
                            Step {index + 1}
                          </span>
                        )}
                      </div>
                    </React.Fragment>
                  );
                })}

                <div className="water-pipe w-16 md:w-24 rounded-full mx-[-5px] z-0">
                  {completed && <div className="water-flow"></div>}
                </div>

                {/* Home */}
                <div className="flex flex-col items-center mx-2 z-10">
                  <div
                    className={`w-24 h-24 rounded-full flex items-center justify-center text-white text-3xl shadow-lg border-4 transition-all ${
                      completed
                        ? "bg-green-500 border-green-200 animate-bounce"
                        : "bg-slate-300 border-slate-200"
                    }`}
                  >
                    <i className="fa-solid fa-house-chimney"></i>
                  </div>
                  <span className="font-bold mt-2">Home</span>
                </div>
              </div>

              {/* Inventory */}
              {!completed && (
                <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-5xl border border-cyan-100">
                  <h3 className="text-xl font-bold mb-6 text-slate-700 flex items-center gap-2">
                    <i className="fa-solid fa-screwdriver-wrench text-cyan-500"></i>{" "}
                    Facilities Inventory
                  </h3>
                  <div className="flex flex-wrap justify-center gap-6">
                    {stages.map((stage) => (
                      <div
                        key={stage.id}
                        draggable
                        onDragStart={(e) => handleDragStart(e, stage.id)}
                        className="bg-slate-50 border hover:border-cyan-400 hover:shadow-lg w-32 p-4 rounded-xl flex flex-col items-center cursor-grab active:cursor-grabbing transition-all hover:-translate-y-1"
                      >
                        <div className="w-10 h-10 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mb-2">
                          <i className={`fa-solid ${stage.icon}`}></i>
                        </div>
                        <span className="font-bold text-sm">{stage.name}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {completed && (
                <div className="bg-green-50 p-8 rounded-3xl border border-green-200 text-center animate-fade-in-up">
                  <h2 className="text-3xl font-bold text-green-700 mb-2">
                    Water Supplied!
                  </h2>
                  <p className="text-green-600 mb-6">
                    You have successfully purified the water for the city.
                  </p>
                  <button
                    onClick={() =>
                      setPlaced([null, null, null, null, null]) ||
                      setCompleted(false)
                    }
                    className="bg-green-600 text-white px-6 py-2 rounded-full font-bold hover:bg-green-700 transition"
                  >
                    Reset Pipeline
                  </button>
                </div>
              )}
            </div>

            
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
