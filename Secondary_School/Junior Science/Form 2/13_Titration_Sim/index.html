<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Titration Simulator | S2 Science</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Outfit", sans-serif;
        background: #fffcf8;
      }
      .solution {
        transition: background-color 0.5s ease;
      }
      .drop {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 10px;
        background: #cbd5e1;
        border-radius: 50%;
        animation: fall 0.5s linear infinite;
      }
      @keyframes fall {
        from {
          top: 100%;
          opacity: 1;
        }
        to {
          top: 300%;
          opacity: 0;
        }
      }
    </style>
  </head>
  <body class="bg-amber-50 text-slate-800 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const App = () => {
        const chartRef = useRef(null);
        const [volumeAdded, setVolumeAdded] = useState(0); // mL Acid added
        const [tapOpen, setTapOpen] = useState(false);
        const [speed, setSpeed] = useState("slow"); // slow, fast
        const [chartInstance, setChartInstance] = useState(null);

        // Simulation Parameters
        // Starting with 25mL Alkali (pH 14)
        // Adding Acid (pH 1). Neutralization at 25mL ideally for simple 1M vs 1M
        // Sigmoid Curve Logic:
        const getPH = (vol) => {
          // Determine excess moles.
          // Moles OH = 1.0 * 0.025 = 0.025
          // Moles H added = 1.0 * (vol/1000)
          // If vol < 25: Excess OH -> pH high
          // If vol == 25: Neutral -> pH 7
          // If vol > 25: Excess H -> pH low

          const v = vol;
          if (Math.abs(v - 25) < 0.1) return 7.0;

          // Simplified Sigmoid visual for smooth curve
          // Center at 25. Steepness control.
          // pH = 7 - (vol - 25) * slope factor, clamped 1-13
          // Better: Logistic function
          // pH = 1 + 13 / (1 + e^(k * (vol - 25)))
          // k ~ 1.5 for steep curve
          return 1 + 13 / (1 + Math.exp(1.5 * (v - 25)));
        };

        const ph = getPH(volumeAdded);

        // Loop
        useEffect(() => {
          let interval;
          if (tapOpen) {
            interval = setInterval(() => {
              setVolumeAdded((prev) => {
                if (prev >= 50) {
                  setTapOpen(false);
                  return 50;
                }
                return prev + (speed === "slow" ? 0.05 : 0.2); // Slower for precision
              });
            }, 50);
          }
          return () => clearInterval(interval);
        }, [tapOpen, speed]);

        // Chart
        useEffect(() => {
          if (chartRef.current) {
            const ctx = chartRef.current.getContext("2d");

            // Generate data points up to current volume
            const dataPoints = [];
            for (let i = 0; i <= volumeAdded; i += 0.5) {
              dataPoints.push({ x: i, y: getPH(i) });
            }
            dataPoints.push({ x: volumeAdded, y: ph }); // Current tip

            if (chartInstance) {
              chartInstance.data.datasets[0].data = dataPoints;
              chartInstance.update();
            } else {
              const newChart = new Chart(ctx, {
                type: "scatter",
                data: {
                  datasets: [
                    {
                      label: "pH Curve",
                      data: dataPoints,
                      borderColor: "#f59e0b",
                      backgroundColor: "#f59e0b",
                      showLine: true,
                      pointRadius: 0,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  animation: false,
                  scales: {
                    x: {
                      type: "linear",
                      position: "bottom",
                      title: { display: true, text: "Volume of Acid (mL)" },
                      min: 0,
                      max: 50,
                    },
                    y: {
                      min: 0,
                      max: 14,
                      title: { display: true, text: "pH" },
                    },
                  },
                },
              });
              setChartInstance(newChart);
            }
          }
        }, [volumeAdded]);

        // Color logic (Phenolphthalein: Pink if > 8.2 (Alkali), Colorless if Acid/Neutral)
        // Just simulate pink if pH > 8
        const getColor = () => (ph > 8.2 ? "#db2777" : "#e2e8f0"); // Pink or "White/Clear"

        return (
          <div className="p-8 max-w-6xl mx-auto min-h-screen flex flex-col items-center">
            <header className="text-center mb-10 w-full">
              <span className="text-amber-600 font-bold uppercase text-xs tracking-widest">
                Form 2 Science • Unit 9
              </span>
              <h1 className="text-4xl font-extrabold text-slate-800 mb-2">
                Titration Simulator
              </h1>
              <p className="text-slate-500">
                Acid-Base Neutralization using Phenolphthalein indicator.
              </p>
            </header>

            <div className="flex flex-col lg:flex-row gap-12 w-full">
              {/* Simulation View */}
              <div className="w-full lg:w-1/3 bg-white rounded-3xl shadow-xl border border-amber-100 relative min-h-[600px] flex flex-col items-center pt-8">
                {/* Stand */}
                <div className="absolute left-1/2 ml-16 bottom-10 w-4 h-[500px] bg-slate-300 rounded-full"></div>
                <div className="absolute left-1/2 ml-10 bottom-10 w-32 h-4 bg-slate-400 rounded-full"></div>{" "}
                {/* Base */}
                <div className="absolute left-1/2 top-20 ml-[-20px] w-24 h-4 bg-slate-400 rotate-[-15deg] origin-right rounded-l-full"></div>{" "}
                {/* Clamp */}
                {/* Burette */}
                <div className="relative z-10 flex flex-col items-center">
                  <div className="w-6 h-64 border-x-2 border-slate-300 bg-white/50 relative">
                    {/* Liquid in Burette */}
                    <div
                      className="absolute bottom-0 w-full bg-slate-200 transition-all duration-75"
                      style={{ height: `${((50 - volumeAdded) / 50) * 100}%` }}
                    ></div>
                    {/* Markings */}
                    {Array.from({ length: 10 }).map((_, i) => (
                      <div
                        key={i}
                        className="absolute right-0 h-[1px] bg-slate-400 w-2"
                        style={{ top: `${i * 10}%` }}
                      ></div>
                    ))}
                  </div>
                  <div
                    className="w-8 h-8 rounded-full bg-slate-400 flex items-center justify-center cursor-pointer hover:bg-slate-500 transition-colors"
                    onClick={() => setTapOpen(!tapOpen)}
                  >
                    <div
                      className={`w-6 h-2 bg-slate-800 rounded-full transition-transform ${
                        tapOpen ? "rotate-90" : "rotate-0"
                      }`}
                    ></div>
                  </div>
                  {/* Tip */}
                  <div className="w-2 h-4 bg-slate-300 relative">
                    {tapOpen && <div className="drop"></div>}
                  </div>
                </div>
                {/* Conical Flask */}
                <div className="relative mt-20 z-10 w-32 h-40">
                  {/* Neck */}
                  <div className="mx-auto w-10 h-16 border-x-2 border-slate-300 bg-white/30 backdrop-blur-sm relative z-20"></div>
                  {/* Body */}
                  <div className="absolute bottom-0 w-32 h-28 bg-white/30 border-2 border-slate-300 rounded-[50%] rounded-t-none backdrop-blur-sm overflow-hidden shadow-inner z-10 flex items-end justify-center">
                    {/* Solution */}
                    <div
                      className="w-full h-16 solution opacity-80"
                      style={{ backgroundColor: getColor() }}
                    ></div>
                  </div>
                </div>
                {/* Volume Readout */}
                <div className="absolute top-4 left-4 font-mono text-sm text-slate-400">
                  Vol: {volumeAdded.toFixed(2)} mL
                </div>
                {/* Tap Control Overlay */}
                <div className="absolute top-1/2 left-4 flex flex-col gap-2">
                  <button
                    onClick={() => {
                      setTapOpen(!tapOpen);
                      setSpeed("slow");
                    }}
                    className={`w-12 h-12 rounded-full shadow flex items-center justify-center border-2 ${
                      tapOpen && speed === "slow"
                        ? "bg-amber-500 text-white"
                        : "bg-white text-slate-400"
                    }`}
                  >
                    <i className="fa-solid fa-droplet"></i>
                  </button>
                  <button
                    onClick={() => {
                      setTapOpen(!tapOpen);
                      setSpeed("fast");
                    }}
                    className={`w-12 h-12 rounded-full shadow flex items-center justify-center border-2 ${
                      tapOpen && speed === "fast"
                        ? "bg-amber-500 text-white"
                        : "bg-white text-slate-400"
                    }`}
                  >
                    <i className="fa-solid fa-faucet-drip"></i>
                  </button>
                </div>
              </div>

              {/* Graph and Data */}
              <div className="w-full lg:w-2/3 flex flex-col gap-8">
                <div className="bg-white p-6 rounded-3xl shadow-lg border border-slate-100 flex-grow">
                  <canvas ref={chartRef}></canvas>
                </div>

                <div className="bg-amber-100 p-6 rounded-2xl text-amber-900 border border-amber-200">
                  <h3 className="font-bold text-lg mb-2">
                    <i className="fa-solid fa-circle-info mr-2"></i> Mission
                  </h3>
                  <p className="mb-2">
                    Neutralize the 25mL of Alkali by adding Acid. Stop the tap
                    exactly when the color changes from <strong>Pink</strong> to{" "}
                    <strong>Colorless</strong>.
                  </p>
                  <div className="flex justify-between items-center bg-white/50 p-2 rounded-lg">
                    <span>
                      Current pH: <strong>{ph.toFixed(2)}</strong>
                    </span>
                    <span>
                      Status:{" "}
                      <strong
                        className={
                          ph > 8
                            ? "text-pink-600"
                            : ph < 6
                            ? "text-red-500"
                            : "text-green-600"
                        }
                      >
                        {ph > 8
                          ? "Alkaline (Pink)"
                          : ph < 6
                          ? "Acidic (Clear)"
                          : "Neutral (Clear/Pale)"}
                      </strong>
                    </span>
                  </div>
                </div>
              </div>
            </div>

            
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
