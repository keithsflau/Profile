<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>對聯武林：決戰巔峰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+TC:wght@500;700&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'calligraphy': ['"Ma Shan Zheng"', 'cursive'],
                        'serif': ['"Noto Serif TC"', 'serif'],
                    },
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .ink-bg {
            background-color: #fdfbf7;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d1d5db' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .vs-text {
            text-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
        }

        .wood-texture {
            background-color: #78350f;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0, 0, 0, 0.1) 10px, rgba(0, 0, 0, 0.1) 20px);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
    </style>
    <link rel="stylesheet" href="../../visit-counter.css">
</head>

<body class="ink-bg min-h-screen text-slate-800 font-serif overflow-hidden select-none">

    <!-- Start Screen -->
    <div id="start-screen"
        class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-stone-900 bg-opacity-95 text-white transition-opacity duration-500">
        <h1 class="text-7xl font-calligraphy text-red-500 mb-4 animate-pulse-slow tracking-widest">對聯武林</h1>
        <p class="text-2xl mb-12 text-stone-400">決戰巔峰 · 以文會友</p>
        <button onclick="startGame()"
            class="px-12 py-4 bg-red-700 hover:bg-red-600 text-2xl font-bold rounded shadow-[0_0_20px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 border-2 border-red-500">
            開始挑戰
        </button>
        <div class="mt-8 text-stone-500 text-sm">
            <p>規則：根據上聯輸入下聯，答對攻擊對手，答錯或超時受傷。</p>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen"
        class="hidden fixed inset-0 z-50 flex flex-col items-center justify-center bg-black bg-opacity-90 text-white">
        <h1 id="end-title" class="text-6xl font-calligraphy mb-6"></h1>
        <p id="end-score" class="text-3xl mb-8 text-yellow-500"></p>
        <button onclick="location.reload()"
            class="px-8 py-3 bg-stone-700 hover:bg-stone-600 rounded text-xl border border-stone-500">
            重出江湖
        </button>
    </div>

    <!-- Main Game Area -->
    <div class="container mx-auto max-w-5xl px-4 py-6 h-screen flex flex-col">

        <!-- Header: Health Bars -->
        <div class="flex justify-between items-center mb-8 relative">
            <!-- Player Status -->
            <div class="w-2/5 flex flex-col items-start gap-2">
                <div class="flex items-center gap-3">
                    <div
                        class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center font-bold text-xl border-2 border-white shadow-lg">
                        俠</div>
                    <span class="font-bold text-lg">挑戰者 (你)</span>
                </div>
                <div class="w-full h-6 bg-slate-300 rounded-full border-2 border-slate-400 overflow-hidden relative">
                    <div id="player-hp-bar"
                        class="h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-300"
                        style="width: 100%;"></div>
                </div>
            </div>

            <!-- VS Badge -->
            <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10">
                <div
                    class="w-16 h-16 bg-red-800 rounded-full flex items-center justify-center border-4 border-yellow-500 shadow-xl">
                    <span class="font-calligraphy text-3xl text-yellow-400 vs-text italic">VS</span>
                </div>
            </div>

            <!-- Enemy Status -->
            <div class="w-2/5 flex flex-col items-end gap-2">
                <div class="flex items-center gap-3 flex-row-reverse">
                    <div
                        class="w-12 h-12 bg-red-700 rounded-full flex items-center justify-center font-bold text-xl border-2 border-white shadow-lg text-white">
                        魔</div>
                    <span class="font-bold text-lg">對聯魔尊</span>
                </div>
                <div class="w-full h-6 bg-slate-300 rounded-full border-2 border-slate-400 overflow-hidden relative">
                    <div id="enemy-hp-bar"
                        class="h-full bg-gradient-to-l from-red-600 to-orange-500 transition-all duration-300"
                        style="width: 100%;"></div>
                </div>
            </div>
        </div>

        <!-- Info Bar -->
        <div
            class="flex justify-between text-slate-600 font-bold mb-4 px-4 bg-white/50 py-2 rounded-lg backdrop-blur-sm">
            <span>連擊: <span id="streak" class="text-red-600 text-xl">0</span></span>
            <span>回合: <span id="round">1</span>/10</span>
            <span>得分: <span id="score">0</span></span>
        </div>

        <!-- Battle Arena -->
        <div class="flex-grow flex flex-col items-center justify-start gap-8 relative">

            <!-- Timer Line -->
            <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-4">
                <div id="timer-bar" class="h-full bg-yellow-500 transition-linear" style="width: 100%;"></div>
            </div>

            <!-- Upper Couplet (The Challenge) -->
            <div class="relative group">
                <div
                    class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-red-800 text-yellow-100 px-4 py-1 rounded text-sm font-bold shadow">
                    上聯出招
                </div>
                <div
                    class="wood-texture px-12 py-6 rounded-lg shadow-2xl border-4 border-yellow-700 transform transition-transform hover:scale-105">
                    <h2 id="upper-text"
                        class="text-5xl font-calligraphy text-yellow-100 tracking-[0.2em] vertically-rl-if-needed text-center text-shadow-md">
                        準備中...
                    </h2>
                </div>
            </div>

            <!-- Feedback Overlay -->
            <div id="feedback-overlay"
                class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-20 opacity-0 transition-opacity duration-300">
                <div id="feedback-text" class="text-6xl font-bold stroke-text" style="-webkit-text-stroke: 2px white;">
                </div>
            </div>

            <!-- Lower Couplet (Input) -->
            <div class="w-full max-w-2xl mt-8">
                <div class="bg-white/90 backdrop-blur p-6 rounded-xl shadow-xl border-t-4 border-slate-800">
                    <label class="block text-slate-500 text-sm font-bold mb-2 text-center">請接下聯</label>
                    <input type="text" id="answer-input"
                        class="w-full text-4xl text-center font-calligraphy p-4 border-b-2 border-slate-300 focus:border-red-600 focus:outline-none bg-transparent transition-colors mb-4 placeholder-slate-300"
                        placeholder="在此輸入..." autocomplete="off">

                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="skipRound()"
                            class="py-3 px-6 rounded-lg font-bold text-slate-500 hover:bg-slate-100 border border-slate-300 transition-colors">
                            跳過 (扣血)
                        </button>
                        <button onclick="checkAnswer()"
                            class="py-3 px-6 bg-red-800 hover:bg-red-700 text-white rounded-lg font-bold shadow-md transition-transform active:scale-95">
                            出招！ (Enter)
                        </button>
                    </div>
                </div>
                <!-- Hint Area -->
                <div id="hint-area" class="mt-4 text-center text-slate-500 text-sm h-6"></div>
            </div>

        </div>
    </div>

    <!-- Logic -->
    <script>
        // Game Configuration
        const MAX_HP = 100;
        const ROUND_TIME = 20; // Seconds

        // Game State
        let state = {
            playerHp: MAX_HP,
            enemyHp: MAX_HP,
            score: 0,
            streak: 0,
            round: 0,
            isPlaying: false,
            currentCouplet: null,
            timer: null
        };

        // Database
        const COUPLETS = [
            { id: 1, upper: "風吹柳綠", correct: ["雨打花紅", "雪落梅香"], keywords: ["雨", "花", "紅", "雪", "梅"], difficulty: 1 },
            { id: 2, upper: "春回大地", correct: ["日照神州", "福滿人間"], keywords: ["日", "神州", "福", "人間"], difficulty: 1 },
            { id: 3, upper: "山青水秀", correct: ["柳暗花明", "鳥語花香"], keywords: ["柳", "花", "鳥", "香"], difficulty: 1 },
            { id: 4, upper: "讀書破萬卷", correct: ["下筆如有神"], keywords: ["下筆", "神"], difficulty: 2 },
            { id: 5, upper: "海內存知己", correct: ["天涯若比鄰"], keywords: ["天涯", "比鄰"], difficulty: 2 },
            { id: 6, upper: "白日依山盡", correct: ["黃河入海流"], keywords: ["黃河", "入海", "流"], difficulty: 2 },
            { id: 7, upper: "欲窮千里目", correct: ["更上一層樓"], keywords: ["更", "上", "樓"], difficulty: 2 },
            { id: 8, upper: "青山一道同雲雨", correct: ["明月何曾是兩鄉"], keywords: ["明月", "兩鄉"], difficulty: 3 },
            { id: 9, upper: "落霞與孤鶩齊飛", correct: ["秋水共長天一色"], keywords: ["秋水", "長天", "色"], difficulty: 3 },
            { id: 10, upper: "天若有情天亦老", correct: ["月如無恨月長圓"], keywords: ["月", "無恨", "圓"], difficulty: 3 }
        ];

        // Init
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const upperText = document.getElementById('upper-text');
        const answerInput = document.getElementById('answer-input');
        const timerBar = document.getElementById('timer-bar');

        // Input Listener
        answerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAnswer();
        });

        function startGame() {
            startScreen.classList.add('opacity-0');
            setTimeout(() => {
                startScreen.classList.add('hidden');
                resetGame();
                nextRound();
            }, 500);
        }

        function resetGame() {
            state = {
                playerHp: MAX_HP,
                enemyHp: MAX_HP,
                score: 0,
                streak: 0,
                round: 0,
                isPlaying: true,
                currentCouplet: null,
                timer: null
            };
            updateUI();
        }

        function nextRound() {
            if (!state.isPlaying) return;
            state.round++;

            // Check Win/Loss conditions
            if (state.playerHp <= 0 || state.enemyHp <= 0 || state.round > 10) {
                endGame();
                return;
            }

            // Pick random couplet
            const idx = Math.floor(Math.random() * COUPLETS.length);
            state.currentCouplet = COUPLETS[idx];

            // Reset UI for round
            upperText.textContent = state.currentCouplet.upper;
            answerInput.value = '';
            answerInput.focus();
            document.getElementById('hint-area').textContent = `(提示: ${state.currentCouplet.upper.length} 字)`;
            answerInput.maxLength = state.currentCouplet.upper.length + 2; // allowance

            updateUI();
            startTimer();
        }

        function startTimer() {
            if (state.timer) clearInterval(state.timer);
            timerBar.style.transition = 'none';
            timerBar.style.width = '100%';

            // Trigger reflow
            void timerBar.offsetWidth;

            timerBar.style.transition = `width ${ROUND_TIME}s linear`;
            timerBar.style.width = '0%';

            state.timer = setTimeout(() => {
                handleRoundResult(false, "時間到！");
            }, ROUND_TIME * 1000);
        }

        function checkAnswer() {
            if (!state.isPlaying) return;
            const input = answerInput.value.trim();
            if (!input) return;

            const c = state.currentCouplet;
            let isCorrect = false;
            let points = 0;

            // 1. Exact match
            if (c.correct.includes(input)) {
                isCorrect = true;
                points = 20;
            }
            // 2. Keyword match (simulated simple logic)
            else if (input.length === c.upper.length) {
                let matchCount = 0;
                c.keywords.forEach(k => {
                    if (input.includes(k)) matchCount++;
                });
                if (matchCount >= 1) { // At least 1 keywords matched
                    isCorrect = true;
                    points = 10 + (matchCount * 5);
                }
            }

            if (isCorrect) {
                handleRoundResult(true, "好功夫！", points);
            } else {
                handleRoundResult(false, "破綻大開！");
            }
        }

        function skipRound() {
            handleRoundResult(false, "怯戰！");
        }

        function handleRoundResult(success, msg, points = 0) {
            clearTimeout(state.timer);
            showFeedback(msg, success);

            if (success) {
                state.streak++;
                const damage = 20 + (state.streak * 2);
                state.enemyHp = Math.max(0, state.enemyHp - damage);
                state.score += points + (state.streak * 5);
                shakeElement(document.getElementById('enemy-hp-bar').parentElement);
            } else {
                state.streak = 0;
                const damage = 20;
                state.playerHp = Math.max(0, state.playerHp - damage);
                shakeElement(document.body);
            }

            updateUI();

            setTimeout(() => {
                nextRound();
            }, 1500);
        }

        function endGame() {
            state.isPlaying = false;
            gameOverScreen.classList.remove('hidden');

            let title = "";
            let color = "";
            if (state.playerHp <= 0) {
                title = "勝敗乃兵家常事";
                color = "text-gray-400";
            } else if (state.enemyHp <= 0) {
                title = "一代宗師！";
                color = "text-yellow-400";
            } else {
                title = "比武結束";
                color = "text-white";
            }

            document.getElementById('end-title').textContent = title;
            document.getElementById('end-title').className = `text-6xl font-calligraphy mb-6 ${color}`;
            document.getElementById('end-score').textContent = `最終得分: ${state.score}`;
        }

        function updateUI() {
            document.getElementById('player-hp-bar').style.width = `${(state.playerHp / MAX_HP) * 100}%`;
            document.getElementById('enemy-hp-bar').style.width = `${(state.enemyHp / MAX_HP) * 100}%`;
            document.getElementById('score').textContent = state.score;
            document.getElementById('streak').textContent = state.streak;
            document.getElementById('round').textContent = state.round > 10 ? 10 : state.round;
        }

        function showFeedback(text, isGood) {
            const overlay = document.getElementById('feedback-overlay');
            const txt = document.getElementById('feedback-text');
            txt.textContent = text;
            txt.style.color = isGood ? '#fbbf24' : '#ef4444'; // Yellow or Red
            overlay.classList.remove('opacity-0');

            // Animation reset
            txt.classList.remove('animate-bounce');
            void txt.offsetWidth;
            txt.classList.add('animate-bounce');

            setTimeout(() => {
                overlay.classList.add('opacity-0');
            }, 1000);
        }

        function shakeElement(el) {
            el.classList.add('animate-shake');
            setTimeout(() => el.classList.remove('animate-shake'), 500);
        }

    </script>

    <!-- Visit Counter -->
    <div id="visit-counter-container"></div>

    
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
<!-- Visit Counter Script -->
    <script src="../../visit-counter.js"></script>
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5jEjDAcEM6TttPbwwh1tvXPo_-W7YrNlKfJRV82PjkmAHvR_wILhA7h-zIRPF7oTRTw/exec';
        VisitCounter.init('seconardychinese/couplet_duel/index', {
            scriptUrl: SCRIPT_URL,
            containerId: 'visit-counter-container'
        });
    </script>
</body>

</html>

