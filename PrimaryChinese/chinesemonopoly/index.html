<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªæ–‡å¤§å¯Œç¿ - ä¸­ä¸€ä¸­æ–‡éŠæˆ²</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
        }
        
        .board-cell {
            transition: all 0.3s ease;
            border: 2px solid #1e293b;
        }
        
        .board-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .player-token {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .dice-rolling {
            animation: diceRoll 0.6s ease-in-out;
        }
        
        @keyframes movePlayer {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .player-moving {
            animation: movePlayer 0.4s ease-in-out;
        }
        
        .property-card {
            transition: all 0.3s ease;
        }
        
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-overlay {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="p-2 md:p-4">
    <div class="max-w-[1800px] mx-auto">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="text-3xl md:text-4xl font-black text-white mb-2 drop-shadow-lg">
                <i class="fas fa-landmark text-yellow-300"></i> èªæ–‡å¤§å¯Œç¿
            </h1>
            <p class="text-white text-sm md:text-lg opacity-90">ç­”å°ä¸­æ–‡å•é¡Œæ‰èƒ½è²·åœ°ï¼</p>
        </div>

        <!-- Main Game Container -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-2 md:gap-4">
            <!-- Left Sidebar: Players & Controls -->
            <div class="lg:col-span-1 space-y-2 md:space-y-4">
                <!-- Players Info -->
                <div class="bg-white rounded-xl shadow-xl p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold mb-3 text-gray-800">
                        <i class="fas fa-users"></i> ç©å®¶è³‡è¨Š
                    </h2>
                    <div id="playersInfo" class="space-y-2">
                        <!-- Players will be dynamically added here -->
                    </div>
                </div>

                <!-- Game Controls -->
                <div class="bg-white rounded-xl shadow-xl p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold mb-3 text-gray-800">
                        <i class="fas fa-gamepad"></i> éŠæˆ²æ§åˆ¶
                    </h2>
                    <div class="space-y-3">
                        <div class="text-center">
                            <p class="text-xs md:text-sm text-gray-600 mb-1">ç•¶å‰ç©å®¶</p>
                            <div id="currentPlayer" class="text-xl md:text-2xl font-bold"></div>
                        </div>
                        <button id="rollDiceBtn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-2 md:py-3 px-4 md:px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg text-sm md:text-base">
                            <i class="fas fa-dice"></i> æ“²éª°å­
                        </button>
                        <div id="diceResult" class="text-center text-xl md:text-2xl font-bold text-gray-800 hidden"></div>
                        <div id="gameActions" class="space-y-2 hidden">
                            <button id="buyPropertyBtn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-all text-sm">
                                <i class="fas fa-shopping-cart"></i> è³¼è²·åœ°ç”¢
                            </button>
                            <button id="endTurnBtn" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition-all text-sm">
                                <i class="fas fa-forward"></i> çµæŸå›åˆ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Properties Owned -->
                <div class="bg-white rounded-xl shadow-xl p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold mb-3 text-gray-800">
                        <i class="fas fa-map-marked-alt"></i> æˆ‘çš„åœ°ç”¢
                    </h2>
                    <div id="myProperties" class="space-y-2 max-h-48 overflow-y-auto">
                        <p class="text-sm text-gray-500 text-center">æš«ç„¡åœ°ç”¢</p>
                    </div>
                </div>
            </div>

            <!-- Center: Game Board -->
            <div class="lg:col-span-2">
                <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl shadow-2xl p-2 md:p-4">
                    <div id="gameBoard" class="relative">
                        <!-- Board will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Right Sidebar: Game Info -->
            <div class="lg:col-span-1 space-y-2 md:space-y-4">
                <!-- Bank Info -->
                <div class="bg-white rounded-xl shadow-xl p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold mb-3 text-gray-800">
                        <i class="fas fa-university"></i> éŠ€è¡Œè³‡è¨Š
                    </h2>
                    <div class="space-y-2 text-sm md:text-base">
                        <div class="flex justify-between">
                            <span>èµ·å§‹è³‡é‡‘:</span>
                            <span class="font-bold">$1,500</span>
                        </div>
                        <div class="flex justify-between">
                            <span>éè·¯è²»:</span>
                            <span class="font-bold text-red-600">åœ°åƒ¹ Ã— å€æ•¸</span>
                        </div>
                    </div>
                </div>

                <!-- Game Rules -->
                <div class="bg-white rounded-xl shadow-xl p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold mb-3 text-gray-800">
                        <i class="fas fa-book"></i> éŠæˆ²è¦å‰‡
                    </h2>
                    <ul class="text-xs md:text-sm space-y-1 text-gray-700">
                        <li>â€¢ ç­”å°å•é¡Œæ‰èƒ½è²·åœ°</li>
                        <li>â€¢ ç¶“éä»–äººåœ°ç”¢éœ€ä»˜ç§Ÿé‡‘</li>
                        <li>â€¢ ç ´ç”¢è€…é€€å‡ºéŠæˆ²</li>
                        <li>â€¢ æœ€å¾Œå‰©é¤˜è€…ç²å‹</li>
                    </ul>
                </div>

                <!-- Event Log -->
                <div class="bg-white rounded-xl shadow-xl p-3 md:p-4">
                    <h2 class="text-lg md:text-xl font-bold mb-3 text-gray-800">
                        <i class="fas fa-scroll"></i> éŠæˆ²æ—¥èªŒ
                    </h2>
                    <div id="eventLog" class="space-y-1 text-xs md:text-sm max-h-48 overflow-y-auto">
                        <p class="text-gray-500">éŠæˆ²é–‹å§‹...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="questionModal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 p-6 md:p-8 relative">
            <button id="closeQuestionModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
            <div id="questionContent" class="space-y-4 md:space-y-6">
                <!-- Question content will be dynamically loaded -->
            </div>
        </div>
    </div>

    <!-- Property Purchase Modal -->
    <div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6 md:p-8 text-center">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">è³¼è²·åœ°ç”¢</h3>
            <div id="purchaseInfo" class="mb-6"></div>
            <div class="space-y-3">
                <button id="confirmPurchaseBtn" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-all">
                    <i class="fas fa-check"></i> ç¢ºèªè³¼è²·
                </button>
                <button id="cancelPurchaseBtn" class="w-full bg-gray-400 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-500 transition-all">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6 md:p-8 text-center">
            <h2 class="text-3xl font-bold text-yellow-600 mb-4">ğŸ‰ éŠæˆ²çµæŸï¼</h2>
            <div id="winnerInfo" class="mb-6"></div>
            <button id="restartGameBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
                <i class="fas fa-redo"></i> é‡æ–°é–‹å§‹
            </button>
        </div>
    </div>

    <!-- Setup Modal -->
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 modal-overlay flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6 md:p-8 text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-landmark text-yellow-300"></i> èªæ–‡å¤§å¯Œç¿
            </h2>
            <p class="text-gray-600 mb-6">è«‹é¸æ“‡ç©å®¶æ•¸é‡</p>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <button class="player-count-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg" data-count="2">
                    <div class="text-2xl mb-2">ğŸ‘¥</div>
                    <div class="text-lg">2 äºº</div>
                </button>
                <button class="player-count-btn bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg" data-count="3">
                    <div class="text-2xl mb-2">ğŸ‘¥</div>
                    <div class="text-lg">3 äºº</div>
                </button>
                <button class="player-count-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg" data-count="4">
                    <div class="text-2xl mb-2">ğŸ‘¥</div>
                    <div class="text-lg">4 äºº</div>
                </button>
            </div>
            <p class="text-sm text-gray-500">ç­”å°ä¸­æ–‡å•é¡Œæ‰èƒ½è²·åœ°ï¼</p>
        </div>
    </div>

    <script>
        // Game Configuration
        const STARTING_MONEY = 1500;
        const BOARD_SIZE = 40;
        const PLAYER_COLORS = [
            { bg: 'bg-blue-500', border: 'border-blue-600', name: 'ç©å®¶ä¸€' },
            { bg: 'bg-red-500', border: 'border-red-600', name: 'ç©å®¶äºŒ' },
            { bg: 'bg-green-500', border: 'border-green-600', name: 'ç©å®¶ä¸‰' },
            { bg: 'bg-yellow-500', border: 'border-yellow-600', name: 'ç©å®¶å››' }
        ];

        // Property Data (40 spaces on Monopoly board)
        const PROPERTIES = [
            { name: 'èµ·é»', type: 'start', price: 0, rent: 0, color: 'bg-green-500' },
            { name: 'ä¸­ç’°', type: 'property', price: 60, rent: 2, color: 'bg-blue-400', group: 'brown' },
            { name: 'æ©Ÿæœƒ', type: 'chance', price: 0, rent: 0, color: 'bg-orange-400' },
            { name: 'éŠ…é‘¼ç£', type: 'property', price: 60, rent: 4, color: 'bg-blue-400', group: 'brown' },
            { name: 'æ‰€å¾—ç¨…', type: 'tax', price: 0, rent: 200, color: 'bg-red-500' },
            { name: 'ä¹é¾ç«™', type: 'railroad', price: 200, rent: 25, color: 'bg-gray-600' },
            { name: 'æ—ºè§’', type: 'property', price: 100, rent: 6, color: 'bg-pink-300', group: 'lightblue' },
            { name: 'æ©Ÿæœƒ', type: 'chance', price: 0, rent: 0, color: 'bg-orange-400' },
            { name: 'æ·±æ°´åŸ—', type: 'property', price: 100, rent: 6, color: 'bg-pink-300', group: 'lightblue' },
            { name: 'æ²¹éº»åœ°', type: 'property', price: 120, rent: 8, color: 'bg-pink-300', group: 'lightblue' },
            { name: 'ç›£ç„', type: 'jail', price: 0, rent: 0, color: 'bg-gray-700' },
            { name: 'å°–æ²™å’€', type: 'property', price: 140, rent: 10, color: 'bg-purple-300', group: 'pink' },
            { name: 'é›»åŠ›å…¬å¸', type: 'utility', price: 150, rent: 0, color: 'bg-yellow-400' },
            { name: 'ä½æ•¦', type: 'property', price: 140, rent: 10, color: 'bg-purple-300', group: 'pink' },
            { name: 'æ²¹å°–æ—º', type: 'property', price: 160, rent: 12, color: 'bg-purple-300', group: 'pink' },
            { name: 'æ±éµç·š', type: 'railroad', price: 200, rent: 25, color: 'bg-gray-600' },
            { name: 'è§€å¡˜', type: 'property', price: 180, rent: 14, color: 'bg-orange-300', group: 'orange' },
            { name: 'ç¤¾å€åŸºé‡‘', type: 'chest', price: 0, rent: 0, color: 'bg-blue-300' },
            { name: 'é»ƒå¤§ä»™', type: 'property', price: 180, rent: 14, color: 'bg-orange-300', group: 'orange' },
            { name: 'ä¹é¾åŸ', type: 'property', price: 200, rent: 16, color: 'bg-orange-300', group: 'orange' },
            { name: 'å…è²»åœè»Š', type: 'freeparking', price: 0, rent: 0, color: 'bg-green-300' },
            { name: 'æ²™ç”°', type: 'property', price: 220, rent: 18, color: 'bg-red-300', group: 'red' },
            { name: 'æ©Ÿæœƒ', type: 'chance', price: 0, rent: 0, color: 'bg-orange-400' },
            { name: 'å¤§åŸ”', type: 'property', price: 220, rent: 18, color: 'bg-red-300', group: 'red' },
            { name: 'ä¸Šæ°´', type: 'property', price: 240, rent: 20, color: 'bg-red-300', group: 'red' },
            { name: 'è¥¿éµç·š', type: 'railroad', price: 200, rent: 25, color: 'bg-gray-600' },
            { name: 'å…ƒæœ—', type: 'property', price: 260, rent: 22, color: 'bg-yellow-300', group: 'yellow' },
            { name: 'å±¯é–€', type: 'property', price: 260, rent: 22, color: 'bg-yellow-300', group: 'yellow' },
            { name: 'æ°´å‹™å±€', type: 'utility', price: 150, rent: 0, color: 'bg-blue-400' },
            { name: 'å¤©æ°´åœ', type: 'property', price: 280, rent: 24, color: 'bg-yellow-300', group: 'yellow' },
            { name: 'å…¥ç„', type: 'gotojail', price: 0, rent: 0, color: 'bg-gray-800' },
            { name: 'ä¸­ç’°', type: 'property', price: 300, rent: 26, color: 'bg-green-300', group: 'green' },
            { name: 'é‡‘é˜', type: 'property', price: 300, rent: 26, color: 'bg-green-300', group: 'green' },
            { name: 'ç¤¾å€åŸºé‡‘', type: 'chest', price: 0, rent: 0, color: 'bg-blue-300' },
            { name: 'ç£ä»”', type: 'property', price: 320, rent: 28, color: 'bg-green-300', group: 'green' },
            { name: 'æ¸¯å³¶ç·š', type: 'railroad', price: 200, rent: 25, color: 'bg-gray-600' },
            { name: 'æ©Ÿæœƒ', type: 'chance', price: 0, rent: 0, color: 'bg-orange-400' },
            { name: 'éŠ…é‘¼ç£', type: 'property', price: 350, rent: 35, color: 'bg-blue-500', group: 'blue' },
            { name: 'è¶…é¡ç¨…', type: 'tax', price: 0, rent: 100, color: 'bg-red-600' },
            { name: 'è·‘é¦¬åœ°', type: 'property', price: 400, rent: 50, color: 'bg-blue-500', group: 'blue' }
        ];

        // Chinese Language Questions Database
        const QUESTIONS = [
            {
                question: "ã€Œæ†§æ†¬ã€çš„æ„æ€æ˜¯ï¼Ÿ",
                options: ["åš®å¾€", "ææ‡¼", "å¾Œæ‚”", "æ†¤æ€’"],
                correct: 0,
                explanation: "ã€Œæ†§æ†¬ã€æŒ‡å°ç¾å¥½äº‹ç‰©çš„åš®å¾€å’ŒæœŸå¾…ã€‚"
            },
            {
                question: "ã€Œç•«è›‡æ·»è¶³ã€æ¯”å–»ä»€éº¼ï¼Ÿ",
                options: ["å¤šæ­¤ä¸€èˆ‰", "ç²¾ç›Šæ±‚ç²¾", "æ°åˆ°å¥½è™•", "å®Œç¾ç„¡ç¼º"],
                correct: 0,
                explanation: "ã€Œç•«è›‡æ·»è¶³ã€æ¯”å–»åšäº†å¤šé¤˜çš„äº‹ï¼Œéä½†ç„¡ç›Šï¼Œåè€Œä¸åˆé©ã€‚"
            },
            {
                question: "ã€Œä»–è·‘å¾—å¾ˆå¿«ã€ä¸­çš„ã€Œå¾—ã€æ˜¯ä»€éº¼è©ï¼Ÿ",
                options: ["åŠ©è©", "å‹•è©", "åè©", "å½¢å®¹è©"],
                correct: 0,
                explanation: "ã€Œå¾—ã€åœ¨é€™è£¡æ˜¯çµæ§‹åŠ©è©ï¼Œç”¨æ–¼é€£æ¥å‹•è©å’Œè£œèªã€‚"
            },
            {
                question: "ã€Œæ˜¥é¢¨åˆç¶ æ±Ÿå—å²¸ã€ä¸­ã€Œç¶ ã€å­—çš„ç”¨æ³•æ˜¯ï¼Ÿ",
                options: ["å½¢å®¹è©ä½œå‹•è©", "åè©ä½œå‹•è©", "å‹•è©ä½œåè©", "å‰¯è©ä½œå‹•è©"],
                correct: 0,
                explanation: "ã€Œç¶ ã€åŸæœ¬æ˜¯å½¢å®¹è©ï¼Œé€™è£¡æ´»ç”¨ç‚ºå‹•è©ï¼Œæ„æ€æ˜¯ã€Œä½¿...è®Šç¶ ã€ã€‚"
            },
            {
                question: "ã€Œå®ˆæ ªå¾…å…”ã€çš„æ•…äº‹å‘Šè¨´æˆ‘å€‘ä»€éº¼é“ç†ï¼Ÿ",
                options: ["ä¸æ‡‰å¢¨å®ˆæˆè¦", "æ‡‰è©²å‹¤å¥®å·¥ä½œ", "è¦æ‡‚å¾—è®Šé€š", "ä»¥ä¸Šçš†æ˜¯"],
                correct: 3,
                explanation: "ã€Œå®ˆæ ªå¾…å…”ã€æ¯”å–»ä¸ä¸»å‹•åŠªåŠ›ï¼Œè€Œå­˜è¬ä¸€çš„åƒ¥å€–å¿ƒç†ã€‚"
            },
            {
                question: "ã€Œäº¡ç¾Šè£œç‰¢ã€çš„æ„æ€æ˜¯ï¼Ÿ",
                options: ["ç‚ºæ™‚å·²æ™š", "åŠæ™‚è£œæ•‘", "ç„¡å¯æŒ½å›", "å¾Œæ‚”è«åŠ"],
                correct: 1,
                explanation: "ã€Œäº¡ç¾Šè£œç‰¢ã€æ¯”å–»å‡ºäº†å•é¡Œä»¥å¾Œæƒ³è¾¦æ³•è£œæ•‘ï¼Œå¯ä»¥é˜²æ­¢ç¹¼çºŒå—æå¤±ã€‚"
            },
            {
                question: "ã€Œç¾éº—çš„èŠ±æœµã€ä¸­ã€Œç¾éº—çš„ã€æ˜¯ä»€éº¼æˆåˆ†ï¼Ÿ",
                options: ["å®šèª", "ç‹€èª", "è£œèª", "ä¸»èª"],
                correct: 0,
                explanation: "ã€Œç¾éº—çš„ã€ä¿®é£¾åè©ã€ŒèŠ±æœµã€ï¼Œæ˜¯å®šèªã€‚"
            },
            {
                question: "ã€Œä»–èªçœŸåœ°å­¸ç¿’ã€ä¸­ã€ŒèªçœŸåœ°ã€æ˜¯ä»€éº¼æˆåˆ†ï¼Ÿ",
                options: ["ç‹€èª", "å®šèª", "è£œèª", "è¬‚èª"],
                correct: 0,
                explanation: "ã€ŒèªçœŸåœ°ã€ä¿®é£¾å‹•è©ã€Œå­¸ç¿’ã€ï¼Œæ˜¯ç‹€èªã€‚"
            },
            {
                question: "ã€Œä¸€çŸ³äºŒé³¥ã€æ¯”å–»ä»€éº¼ï¼Ÿ",
                options: ["ä¸€èˆ‰å…©å¾—", "å›°é›£é‡é‡", "æ©Ÿæœƒé›£å¾—", "é‹æ°£å¾ˆå¥½"],
                correct: 0,
                explanation: "ã€Œä¸€çŸ³äºŒé³¥ã€æ¯”å–»åšä¸€ä»¶äº‹å¾—åˆ°å…©ç¨®å¥½è™•ã€‚"
            },
            {
                question: "ã€Œç ´é‡œæ²‰èˆŸã€è¡¨é”ä»€éº¼æ±ºå¿ƒï¼Ÿ",
                options: ["ä¸ç•™é€€è·¯ï¼Œæ±ºä¸€æ­»æˆ°", "å°å¿ƒè¬¹æ…", "çŒ¶è±«ä¸æ±º", "ä¸‰å¿ƒäºŒæ„"],
                correct: 0,
                explanation: "ã€Œç ´é‡œæ²‰èˆŸã€æ¯”å–»ä¸ç•™é€€è·¯ï¼Œä¸‹æ±ºå¿ƒä¸é¡§ä¸€åˆ‡åœ°å¹¹åˆ°åº•ã€‚"
            },
            {
                question: "ã€Œä½†é¡˜äººé•·ä¹…ï¼Œåƒé‡Œå…±å¬‹å¨Ÿã€ä¸­çš„ã€Œå¬‹å¨Ÿã€æŒ‡ä»€éº¼ï¼Ÿ",
                options: ["æœˆäº®", "ç¾å¥³", "ç¾å¥½", "é•·ä¹…"],
                correct: 0,
                explanation: "ã€Œå¬‹å¨Ÿã€åœ¨é€™è£¡æŒ‡æœˆäº®ï¼Œæ˜¯å€Ÿä»£ä¿®è¾­æ‰‹æ³•ã€‚"
            },
            {
                question: "ã€ŒèºŠèº‡ã€çš„åŒç¾©è©æ˜¯ï¼Ÿ",
                options: ["çŒ¶è±«", "æœæ–·", "å‹‡æ•¢", "å …å®š"],
                correct: 0,
                explanation: "ã€ŒèºŠèº‡ã€æŒ‡çŒ¶è±«ä¸æ±ºï¼Œæ‹¿ä¸å®šä¸»æ„ã€‚"
            },
            {
                question: "ã€Œç’€ç’¨ã€é€šå¸¸ç”¨ä¾†å½¢å®¹ä»€éº¼ï¼Ÿ",
                options: ["å…‰èŠ’", "è²éŸ³", "å‘³é“", "è§¸æ„Ÿ"],
                correct: 0,
                explanation: "ã€Œç’€ç’¨ã€å½¢å®¹å…‰å½©é®®æ˜ã€è€€çœ¼å¥ªç›®ã€‚"
            },
            {
                question: "ã€Œé‚‚é€…ã€çš„æ„æ€æ˜¯ï¼Ÿ",
                options: ["å¶ç„¶ç›¸é‡", "æ•…æ„é¿é–‹", "é•·æœŸç›¸è™•", "å‘Šåˆ¥åˆ†é›¢"],
                correct: 0,
                explanation: "ã€Œé‚‚é€…ã€æŒ‡ä¸æœŸè€Œé‡ï¼Œå¶ç„¶ç›¸é‡ã€‚"
            },
            {
                question: "ã€Œè¹£è·šã€å½¢å®¹ä»€éº¼ç‹€æ…‹ï¼Ÿ",
                options: ["èµ°è·¯ä¸ç©©", "èªªè©±æµåˆ©", "æ€ç¶­æ•æ·", "å‹•ä½œè¿…é€Ÿ"],
                correct: 0,
                explanation: "ã€Œè¹£è·šã€å½¢å®¹èµ°è·¯ç·©æ…¢ã€æ–æ“ºä¸ç©©çš„æ¨£å­ã€‚"
            }
        ];

        // Game State
        let gameState = {
            players: [],
            currentPlayerIndex: 0,
            gameStarted: false,
            gameOver: false,
            properties: PROPERTIES.map((prop, index) => ({
                ...prop,
                owner: null,
                index: index
            })),
            numPlayers: 2,
            currentProperty: null
        };

        // Initialize Game
        function initGame(numPlayers = 2) {
            gameState.numPlayers = Math.min(Math.max(parseInt(numPlayers) || 2, 2), 4);
            
            // Create players
            gameState.players = [];
            for (let i = 0; i < gameState.numPlayers; i++) {
                gameState.players.push({
                    id: i,
                    name: PLAYER_COLORS[i].name,
                    position: 0,
                    money: STARTING_MONEY,
                    color: PLAYER_COLORS[i],
                    inJail: false,
                    jailTurns: 0,
                    properties: []
                });
            }

            // Reset properties
            gameState.properties = PROPERTIES.map((prop, index) => ({
                ...prop,
                owner: null,
                index: index
            }));

            gameState.currentPlayerIndex = 0;
            gameState.gameStarted = true;
            gameState.gameOver = false;

            // Hide setup modal
            const setupModal = document.getElementById('setupModal');
            if (setupModal) {
                setupModal.classList.add('hidden');
                setupModal.classList.remove('flex');
            }

            renderBoard();
            renderPlayersInfo();
            updateCurrentPlayer();
            addEventLog("éŠæˆ²é–‹å§‹ï¼");
        }

        // Render Game Board (Monopoly style - 4 sides)
        function renderBoard() {
            const boardElement = document.getElementById('gameBoard');
            boardElement.innerHTML = '';
            
            // Create 4-sided board layout (11x11 grid for 40 cells)
            // Layout: 9 cells per side + 4 corners = 40 total
            const boardHTML = `
                <div class="grid grid-cols-11 gap-0 relative" style="aspect-ratio: 1;">
                    ${Array.from({ length: 40 }, (_, i) => {
                        const cell = getCellPosition(i);
                        const isCorner = i === 0 || i === 10 || i === 20 || i === 30;
                        return `
                            <div class="board-cell ${cell.color} text-white p-1 md:p-2 relative flex flex-col items-center justify-center text-[7px] md:text-xs font-bold" 
                                 style="grid-column: ${cell.col}; grid-row: ${cell.row}; min-height: ${isCorner ? '80px' : '60px'};"
                                 data-index="${i}">
                                <div class="text-center w-full">
                                    <div class="font-bold mb-1 truncate">${PROPERTIES[i].name}</div>
                                    ${PROPERTIES[i].price > 0 ? `<div class="text-[6px] md:text-[10px]">$${PROPERTIES[i].price}</div>` : ''}
                                </div>
                                <div id="cell-players-${i}" class="absolute bottom-1 left-1 flex gap-0.5 flex-wrap">
                                    <!-- Players will be rendered here -->
                                </div>
                                ${gameState.properties[i].owner !== null ? `
                                    <div class="absolute top-1 right-1 w-2 h-2 md:w-3 md:h-3 rounded-full ${PLAYER_COLORS[gameState.properties[i].owner]?.bg || 'bg-gray-500'} border border-white"></div>
                                ` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            boardElement.innerHTML = boardHTML;
            updatePlayerPositions();
        }

        // Calculate cell position for 4-sided board
        // Traditional Monopoly: 40 cells total
        // - 4 corners (0, 10, 20, 30)
        // - 9 cells per side between corners
        function getCellPosition(index) {
            // Bottom row: index 0-9 (right to left, starting from bottom-right corner)
            if (index <= 9) {
                return { row: 11, col: 11 - index, color: PROPERTIES[index].color };
            }
            // Left column: index 10-19 (bottom to top, starting from bottom-left corner)
            else if (index <= 19) {
                return { row: 11 - (index - 10), col: 1, color: PROPERTIES[index].color };
            }
            // Top row: index 20-29 (left to right, starting from top-left corner)
            else if (index <= 29) {
                return { row: 1, col: 1 + (index - 20), color: PROPERTIES[index].color };
            }
            // Right column: index 30-39 (top to bottom, starting from top-right corner)
            else {
                return { row: 1 + (index - 30), col: 11, color: PROPERTIES[index].color };
            }
        }

        // Render Players Info
        function renderPlayersInfo() {
            const playersInfoElement = document.getElementById('playersInfo');
            const colorMap = {
                'bg-blue-500': 'text-blue-600',
                'bg-red-500': 'text-red-600',
                'bg-green-500': 'text-green-600',
                'bg-yellow-500': 'text-yellow-600'
            };
            
            playersInfoElement.innerHTML = gameState.players.map(player => {
                const textColor = colorMap[player.color.bg] || 'text-gray-600';
                return `
                    <div class="p-2 md:p-3 rounded-lg border-2 ${player.id === gameState.currentPlayerIndex ? player.color.border : 'border-transparent'} ${player.color.bg} bg-opacity-10">
                        <div class="flex items-center justify-between mb-1">
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-4 rounded-full ${player.color.bg}"></div>
                                <span class="font-semibold ${textColor} text-sm md:text-base">${player.name}</span>
                            </div>
                            ${player.inJail ? '<span class="text-xs text-red-600">â›“ï¸</span>' : ''}
                        </div>
                        <div class="text-xs md:text-sm font-bold ${textColor}">
                            $${player.money.toLocaleString()}
                        </div>
                        <div class="text-xs text-gray-600">
                            åœ°ç”¢: ${player.properties.length} è™•
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update Current Player
        function updateCurrentPlayer() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const colorMap = {
                'bg-blue-500': 'text-blue-600',
                'bg-red-500': 'text-red-600',
                'bg-green-500': 'text-green-600',
                'bg-yellow-500': 'text-yellow-600'
            };
            const textColor = colorMap[currentPlayer.color.bg] || 'text-gray-600';
            
            document.getElementById('currentPlayer').textContent = currentPlayer.name;
            document.getElementById('currentPlayer').className = `text-xl md:text-2xl font-bold ${textColor}`;
            renderPlayersInfo();
            updateMyProperties();
        }

        // Update Player Positions on Board
        function updatePlayerPositions() {
            // Clear all player tokens
            for (let i = 0; i < BOARD_SIZE; i++) {
                const cellElement = document.getElementById(`cell-players-${i}`);
                if (cellElement) {
                    cellElement.innerHTML = '';
                }
            }

            // Render player tokens
            gameState.players.forEach((player, playerIndex) => {
                const cellElement = document.getElementById(`cell-players-${player.position}`);
                if (cellElement) {
                    const token = document.createElement('div');
                    token.className = `player-token ${player.color.bg} ${player.color.border}`;
                    token.style.zIndex = '20';
                    token.title = player.name;
                    cellElement.appendChild(token);
                }
            });
        }

        // Update My Properties
        function updateMyProperties() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const myPropertiesElement = document.getElementById('myProperties');
            
            if (currentPlayer.properties.length === 0) {
                myPropertiesElement.innerHTML = '<p class="text-sm text-gray-500 text-center">æš«ç„¡åœ°ç”¢</p>';
            } else {
                myPropertiesElement.innerHTML = currentPlayer.properties.map(propIndex => {
                    const prop = gameState.properties[propIndex];
                    return `
                        <div class="property-card p-2 bg-gray-50 rounded border border-gray-200 text-xs">
                            <div class="font-bold text-gray-800">${prop.name}</div>
                            <div class="text-gray-600">ç§Ÿé‡‘: $${prop.rent}</div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Roll Dice
        function rollDice() {
            if (gameState.gameOver) return;
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            // Check if player is in jail
            if (currentPlayer.inJail) {
                if (currentPlayer.jailTurns >= 3) {
                    currentPlayer.inJail = false;
                    currentPlayer.jailTurns = 0;
                    addEventLog(`${currentPlayer.name} å‡ºç„äº†ï¼`);
                } else {
                    currentPlayer.jailTurns++;
                    addEventLog(`${currentPlayer.name} ä»åœ¨ç›£ç„ä¸­ (${currentPlayer.jailTurns}/3)`);
                    nextTurn();
                    return;
                }
            }
            
            const diceBtn = document.getElementById('rollDiceBtn');
            diceBtn.disabled = true;
            diceBtn.classList.add('dice-rolling');

            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            const diceResultElement = document.getElementById('diceResult');
            
            setTimeout(() => {
                diceBtn.classList.remove('dice-rolling');
                diceResultElement.textContent = `ğŸ² ${dice1} + ${dice2} = ${total}`;
                diceResultElement.classList.remove('hidden');
                
                movePlayer(total);
            }, 600);
        }

        // Move Player
        function movePlayer(steps) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const newPosition = (currentPlayer.position + steps) % BOARD_SIZE;
            
            // Animate movement
            let currentPos = currentPlayer.position;
            const moveInterval = setInterval(() => {
                currentPos = (currentPos + 1) % BOARD_SIZE;
                currentPlayer.position = currentPos;
                updatePlayerPositions();
                
                if (currentPos === newPosition) {
                    clearInterval(moveInterval);
                    currentPlayer.position = newPosition;
                    updatePlayerPositions();
                    
                    // Handle landing on space
                    setTimeout(() => handleLanding(newPosition), 300);
                }
            }, 150);
        }

        // Handle Landing on Space
        function handleLanding(position) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const property = gameState.properties[position];
            
            addEventLog(`${currentPlayer.name} åˆ°é” ${property.name}`);
            
            switch (property.type) {
                case 'start':
                    currentPlayer.money += 200;
                    addEventLog(`${currentPlayer.name} ç¶“éèµ·é»ï¼Œç²å¾— $200`);
                    renderPlayersInfo();
                    nextTurn();
                    break;
                    
                case 'property':
                case 'railroad':
                case 'utility':
                    if (property.owner === null) {
                        // Show question to buy property
                        gameState.currentProperty = position;
                        showQuestionForPurchase();
                    } else if (property.owner === currentPlayer.id) {
                        addEventLog(`${currentPlayer.name} åˆ°é”è‡ªå·±çš„åœ°ç”¢`);
                        nextTurn();
                    } else {
                        // Pay rent
                        const owner = gameState.players[property.owner];
                        const rent = calculateRent(property);
                        currentPlayer.money -= rent;
                        owner.money += rent;
                        addEventLog(`${currentPlayer.name} æ”¯ä»˜ $${rent} ç§Ÿé‡‘çµ¦ ${owner.name}`);
                        
                        if (currentPlayer.money < 0) {
                            handleBankruptcy(currentPlayer);
                        } else {
                            renderPlayersInfo();
                            nextTurn();
                        }
                    }
                    break;
                    
                case 'tax':
                    const taxAmount = property.rent;
                    currentPlayer.money -= taxAmount;
                    addEventLog(`${currentPlayer.name} ç¹³ç´ç¨…æ¬¾ $${taxAmount}`);
                    if (currentPlayer.money < 0) {
                        handleBankruptcy(currentPlayer);
                    } else {
                        renderPlayersInfo();
                        nextTurn();
                    }
                    break;
                    
                case 'gotojail':
                    currentPlayer.position = 10; // Jail position
                    currentPlayer.inJail = true;
                    currentPlayer.jailTurns = 0;
                    addEventLog(`${currentPlayer.name} è¢«é€é€²ç›£ç„ï¼`);
                    updatePlayerPositions();
                    nextTurn();
                    break;
                    
                case 'chance':
                case 'chest':
                    handleChanceOrChest(property.type);
                    break;
                    
                case 'freeparking':
                    addEventLog(`${currentPlayer.name} å…è²»åœè»Š`);
                    nextTurn();
                    break;
                    
                default:
                    nextTurn();
            }
        }

        // Calculate Rent
        function calculateRent(property) {
            if (property.type === 'railroad') {
                // Count railroads owned by same player
                const owner = gameState.players[property.owner];
                const railroadsOwned = owner.properties.filter(idx => 
                    gameState.properties[idx].type === 'railroad'
                ).length;
                return 25 * railroadsOwned;
            } else if (property.type === 'utility') {
                // Count utilities owned by same player
                const owner = gameState.players[property.owner];
                const utilitiesOwned = owner.properties.filter(idx => 
                    gameState.properties[idx].type === 'utility'
                ).length;
                return utilitiesOwned === 2 ? 100 : 50;
            } else {
                return property.rent;
            }
        }

        // Show Question for Purchase
        function showQuestionForPurchase() {
            const property = gameState.properties[gameState.currentProperty];
            const question = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
            
            const modal = document.getElementById('questionModal');
            const questionContent = document.getElementById('questionContent');
            
            questionContent.innerHTML = `
                <div class="text-center">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">è³¼è²· ${property.name}</h3>
                    <p class="text-sm md:text-base text-gray-600 mb-2">åƒ¹æ ¼: $${property.price}</p>
                    <p class="text-sm md:text-base text-gray-600 mb-4">ç­”å°å•é¡Œæ‰èƒ½è³¼è²·ï¼</p>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p class="text-lg md:text-xl text-gray-800 mb-4">${question.question}</p>
                        <div class="space-y-2">
                            ${question.options.map((option, index) => `
                                <button class="option-btn w-full p-3 bg-white hover:bg-blue-100 rounded-lg text-left font-semibold transition-all transform hover:scale-105 border-2 border-transparent hover:border-blue-300" data-answer="${index}">
                                    ${String.fromCharCode(65 + index)}. ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div id="answerResult" class="mt-4 hidden"></div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');

            // Add event listeners to options
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const selectedAnswer = parseInt(this.dataset.answer);
                    checkPurchaseAnswer(question, selectedAnswer, property);
                });
            });
        }

        // Check Purchase Answer
        function checkPurchaseAnswer(question, selectedAnswer, property) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const answerResult = document.getElementById('answerResult');
            const optionButtons = document.querySelectorAll('.option-btn');
            
            // Disable all buttons
            optionButtons.forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-100', 'hover:scale-105');
            });

            if (selectedAnswer === question.correct) {
                // Correct answer - can buy property
                optionButtons[selectedAnswer].classList.add('bg-green-500', 'text-white', 'border-green-600');
                answerResult.innerHTML = `
                    <div class="bg-green-100 border-2 border-green-500 rounded-lg p-4">
                        <p class="text-green-800 font-bold text-lg">âœ“ ç­”å°äº†ï¼</p>
                        <p class="text-green-700 mt-2">${question.explanation}</p>
                        <p class="text-green-700 mt-2">ä½ å¯ä»¥è³¼è²·é€™å¡Šåœ°ç”¢ï¼</p>
                    </div>
                `;
                
                setTimeout(() => {
                    closeQuestionModal();
                    showPurchaseModal(property);
                }, 2000);
            } else {
                // Wrong answer - cannot buy
                optionButtons[selectedAnswer].classList.add('bg-red-500', 'text-white', 'border-red-600');
                optionButtons[question.correct].classList.add('bg-green-500', 'text-white', 'border-green-600');
                answerResult.innerHTML = `
                    <div class="bg-red-100 border-2 border-red-500 rounded-lg p-4">
                        <p class="text-red-800 font-bold text-lg">âœ— ç­”éŒ¯äº†</p>
                        <p class="text-red-700 mt-2">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${question.options[question.correct]}</p>
                        <p class="text-red-700 mt-2">${question.explanation}</p>
                        <p class="text-red-700 mt-2 font-bold">ç„¡æ³•è³¼è²·é€™å¡Šåœ°ç”¢</p>
                    </div>
                `;
                
                setTimeout(() => {
                    closeQuestionModal();
                    gameState.currentProperty = null;
                    nextTurn();
                }, 2000);
            }
        }

        // Show Purchase Modal
        function showPurchaseModal(property) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const modal = document.getElementById('purchaseModal');
            const purchaseInfo = document.getElementById('purchaseInfo');
            
            purchaseInfo.innerHTML = `
                <div class="space-y-2">
                    <p class="text-lg font-bold text-gray-800">${property.name}</p>
                    <p class="text-gray-600">åƒ¹æ ¼: <span class="font-bold text-blue-600">$${property.price}</span></p>
                    <p class="text-gray-600">ç§Ÿé‡‘: <span class="font-bold text-green-600">$${property.rent}</span></p>
                    <p class="text-sm text-gray-500 mt-4">ä½ çš„è³‡é‡‘: $${currentPlayer.money.toLocaleString()}</p>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Confirm Purchase
        function confirmPurchase() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const property = gameState.properties[gameState.currentProperty];
            
            if (currentPlayer.money >= property.price) {
                currentPlayer.money -= property.price;
                property.owner = currentPlayer.id;
                currentPlayer.properties.push(gameState.currentProperty);
                
                addEventLog(`${currentPlayer.name} è³¼è²·äº† ${property.name} ($${property.price})`);
                
                renderBoard();
                renderPlayersInfo();
                updateMyProperties();
                
                closePurchaseModal();
                gameState.currentProperty = null;
                nextTurn();
            } else {
                alert('è³‡é‡‘ä¸è¶³ï¼');
            }
        }

        // Close Modals
        function closeQuestionModal() {
            const modal = document.getElementById('questionModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function closePurchaseModal() {
            const modal = document.getElementById('purchaseModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Handle Chance or Community Chest
        function handleChanceOrChest(type) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const effects = [
                { text: 'ç²å¾— $100', money: 100 },
                { text: 'ç²å¾— $200', money: 200 },
                { text: 'æ”¯ä»˜ $50', money: -50 },
                { text: 'æ”¯ä»˜ $100', money: -100 },
                { text: 'å‰é€²3æ ¼', move: 3 },
                { text: 'å¾Œé€€2æ ¼', move: -2 }
            ];
            
            const effect = effects[Math.floor(Math.random() * effects.length)];
            addEventLog(`${currentPlayer.name} æŠ½åˆ°${type === 'chance' ? 'æ©Ÿæœƒ' : 'ç¤¾å€åŸºé‡‘'}å¡: ${effect.text}`);
            
            if (effect.money) {
                currentPlayer.money += effect.money;
                if (currentPlayer.money < 0) {
                    handleBankruptcy(currentPlayer);
                    return;
                }
            } else if (effect.move) {
                const newPosition = (currentPlayer.position + effect.move + BOARD_SIZE) % BOARD_SIZE;
                currentPlayer.position = newPosition;
                updatePlayerPositions();
                setTimeout(() => handleLanding(newPosition), 500);
                return;
            }
            
            renderPlayersInfo();
            nextTurn();
        }

        // Handle Bankruptcy
        function handleBankruptcy(player) {
            addEventLog(`${player.name} ç ´ç”¢äº†ï¼`);
            
            // Transfer properties to bank
            player.properties.forEach(propIndex => {
                gameState.properties[propIndex].owner = null;
            });
            
            // Remove player
            const playerIndex = gameState.players.findIndex(p => p.id === player.id);
            gameState.players.splice(playerIndex, 1);
            
            // Adjust current player index
            if (gameState.currentPlayerIndex >= gameState.players.length) {
                gameState.currentPlayerIndex = 0;
            }
            
            if (gameState.players.length === 1) {
                endGame(gameState.players[0]);
            } else {
                renderBoard();
                renderPlayersInfo();
                updateCurrentPlayer();
                nextTurn();
            }
        }

        // Next Turn
        function nextTurn() {
            const diceResultElement = document.getElementById('diceResult');
            diceResultElement.classList.add('hidden');
            
            const diceBtn = document.getElementById('rollDiceBtn');
            diceBtn.disabled = false;
            
            const gameActions = document.getElementById('gameActions');
            gameActions.classList.add('hidden');
            
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            updateCurrentPlayer();
        }

        // End Game
        function endGame(winner) {
            gameState.gameOver = true;
            const modal = document.getElementById('gameOverModal');
            const winnerInfo = document.getElementById('winnerInfo');
            
            const colorMap = {
                'bg-blue-500': 'text-blue-600',
                'bg-red-500': 'text-red-600',
                'bg-green-500': 'text-green-600',
                'bg-yellow-500': 'text-yellow-600'
            };
            const textColor = colorMap[winner.color.bg] || 'text-gray-600';
            
            winnerInfo.innerHTML = `
                <div class="mb-4">
                    <p class="text-xl font-semibold text-gray-700 mb-2">ğŸ† ç²å‹è€…</p>
                    <p class="text-3xl font-bold ${textColor}">${winner.name}</p>
                    <p class="text-lg text-gray-600 mt-2">è³‡é‡‘: $${winner.money.toLocaleString()}</p>
                    <p class="text-lg text-gray-600">åœ°ç”¢: ${winner.properties.length} è™•</p>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Add Event Log
        function addEventLog(message) {
            const eventLog = document.getElementById('eventLog');
            const logEntry = document.createElement('p');
            logEntry.className = 'text-gray-700';
            logEntry.textContent = message;
            eventLog.insertBefore(logEntry, eventLog.firstChild);
            
            // Keep only last 10 entries
            while (eventLog.children.length > 10) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }

        // Event Listeners
        document.getElementById('rollDiceBtn').addEventListener('click', rollDice);
        document.getElementById('closeQuestionModal').addEventListener('click', closeQuestionModal);
        document.getElementById('confirmPurchaseBtn').addEventListener('click', confirmPurchase);
        document.getElementById('cancelPurchaseBtn').addEventListener('click', () => {
            closePurchaseModal();
            gameState.currentProperty = null;
            nextTurn();
        });
        document.getElementById('restartGameBtn').addEventListener('click', () => {
            document.getElementById('gameOverModal').classList.add('hidden');
            document.getElementById('gameOverModal').classList.remove('flex');
            // Show setup modal again
            document.getElementById('setupModal').classList.remove('hidden');
            document.getElementById('setupModal').classList.add('flex');
        });

        // Close modal when clicking outside
        document.getElementById('questionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeQuestionModal();
            }
        });

        // Setup modal - player count buttons
        document.querySelectorAll('.player-count-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const numPlayers = parseInt(this.dataset.count);
                initGame(numPlayers);
            });
        });

        // Initialize - show setup modal on load
        window.addEventListener('load', function() {
            // Show setup modal instead of prompt
            const setupModal = document.getElementById('setupModal');
            if (setupModal) {
                setupModal.classList.remove('hidden');
                setupModal.classList.add('flex');
            }
        });
    </script>
</body>
</html>
