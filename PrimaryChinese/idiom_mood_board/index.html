<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>成語情緒卡 - Idiom Mood Board</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      font-family: 'Microsoft JhengHei', 'PingFang TC', 'Heiti TC', 'Arial', sans-serif;
      margin: 0;
      padding: 0;
    }
    * {
      box-sizing: border-box;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0) rotateY(0deg); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) rotateY(0deg); }
      20%, 40%, 60%, 80% { transform: translateX(10px) rotateY(0deg); }
    }
    .animate-shake {
      animation: shake 0.5s;
    }
    .perspective-1000 {
      perspective: 1000px;
    }
    .rotate-y-180 {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <footer style="text-align: center; padding: 16px; color: #64748b; font-size: 12px; font-family: system-ui, sans-serif;">
    <p style="font-style: italic; margin-bottom: 4px;">
      But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his understanding. Jeremiah 10:12
    </p>
    <p style="font-size: 11px; margin-bottom: 4px; margin-top: 8px;">
      「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
    </p>
    <p style="font-size: 11px; margin-top: 8px; padding-top: 8px; border-top: 1px solid #cbd5e1;">
      @ 2025 Primary Chinese Learning Resources | Prepared by SF Lau
    </p>
  </footer>

  <script type="text/babel">
    const { useState } = React;

    // Icons as SVG components
    const Smile = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const Frown = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const Heart = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
      </svg>
    );

    const Mountain = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
      </svg>
    );

    const Sparkles = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
      </svg>
    );

    const CheckCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const XCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const RotateCcw = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>
    );

    const TOTAL_QUESTIONS_PER_SESSION = 10;

    const shuffleArray = (array) => {
      const result = [...array];
      for (let i = result.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [result[i], result[j]] = [result[j], result[i]];
      }
      return result;
    };

    // Questions Data
    const joyDistractors = [
      { text: "手舞足蹈", hint: "這個成語強調外在誇張的肢體動作，題目想表達的是內心的情緒層次。" },
      { text: "眉飛色舞", hint: "它著重臉部表情的誇張，與題目所涵蓋的心情深度不同。" },
      { text: "喜上眉梢", hint: "只是輕盈的喜悅，沒有題目描述的強烈驚喜或成就感。" },
      { text: "歡蹦亂跳", hint: "形容童趣式的跳躍，與題目想強調的情緒細膩度不符。" },
      { text: "笑容可掬", hint: "僅描寫面帶微笑，無法突顯題目中的內心澎湃。" },
    ];

    const angerDistractors = [
      { text: "惱羞成怒", hint: "重點在因羞愧而生氣，與題目的怒火來源不同。" },
      { text: "忿忿不平", hint: "語氣較為溫和，沒有題目中的猛烈怒意。" },
      { text: "怒不可當", hint: "描述無法抵擋的怒勢，但題目要凸顯的是另一種情緒層次。" },
      { text: "氣急如焚", hint: "偏向焦躁不安，與題目所述的怒火質地不同。" },
      { text: "怨氣沖天", hint: "強調長期積累的怨氣，並非題目當下爆發的情緒。" },
    ];

    const sorrowDistractors = [
      { text: "愁眉苦臉", hint: "只描述愁苦表情，沒有題目提到的內心震盪。" },
      { text: "垂頭喪氣", hint: "偏向失望沮喪，沒有正確答案的深沉悲痛。" },
      { text: "唉聲嘆氣", hint: "只是一直嘆氣，力度不如正確答案。" },
      { text: "愁雲慘霧", hint: "多形容整體氣氛陰鬱，與題目聚焦的個人感受不同。" },
      { text: "悽風苦雨", hint: "比喻環境凄冷，與題目描寫的內心情緒不完全吻合。" },
    ];

    const sceneryDistractors = [
      { text: "賞心悅目", hint: "泛指看了心情好，沒有題目所說的震撼層次。" },
      { text: "風和日麗", hint: "重點在天氣晴朗，未能表達景色的細節。" },
      { text: "山光水色", hint: "泛稱山水風光，與題目的特定畫面不夠貼近。" },
      { text: "春色滿園", hint: "著重春天景象，與題目時間或氣氛未必相同。" },
      { text: "鳥語花香", hint: "描述自然生機，沒有正確答案所呈現的視覺震撼。" },
    ];

    const cycleDistractors = (pool, index) => {
      const picks = [];
      for (let i = 0; i < 3; i += 1) {
        picks.push(pool[(index + i) % pool.length]);
      }
      return picks;
    };

    const shuffleOptions = (options) => {
      const result = [...options];
      for (let i = result.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [result[i], result[j]] = [result[j], result[i]];
      }
      return result;
    };

    const createQuestions = (items, mood, moodColor, distractors, startId) =>
      items.map((item, idx) => {
        const wrongs = cycleDistractors(distractors, idx);
        const options = shuffleOptions([
          {
            text: item.idiom,
            isCorrect: true,
            meaning: item.meaning,
            hint: null,
          },
          ...wrongs.map((wrong) => ({
            text: wrong.text,
            isCorrect: false,
            meaning: null,
            hint: wrong.hint,
          })),
        ]);

        return {
          id: startId + idx,
          scenario: item.scenario,
          mood,
          moodColor,
          options,
        };
      });

    const createItems = (tuples) =>
      tuples.map(([scenario, idiom, meaning]) => ({
        scenario,
        idiom,
        meaning,
      }));

    const joyItems = createItems([
      ["這次測驗我以為會不及格，結果拿了滿分！", "喜出望外", "遇到出乎意料的好事而感到特別高興。"],
      ["媽媽突然告訴我週末可以去看最喜歡的樂團演唱會。", "心花怒放", "形容心裡像花朵盛開般充滿喜悅。"],
      ["班際合唱比賽我們拿下冠軍，全班在舞台下笑到停不下來。", "樂不可支", "高興得無法自持。"],
      ["籃球隊挺進總決賽，大家一路唱歌回學校。", "興高采烈", "形容興致極高、情緒熱烈。"],
      ["戲劇社排練時，朋友模仿老師的樣子把我們逗得直不起腰。", "捧腹大笑", "形容笑到肚子都痛。"],
      ["我的漫畫投稿被校外雜誌刊登，通知一到我整個人跳起來。", "欣喜若狂", "高興得幾乎要失去理智。"],
      ["科技展的自動澆花系統得到評審一致好評，我走路都抬頭挺胸。", "得意洋洋", "神情得意，顯得十分自豪。"],
      ["主持完開學典禮後，同學說我聲音很穩，我覺得自己閃閃發光。", "神采飛揚", "精神飽滿、充滿光彩。"],
      ["澄清誤會證明我沒有抄襲，那一刻我終於可以抬頭。", "揚眉吐氣", "洗刷委屈後暢快地抬頭挺胸。"],
      ["家人為我準備驚喜生日會，客廳充滿歡笑。", "歡天喜地", "形容極度歡樂。"],
      ["社際桌遊日我們自己設計的關卡大受歡迎，玩到忘了時間。", "其樂無窮", "樂趣無窮，越玩越開心。"],
      ["老師宣布期末前一天不用考小測，全班立刻花式尖叫。", "眉開眼笑", "形容非常高興，笑容掛在臉上。"],
      ["收到遠方筆友寄來的大包裹，我的喜悅根本藏不住。", "喜形於色", "內心喜悅完全流露在臉上。"],
      ["校方公布要重建操場，同學們在禮堂拍手到手酸。", "歡欣鼓舞", "大家因好消息而感到振奮歡喜。"],
      ["收到心願營隊錄取通知，我激動到在走廊跳來跳去。", "雀躍不已", "高興得不停跳躍。"],
      ["長跑比賽過終點時，臉上的汗水都變成微笑。", "滿面春風", "臉上洋溢著春風吹拂的笑容。"],
      ["看到好友考上夢想中的美術班，我也跟著笑得合不攏嘴。", "笑逐顏開", "形容人滿臉笑容、十分開心。"],
      ["攝影作品在市級展覽得獎，我覺得全班的努力都被看見。", "引以為榮", "把成就當成榮耀而感到驕傲。"],
      ["在舊書市集買到絕版漫畫，我抱著它一路回家。", "如獲至寶", "好像得到珍貴寶物般喜愛。"],
      ["歷史小劇場演出成功，謝幕時我們互相舉起雙手慶賀。", "額手稱慶", "高興得舉起雙手彼此道賀。"],
      ["球隊換上全新球衣，每個人都走路帶風。", "神氣活現", "神態得意、精神十足。"],
      ["清晨合唱練習結束，我精神充沛地迎接一天。", "精神抖擻", "精神旺盛、充滿幹勁。"],
      ["多次失敗後終於調出完美的化學顏料，我高興得快飄起來。", "大喜過望", "喜悅超出原本期望。"],
      ["被邀請在城市舞台演出，我走路像被春風吹拂。", "春風得意", "因成功而得意洋洋。"],
      ["老師宣布我們奪冠時，禮堂響起震耳欲聾的歡呼。", "歡聲雷動", "形容歡呼聲像雷聲般響亮。"],
    ]);

    const angerItems = createItems([
      ["有人故意破壞我的作品，我氣得不得了！", "怒不可遏", "憤怒得無法抑制。"],
      ["同學在網上散布關於我的假消息，我感覺頭頂都冒煙了。", "火冒三丈", "形容怒火猛然竄起。"],
      ["看到高年級欺負新生，我瞬間站出來替他說話。", "怒髮衝冠", "怒氣大到頭髮直豎、頂起帽子。"],
      ["弟弟打翻我一週才完成的模型，我差點跳起來怒吼。", "暴跳如雷", "怒氣爆發得像打雷一樣猛烈。"],
      ["辛苦的報告被人抄襲還否認，我直接在老師面前怒了。", "勃然大怒", "突然大發脾氣。"],
      ["想到偷走我手機的人，我氣得牙齒都咬緊。", "咬牙切齒", "形容極度憤恨。"],
      ["有人在餐廳插隊，我瞪大眼看著他。", "怒目圓睜", "瞪大眼睛表示憤怒。"],
      ["裁判的誤判害我們出局，隊友們全都氣到想哭。", "怒氣沖天", "怒氣濃烈得像衝上天空。"],
      ["交稿前電腦突然當機，我又急又怒差點哭出來。", "氣急敗壞", "又氣又慌張，手忙腳亂。"],
      ["看到有人亂丟垃圾還裝沒事，我心裡火燒般難受。", "怒火中燒", "怒火在心裡燃燒。"],
      ["明明是我先完成，卻被說沒貢獻，我覺得超不公平。", "憤憤不平", "因不公平而感到憤恨。"],
      ["辯論場上有人講歧視言論，我忍不住拍桌站起。", "拍案而起", "氣得拍桌子站起來。"],
      ["看到同學霸凌學弟，我胸口充滿正義的怒火。", "義憤填膺", "胸中充滿正義的憤怒。"],
      ["朋友遲到還怪我沒提醒，我氣得耳鼻都冒煙的感覺。", "七竅生煙", "形容極度憤怒。"],
      ["被誤會作弊時，我的怒意全寫在臉上。", "怒形於色", "怒氣直接表現在臉上。"],
      ["好不容易安排好的活動被臨時取消，我整個人超不爽。", "怫然不悅", "神情顯得不愉快。"],
      ["老師突然換掉我主持的角色，我走進辦公室整個人冒火。", "怒氣衝衝", "怒氣勃發、氣勢逼人。"],
      ["提醒同學別玩危險實驗時，我語氣不小心變得很凶。", "疾言厲色", "用嚴厲口吻責備別人。"],
      ["聽到有人把我們成果拿去報名比賽，我氣到胸口發熱。", "怒火攻心", "怒火直衝心口，情緒極度激動。"],
      ["弟妹亂動科展作品，我當場爆炸。", "大動肝火", "形容非常生氣、火氣大。"],
      ["網友留下一堆惡意留言，我看了心裡滿是仇恨。", "切齒痛恨", "形容痛恨到牙齒都發抖。"],
      ["排隊時被人大力推開，我整個人不爽到極點。", "氣憤難平", "怒氣久久無法平息。"],
      ["隊友消極比賽害我們落敗，我覺得胸口都是火。", "滿腔怒火", "胸中充滿怒意。"],
      ["球場上被對手故意絆倒，我立刻怒吼抗議。", "大發雷霆", "怒氣爆發像打雷般猛烈。"],
      ["有人當眾嘲笑我的家人，我忍不住提高音量回擊。", "破口大罵", "氣得開口就罵。"],
    ]);

    const sorrowItems = createItems([
      ["好友突然要轉學，我坐在操場上久久說不出話。", "黯然神傷", "心情黯淡、神情哀傷。"],
      ["再努力還是落選代表隊，我開始懷疑自己。", "心灰意冷", "形容信心受挫後完全冷卻。"],
      ["家裡的經濟狀況讓我擔心到睡不著。", "愁腸百結", "憂愁得像腸子打成死結。"],
      ["養的兔子生病離開，我心裡像被刀刮。", "心如刀割", "形容極度悲痛。"],
      ["畢業典禮上感謝老師時，我哭到說不出話。", "泣不成聲", "哭得連話都說不出來。"],
      ["爸媽要外派半年，我一直擔心家裡會變化。", "憂心忡忡", "心中充滿擔憂。"],
      ["聽到遠方親戚離世，我整個人像被抽掉力氣。", "悲痛欲絕", "悲傷到幾乎承受不住。"],
      ["上台忘詞下台後，我覺得整個靈魂都飛走了。", "失魂落魄", "因驚慌或悲傷而精神恍惚。"],
      ["弟弟晚上還沒回家，我焦躁得像火燒。", "憂心如焚", "憂愁得像心被火焚燒。"],
      ["畢業前夕整理抽屜，各種回憶一起湧上來。", "百感交集", "不同情感同時湧現。"],
      ["心愛的狗狗走失，我站在告示牌前哭不停。", "傷心欲絕", "悲傷到無法自拔。"],
      ["看到有人亂破壞校園植栽，我痛得直搖頭。", "痛心疾首", "極度痛心又憤恨。"],
      ["經過以前一起玩耍的公園，我突然有點想哭。", "觸景傷情", "看到景物勾起悲傷情緒。"],
      ["比賽結束後的空虛讓我無所適從。", "悵然若失", "好像失去重要事物般空落落。"],
      ["努力準備的劇本沒被採用，我難過到哭不出來。", "欲哭無淚", "悲傷到連眼淚都流不出來。"],
      ["雨天取消戶外教學，心情一下子低到谷底。", "惆悵滿懷", "心中充滿惆悵與失落。"],
      ["聽老師分享災區故事，我鼻子酸酸的。", "悲從中來", "悲傷由心底湧現。"],
      ["等家人手術結果時，我腦中一直打轉。", "愁思滿懷", "心裡充滿憂愁與思緒。"],
      ["家裡快要搬家，我心裡有好多掛念。", "心事重重", "心裡背著許多擔憂。"],
      ["收到親人寫來的告別信，我整晚抱著枕頭哭。", "哀痛欲絕", "哀傷得幾乎無法承受。"],
      ["歷史影片播戰爭畫面，我難過得眼眶通紅。", "泣血悲歌", "悲傷到像在血淚中歌哭。"],
      ["老師念到我的感謝卡時，我眼淚一直打轉。", "淚眼汪汪", "眼中含著淚水的樣子。"],
      ["最好的朋友突然不跟我說話，我覺得整個世界都灰了。", "痛不欲生", "痛苦到不想活下去。"],
      ["等成績的那幾天，我做什麼都心神不寧。", "魂不守舍", "因擔憂而心神不定。"],
      ["躺在床上一直想著未來的升學安排。", "憂思綿綿", "憂愁思緒綿延不絕。"],
    ]);

    const sceneryItems = createItems([
      ["登上山頂吹著涼風，看著整座城市閃光。", "心曠神怡", "心胸開闊、精神舒暢。"],
      ["走在舊城巷弄中，我怎麼都不想回家。", "流連忘返", "留戀景物而捨不得離開。"],
      ["大型科技展的沉浸式投影讓我一直驚呼。", "嘆為觀止", "讚嘆景象已達到極致。"],
      ["燈會的花燈一盞接一盞，我的眼睛忙不停。", "目不暇給", "美景太多來不及細看。"],
      ["清晨的茶園被薄霧包圍，像童話場景。", "如詩如畫", "景象像詩畫般優美。"],
      ["山頭日出時，雲海染上一層金粉。", "雲蒸霞蔚", "形容雲霞繚繞、色彩繽紛。"],
      ["露營時湖面映著山影，美得讓人屏息。", "湖光山色", "湖水與山色相映成趣。"],
      ["插畫展的作品太多太美，我怎麼看也看不完。", "美不勝收", "美景多得無法一一欣賞。"],
      ["遠方的山一層層疊起來，顏色深深淺淺。", "層巒疊翠", "山巒重疊、綠意盎然。"],
      ["山谷裡的小溪一路蜿蜒，旁邊都是綠樹。", "青山綠水", "形容山水秀麗。"],
      ["午後日光灑在湖面上，閃耀得像碎鑽。", "波光粼粼", "水面因光線而閃閃發亮。"],
      ["颱風過後的天空乾淨到沒有一片雲。", "碧空如洗", "天空清澈湛藍。"],
      ["阿姨的山村家風景像明信片。", "山清水秀", "山水清秀優美。"],
      ["新建好的圖書館內外都像藝術品。", "美輪美奐", "形容建築華美壯麗。"],
      ["花市裡各種顏色的花把視線填滿。", "萬紫千紅", "花朵顏色繁多繽紛。"],
      ["影片播放全國美景，我深感大地廣闊。", "錦繡河山", "形容國土山河壯麗。"],
      ["站在海堤上望出去，視線好像沒有邊界。", "海闊天空", "形容景緻遼闊、視野寬廣。"],
      ["整排風車慢慢旋轉，畫面超震撼。", "蔚為壯觀", "景象宏偉壯觀。"],
      ["船上遠望時，海面和天空像連成一線。", "水天一色", "水面與天空同一顏色連成一片。"],
      ["風一吹櫻花瓣像雨一樣落下。", "落英繽紛", "花瓣散落、五彩繽紛。"],
      ["湖邊木棧道微風慢慢吹來，心情好平靜。", "清風徐來", "形容柔和的風輕輕吹拂。"],
      ["雨後的樹葉綠得好像會滴下顏色。", "翠色欲流", "形容濃綠得像要流動。"],
      ["露營晚上抬頭就能看到滿天星斗。", "星河燦爛", "形容星空燦爛耀眼。"],
      ["黃昏的天空被橘紅色鋪滿。", "彩霞滿天", "整片天空都是彩霞。"],
      ["清晨湖面霧氣裊裊，遠方朦朧看不到盡頭。", "煙波浩渺", "形容水面霧氣迷濛、廣闊無邊。"],
    ]);

    const questionsData = [
      ...createQuestions(joyItems, "joy", "yellow", joyDistractors, 1),
      ...createQuestions(angerItems, "anger", "red", angerDistractors, 26),
      ...createQuestions(sorrowItems, "sorrow", "indigo", sorrowDistractors, 51),
      ...createQuestions(sceneryItems, "scenery", "teal", sceneryDistractors, 76),
    ];

    const getRandomQuestions = () => shuffleArray(questionsData).slice(0, TOTAL_QUESTIONS_PER_SESSION);

    // Mood icon mapping
    const moodIcons = {
      joy: Smile,
      anger: Frown,
      sorrow: Heart,
      scenery: Mountain
    };

    // Mood color classes
    const moodColorClasses = {
      yellow: {
        bg: "bg-gradient-to-br from-yellow-400 via-amber-500 to-orange-500",
        text: "text-yellow-900",
        border: "border-yellow-300",
        optionHover: "hover:bg-yellow-200"
      },
      red: {
        bg: "bg-gradient-to-br from-red-400 via-rose-500 to-pink-500",
        text: "text-red-900",
        border: "border-red-300",
        optionHover: "hover:bg-red-200"
      },
      blue: {
        bg: "bg-gradient-to-br from-blue-400 via-cyan-500 to-teal-500",
        text: "text-blue-900",
        border: "border-blue-300",
        optionHover: "hover:bg-blue-200"
      },
      indigo: {
        bg: "bg-gradient-to-br from-indigo-500 via-purple-500 to-blue-500",
        text: "text-indigo-900",
        border: "border-indigo-300",
        optionHover: "hover:bg-indigo-200"
      },
      teal: {
        bg: "bg-gradient-to-br from-teal-400 via-emerald-500 to-green-500",
        text: "text-teal-900",
        border: "border-teal-300",
        optionHover: "hover:bg-teal-200"
      }
    };

    function IdiomMoodBoard() {
      const [questionSet, setQuestionSet] = useState(() => getRandomQuestions());
      const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
      const [selectedOption, setSelectedOption] = useState(null);
      const [isFlipped, setIsFlipped] = useState(false);
      const [isShaking, setIsShaking] = useState(false);
      const [showHint, setShowHint] = useState(false);
      const [completedMoods, setCompletedMoods] = useState([]);
      const [wrongHint, setWrongHint] = useState("");
      const [sessionComplete, setSessionComplete] = useState(false);

      const totalQuestions = questionSet.length;
      const currentQuestion = questionSet[currentQuestionIndex];
      const isLastQuestion = currentQuestionIndex === totalQuestions - 1;

      const resetQuestionState = () => {
        setSelectedOption(null);
        setIsFlipped(false);
        setIsShaking(false);
        setShowHint(false);
        setWrongHint("");
      };

      const startNewSession = () => {
        setQuestionSet(getRandomQuestions());
        setCurrentQuestionIndex(0);
        setCompletedMoods([]);
        setSessionComplete(false);
        resetQuestionState();
      };

      if (!currentQuestion) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-100 via-pink-50 to-orange-50">
            <p className="text-lg text-gray-600">載入題目中...</p>
          </div>
        );
      }

      const handleOptionClick = (option, optionIndex) => {
        if (selectedOption !== null || sessionComplete) return; // Prevent multiple clicks

        setSelectedOption(optionIndex);

        if (option.isCorrect) {
          // Correct answer
          setIsFlipped(true);
          setShowHint(false);
          
          // Add mood to completed gallery if not already added
          if (!completedMoods.includes(currentQuestion.mood)) {
            setCompletedMoods([...completedMoods, currentQuestion.mood]);
          }

          // Move to next question after 3 seconds
          const wasLastQuestion = isLastQuestion;
          setTimeout(() => {
            if (wasLastQuestion) {
              setSessionComplete(true);
            } else {
              setCurrentQuestionIndex((prev) => prev + 1);
              resetQuestionState();
            }
          }, 3000);
        } else {
          // Wrong answer
          setIsShaking(true);
          setWrongHint(option.hint);
          setShowHint(true);
          
          // Reset shake animation after it completes
          setTimeout(() => {
            setIsShaking(false);
            setSelectedOption(null);
          }, 1000);
        }
      };

      const getMoodIcon = (mood) => {
        const IconComponent = moodIcons[mood];
        return IconComponent ? <IconComponent className="w-6 h-6" /> : null;
      };

      const colorScheme = moodColorClasses[currentQuestion.moodColor] || moodColorClasses.yellow;
      const correctOption = currentQuestion.options.find((opt) => opt.isCorrect);

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-orange-50 py-8 px-4">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8">
              <h1 className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-600 to-orange-600 mb-2">
                成語情緒卡
              </h1>
              <p className="text-xl text-gray-600">Idiom Mood Board</p>
              <div className="mt-4 text-sm text-gray-500">
                題目 {currentQuestionIndex + 1} / {totalQuestions}
              </div>
            </div>

            {/* Scenario Card */}
            <div className="mb-8 perspective-1000">
              <div
                className={`relative w-full h-64 rounded-2xl shadow-2xl transition-transform duration-700 ${
                  isFlipped ? 'rotate-y-180' : ''
                } ${isShaking ? 'animate-shake' : ''}`}
                style={{ transformStyle: 'preserve-3d' }}
              >
                {/* Front of card - Scenario */}
                <div
                  className={`absolute inset-0 ${colorScheme.bg} rounded-2xl p-8 flex flex-col items-center justify-center text-white`}
                  style={{ 
                    backfaceVisibility: 'hidden',
                    WebkitBackfaceVisibility: 'hidden'
                  }}
                >
                  <div className="text-center">
                    <div className="text-6xl mb-4">
                      {getMoodIcon(currentQuestion.mood)}
                    </div>
                    <p className="text-2xl font-semibold leading-relaxed">
                      {currentQuestion.scenario}
                    </p>
                  </div>
                </div>

                {/* Back of card - Correct answer meaning */}
                <div
                  className={`absolute inset-0 ${colorScheme.bg} rounded-2xl p-8 flex flex-col items-center justify-center text-white`}
                  style={{ 
                    backfaceVisibility: 'hidden',
                    WebkitBackfaceVisibility: 'hidden',
                    transform: 'rotateY(180deg)'
                  }}
                >
                  <div className="text-center">
                    <CheckCircle className="w-16 h-16 mx-auto mb-4 animate-bounce" />
                    <div className="text-4xl font-bold mb-4">
                      {correctOption?.text}
                    </div>
                    <p className="text-xl leading-relaxed">
                      {correctOption?.meaning}
                    </p>
                    <div className="mt-6 text-2xl animate-pulse">
                      太棒了！✨
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Wrong Answer Hint */}
            {showHint && wrongHint && (
              <div className="mb-6 p-4 bg-red-100 border-2 border-red-300 rounded-xl">
                <div className="flex items-start gap-3">
                  <XCircle className="w-6 h-6 text-red-600 flex-shrink-0 mt-1" />
                  <div>
                    <p className="font-semibold text-red-800 mb-1">提示：</p>
                    <p className="text-red-700">{wrongHint}</p>
                  </div>
                </div>
              </div>
            )}

            {/* Options */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
              {currentQuestion.options.map((option, index) => {
                const isSelected = selectedOption === index;
                const isCorrect = option.isCorrect;
                const isDisabled = selectedOption !== null;

                return (
                  <button
                    key={index}
                    onClick={() => handleOptionClick(option, index)}
                    disabled={isDisabled}
                    className={`
                      p-6 rounded-xl text-lg font-semibold transition-all duration-300
                      ${isDisabled && !isSelected ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
                      ${isSelected && isCorrect
                        ? `${colorScheme.bg} text-white transform scale-105 shadow-lg`
                        : isSelected && !isCorrect
                        ? 'bg-red-500 text-white transform scale-105 shadow-lg'
                        : `bg-white ${colorScheme.border} border-2 ${colorScheme.text} ${colorScheme.optionHover} hover:scale-105 hover:shadow-md`
                      }
                    `}
                  >
                    {option.text}
                  </button>
                );
              })}
            </div>

            {/* Progress: Mood Gallery */}
            <div className="bg-white/80 rounded-2xl p-6 shadow-lg">
              <h2 className="text-2xl font-bold text-center mb-4 text-gray-800">
                情緒收藏館
              </h2>
              <div className="flex justify-center gap-6 flex-wrap">
                {Object.keys(moodIcons).map((mood) => {
                  const isCompleted = completedMoods.includes(mood);
                  const IconComponent = moodIcons[mood];
                  const moodNames = {
                    joy: "喜悅",
                    anger: "憤怒",
                    sorrow: "憂傷",
                    scenery: "風景"
                  };

                  return (
                    <div
                      key={mood}
                      className={`flex flex-col items-center gap-2 p-4 rounded-xl transition-all duration-300 ${
                        isCompleted
                          ? 'bg-gradient-to-br from-green-400 to-emerald-500 text-white scale-110 shadow-lg'
                          : 'bg-gray-200 text-gray-400'
                      }`}
                    >
                      {IconComponent && (
                        <IconComponent className={`w-8 h-8 ${isCompleted ? 'animate-bounce' : ''}`} />
                      )}
                      <span className="text-sm font-semibold">{moodNames[mood]}</span>
                      {isCompleted && (
                        <Sparkles className="w-4 h-4 animate-pulse" />
                      )}
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Next/Replay Button */}
            {sessionComplete && (
              <div className="text-center mt-6 space-y-4">
                <p className="text-lg font-semibold text-gray-700">
                  恭喜！你完成了本輪 10 題情緒成語挑戰。
                </p>
                <button
                  onClick={startNewSession}
                  className="inline-flex items-center justify-center gap-2 px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold rounded-xl shadow-lg hover:scale-105 transition-transform duration-300"
                >
                  <RotateCcw className="w-5 h-5" />
                  再抽十題
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <React.StrictMode>
        <IdiomMoodBoard />
      </React.StrictMode>
    );
  </script>

    <!-- Visit Counter -->
    <div id="visit-counter-container" class="text-center my-4"></div>

    <!-- Visit Counter Script -->
    <script src="/visit-counter.js"></script>
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5jEjDAcEM6TttPbwwh1tvXPo_-W7YrNlKfJRV82PjkmAHvR_wILhA7h-zIRPF7oTRTw/exec';
        VisitCounter.init('c-/users/keith/onedrive/desktop/profile/primarychinese/idiom-mood-board', {
            scriptUrl: SCRIPT_URL,
            containerId: 'visit-counter-container'
        });
    </script>
</body>
</html>
