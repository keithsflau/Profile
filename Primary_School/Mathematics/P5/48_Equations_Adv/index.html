<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小五數學：簡易方程 (二)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      const Calculator = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <rect width="16" height="20" x="4" y="2" rx="2" />
          <line x1="8" x2="16" y1="6" y2="6" />
          <line x1="16" x2="16" y1="14" y2="18" />
          <path d="M16 10h.01" />
          <path d="M12 10h.01" />
          <path d="M8 10h.01" />
          <path d="M12 14h.01" />
          <path d="M8 14h.01" />
          <path d="M12 18h.01" />
          <path d="M8 18h.01" />
        </svg>
      );
      const RefreshCw = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M3 12a9 9 0 0 1 9-9 9.97 9.97 0 0 1 5.9 2" />
          <path d="M21 12a9 9 0 0 1-9 9 9.97 9.97 0 0 1-5.9-2" />
          <path d="M2.5 12h5" />
          <path d="M16.5 12h5" />
          <path d="M21 21v-4.5" />
          <path d="M3 7.5V3" />
        </svg>
      );
      const X = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M18 6 6 18" />
          <path d="m6 6 12 12" />
        </svg>
      );
      const Divide = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <circle cx="12" cy="6" r="1" />
          <line x1="5" x2="19" y1="12" y2="12" />
          <circle cx="12" cy="18" r="1" />
        </svg>
      );

      function App() {
        // type: 'mul' (Ax = B) or 'div' (x/A = B)
        const [type, setType] = useState("mul");
        const [varVal, setVarVal] = useState(4); // The answer
        const [coeff, setCoeff] = useState(3); // The multiplier/divisor
        const [step, setStep] = useState(0);
        const [showHint, setShowHint] = useState(false);

        const generate = () => {
          const nextType = Math.random() > 0.5 ? "mul" : "div";
          setType(nextType);
          setVarVal(Math.floor(Math.random() * 8) + 2); // 2-9
          setCoeff(Math.floor(Math.random() * 3) + 2); // 2-4
          setStep(0);
          setShowHint(false);
        };

        useEffect(() => {
          generate();
        }, []);

        const total = type === "mul" ? varVal * coeff : varVal;
        // Equation strings
        // Mul: 3y = 12
        // Div: y/3 = 4

        const eqLeft =
          type === "mul" ? (
            <span>
              {coeff}
              <span className="text-indigo-600">y</span>
            </span>
          ) : (
            <div className="flex flex-col items-center inline-flex align-middle">
              <span className="text-indigo-600 border-b-2 border-black w-full text-center">
                y
              </span>
              <span>{coeff}</span>
            </div>
          );

        const eqRight = type === "mul" ? total : varVal;

        return (
          <div className="min-h-screen p-6 flex flex-col items-center justify-center">
            <div className="bg-white/90 backdrop-blur-xl rounded-[2rem] p-8 shadow-2xl border-4 border-white w-full max-w-3xl">
              <div className="flex justify-between items-center mb-12">
                <div className="flex items-center gap-3">
                  <div className="p-3 bg-pink-100 rounded-2xl text-pink-500">
                    <Calculator />
                  </div>
                  <h1 className="text-3xl font-black text-slate-800">
                    簡易方程 (乘除)
                  </h1>
                </div>
                <button
                  onClick={generate}
                  className="p-3 bg-slate-100 rounded-full hover:bg-slate-200"
                >
                  <RefreshCw size={20} />
                </button>
              </div>

              {/* Question Area */}
              <div className="flex flex-col items-center mb-12">
                <div className="bg-slate-50 border-2 border-slate-200 px-12 py-8 rounded-3xl text-6xl font-black text-slate-700 flex items-center gap-6 shadow-inner">
                  {eqLeft}
                  <span>=</span>
                  <span>{eqRight}</span>
                </div>
              </div>

              {/* Visualization */}
              <div className="bg-white border-2 border-slate-100 rounded-2xl p-8 mb-8 relative min-h-[300px] flex flex-col items-center justify-center overflow-hidden">
                {type === "mul" ? (
                  // Multiplication Visual: 3 bags = 12 dots
                  <div className="w-full">
                    <div className="flex justify-center gap-4 mb-4">
                      {Array.from({ length: coeff }).map((_, i) => (
                        <div
                          key={i}
                          className={`relative bg-indigo-100 border-4 border-indigo-300 rounded-2xl p-4 w-32 h-40 flex flex-col items-center justify-center transition-all duration-500 ${
                            step === 1
                              ? "scale-110 border-green-400 bg-green-50"
                              : ""
                          }`}
                        >
                          <span className="absolute top-2 left-2 text-indigo-400 font-bold">
                            y
                          </span>
                          <div className="flex flex-wrap gap-2 justify-center">
                            {step === 1 ? (
                              // Show dots inside
                              Array.from({ length: varVal }).map((_, d) => (
                                <div
                                  key={d}
                                  className="w-4 h-4 bg-green-500 rounded-full shadow-sm animate-[bounce_1s_ease-in-out]"
                                ></div>
                              ))
                            ) : (
                              <div className="text-5xl text-indigo-200 font-black">
                                ?
                              </div>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                    <div className="text-center font-bold text-slate-400">
                      總數 Total: {total}
                    </div>
                  </div>
                ) : (
                  // Division Visual: Bar cut into parts
                  <div className="w-full px-8">
                    <div className="flex w-full h-32 rounded-2xl overflow-hidden border-4 border-indigo-300">
                      {Array.from({ length: coeff }).map((_, i) => (
                        <div
                          key={i}
                          className={`flex-1 border-r-2 border-indigo-200 bg-indigo-50 flex items-center justify-center relative transition-colors duration-500 ${
                            step === 1 ? "bg-green-100" : ""
                          }`}
                        >
                          {step === 1 && (
                            <span className="text-4xl font-black text-green-600">
                              {varVal}
                            </span>
                          )}
                          {!step && (
                            <span className="text-xl font-bold text-indigo-300">
                              y/{coeff}
                            </span>
                          )}
                        </div>
                      ))}
                    </div>
                    <div className="flex justify-between mt-2 text-slate-400 font-bold">
                      <span>0</span>
                      <span>y (Total)</span>
                    </div>
                  </div>
                )}

                {/* Hint overlay */}
                {step === 0 && (
                  <div className="absolute inset-0 bg-white/60 backdrop-blur-[2px] flex items-center justify-center">
                    <button
                      onClick={() => setStep(1)}
                      className="bg-slate-800 text-white px-8 py-4 rounded-full font-bold text-xl hover:scale-110 transition-transform shadow-xl hover:shadow-2xl flex items-center gap-3"
                    >
                      {type === "mul" ? "兩邊除以" : "兩邊乘以"} {coeff}
                      {type === "mul" ? <Divide size={20} /> : <X size={20} />}
                    </button>
                  </div>
                )}
              </div>

              {/* Solution */}
              <div
                className={`transition-all duration-500 ${
                  step === 1
                    ? "opacity-100 translate-y-0"
                    : "opacity-0 translate-y-10"
                }`}
              >
                <div className="bg-green-100 border-2 border-green-400 p-6 rounded-2xl text-center">
                  <div className="text-2xl font-bold text-green-800 mb-2">
                    過程解說 Steps
                  </div>
                  <div className="text-3xl text-slate-700 font-mono">
                    {type === "mul" ? (
                      <>
                        {coeff}y ÷ {coeff} = {total} ÷ {coeff}
                        <br />
                        <span className="font-black text-green-600 mt-2 block">
                          y = {varVal}
                        </span>
                      </>
                    ) : (
                      <>
                        y/{coeff} × {coeff} = {varVal} × {coeff}
                        <br />
                        <span className="font-black text-green-600 mt-2 block">
                          y = {total}
                        </span>
                      </>
                    )}
                  </div>

                  <button
                    onClick={generate}
                    className="mt-6 bg-green-500 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-600 shadow-lg"
                  >
                    下一題
                  </button>
                </div>
              </div>
            </div>

            <div className="fixed bottom-4 left-4">
              <a
                href="../index.html"
                className="bg-white/80 backdrop-blur hover:bg-white text-slate-600 px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all"
              >
                ← 返回目錄
              </a>
            </div>
          </div>
        );
      }

      lucide.createIcons();
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
