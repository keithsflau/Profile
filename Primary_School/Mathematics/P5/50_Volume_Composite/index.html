<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小五數學：複合圖形體積</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      }
      .scene {
        perspective: 1200px;
        transform-style: preserve-3d;
      }
      .shape-container {
        position: relative;
        transform-style: preserve-3d;
        transform: rotateX(-30deg) rotateY(45deg);
        transition: transform 0.5s ease;
      }
      .cube {
        position: absolute;
        width: 40px;
        height: 40px;
        transform-style: preserve-3d;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      .face {
        position: absolute;
        width: 40px;
        height: 40px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: inherit;
        opacity: 0.95;
      }
      /* Cube Face Transforms */
      .front {
        transform: rotateY(0deg) translateZ(20px);
        filter: brightness(1);
      }
      .right {
        transform: rotateY(90deg) translateZ(20px);
        filter: brightness(0.9);
      }
      .left {
        transform: rotateY(-90deg) translateZ(20px);
        filter: brightness(0.9);
      }
      .back {
        transform: rotateY(180deg) translateZ(20px);
        filter: brightness(0.8);
      }
      .top {
        transform: rotateX(90deg) translateZ(20px);
        filter: brightness(1.1);
      }
      .bottom {
        transform: rotateX(-90deg) translateZ(20px);
        filter: brightness(0.7);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;

      const Split = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M16 3h5v5" />
          <path d="M8 3H3v5" />
          <path d="M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3" />
          <path d="m15 9 6-6" />
        </svg>
      );
      const Scissors = (props) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={props.size || 24}
          height={props.size || 24}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          {...props}
        >
          <circle cx="6" cy="6" r="3" />
          <circle cx="6" cy="18" r="3" />
          <line x1="20" x2="8.12" y1="4" y2="15.88" />
          <line x1="14.47" x2="20" y1="14.48" y2="20" />
          <line x1="8.12" x2="12" y1="8.12" y2="12" />
        </svg>
      );
      const Layers = (props) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={props.size || 24}
          height={props.size || 24}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          {...props}
        >
          <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z" />
          <path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65" />
          <path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65" />
        </svg>
      );
      const RefreshCw = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M3 12a9 9 0 0 1 9-9 9.97 9.97 0 0 1 5.9 2" />
          <path d="M21 12a9 9 0 0 1-9 9 9.97 9.97 0 0 1-5.9-2" />
          <path d="M2.5 12h5" />
          <path d="M16.5 12h5" />
          <path d="M21 21v-4.5" />
          <path d="M3 7.5V3" />
        </svg>
      );

      function App() {
        const [method, setMethod] = useState("none"); // none, v-split, h-split

        // Shape Definition: L-Shape
        // Bottom Slab: 4x2x2 (LxWxH) at y=0,1; x=0..3; z=0..1
        // Top Tower: 2x2x3 at x=0..1; z=0..1; y=2..4
        // Dimensions:
        // Slab: 4L, 2W, 2H
        // Tower: 2L, 2W, 3H on top of Slab(0,0)

        // Let's parameterize the shape
        const shape = {
          slab: { l: 4, w: 2, h: 2, color: "#f59e0b" },
          tower: { l: 2, w: 2, h: 3, x: 0, z: 0, color: "#ec4899" },
        };

        const cubes = [];

        // Generate Slab Cubes
        for (let x = 0; x < shape.slab.l; x++) {
          for (let y = 0; y < shape.slab.h; y++) {
            for (let z = 0; z < shape.slab.w; z++) {
              let group = "slab";
              // Logic for coloring based on method
              let color = "bg-orange-500"; // Default slab color usually

              if (method === "v-split") {
                // Split vertical line at x=2
                if (x < 2) group = "A";
                else group = "B";
              }
              if (method === "h-split") {
                // Split horizontal line between slab and tower?
                // Slab is always group A in h-split if the tower is on top
                group = "A";
              }

              cubes.push({ x, y, z, group, baseColor: "#f59e0b" });
            }
          }
        }
        // Generate Tower Cubes
        // Tower starts at y = shape.slab.h
        for (let x = 0; x < shape.tower.l; x++) {
          for (let y = 0; y < shape.tower.h; y++) {
            for (let z = 0; z < shape.tower.w; z++) {
              const actualY = y + shape.slab.h;
              let group = "tower";

              if (method === "v-split") {
                if (x < 2) group = "A";
                else group = "B";
              }
              if (method === "h-split") {
                group = "B";
              }

              cubes.push({ x, y: actualY, z, group, baseColor: "#ec4899" });
            }
          }
        }

        const size = 40;

        // Center offsets need calculation
        const cx = (4 * 40) / 2;
        const cy = (5 * 40) / 2;
        const cz = (2 * 40) / 2;

        const getGroupColor = (g) => {
          if (method === "none") {
            return g === "slab" || (g === "A" && method === "h-split")
              ? "rgb(245, 158, 11)"
              : "rgb(236, 72, 153)";
          }
          if (g === "A") return "rgb(59, 130, 246)"; // Blue
          if (g === "B") return "rgb(34, 197, 94)"; // Green

          // Fallbacks for initial generation mapping
          if (g === "slab") return "rgb(245, 158, 11)";
          if (g === "tower") return "rgb(236, 72, 153)";
        };

        return (
          <div className="min-h-screen flex flex-col md:flex-row items-center justify-center p-8 overflow-hidden gap-12">
            {/* Left Panel: Calculator */}
            <div className="bg-white/95 backdrop-blur-xl p-8 rounded-[2rem] shadow-2xl w-full max-w-lg border-4 border-white z-10 flex flex-col gap-6">
              <h1 className="text-3xl font-black text-slate-800 flex items-center gap-3 mb-4">
                <Layers className="text-orange-500" />
                複合圖形體積
              </h1>

              <div className="flex gap-4">
                <button
                  onClick={() => setMethod("none")}
                  className={`flex-1 py-4 rounded-xl font-bold transition-all ${
                    method === "none"
                      ? "bg-slate-800 text-white shadow-lg"
                      : "bg-slate-100 text-slate-500 hover:bg-slate-200"
                  }`}
                >
                  原圖
                </button>
                <button
                  onClick={() => setMethod("v-split")}
                  className={`flex-1 py-4 rounded-xl font-bold transition-all flex flex-col items-center gap-1 ${
                    method === "v-split"
                      ? "bg-blue-500 text-white shadow-lg"
                      : "bg-blue-50 text-blue-400 hover:bg-blue-100"
                  }`}
                >
                  <Scissors size={20} className="rotate-90" /> 切割方法 (一)
                </button>
                <button
                  onClick={() => setMethod("h-split")}
                  className={`flex-1 py-4 rounded-xl font-bold transition-all flex flex-col items-center gap-1 ${
                    method === "h-split"
                      ? "bg-green-500 text-white shadow-lg"
                      : "bg-green-50 text-green-400 hover:bg-green-100"
                  }`}
                >
                  <Scissors size={20} /> 切割方法 (二)
                </button>
              </div>

              <div className="bg-slate-50 rounded-2xl p-6 border-2 border-slate-100 min-h-[200px] flex items-center justify-center">
                {method === "none" && (
                  <div className="text-center text-slate-400 font-bold">
                    請選擇切割方法以計算體積
                    <br />
                    Select a method to calculate volume
                  </div>
                )}
                {method === "v-split" && (
                  <div className="w-full space-y-4">
                    <div className="flex items-center gap-4 bg-blue-100 p-4 rounded-xl text-blue-800 font-bold">
                      <div className="w-6 h-6 bg-blue-500 rounded border border-blue-600"></div>
                      <span>長方體 A: 2 × 2 × 5 = 20</span>
                    </div>
                    <div className="flex items-center gap-4 bg-green-100 p-4 rounded-xl text-green-800 font-bold">
                      <div className="w-6 h-6 bg-green-500 rounded border border-green-600"></div>
                      <span>長方體 B: 2 × 2 × 2 = 8</span>
                    </div>
                    <div className="border-t-2 border-slate-200 pt-4 text-right text-3xl font-black text-slate-700">
                      總體積 = 28
                    </div>
                  </div>
                )}
                {method === "h-split" && (
                  <div className="w-full space-y-4">
                    <div className="flex items-center gap-4 bg-blue-100 p-4 rounded-xl text-blue-800 font-bold">
                      <div className="w-6 h-6 bg-blue-500 rounded border border-blue-600"></div>
                      <span>下層 A: 4 × 2 × 2 = 16</span>
                    </div>
                    <div className="flex items-center gap-4 bg-green-100 p-4 rounded-xl text-green-800 font-bold">
                      <div className="w-6 h-6 bg-green-500 rounded border border-green-600"></div>
                      <span>上層 B: 2 × 2 × 3 = 12</span>
                    </div>
                    <div className="border-t-2 border-slate-200 pt-4 text-right text-3xl font-black text-slate-700">
                      總體積 = 28
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Right Panel: 3D Visualization */}
            <div className="w-full md:w-[600px] h-[500px] relative flex items-center justify-center scene">
              <div className="shape-container">
                {cubes.map((c, i) => {
                  // Calculate offset based on split interaction
                  let offsetX = 0;
                  let offsetY = 0;

                  if (method === "v-split") {
                    if (c.group === "B") offsetX = 40; // separate B slightly to right
                  }
                  if (method === "h-split") {
                    if (c.group === "B") offsetY = 40; // lift B slightly up
                  }

                  return (
                    <div
                      key={i}
                      className="cube"
                      style={{
                        transform: `translate3d(${
                          c.x * size - cx + offsetX
                        }px, ${-c.y * size + cy - offsetY}px, ${
                          c.z * size - cz
                        }px)`,
                        backgroundColor: getGroupColor(c.group), // fallback for faces
                      }}
                    >
                      {["front", "back", "right", "left", "top", "bottom"].map(
                        (face) => (
                          <div
                            key={face}
                            className={`face ${face}`}
                            style={{ backgroundColor: getGroupColor(c.group) }}
                          ></div>
                        )
                      )}
                    </div>
                  );
                })}
              </div>
              {/* Floor Shadow */}
              <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-black/10 rounded-full blur-2xl -z-10 transform rotateX(60deg) translateZ(-250px) scale-150"></div>
            </div>

            <div className="fixed bottom-4 left-4">
              <a
                href="../index.html"
                className="bg-white/80 backdrop-blur hover:bg-white text-slate-600 px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all"
              >
                ← 返回目錄
              </a>
            </div>
          </div>
        );
      }

      lucide.createIcons();
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
