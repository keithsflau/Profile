<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫îÊï∏Â≠∏ÔºöÈ´îÁ©çÂàùÊé¢ | Volume Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: #0f172a;
        color: white;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(14, 165, 233, 0.15); /* Sky 500 alpha */
        backdrop-filter: blur(12px);
        border: 1px solid rgba(56, 189, 248, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      /* CSS 3D Engine */
      .scene {
        perspective: 1200px;
        transform-style: preserve-3d;
      }
      .cuboid-container {
        position: relative;
        transform-style: preserve-3d;
        transform: rotateX(-25deg) rotateY(45deg);
        transition: transform 0.1s ease-out; /* Smooth drag */
      }
      .cube {
        position: absolute;
        width: 40px;
        height: 40px;
        transform-style: preserve-3d;
        transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .face {
        position: absolute;
        width: 40px;
        height: 40px;
        box-sizing: border-box;
        border: 1px solid rgba(56, 189, 248, 0.5); /* Sky 400 borders */
        background: rgba(14, 165, 233, 0.1);
        backface-visibility: visible; /* Glass effect needs backface? Actually standard CSS 3D usually hides backface for opacity but here we want transparency */
      }
      /* Individual faces transforms */
      .front {
        transform: rotateY(0deg) translateZ(20px);
      }
      .right {
        transform: rotateY(90deg) translateZ(20px);
      }
      .left {
        transform: rotateY(-90deg) translateZ(20px);
      }
      .back {
        transform: rotateY(180deg) translateZ(20px);
      }
      .top {
        transform: rotateX(90deg) translateZ(20px);
      }
      .bottom {
        transform: rotateX(-90deg) translateZ(20px);
      }

      /* Neon glow for faces */
      .face {
        box-shadow: inset 0 0 10px rgba(56, 189, 248, 0.2);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const { motion } = window.Motion;
      const { Box, Expand, Move3d } = window.LucideReact;
      const { LanguageSelector } = window.MathI18n || {
        LanguageSelector: () => null,
      };

      const t = {
        title: {
          en: "Volume Explorer",
          zh: "È´îÁ©çÂàùÊé¢",
          ja: "‰ΩìÁ©ç„ÅÆÊé¢Ê±Ç",
          ko: "Î∂ÄÌîº ÌÉêÍµ¨",
          es: "Explorador de Volumen",
          de: "Volumen-Explorer",
          fi: "Tilavuuden tutkiminen",
          fr: "Explorateur de volume",
          ar: "ŸÖÿ≥ÿ™ŸÉÿ¥ŸÅ ÿßŸÑÿ≠ÿ¨ŸÖ",
          it: "Esploratore di volume",
        },
        length: {
          en: "Length",
          zh: "Èï∑",
          ja: "Èï∑„Åï",
          ko: "Í∏∏Ïù¥",
          es: "Largo",
          de: "L√§nge",
          fi: "Pituus",
          fr: "Longueur",
          ar: "ÿßŸÑÿ∑ŸàŸÑ",
          it: "Lunghezza",
        },
        width: {
          en: "Width",
          zh: "Èóä",
          ja: "ÂπÖ",
          ko: "ÎÑàÎπÑ",
          es: "Ancho",
          de: "Breite",
          fi: "Leveys",
          fr: "Largeur",
          ar: "ÿßŸÑÿπÿ±ÿ∂",
          it: "Larghezza",
        },
        height: {
          en: "Height",
          zh: "È´ò",
          ja: "È´ò„Åï",
          ko: "ÎÜíÏù¥",
          es: "Alto",
          de: "H√∂he",
          fi: "Korkeus",
          fr: "Hauteur",
          ar: "ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ",
          it: "Altezza",
        },
        formula: {
          en: "V = L √ó W √ó H",
          zh: "È´îÁ©ç = Èï∑ √ó Èóä √ó È´ò",
          ja: "‰ΩìÁ©ç = Èï∑„Åï √ó ÂπÖ √ó È´ò„Åï",
          ko: "Î∂ÄÌîº = Í∏∏Ïù¥ √ó ÎÑàÎπÑ √ó ÎÜíÏù¥",
          es: "V = Largo √ó Ancho √ó Alto",
          de: "V = L √ó B √ó H",
          fi: "V = P √ó L √ó K",
          fr: "V = L √ó l √ó h",
          ar: "ÿßŸÑÿ≠ÿ¨ŸÖ = ÿßŸÑÿ∑ŸàŸÑ √ó ÿßŸÑÿπÿ±ÿ∂ √ó ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ",
          it: "V = L √ó L √ó A",
        },
        explode: {
          en: "Explode View",
          zh: "ÂàÜËß£Ë¶ñÂúñ",
          ja: "ÂàÜËß£„Éì„É•„Éº",
          ko: "Î∂ÑÌï¥ Î≥¥Í∏∞",
          es: "Vista Explosiva",
          de: "Explosionsansicht",
          fi: "R√§j√§ytyskuva",
          fr: "Vue √©clat√©e",
          ar: "ÿπÿ±ÿ∂ ŸÖŸÅÿµŸÑ",
          it: "Vista esplosa",
        },
      };

      const getText = (key, lang) => t[key]?.[lang] || t[key]?.["en"] || key;

      function App() {
        const [lang, setLang] = useState("zh");
        const [dims, setDims] = useState({ l: 3, w: 2, h: 4 });
        const [isExploded, setIsExploded] = useState(false);
        const [rotation, setRotation] = useState({ x: -25, y: 45 });
        const [isDragging, setIsDragging] = useState(false);
        const lastMousePos = useRef({ x: 0, y: 0 });

        const cubes = [];
        for (let x = 0; x < dims.l; x++) {
          for (let y = 0; y < dims.h; y++) {
            for (let z = 0; z < dims.w; z++) {
              cubes.push({ x, y, z });
            }
          }
        }

        const size = 40;
        const offsetStep = isExploded ? 60 : 40;
        const cx = (dims.l * offsetStep) / 2 - offsetStep / 2;
        const cy = (dims.h * offsetStep) / 2 - offsetStep / 2;
        const cz = (dims.w * offsetStep) / 2 - offsetStep / 2;

        const handleMouseDown = (e) => {
          setIsDragging(true);
          lastMousePos.current = { x: e.clientX, y: e.clientY };
        };

        const handleMouseMove = (e) => {
          if (!isDragging) return;
          const deltaX = e.clientX - lastMousePos.current.x;
          const deltaY = e.clientY - lastMousePos.current.y;
          setRotation((prev) => ({
            x: prev.x - deltaY * 0.5,
            y: prev.y + deltaX * 0.5,
          }));
          lastMousePos.current = { x: e.clientX, y: e.clientY };
        };

        const handleMouseUp = () => setIsDragging(false);

        useEffect(() => {
          window.addEventListener("mouseup", handleMouseUp);
          window.addEventListener("mousemove", handleMouseMove);
          return () => {
            window.removeEventListener("mouseup", handleMouseUp);
            window.removeEventListener("mousemove", handleMouseMove);
          };
        }, [isDragging]);

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <div className="w-full max-w-6xl flex justify-between items-center mb-6">
              <h1 className="text-3xl md:text-5xl font-black text-sky-400 drop-shadow-[0_0_15px_rgba(56,189,248,0.5)]">
                üßä {getText("title", lang)}
              </h1>
              <div className="bg-slate-800/80 p-1.5 rounded-xl border border-white/10 flex flex-wrap justify-end gap-1">
                {[
                  "zh",
                  "en",
                  "ja",
                  "ko",
                  "es",
                  "de",
                  "fi",
                  "fr",
                  "ar",
                  "it",
                ].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 rounded-lg font-bold text-xs uppercase transition-all ${
                      lang === l
                        ? "bg-sky-600 text-white shadow-lg scale-105"
                        : "text-slate-400 hover:text-white hover:bg-white/5"
                    }`}
                  >
                    {l}
                  </button>
                ))}
              </div>
            </div>

            <main className="w-full max-w-6xl grid lg:grid-cols-3 gap-8">
              {/* Control Panel */}
              <div className="flex flex-col gap-6">
                <div className="glass-panel p-8 rounded-3xl">
                  {["l", "w", "h"].map((d) => {
                    const labels = { l: "length", w: "width", h: "height" };
                    const colors = {
                      l: "text-blue-400",
                      w: "text-purple-400",
                      h: "text-green-400",
                    };
                    const accents = {
                      l: "accent-blue-500",
                      w: "accent-purple-500",
                      h: "accent-green-500",
                    };

                    return (
                      <div key={d} className="mb-6 last:mb-0">
                        <div className="flex justify-between text-sm font-bold text-slate-300 mb-2">
                          <span className={colors[d]}>
                            {getText(labels[d], lang)}
                          </span>
                          <span className="bg-slate-900 px-2 py-0.5 rounded text-white">
                            {dims[d]}
                          </span>
                        </div>
                        <input
                          type="range"
                          min="1"
                          max="6"
                          value={dims[d]}
                          onChange={(e) =>
                            setDims({ ...dims, [d]: parseInt(e.target.value) })
                          }
                          className={`w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer ${accents[d]}`}
                        />
                      </div>
                    );
                  })}
                </div>

                <div className="glass-panel p-6 rounded-3xl flex flex-col items-center">
                  <div className="text-sky-300 font-bold uppercase tracking-widest text-sm mb-2">
                    {getText("formula", lang)}
                  </div>
                  <div className="flex items-center gap-2 text-4xl font-mono font-black text-white">
                    <span className="text-blue-400">{dims.l}</span>
                    <span className="text-slate-500">√ó</span>
                    <span className="text-purple-400">{dims.w}</span>
                    <span className="text-slate-500">√ó</span>
                    <span className="text-green-400">{dims.h}</span>
                    <span className="text-slate-500">=</span>
                    <span className="text-sky-400">
                      {dims.l * dims.w * dims.h}
                    </span>
                  </div>
                </div>

                <button
                  onClick={() => setIsExploded(!isExploded)}
                  className={`w-full py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 shadow-lg ${
                    isExploded
                      ? "bg-sky-500 text-white"
                      : "bg-slate-800 text-sky-400 hover:bg-slate-700"
                  }`}
                >
                  <Expand size={20} /> {getText("explode", lang)}
                </button>
              </div>

              {/* 3D Scene */}
              <div
                className="lg:col-span-2 glass-panel rounded-3xl relative overflow-hidden flex items-center justify-center min-h-[500px]"
                onMouseDown={handleMouseDown}
              >
                <div className="absolute top-4 left-4 flex gap-2">
                  <div className="bg-black/40 backdrop-blur px-3 py-1 rounded-lg text-xs text-sky-300 border border-sky-500/20 flex items-center gap-2">
                    <Move3d size={14} /> Drag to Rotate
                  </div>
                </div>

                <div className="scene w-full h-full flex items-center justify-center pointer-events-none">
                  <div
                    className="cuboid-container"
                    style={{
                      transform: `rotateX(${rotation.x}deg) rotateY(${rotation.y}deg)`,
                    }}
                  >
                    {cubes.map((c, i) => (
                      <div
                        key={i}
                        className="cube"
                        style={{
                          transform: `translate3d(${c.x * offsetStep - cx}px, ${
                            -c.y * offsetStep + cy
                          }px, ${c.z * offsetStep - cz}px)`,
                        }}
                      >
                        <div className="face front"></div>
                        <div className="face back"></div>
                        <div className="face right"></div>
                        <div className="face left"></div>
                        <div className="face top"></div>
                        <div className="face bottom"></div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Grid Floor */}
                <div
                  className="absolute w-[800px] h-[800px] bg-[radial-gradient(circle,rgba(56,189,248,0.1)_1px,transparent_1px)] bg-[length:20px_20px] pointer-events-none opacity-50"
                  style={{ transform: `rotateX(60deg) scale(2)` }}
                ></div>
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
