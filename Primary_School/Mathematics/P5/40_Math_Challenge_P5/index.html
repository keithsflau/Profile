<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫îÊï∏Â≠∏ÔºöÊï∏ÁêÜÊåëÊà∞ | P5 Math Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: #0f172a;
        color: white;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(99, 102, 241, 0.15); /* Indigo 500 alpha */
        backdrop-filter: blur(16px);
        border: 1px solid rgba(129, 140, 248, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .btn-glass {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.2s;
      }
      .btn-glass:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector } = window.MathI18n || {
        LanguageSelector: () => null,
      };

      const t = {
        title: {
          en: "P5 Math Challenge",
          zh: "P5 Êï∏ÁêÜÊåëÊà∞",
          ja: "P5 Êï∞Â≠¶„ÉÅ„É£„É¨„É≥„Ç∏",
          ko: "P5 ÏàòÌïô Ï±åÎ¶∞ÏßÄ",
          es: "Desaf√≠o Matem√°tico P5",
          de: "P5 Mathe-Challenge",
          fi: "P5 Matematiikkahaaste",
          fr: "D√©fi Math P5",
          ar: "ÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™ P5",
          it: "Sfida Matematica P5",
        },
        start: {
          en: "Start Challenge",
          zh: "ÈñãÂßãÊåëÊà∞",
          ja: "„ÉÅ„É£„É¨„É≥„Ç∏ÈñãÂßã",
          ko: "Ï±åÎ¶∞ÏßÄ ÏãúÏûë",
          es: "Iniciar Desaf√≠o",
          de: "Starten",
          fi: "Aloita",
          fr: "Commencer",
          ar: "ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≠ÿØŸä",
          it: "Inizia",
        },
        score: {
          en: "Score",
          zh: "ÂàÜÊï∏",
          ja: "„Çπ„Ç≥„Ç¢",
          ko: "Ï†êÏàò",
          es: "Puntuaci√≥n",
          de: "Punktzahl",
          fi: "Pisteet",
          fr: "Score",
          ar: "ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",
          it: "Punteggio",
        },
        q1: {
          en: "3/4 + 1/2 = ?",
          zh: "3/4 + 1/2 = ?",
          ja: "3/4 + 1/2 = ?",
          ko: "3/4 + 1/2 = ?",
          es: "3/4 + 1/2 = ?",
          de: "3/4 + 1/2 = ?",
          fi: "3/4 + 1/2 = ?",
          fr: "3/4 + 1/2 = ?",
          ar: "3/4 + 1/2 = ?",
          it: "3/4 + 1/2 = ?",
        },
        q2: {
          en: "Area of Triangle Formula?",
          zh: "‰∏âËßíÂΩ¢Èù¢Á©çÂÖ¨ÂºèÔºü",
          ja: "‰∏âËßíÂΩ¢„ÅÆÈù¢Á©ç„ÅÆÂÖ¨ÂºèÔºü",
          ko: "ÏÇºÍ∞ÅÌòïÏùò ÎÑìÏù¥ Í≥µÏãù?",
          es: "¬øF√≥rmula del √Årea del Tri√°ngulo?",
          de: "Formel f√ºr Dreiecksfl√§che?",
          fi: "Kolmion pinta-alan kaava?",
          fr: "Formule de l'aire du triangle ?",
          ar: "ÿµŸäÿ∫ÿ© ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ´ŸÑÿ´ÿü",
          it: "Formula Area Triangolo?",
        },
        q2_opt1: {
          en: "Base √ó Height",
          zh: "Â∫ï √ó È´ò",
          ja: "Â∫ïËæ∫ √ó È´ò„Åï",
          ko: "Î∞ëÎ≥Ä √ó ÎÜíÏù¥",
          es: "Base √ó Altura",
          de: "Basis √ó H√∂he",
          fi: "Kanta √ó Korkeus",
          fr: "Base √ó Hauteur",
          ar: "ÿßŸÑŸÇÿßÿπÿØÿ© √ó ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ",
          it: "Base √ó Altezza",
        },
        q2_opt2: {
          en: "Base √ó Height √∑ 2",
          zh: "Â∫ï √ó È´ò √∑ 2",
          ja: "Â∫ïËæ∫ √ó È´ò„Åï √∑ 2",
          ko: "Î∞ëÎ≥Ä √ó ÎÜíÏù¥ √∑ 2",
          es: "Base √ó Altura √∑ 2",
          de: "Basis √ó H√∂he √∑ 2",
          fi: "Kanta √ó Korkeus √∑ 2",
          fr: "Base √ó Hauteur √∑ 2",
          ar: "ÿßŸÑŸÇÿßÿπÿØÿ© √ó ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ √∑ 2",
          it: "Base √ó Altezza √∑ 2",
        },
        q2_opt3: {
          en: "Base + Height",
          zh: "Â∫ï + È´ò",
          ja: "Â∫ïËæ∫ + È´ò„Åï",
          ko: "Î∞ëÎ≥Ä + ÎÜíÏù¥",
          es: "Base + Altura",
          de: "Basis + H√∂he",
          fi: "Kanta + Korkeus",
          fr: "Base + Hauteur",
          ar: "ÿßŸÑŸÇÿßÿπÿØÿ© + ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ",
          it: "Base + Altezza",
        },
        q2_opt4: {
          en: "Base √ó Height √ó 2",
          zh: "Â∫ï √ó È´ò √ó 2",
          ja: "Â∫ïËæ∫ √ó È´ò„Åï √ó 2",
          ko: "Î∞ëÎ≥Ä √ó ÎÜíÏù¥ √ó 2",
          es: "Base √ó Altura √ó 2",
          de: "Basis √ó H√∂he √ó 2",
          fi: "Kanta √ó Korkeus √ó 2",
          fr: "Base √ó Hauteur √ó 2",
          ar: "ÿßŸÑŸÇÿßÿπÿØÿ© √ó ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ √ó 2",
          it: "Base √ó Altezza √ó 2",
        },
        q3: {
          en: "25% equals?",
          zh: "25% Á≠âÊñºÔºü",
          ja: "25% „ÅØÔºü",
          ko: "25%Îäî?",
          es: "¬ø25% es igual a?",
          de: "25% entspricht?",
          fi: "25% vastaa?",
          fr: "25% √©gale ?",
          ar: "25% Ÿäÿ≥ÿßŸàŸäÿü",
          it: "25% uguale?",
        },
        q4: {
          en: "Volume of Cuboid Formula?",
          zh: "Èï∑ÊñπÈ´îÈ´îÁ©çÂÖ¨ÂºèÔºü",
          ja: "Áõ¥Êñπ‰Ωì„ÅÆ‰ΩìÁ©ç„ÅÆÂÖ¨ÂºèÔºü",
          ko: "ÏßÅÏú°Î©¥Ï≤¥Ïùò Î∂ÄÌîº Í≥µÏãù?",
          es: "¬øF√≥rmula del Volumen del Cuboide?",
          de: "Formel f√ºr Quadervolumen?",
          fi: "Suorakulmaisen s√§rmi√∂n tilavuus?",
          fr: "Formule du volume du cubo√Øde ?",
          ar: "ÿµŸäÿ∫ÿ© ÿ≠ÿ¨ŸÖ ŸÖÿ™Ÿàÿßÿ≤Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿ∑ŸäŸÑÿßÿ™ÿü",
          it: "Formula Volume Cuboide?",
        },
        q4_opt1: {
          en: "L √ó W",
          zh: "Èï∑ √ó Èóä",
          ja: "Á∏¶ √ó Ê®™",
          ko: "Í∞ÄÎ°ú √ó ÏÑ∏Î°ú",
          es: "L √ó A",
          de: "L √ó B",
          fi: "P √ó L",
          fr: "L √ó l",
          ar: "ÿßŸÑÿ∑ŸàŸÑ √ó ÿßŸÑÿπÿ±ÿ∂",
          it: "L √ó P",
        },
        q4_opt2: {
          en: "L √ó W √ó H",
          zh: "Èï∑ √ó Èóä √ó È´ò",
          ja: "Á∏¶ √ó Ê®™ √ó È´ò„Åï",
          ko: "Í∞ÄÎ°ú √ó ÏÑ∏Î°ú √ó ÎÜíÏù¥",
          es: "L √ó A √ó H",
          de: "L √ó B √ó H",
          fi: "P √ó L √ó K",
          fr: "L √ó l √ó H",
          ar: "ÿßŸÑÿ∑ŸàŸÑ √ó ÿßŸÑÿπÿ±ÿ∂ √ó ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ",
          it: "L √ó P √ó A",
        },
        q4_opt3: {
          en: "L + W + H",
          zh: "Èï∑ + Èóä + È´ò",
          ja: "Á∏¶ + Ê®™ + È´ò„Åï",
          ko: "Í∞ÄÎ°ú + ÏÑ∏Î°ú + ÎÜíÏù¥",
          es: "L + A + H",
          de: "L + B + H",
          fi: "P + L + K",
          fr: "L + l + H",
          ar: "ÿßŸÑÿ∑ŸàŸÑ + ÿßŸÑÿπÿ±ÿ∂ + ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ",
          it: "L + P + A",
        },
        q4_opt4: {
          en: "2(L + W)",
          zh: "2(Èï∑ + Èóä)",
          ja: "2(Á∏¶ + Ê®™)",
          ko: "2(Í∞ÄÎ°ú + ÏÑ∏Î°ú)",
          es: "2(L + A)",
          de: "2(L + B)",
          fi: "2(P + L)",
          fr: "2(L + l)",
          ar: "2(ÿßŸÑÿ∑ŸàŸÑ + ÿßŸÑÿπÿ±ÿ∂)",
          it: "2(L + P)",
        },
        q7: {
          en: "Angle of North-East?",
          zh: "Êù±ÂåóÊñπÁöÑËßíÂ∫¶Ôºü",
          ja: "ÂåóÊù±„ÅÆËßíÂ∫¶Ôºü",
          ko: "Î∂ÅÎèôÏ™ΩÏùò Í∞ÅÎèÑ?",
          es: "¬ø√Ångulo del Noreste?",
          de: "Winkel von Nordost?",
          fi: "Koillisen kulma?",
          fr: "Angle du Nord-Est ?",
          ar: "ÿ≤ÿßŸàŸäÿ© ÿßŸÑÿ¥ŸÖÿßŸÑ ÿßŸÑÿ¥ÿ±ŸÇŸäÿü",
          it: "Angolo Nord-Est?",
        },
        q8: {
          en: "Round 3.456 to 1 d.p.",
          zh: "3.456 ÂõõÊç®‰∫îÂÖ•Ëá≥‰∏Ä‰ΩçÂ∞èÊï∏",
          ja: "3.456 „ÇíÂ∞èÊï∞Á¨¨1‰Ωç„ÅßÂõõÊç®‰∫îÂÖ•",
          ko: "3.456 ÏÜåÏàò Ï≤´Ïß∏ÏûêÎ¶¨ Î∞òÏò¨Î¶º",
          es: "Redondear 3.456 a 1 d.",
          de: "Runde 3,456 auf 1 Dez.",
          fi: "Py√∂rist√§ 3.456 1 des.",
          fr: "Arrondir 3.456 √† 1 d√©c.",
          ar: "ŸÇÿ±ÿ® 3.456 ÿ•ŸÑŸâ ŸÖŸÜÿ≤ŸÑÿ© Ÿàÿßÿ≠ÿØÿ©",
          it: "Arrotonda 3.456 a 1 dec.",
        },
        completed: {
          en: "Challenge Complete!",
          zh: "ÊåëÊà∞ÂÆåÊàêÔºÅ",
          ja: "„ÉÅ„É£„É¨„É≥„Ç∏ÂÆå‰∫ÜÔºÅ",
          ko: "Ï±åÎ¶∞ÏßÄ ÏôÑÎ£å!",
          es: "¬°Desaf√≠o Completado!",
          de: "Herausforderung Abgeschlossen!",
          fi: "Haaste Suoritettu!",
          fr: "D√©fi Termin√© !",
          ar: "ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿ™ÿ≠ÿØŸä!",
          it: "Sfida Completata!",
        },
        playAgain: {
          en: "Play Again",
          zh: "ÂÜçÁé©‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§",
          ko: "Îã§ÏãúÌïòÍ∏∞",
          es: "Jugar de Nuevo",
          de: "Nochmal Spielen",
          fi: "Pelaa Uudelleen",
          fr: "Rejouer",
          ar: "ÿßŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Gioca Ancora",
        },
        correct: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµ!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        wrong: {
          en: "Wrong!",
          zh: "Á≠îÈåØ‰∫ÜÔºÅ",
          ja: "‰∏çÊ≠£Ëß£ÔºÅ",
          ko: "Ïò§Îãµ!",
          es: "¬°Incorrecto!",
          de: "Falsch!",
          fi: "V√§√§rin!",
          fr: "Faux !",
          ar: "ÿÆÿ∑ÿ£!",
          it: "Sbagliato!",
        },
      };

      const getText = (key, lang) => t[key]?.[lang] || t[key]?.["en"] || key;

      function App() {
        const [lang, setLang] = useState("zh");
        const [gameState, setGameState] = useState("menu"); // menu, playing, end
        const [qIndex, setQIndex] = useState(0);
        const [score, setScore] = useState(0);
        const [feedback, setFeedback] = useState(null); // null, correct, wrong

        const questions = [
          { q: "q1", opts: ["5/4", "4/6", "1", "5/6"], ans: 0 },
          {
            q: "q2",
            opts: ["q2_opt1", "q2_opt2", "q2_opt3", "q2_opt4"],
            ans: 1,
            dynamic: true,
          },
          { q: "q3", opts: ["0.25", "0.025", "2.5", "25"], ans: 0 },
          {
            q: "q4",
            opts: ["q4_opt1", "q4_opt2", "q4_opt3", "q4_opt4"],
            ans: 1,
            dynamic: true,
          },
          { q: "2x + 3 = 11, x = ?", opts: ["4", "5", "7", "3"], ans: 0 },
          { q: "1.5 √ó 0.4 = ?", opts: ["0.6", "0.06", "6", "60"], ans: 0 },
          { q: "q7", opts: ["45¬∞", "90¬∞", "135¬∞", "180¬∞"], ans: 0 },
          { q: "q8", opts: ["3.4", "3.5", "3.46", "3.0"], ans: 1 },
        ];

        const handleAnswer = (idx) => {
          if (feedback) return; // Prevent double clicks
          const correct = idx === questions[qIndex].ans;
          if (correct) {
            setScore((s) => s + 100);
            setFeedback("correct");
          } else {
            setFeedback("wrong");
          }

          setTimeout(() => {
            setFeedback(null);
            if (qIndex < questions.length - 1) {
              setQIndex(qIndex + 1);
            } else {
              setGameState("end");
            }
          }, 1000);
        };

        const startGame = () => {
          setScore(0);
          setQIndex(0);
          setGameState("playing");
          setFeedback(null);
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4 relative overflow-hidden">
            {/* Background decoration */}
            <div className="absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden">
              <div className="absolute top-10 left-10 w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl animate-pulse"></div>
              <div className="absolute bottom-10 right-10 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse delay-700"></div>
            </div>

            <div className="w-full max-w-4xl flex justify-between items-center mb-10 z-10">
              <h1 className="text-4xl font-black text-indigo-400 drop-shadow-[0_0_15px_rgba(129,140,248,0.5)]">
                üèÜ {getText("title", lang)}
              </h1>
              <div className="bg-slate-800/80 p-1.5 rounded-xl border border-white/10 flex flex-wrap justify-end gap-1 max-w-[50%]">
                {[
                  "zh",
                  "en",
                  "ja",
                  "ko",
                  "es",
                  "de",
                  "fi",
                  "fr",
                  "ar",
                  "it",
                ].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 rounded-lg font-bold text-xs uppercase transition-all ${
                      lang === l
                        ? "bg-indigo-600 text-white shadow-lg scale-105"
                        : "text-slate-400 hover:text-white hover:bg-white/5"
                    }`}
                  >
                    {l}
                  </button>
                ))}
              </div>
            </div>

            <div className="w-full max-w-3xl flex flex-col items-center z-10">
              <AnimatePresence mode="wait">
                {gameState === "menu" && (
                  <motion.div
                    key="menu"
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.9 }}
                    className="glass-panel p-12 rounded-3xl flex flex-col items-center gap-8 text-center w-full max-w-lg"
                  >
                    <div className="text-8xl">üéÆ</div>
                    <div className="text-slate-300 text-lg">
                      Are you ready to test your skills?
                    </div>
                    <button
                      onClick={startGame}
                      className="w-full py-4 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-black text-2xl shadow-lg hover:shadow-indigo-500/50 hover:scale-105 transition-all"
                    >
                      {getText("start", lang)}
                    </button>
                  </motion.div>
                )}

                {gameState === "playing" && (
                  <motion.div
                    key="playing"
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    className="w-full max-w-2xl"
                  >
                    {/* Header */}
                    <div className="flex justify-between items-end mb-4 px-4">
                      <div className="text-indigo-300 font-bold">
                        Question {qIndex + 1} / {questions.length}
                      </div>
                      <div className="text-3xl font-black text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]">
                        {score}
                      </div>
                    </div>

                    {/* Card */}
                    <div className="glass-panel p-8 rounded-3xl relative overflow-hidden">
                      {/* Question */}
                      <h2 className="text-3xl md:text-4xl font-black text-white text-center mb-10 leading-snug">
                        {getText(questions[qIndex].q, lang)}
                      </h2>

                      {/* Options */}
                      <div className="grid grid-cols-2 gap-4">
                        {questions[qIndex].opts.map((opt, i) => (
                          <button
                            key={i}
                            onClick={() => handleAnswer(i)}
                            disabled={feedback !== null}
                            className={`
                                                p-6 rounded-2xl text-xl font-bold transition-all border
                                                ${
                                                  feedback === null
                                                    ? "bg-white/5 border-white/10 hover:bg-white/10 hover:border-indigo-400/50 hover:shadow-[0_0_20px_rgba(99,102,241,0.3)]"
                                                    : i ===
                                                      questions[qIndex].ans
                                                    ? "bg-green-500 text-white border-green-400 shadow-[0_0_20px_rgba(34,197,94,0.5)]" // Show correct answer
                                                    : "bg-white/5 border-white/10 opacity-50"
                                                }
                                                ${
                                                  feedback === "wrong" &&
                                                  feedback !== null &&
                                                  "grayscale"
                                                } 
                                            `}
                          >
                            {questions[qIndex].dynamic
                              ? getText(opt, lang)
                              : opt}
                          </button>
                        ))}
                      </div>

                      {/* Feedback Overlay */}
                      <AnimatePresence>
                        {feedback && (
                          <motion.div
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            exit={{ opacity: 0 }}
                            className="absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center pointer-events-none"
                          >
                            <motion.div
                              initial={{ scale: 0.5, rotate: -10 }}
                              animate={{ scale: 1.2, rotate: 0 }}
                              className={`text-6xl font-black ${
                                feedback === "correct"
                                  ? "text-green-400"
                                  : "text-red-400"
                              } drop-shadow-[0_0_30px_currentColor]`}
                            >
                              {getText(feedback, lang)}
                            </motion.div>
                          </motion.div>
                        )}
                      </AnimatePresence>
                    </div>
                  </motion.div>
                )}

                {gameState === "end" && (
                  <motion.div
                    key="end"
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className="glass-panel p-12 rounded-3xl flex flex-col items-center gap-6 text-center w-full max-w-lg"
                  >
                    <div className="text-8xl">üèÜ</div>
                    <h2 className="text-3xl font-black text-white">
                      {getText("completed", lang)}
                    </h2>
                    <div className="text-xl text-slate-300">
                      {getText("score", lang)}
                    </div>
                    <div className="text-7xl font-black text-yellow-400 drop-shadow-[0_0_30px_rgba(250,204,21,0.5)]">
                      {score}
                    </div>
                    <button
                      onClick={startGame}
                      className="w-full py-4 rounded-xl bg-white/10 hover:bg-white/20 border border-white/20 text-white font-bold text-xl transition-all mt-4"
                    >
                      {getText("playAgain", lang)}
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
