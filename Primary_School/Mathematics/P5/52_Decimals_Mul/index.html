<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小五數學：小數乘法 | Decimal Multiplication</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: #0f172a;
        color: white;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(6, 182, 212, 0.15); /* Cyan 500 alpha */
        backdrop-filter: blur(12px);
        border: 1px solid rgba(34, 211, 238, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .grid-cell {
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { X, ArrowRight, Grid: GridIcon, Calculator } = window.LucideReact;
      const { LanguageSelector } = window.MathI18n || {
        LanguageSelector: () => null,
      };

      const t = {
        title: {
          en: "Decimal Multiplication",
          zh: "小數乘法",
          ja: "小数の掛け算",
          ko: "소수 곱셈",
          es: "Multiplicación de Decimales",
          de: "Dezimalmultiplikation",
          fi: "Desimaalilukujen kertolasku",
          fr: "Multiplication décimale",
          ar: "ضرب الأعداد العشرية",
          it: "Moltiplicazione decimale",
        },
        multiplicand: {
          en: "Multiplicand",
          zh: "被乘數",
          ja: "被乗数",
          ko: "피승수",
          es: "Multiplicando",
          de: "Multiplikand",
          fi: "Kerrottava",
          fr: "Multiplicande",
          ar: "المضروب",
          it: "Moltiplicando",
        },
        multiplier: {
          en: "Multiplier",
          zh: "乘數",
          ja: "乗数",
          ko: "승수",
          es: "Multiplicador",
          de: "Multiplikator",
          fi: "Kertoja",
          fr: "Multiplicateur",
          ar: "المضروب فيه",
          it: "Moltiplicatore",
        },
        product: {
          en: "Product",
          zh: "積",
          ja: "積",
          ko: "곱",
          es: "Producto",
          de: "Produkt",
          fi: "Tulo",
          fr: "Produit",
          ar: "الناتج",
          it: "Prodotto",
        },
        columns: {
          en: "Columns",
          zh: "橫向",
          ja: "列",
          ko: "열",
          es: "Columnas",
          de: "Spalten",
          fi: "Sarakkeet",
          fr: "Colonnes",
          ar: "الأعمدة",
          it: "Colonne",
        },
        rows: {
          en: "Rows",
          zh: "直向",
          ja: "行",
          ko: "행",
          es: "Filas",
          de: "Zeilen",
          fi: "Rivit",
          fr: "Lignes",
          ar: "الصفوف",
          it: "Righe",
        },
        result: {
          en: "Result",
          zh: "結果",
          ja: "結果",
          ko: "결과",
          es: "Resultado",
          de: "Ergebnis",
          fi: "Tulos",
          fr: "Résultat",
          ar: "النتيجة",
          it: "Risultato",
        },
        countSquares: {
          en: "{n} squares",
          zh: "{n} 格",
          ja: "{n} マス",
          ko: "{n} 칸",
          es: "{n} cuadrados",
          de: "{n} Quadrate",
          fi: "{n} ruutua",
          fr: "{n} carrés",
          ar: "{n} مربعات",
          it: "{n} quadrati",
        },
        calc: {
          en: "{c} × {r} = {p}",
          zh: "{c} × {r} = {p}",
          ja: "{c} × {r} = {p}",
          ko: "{c} × {r} = {p}",
          es: "{c} × {r} = {p}",
          de: "{c} × {r} = {p}",
          fi: "{c} × {r} = {p}",
          fr: "{c} × {r} = {p}",
          ar: "{c} × {r} = {p}",
          it: "{c} × {r} = {p}",
        },
      };

      const getText = (key, lang, params = {}) => {
        let text = t[key]?.[lang] || t[key]?.["en"] || key;
        for (const p in params) {
          text = text.replace(`{${p}}`, params[p]);
        }
        return text;
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [cols, setCols] = useState(5); // 1-10 (represents 0.1 - 1.0)
        const [rows, setRows] = useState(3); // 1-10

        const val1 = (cols / 10).toFixed(1);
        const val2 = (rows / 10).toFixed(1);
        const product = (val1 * val2).toFixed(2);
        const totalSquares = cols * rows;

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <div className="w-full max-w-5xl flex justify-between items-center mb-10">
              <h1 className="text-3xl md:text-5xl font-black text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.5)]">
                ✖️ {getText("title", lang)}
              </h1>
              <div className="bg-slate-800/80 p-1.5 rounded-xl border border-white/10 flex flex-wrap justify-end gap-1 max-w-[50%]">
                {[
                  "zh",
                  "en",
                  "ja",
                  "ko",
                  "es",
                  "de",
                  "fi",
                  "fr",
                  "ar",
                  "it",
                ].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 rounded-lg font-bold text-xs uppercase transition-all ${
                      lang === l
                        ? "bg-cyan-600 text-white shadow-lg scale-105"
                        : "text-slate-400 hover:text-white hover:bg-white/5"
                    }`}
                  >
                    {l}
                  </button>
                ))}
              </div>
            </div>

            <main className="w-full max-w-5xl grid lg:grid-cols-2 gap-8">
              {/* Control Panel */}
              <div className="flex flex-col gap-6">
                <div className="glass-panel p-8 rounded-3xl">
                  {/* Axis 1 */}
                  <div className="mb-8">
                    <div className="flex justify-between text-yellow-400 font-bold mb-2">
                      <span>
                        {getText("columns", lang)} /{" "}
                        {getText("multiplicand", lang)}
                      </span>
                      <span className="text-white text-xl font-mono">
                        {val1}
                      </span>
                    </div>
                    <div className="flex gap-4 items-center">
                      <input
                        type="range"
                        min="1"
                        max="10"
                        value={cols}
                        onChange={(e) => setCols(parseInt(e.target.value))}
                        className="flex-1 accent-yellow-400"
                      />
                    </div>
                  </div>

                  {/* Axis 2 */}
                  <div className="mb-4">
                    <div className="flex justify-between text-pink-400 font-bold mb-2">
                      <span>
                        {getText("rows", lang)} / {getText("multiplier", lang)}
                      </span>
                      <span className="text-white text-xl font-mono">
                        {val2}
                      </span>
                    </div>
                    <div className="flex gap-4 items-center">
                      <input
                        type="range"
                        min="1"
                        max="10"
                        value={rows}
                        onChange={(e) => setRows(parseInt(e.target.value))}
                        className="flex-1 accent-pink-400"
                      />
                    </div>
                  </div>
                </div>

                <div className="glass-panel p-6 rounded-3xl flex flex-col items-center">
                  <div className="flex items-center gap-4 text-4xl md:text-5xl font-black text-white font-mono flex-wrap justify-center">
                    <span className="text-yellow-400">{val1}</span>
                    <X className="text-slate-500" size={32} />
                    <span className="text-pink-400">{val2}</span>
                    <span className="text-slate-500">=</span>
                    <span className="text-cyan-400">{product}</span>
                  </div>
                  <div className="mt-4 text-sm font-bold text-slate-400 bg-black/20 px-4 py-2 rounded-lg">
                    {getText("calc", lang, {
                      c: cols,
                      r: rows,
                      p: totalSquares,
                    })}{" "}
                    ({getText("countSquares", lang, { n: totalSquares })}) ÷ 100
                  </div>
                </div>
              </div>

              {/* Grid Visualization */}
              <div className="glass-panel p-8 rounded-3xl flex flex-col items-center justify-center min-h-[400px] relative">
                <div className="relative">
                  {/* Axis Labels */}
                  <div className="absolute -top-8 left-0 w-full flex justify-center text-yellow-400 font-mono font-bold">
                    {val1}
                  </div>
                  <div className="absolute -left-10 top-0 h-full flex flex-col justify-center text-pink-400 font-mono font-bold">
                    <span className="-rotate-90 whitespace-nowrap">{val2}</span>
                  </div>

                  {/* The Grid */}
                  <div className="grid grid-cols-10 gap-1 bg-slate-900/50 p-2 rounded-xl border border-white/10 shadow-2xl">
                    {Array.from({ length: 10 }).map((_, r) =>
                      Array.from({ length: 10 }).map((_, c) => {
                        // r is row index (0-9), c is col index (0-9)
                        // Row count is `rows` (1-based). So active if r < rows.
                        // Col count is `cols`. Active if c < cols.
                        const inRow = r < rows;
                        const inCol = c < cols;
                        const intersect = inRow && inCol;

                        let bgClass = "bg-slate-700/30";
                        if (intersect)
                          bgClass =
                            "bg-cyan-400 shadow-[0_0_8px_rgba(34,211,238,0.8)] z-10 scale-105";
                        else if (inRow) bgClass = "bg-pink-500/30";
                        else if (inCol) bgClass = "bg-yellow-500/30";

                        return (
                          <motion.div
                            key={`${r}-${c}`}
                            className={`w-6 h-6 sm:w-8 sm:h-8 rounded-sm ${bgClass}`}
                            initial={false}
                            animate={{ scale: intersect ? 1.1 : 1 }}
                            transition={{
                              type: "spring",
                              stiffness: 300,
                              damping: 20,
                            }}
                          />
                        );
                      })
                    )}
                  </div>
                </div>

                <div className="absolute bottom-4 right-4 flex gap-4 text-xs font-bold">
                  <div className="flex items-center gap-2 text-yellow-400">
                    <div className="w-3 h-3 bg-yellow-500/50 rounded-sm"></div>
                    {getText("multiplicand", lang)}
                  </div>
                  <div className="flex items-center gap-2 text-pink-400">
                    <div className="w-3 h-3 bg-pink-500/50 rounded-sm"></div>
                    {getText("multiplier", lang)}
                  </div>
                  <div className="flex items-center gap-2 text-cyan-400">
                    <div className="w-3 h-3 bg-cyan-400 rounded-sm shadow-[0_0_5px_currentColor]"></div>
                    {getText("product", lang)}
                  </div>
                </div>
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
