<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小五數學：分數除法</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
      }
      .slice {
        transition: all 0.5s ease;
        transform-origin: center;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      // Inline Icons
      const Pizza = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M15 11h.01" />
          <path d="M11 15h.01" />
          <path d="M16.5 4a2.12 2.12 0 0 1 2.12 2.12 2.12 2.12 0 0 1-2.12 2.12 2.12 2.12 0 0 1-2.12-2.12 2.12 2.12 0 0 1 2.12-2.12Z" />
          <path d="M8.5 7a2.12 2.12 0 0 1 2.12 2.12 2.12 2.12 0 0 1-2.12 2.12 2.12 2.12 0 0 1-2.12-2.12 2.12 2.12 0 0 1 2.12-2.12Z" />
          <path d="M12 21a10 10 0 1 1 10-10 10 10 0 0 1-10 10Z" />
          <path d="M12 11 2 2" />
          <path d="M12 11 15 22" />
        </svg>
      );
      const Users = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
          <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
          <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
      );
      const ArrowRight = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M5 12h14" />
          <path d="m12 5 7 7-7 7" />
        </svg>
      );

      function App() {
        const [numerator, setNumerator] = useState(1);
        const [denominator, setDenominator] = useState(2);
        const [divisor, setDivisor] = useState(2); // Whole number divisor

        // Ensure numerator < denominator
        useEffect(() => {
          if (numerator >= denominator) setNumerator(denominator - 1);
        }, [denominator]);

        const finalBottom = denominator * divisor;

        // Render Pie Chart
        const renderPie = () => {
          // We need to draw segments
          // Total segments = denominator initially.
          // We highlight 'numerator' segments.
          // When dividing, we essentially cut each segment into 'divisor' pieces.
          // So total segments become denominator * divisor.
          // Highlighted segments become numerator * divisor? No.
          // If we have 1/2 of a pizza. Divide by 2.
          // We have 1 slice of size 1/2.
          // We cut it into 2. We take 1.
          // Result is 1/4.

          // Visual approach:
          // Show the original fraction.
          // Then show the cuts.
          // Then highlight the result.

          const paths = [];
          const center = 150;
          const radius = 120;

          // Draw Base Segments (Denominator)
          // We just draw lines?
          // Let's rely on SVG paths.

          const makeSector = (startAngle, endAngle, color) => {
            const x1 = center + radius * Math.cos((Math.PI * startAngle) / 180);
            const y1 = center + radius * Math.sin((Math.PI * startAngle) / 180);
            const x2 = center + radius * Math.cos((Math.PI * endAngle) / 180);
            const y2 = center + radius * Math.sin((Math.PI * endAngle) / 180);

            return `M${center},${center} L${x1},${y1} A${radius},${radius} 0 0,1 ${x2},${y2} Z`;
          };

          // Draw denominator slices
          const stepAngle = 360 / denominator;
          for (let i = 0; i < denominator; i++) {
            const start = i * stepAngle - 90;
            const end = (i + 1) * stepAngle - 90;
            const isActive = i < numerator;

            paths.push(
              <path
                key={`base-${i}`}
                d={makeSector(start, end)}
                fill={isActive ? "#fbbf24" : "#f1f5f9"} // Amber-400 or Slate-100
                stroke="#94a3b8"
                strokeWidth="2"
              />
            );

            // If active and we are dividing...
            if (isActive) {
              // Draw subdivision lines within this sector
              const subStep = stepAngle / divisor;
              for (let d = 1; d < divisor; d++) {
                const subAngle = start + subStep * d;
                const lx =
                  center + radius * Math.cos((Math.PI * subAngle) / 180);
                const ly =
                  center + radius * Math.sin((Math.PI * subAngle) / 180);
                paths.push(
                  <line
                    key={`sub-${i}-${d}`}
                    x1={center}
                    y1={center}
                    x2={lx}
                    y2={ly}
                    stroke="#dc2626" // Red cuts
                    strokeWidth="2"
                    strokeDasharray="4 2"
                  />
                );
              }
            }
          }

          // Highlight ONLY the result piece?
          // 1/2 div 2 = 1/4.
          // The result is ONE of the small pieces from the original highlighted area.
          // One small piece angle = 360 / (denominator * divisor)

          const resultAngle = 360 / (denominator * divisor);
          // Highlight the first piece
          paths.push(
            <path
              key="result"
              d={makeSector(-90, -90 + resultAngle)}
              fill="url(#striped-pattern)"
              stroke="#dc2626"
              strokeWidth="3"
            />
          );

          return paths;
        };

        return (
          <div className="min-h-screen p-6 flex flex-col items-center justify-center">
            <div className="bg-white/95 backdrop-blur-xl rounded-[2rem] p-8 shadow-2xl border-4 border-white w-full max-w-5xl flex flex-col lg:flex-row gap-12 items-center">
              {/* Controls */}
              <div className="flex-1 space-y-8 w-full">
                <div className="flex items-center gap-4 mb-4">
                  <div className="p-4 bg-purple-100 rounded-2xl text-purple-600">
                    <Pizza />
                  </div>
                  <div>
                    <h1 className="text-3xl font-black text-slate-800">
                      分數除法
                    </h1>
                    <p className="text-slate-500 font-bold">
                      Fraction Division
                    </p>
                  </div>
                </div>

                <div className="bg-slate-50 p-6 rounded-2xl border-2 border-slate-100 space-y-6">
                  <div>
                    <label className="block text-slate-500 font-bold mb-2">
                      原本有多少 (Fraction)
                    </label>
                    <div className="flex items-center gap-4">
                      <span className="text-2xl font-black text-slate-700 w-8 text-right">
                        {numerator}
                      </span>
                      <input
                        type="range"
                        min="1"
                        max={denominator - 1}
                        value={numerator}
                        onChange={(e) => setNumerator(parseInt(e.target.value))}
                        className="flex-1 accent-amber-400"
                      />
                    </div>
                    <div className="h-px bg-slate-300 my-2 mx-12"></div>
                    <div className="flex items-center gap-4">
                      <span className="text-2xl font-black text-slate-700 w-8 text-right">
                        {denominator}
                      </span>
                      <input
                        type="range"
                        min="2"
                        max="6"
                        value={denominator}
                        onChange={(e) =>
                          setDenominator(parseInt(e.target.value))
                        }
                        className="flex-1 accent-slate-400"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-slate-500 font-bold mb-2 flex items-center gap-2">
                      <Users size={20} /> 分給多少人 (Divide by)
                    </label>
                    <div className="flex items-center gap-4">
                      <span className="text-2xl font-black text-purple-600 w-8 text-right">
                        {divisor}
                      </span>
                      <input
                        type="range"
                        min="2"
                        max="5"
                        value={divisor}
                        onChange={(e) => setDivisor(parseInt(e.target.value))}
                        className="flex-1 accent-purple-500"
                      />
                    </div>
                  </div>
                </div>

                {/* Math Equation */}
                <div className="bg-purple-50 p-6 rounded-2xl border-2 border-purple-100 flex items-center justify-center gap-4 text-4xl font-black text-slate-700">
                  <div className="flex flex-col items-center">
                    <span>{numerator}</span>
                    <div className="w-full h-1 bg-slate-800 my-1"></div>
                    <span>{denominator}</span>
                  </div>
                  <span className="text-purple-400">÷</span>
                  <span className="text-purple-600">{divisor}</span>
                  <span>=</span>
                  <div className="flex flex-col items-center bg-white px-4 py-2 rounded-xl shadow-sm border border-purple-200">
                    <span className="text-red-500">{numerator}</span>
                    <div className="w-full h-1 bg-slate-800 my-1"></div>
                    <span className="text-green-600">{finalBottom}</span>
                  </div>
                </div>

                <div className="text-center text-slate-400 font-bold text-sm">
                  除以 {divisor} 等於乘以 1/{divisor}
                  <br />
                  Divide by {divisor} is same as multiply by 1/{divisor}
                </div>
              </div>

              {/* Visualization */}
              <div className="flex-1 flex justify-center items-center relative">
                <svg width="300" height="300" viewBox="0 0 300 300">
                  <defs>
                    <pattern
                      id="striped-pattern"
                      width="4"
                      height="4"
                      patternUnits="userSpaceOnUse"
                      patternTransform="rotate(45)"
                    >
                      <rect
                        width="2"
                        height="4"
                        transform="translate(0,0)"
                        fill="#ef4444"
                        opacity="0.3"
                      ></rect>
                    </pattern>
                  </defs>
                  {renderPie()}
                </svg>

                {/* Labels */}
                <div className="absolute top-0 right-0 bg-white/90 p-3 rounded-xl shadow-lg border border-slate-100 text-sm font-bold">
                  <div className="flex items-center gap-2 text-amber-500">
                    <div className="w-4 h-4 bg-amber-400 rounded"></div>
                    原本份額
                  </div>
                  <div className="flex items-center gap-2 text-red-500 mt-1">
                    <div className="w-4 h-4 bg-red-100 border border-red-500 rounded relative overflow-hidden">
                      <div className="absolute inset-0 bg-red-500/20 rotate-45 scale-150"></div>
                    </div>
                    每人所得
                  </div>
                </div>
              </div>
            </div>

            <div className="fixed bottom-4 left-4">
              <a
                href="../index.html"
                className="bg-white/80 backdrop-blur hover:bg-white text-slate-600 px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all"
              >
                ← 返回目錄
              </a>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
