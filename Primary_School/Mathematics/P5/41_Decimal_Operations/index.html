<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫îÊï∏Â≠∏ÔºöÂ∞èÊï∏ÂõõÂâáÈÅãÁÆó | Decimal Operations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: #0f172a;
        color: white;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(124, 58, 237, 0.15); /* Purple 600 alpha */
        backdrop-filter: blur(16px);
        border: 1px solid rgba(167, 139, 250, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .mono-digit {
        font-family: "JetBrains Mono", monospace;
        letter-spacing: 1px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { Calculator, Check, X, RefreshCw, Trophy, Lightbulb } =
        window.LucideReact;
      const { LanguageSelector } = window.MathI18n || {
        LanguageSelector: () => null,
      };

      const t = {
        title: {
          en: "Decimal Operations",
          zh: "Â∞èÊï∏ÂõõÂâáÈÅãÁÆó",
          ja: "Â∞èÊï∞„ÅÆÂõõÂâáÊºîÁÆó",
          ko: "ÏÜåÏàò ÏÇ¨ÏπôÏó∞ÏÇ∞",
          es: "Operaciones con Decimales",
          de: "Dezimaloperationen",
          fi: "Desimaalilaskut",
          fr: "Op√©rations d√©cimales",
          ar: "ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿπÿ¥ÿ±Ÿäÿ©",
          it: "Operazioni con i decimali",
        },
        score: {
          en: "Score",
          zh: "ÂæóÂàÜ",
          ja: "„Çπ„Ç≥„Ç¢",
          ko: "Ï†êÏàò",
          es: "Puntuaci√≥n",
          de: "Punktzahl",
          fi: "Pisteet",
          fr: "Score",
          ar: "ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",
          it: "Punteggio",
        },
        steps: {
          en: "Calculation Steps",
          zh: "Ë®àÁÆóÊ≠•È©ü",
          ja: "Ë®àÁÆóÊâãÈ†Ü",
          ko: "Í≥ÑÏÇ∞ Îã®Í≥Ñ",
          es: "Pasos de C√°lculo",
          de: "Rechenschritte",
          fi: "Laskentavaiheet",
          fr: "√âtapes de calcul",
          ar: "ÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ®",
          it: "Passaggi del calcolo",
        },
        showSteps: {
          en: "Show Steps",
          zh: "È°ØÁ§∫Ë©≥Á¥∞Ê≠•È©ü",
          ja: "ÊâãÈ†Ü„ÇíË°®Á§∫",
          ko: "Îã®Í≥Ñ ÌëúÏãú",
          es: "Mostrar Pasos",
          de: "Schritte anzeigen",
          fi: "N√§yt√§ vaiheet",
          fr: "Afficher les √©tapes",
          ar: "ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿÆÿ∑Ÿàÿßÿ™",
          it: "Mostra passaggi",
        },
        hideSteps: {
          en: "Hide Steps",
          zh: "Èö±ËóèË©≥Á¥∞Ê≠•È©ü",
          ja: "ÊâãÈ†Ü„ÇíÈö†„Åô",
          ko: "Îã®Í≥Ñ Ïà®Í∏∞Í∏∞",
          es: "Ocultar Pasos",
          de: "Schritte ausblenden",
          fi: "Piilota vaiheet",
          fr: "Masquer les √©tapes",
          ar: "ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿÆÿ∑Ÿàÿßÿ™",
          it: "Nascondi passaggi",
        },
        next: {
          en: "Next Question",
          zh: "‰∏ã‰∏ÄÈ°å",
          ja: "Ê¨°„ÅÆÂïèÈ°å",
          ko: "Îã§Ïùå Î¨∏Ï†ú",
          es: "Siguiente Pregunta",
          de: "N√§chste Frage",
          fi: "Seuraava kysymys",
          fr: "Question suivante",
          ar: "ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä",
          it: "Prossima domanda",
        },
        check: {
          en: "Check",
          zh: "Á¢∫Ë™ç",
          ja: "Á¢∫Ë™ç",
          ko: "ÌôïÏù∏",
          es: "Comprobar",
          de: "Pr√ºfen",
          fi: "Tarkista",
          fr: "V√©rifier",
          ar: "ÿ™ÿ≠ŸÇŸÇ",
          it: "Controlla",
        },
        inputPlaceholder: {
          en: "Enter answer...",
          zh: "Ëº∏ÂÖ•Á≠îÊ°à...",
          ja: "Á≠î„Åà„ÇíÂÖ•Âäõ...",
          ko: "Îãµ ÏûÖÎ†•...",
          es: "Ingresa respuesta...",
          de: "Antwort eingeben...",
          fi: "Sy√∂t√§ vastaus...",
          fr: "Entrez r√©ponse...",
          ar: "ÿ£ÿØÿÆŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©...",
          it: "Inserisci risposta...",
        },
        tipsTitle: {
          en: "Decimal Tips",
          zh: "ÈÅãÁÆóË¶ÅË®£",
          ja: "„Éí„É≥„Éà",
          ko: "ÌåÅ",
          es: "Consejos",
          de: "Tipps",
          fi: "Vinkit",
          fr: "Astuces",
          ar: "ŸÜÿµÿßÿ¶ÿ≠",
          it: "Suggerimenti",
        },
        addTip: {
          en: "Align decimal points!",
          zh: "Â∞èÊï∏ÈªûË¶ÅÂ∞çÈΩäÔºÅ",
          ja: "Â∞èÊï∞ÁÇπ„ÇíÊèÉ„Åà„Å¶ÔºÅ",
          ko: "ÏÜåÏàòÏ†êÏùÑ ÎßûÏ∂îÏÑ∏Ïöî!",
          es: "¬°Alinea puntos decimales!",
          de: "Kommas ausrichten!",
          fi: "Kohdista desimaalit!",
          fr: "Alignez les points !",
          ar: "ÿ≠ÿßÿ∞Ÿê ÿßŸÑŸÜŸÇÿßÿ∑!",
          it: "Allinea i punti!",
        },
        mulTip: {
          en: "Count decimal places.",
          zh: "Êï∏Â∞èÊï∏‰ΩçÊï∏Ê®ôÈªû„ÄÇ",
          ja: "Ê°ÅÊï∞„ÇíÊï∞„Åà„Çã„ÄÇ",
          ko: "ÏûêÎ¶øÏàòÎ•º ÏÑ∏ÏÑ∏Ïöî.",
          es: "Cuenta decimales.",
          de: "Stellen z√§hlen.",
          fi: "Laske desimaalit.",
          fr: "Comptez les d√©cimales.",
          ar: "ÿπÿØ ÿßŸÑŸÖŸÜÿßÿ≤ŸÑ.",
          it: "Conta i decimali.",
        },
        divTip: {
          en: "Shift decimals if needed.",
          zh: "Áßª‰ΩçËÆäÊï¥Êï∏ÂÜçÈô§„ÄÇ",
          ja: "ÂøÖË¶Å„Å™„ÇâÁÇπ„ÇíÁßªÂãï„ÄÇ",
          ko: "ÌïÑÏöîÌïòÎ©¥ Ï†ê Ïù¥Îèô.",
          es: "Mueve el punto si es necesario.",
          de: "Komma verschieben.",
          fi: "Siirr√§ pilkkua.",
          fr: "D√©placez la virgule.",
          ar: "ÿ≠ÿ±ŸÉ ÿßŸÑÿπŸÑÿßŸÖÿ©.",
          it: "Sposta la virgola.",
        },
        quickPractice: {
          en: "Quick Practice",
          zh: "Âø´ÈÄüÁ∑¥Áøí",
          ja: "„ÇØ„Ç§„ÉÉ„ÇØÁ∑¥Áøí",
          ko: "Îπ†Î•∏ Ïó∞Ïäµ",
          es: "Pr√°ctica R√°pida",
          de: "Schnell√ºbung",
          fi: "Pikaharjoitus",
          fr: "Pratique rapide",
          ar: "ÿ™ÿØÿ±Ÿäÿ® ÿ≥ÿ±Ÿäÿπ",
          it: "Pratica veloce",
        },
        correctMsg: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµ!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        incorrectMsg: {
          en: "Try Again!",
          zh: "ÂÜçË©¶‰∏ÄÊ¨°ÔºÅ",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÔºÅ",
          ko: "Îã§Ïãú ÏãúÎèÑ!",
          es: "¬°Int√©ntalo!",
          de: "Nochmal!",
          fi: "Yrit√§ uudelleen!",
          fr: "R√©essayez !",
          ar: "ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ!",
          it: "Riprova!",
        },
      };

      const getText = (key, lang) => t[key]?.[lang] || t[key]?.["en"] || key;

      function App() {
        const [lang, setLang] = useState("zh");
        const [operation, setOperation] = useState("+");
        const [num1, setNum1] = useState(12.5);
        const [num2, setNum2] = useState(3.25);
        const [userAnswer, setUserAnswer] = useState("");
        const [feedback, setFeedback] = useState(null);
        const [score, setScore] = useState(0);
        const [showSteps, setShowSteps] = useState(false);

        const operations = [
          {
            symbol: "+",
            color: "text-green-400",
            bg: "bg-green-500/20",
            border: "border-green-500/50",
          },
          {
            symbol: "-",
            color: "text-amber-400",
            bg: "bg-amber-500/20",
            border: "border-amber-500/50",
          },
          {
            symbol: "√ó",
            color: "text-blue-400",
            bg: "bg-blue-500/20",
            border: "border-blue-500/50",
          },
          {
            symbol: "√∑",
            color: "text-purple-400",
            bg: "bg-purple-500/20",
            border: "border-purple-500/50",
          },
        ];

        const calculate = () => {
          switch (operation) {
            case "+":
              return num1 + num2;
            case "-":
              return num1 - num2;
            case "√ó":
              return num1 * num2;
            case "√∑":
              return num1 / num2;
            default:
              return 0;
          }
        };

        const correctAnswer = calculate();

        const generateQuestion = () => {
          const ops = ["+", "-", "√ó", "√∑"];
          const op = ops[Math.floor(Math.random() * ops.length)];
          setOperation(op);

          let n1, n2;
          if (op === "√∑") {
            // Ensure clean divisions for simplicity in P5 context
            n2 =
              Math.floor(Math.random() * 9) +
              1 +
              Math.floor(Math.random() * 5) / 10; // e.g., 2.5
            n2 = parseFloat(n2.toFixed(1));
            // make result integer or simple decimal
            const res =
              Math.floor(Math.random() * 10) +
              1 +
              Math.floor(Math.random() * 5) / 10;
            n1 = parseFloat((n2 * res).toFixed(2));
          } else {
            n1 = parseFloat((Math.random() * 50 + 1).toFixed(2));
            n2 = parseFloat((Math.random() * 20 + 1).toFixed(2));
          }

          setNum1(n1);
          setNum2(n2);
          setUserAnswer("");
          setFeedback(null);
          setShowSteps(false);
        };

        const checkAnswer = () => {
          const userVal = parseFloat(userAnswer);
          const isCorrect = Math.abs(userVal - correctAnswer) < 0.01;

          if (isCorrect) {
            setFeedback("correct");
            setScore((s) => s + 10);
            window.confetti && window.confetti();
          } else {
            setFeedback("incorrect");
          }
        };

        // Helper to format steps
        const renderStepsContent = () => {
          const ansStr = correctAnswer.toFixed(2);
          if (operation === "+")
            return `${num1} + ${num2} = ${ansStr}\n${getText("addTip", lang)}`;
          if (operation === "-")
            return `${num1} - ${num2} = ${ansStr}\n${getText("addTip", lang)}`; // Alignment rule applies
          if (operation === "√ó")
            return `${num1} √ó ${num2} = ${ansStr}\n${getText("mulTip", lang)}`;
          if (operation === "√∑")
            return `${num1} √∑ ${num2} = ${ansStr}\n${getText("divTip", lang)}`;
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <div className="w-full max-w-4xl flex justify-between items-center mb-10">
              <h1 className="text-4xl font-black text-purple-400 drop-shadow-[0_0_15px_rgba(167,139,250,0.5)]">
                üßÆ {getText("title", lang)}
              </h1>
              <div className="bg-slate-800/80 p-1.5 rounded-xl border border-white/10 flex flex-wrap justify-end gap-1 max-w-[50%]">
                {[
                  "zh",
                  "en",
                  "ja",
                  "ko",
                  "es",
                  "de",
                  "fi",
                  "fr",
                  "ar",
                  "it",
                ].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 rounded-lg font-bold text-xs uppercase transition-all ${
                      lang === l
                        ? "bg-purple-600 text-white shadow-lg scale-105"
                        : "text-slate-400 hover:text-white hover:bg-white/5"
                    }`}
                  >
                    {l}
                  </button>
                ))}
              </div>
            </div>

            <div className="w-full max-w-5xl grid lg:grid-cols-3 gap-6">
              {/* Main Question Area */}
              <div className="lg:col-span-2 flex flex-col gap-6">
                <div className="glass-panel p-8 rounded-3xl relative overflow-hidden">
                  {/* Selector */}
                  <div className="flex gap-2 justify-center mb-8">
                    {operations.map((op) => (
                      <button
                        key={op.symbol}
                        onClick={() => setOperation(op.symbol)}
                        className={`w-12 h-12 rounded-xl text-2xl font-black transition-all border ${
                          operation === op.symbol
                            ? `${op.bg} ${op.color} ${op.border} shadow-[0_0_15px_currentColor]`
                            : "bg-slate-800/50 border-transparent text-slate-500 hover:bg-slate-800"
                        }`}
                      >
                        {op.symbol}
                      </button>
                    ))}
                  </div>

                  {/* Problem */}
                  <div className="flex flex-col md:flex-row items-center justify-center gap-4 mb-8 text-5xl md:text-6xl font-black font-mono text-white drop-shadow-lg">
                    <div>{num1}</div>
                    <div
                      className={
                        operations.find((o) => o.symbol === operation).color
                      }
                    >
                      {operation}
                    </div>
                    <div>{num2}</div>
                    <div className="text-white/20">=</div>
                  </div>

                  {/* Input */}
                  <div className="max-w-md mx-auto relative group">
                    <input
                      type="number"
                      value={userAnswer}
                      onChange={(e) => setUserAnswer(e.target.value)}
                      onKeyDown={(e) => e.key === "Enter" && checkAnswer()}
                      placeholder={getText("inputPlaceholder", lang)}
                      className="w-full bg-slate-900/60 border-2 border-white/10 rounded-2xl px-6 py-4 text-3xl font-mono text-center text-white outline-none focus:border-purple-500 transition-colors"
                    />
                    <button
                      onClick={checkAnswer}
                      className="absolute right-2 top-2 bottom-2 bg-purple-600 hover:bg-purple-500 text-white px-6 rounded-xl font-bold transition-all shadow-lg"
                    >
                      <Check size={24} />
                    </button>
                  </div>

                  {/* Feedback */}
                  <AnimatePresence>
                    {feedback && (
                      <motion.div
                        initial={{ opacity: 0, y: 10 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0 }}
                        className={`mt-6 text-center text-2xl font-black ${
                          feedback === "correct"
                            ? "text-green-400"
                            : "text-red-400"
                        }`}
                      >
                        {feedback === "correct"
                          ? `üéâ ${getText("correctMsg", lang)}`
                          : `‚ùå ${getText("incorrectMsg", lang)}`}
                        {feedback === "incorrect" && (
                          <div className="text-sm text-slate-400 mt-1 font-mono">
                            Ans: {correctAnswer.toFixed(2)}
                          </div>
                        )}
                      </motion.div>
                    )}
                  </AnimatePresence>
                </div>

                {/* Steps Panel */}
                <div className="glass-panel p-6 rounded-2xl">
                  <button
                    onClick={() => setShowSteps(!showSteps)}
                    className="flex items-center gap-2 text-purple-300 font-bold hover:text-white transition-colors"
                  >
                    <Lightbulb size={20} />
                    {showSteps
                      ? getText("hideSteps", lang)
                      : getText("showSteps", lang)}
                  </button>
                  <AnimatePresence>
                    {showSteps && (
                      <motion.div
                        initial={{ height: 0, opacity: 0 }}
                        animate={{ height: "auto", opacity: 1 }}
                        exit={{ height: 0, opacity: 0 }}
                        className="overflow-hidden"
                      >
                        <pre className="mt-4 p-4 bg-slate-900/50 rounded-xl font-mono text-slate-300 whitespace-pre-wrap">
                          {renderStepsContent()}
                        </pre>
                      </motion.div>
                    )}
                  </AnimatePresence>
                </div>
              </div>

              {/* Sidebar */}
              <div className="flex flex-col gap-6">
                {/* Score */}
                <div className="glass-panel p-6 rounded-3xl flex items-center justify-between">
                  <div className="flex items-center gap-3 text-purple-200">
                    <Trophy size={28} />
                    <span className="font-bold text-lg uppercase tracking-wider">
                      {getText("score", lang)}
                    </span>
                  </div>
                  <div className="text-4xl font-black text-white">{score}</div>
                </div>

                {/* Tips */}
                <div className="glass-panel p-6 rounded-3xl flex-1">
                  <h3 className="text-purple-300 font-bold uppercase tracking-widest mb-4 border-b border-white/10 pb-2">
                    {getText("tipsTitle", lang)}
                  </h3>
                  <div className="space-y-4">
                    {[
                      { sym: "+/-", text: "addTip", color: "text-green-400" },
                      { sym: "√ó", text: "mulTip", color: "text-blue-400" },
                      { sym: "√∑", text: "divTip", color: "text-purple-400" },
                    ].map((tip, i) => (
                      <div
                        key={i}
                        className="bg-slate-900/30 p-3 rounded-xl border border-white/5"
                      >
                        <div className={`font-black ${tip.color} text-xl mb-1`}>
                          {tip.sym}
                        </div>
                        <div className="text-sm text-slate-300">
                          {getText(tip.text, lang)}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Next Button */}
                <button
                  onClick={generateQuestion}
                  className="w-full py-4 bg-slate-800 hover:bg-slate-700 text-white rounded-2xl font-bold text-lg shadow-lg transition-all flex items-center justify-center gap-2"
                >
                  <RefreshCw size={20} /> {getText("next", lang)}
                </button>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
