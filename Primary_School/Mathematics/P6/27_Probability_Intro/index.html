<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞èÂÖ≠Êï∏Â≠∏ÔºöÊ¶ÇÁéáÂÖ•ÈñÄ | Intro to Probability</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: #0f172a;
        color: white;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .perspective-1000 {
        perspective: 1000px;
      }
      .preserve-3d {
        transform-style: preserve-3d;
      }
      .backface-hidden {
        backface-visibility: hidden;
      }
      .rotate-x-180 {
        transform: rotateX(180deg);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const { motion, useAnimation } = window.Motion;
      const { LanguageSelector } = window.MathI18n || {
        LanguageSelector: () => null,
      };

      const t = {
        title: {
          en: "Coin Flip Probability",
          zh: "Êì≤Á°¨Âπ£Ê¶ÇÁéá",
          ja: "„Ç≥„Ç§„É≥Êäï„ÅíÁ¢∫Áéá",
          ko: "ÎèôÏ†Ñ ÎçòÏßÄÍ∏∞ ÌôïÎ•†",
          es: "Probabilidad de Lanzamiento de Moneda",
          de: "M√ºnzwurf-Wahrscheinlichkeit",
          fi: "Kolikonheiton todenn√§k√∂isyys",
          fr: "Probabilit√© de pile ou face",
          ar: "ÿßÿ≠ÿ™ŸÖÿßŸÑŸäÿ© ÿ±ŸÖŸä ÿßŸÑÿπŸÖŸÑÿ©",
          it: "Probabilit√† Lancio Moneta",
        },
        flip: {
          en: "FLIP",
          zh: "ÊäïÊì≤",
          ja: "Êäï„Åí„Çã",
          ko: "ÎçòÏßÄÍ∏∞",
          es: "LANZAR",
          de: "WERFEN",
          fi: "HEIT√Ñ",
          fr: "LANCER",
          ar: "ÿ±ŸÖŸä",
          it: "LANCIA",
        },
        flipping: {
          en: "Flipping...",
          zh: "ÊäïÊì≤‰∏≠...",
          ja: "Êäï„Åí„Å¶„ÅÑ„Åæ„Åô...",
          ko: "ÎçòÏßÄÎäî Ï§ë...",
          es: "Lanzando...",
          de: "Werfen...",
          fi: "Heitt√§√§...",
          fr: "Lancement...",
          ar: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ±ŸÖŸä...",
          it: "Lancio...",
        },
        heads: {
          en: "Heads",
          zh: "ÂÖ¨ (Ê¥ãÁ¥´Ëçä)",
          ja: "Ë°®",
          ko: "ÏïûÎ©¥",
          es: "Cara",
          de: "Kopf",
          fi: "Kruuna",
          fr: "Face",
          ar: "Ÿàÿ¨Ÿá",
          it: "Testa",
        },
        tails: {
          en: "Tails",
          zh: "Â≠ó (10ÂÖÉ)",
          ja: "Ë£è",
          ko: "Îí∑Î©¥",
          es: "Cruz",
          de: "Zahl",
          fi: "Klaava",
          fr: "Pile",
          ar: "ÿ∞ŸäŸÑ",
          it: "Croce",
        },
        stats: {
          en: "Statistics",
          zh: "Áµ±Ë®à",
          ja: "Áµ±Ë®à",
          ko: "ÌÜµÍ≥Ñ",
          es: "Estad√≠sticas",
          de: "Statistiken",
          fi: "Tilastot",
          fr: "Statistiques",
          ar: "ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™",
          it: "Statistiche",
        },
        total: {
          en: "Total Flips",
          zh: "Á∏ΩÊ¨°Êï∏",
          ja: "ÂêàË®àÂõûÊï∞",
          ko: "Ï¥ù ÌöüÏàò",
          es: "Lanzamientos Totales",
          de: "Gesamtw√ºrfe",
          fi: "Heittoja yhteens√§",
          fr: "Total lancers",
          ar: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ±ŸÖŸäÿßÿ™",
          it: "Lanci Totali",
        },
        history: {
          en: "History",
          zh: "Ê≠∑Âè≤Ë®òÈåÑ",
          ja: "Â±•Ê≠¥",
          ko: "Í∏∞Î°ù",
          es: "Historial",
          de: "Verlauf",
          fi: "Historia",
          fr: "Historique",
          ar: "ÿ™ÿßÿ±ŸäÿÆ",
          it: "Cronologia",
        },
        theory: {
          en: "Theoretical Probability: 50%",
          zh: "ÁêÜË´ñÊ¶ÇÁéá: 50%",
          ja: "ÁêÜË´ñÁöÑÁ¢∫Áéá: 50%",
          ko: "Ïù¥Î°†Ï†Å ÌôïÎ•†: 50%",
          es: "Probabilidad Te√≥rica: 50%",
          de: "Theoretische Wahrscheinlichkeit: 50%",
          fi: "Teoreettinen todenn√§k√∂isyys: 50%",
          fr: "Probabilit√© th√©orique: 50%",
          ar: "ÿßŸÑÿßÿ≠ÿ™ŸÖÿßŸÑ ÿßŸÑŸÜÿ∏ÿ±Ÿä: 50%",
          it: "Probabilit√† Teorica: 50%",
        },
      };

      const getText = (key, lang) => t[key]?.[lang] || t[key]?.["en"] || key;

      function App() {
        const [lang, setLang] = useState("zh");
        const [isFlipping, setIsFlipping] = useState(false);
        const [result, setResult] = useState(null); // 'heads' or 'tails'
        const [history, setHistory] = useState([]);
        const controls = useAnimation();

        const flipCoin = async () => {
          if (isFlipping) return;
          setIsFlipping(true);
          setResult(null);

          // Determine outcome
          const outcome = Math.random() > 0.5 ? "heads" : "tails";

          // Animate
          await controls.start({
            rotateX: [0, 720 + (outcome === "tails" ? 180 : 0)],
            y: [0, -200, 0],
            scale: [1, 1.5, 1],
            transition: { duration: 1, ease: "easeInOut" },
          });

          // Reset rotation but keep visual outcome (using mod 360 logic internally in css ideally, but here we snap)
          // For simplicity in this react-motion setup, we will just set the final state visually.
          // Actually, we need to reset the animation controls carefully or just rely on the 'outcome' state rendering.

          setResult(outcome);
          setHistory((prev) => [outcome, ...prev]);

          // Reset rotation for next flip slightly?
          controls.set({ rotateX: 0, y: 0, scale: 1 });

          setIsFlipping(false);
        };

        const headCount = history.filter((h) => h === "heads").length;
        const totalCount = history.length;
        const headPct =
          totalCount === 0 ? 0 : Math.round((headCount / totalCount) * 100);

        return (
          <div className="min-h-screen flex flex-col items-center p-4 font-sans bg-slate-900 text-white">
            <div className="w-full max-w-4xl flex justify-between items-center mb-8">
              <h1 className="text-4xl font-black text-amber-400 drop-shadow-[0_0_15px_rgba(251,191,36,0.5)]">
                ü™ô {getText("title", lang)}
              </h1>
              <div className="flex bg-slate-800/80 p-1.5 rounded-xl border border-white/10 flex-wrap justify-end gap-1 max-w-[50%]">
                {[
                  "zh",
                  "en",
                  "ja",
                  "ko",
                  "es",
                  "de",
                  "fi",
                  "fr",
                  "ar",
                  "it",
                ].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 rounded-lg font-bold text-xs uppercase transition-all ${
                      lang === l
                        ? "bg-amber-600 text-white shadow-lg scale-105"
                        : "text-slate-400 hover:text-white hover:bg-white/5"
                    }`}
                  >
                    {l}
                  </button>
                ))}
              </div>
            </div>

            <div className="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8">
              {/* Coin Section */}
              <div className="glass-panel p-8 rounded-3xl flex flex-col items-center justify-center min-h-[400px]">
                <div className="relative w-48 h-48 perspective-1000 mb-12">
                  <motion.div
                    className="w-full h-full relative preserve-3d"
                    animate={controls}
                  >
                    {/* Front (Heads) */}
                    <div
                      className={`absolute inset-0 backface-hidden rounded-full border-4 border-amber-600 bg-amber-400 shadow-[0_0_30px_rgba(251,191,36,0.5)] flex items-center justify-center`}
                    >
                      <div className="w-32 h-32 rounded-full border-2 border-amber-600/50 flex items-center justify-center">
                        <span className="text-5xl font-black text-amber-700/80">
                          Face
                        </span>
                      </div>
                    </div>

                    {/* Back (Tails) */}
                    <div
                      className={`absolute inset-0 backface-hidden rounded-full border-4 border-slate-400 bg-slate-200 shadow-[0_0_30px_rgba(148,163,184,0.5)] flex items-center justify-center rotate-x-180`}
                      style={{ transform: "rotateX(180deg)" }}
                    >
                      <div className="w-32 h-32 rounded-full border-2 border-slate-400/50 flex items-center justify-center">
                        <span className="text-5xl font-black text-slate-500/80">
                          $10
                        </span>
                      </div>
                    </div>
                  </motion.div>

                  {/* Outcome Label */}
                  {!isFlipping && result && (
                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      className={`absolute -bottom-16 left-0 right-0 text-center text-2xl font-black ${
                        result === "heads" ? "text-amber-400" : "text-slate-200"
                      }`}
                    >
                      {getText(result, lang)}
                    </motion.div>
                  )}
                </div>

                <button
                  onClick={flipCoin}
                  disabled={isFlipping}
                  className="px-8 py-4 bg-amber-500 hover:bg-amber-400 text-slate-900 rounded-full font-black text-xl shadow-lg transition-transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {isFlipping
                    ? getText("flipping", lang)
                    : getText("flip", lang)}
                </button>
              </div>

              {/* Stats Section */}
              <div className="flex flex-col gap-6">
                <div className="glass-panel p-6 rounded-3xl">
                  <h3 className="text-slate-400 font-bold uppercase mb-4">
                    {getText("stats", lang)}
                  </h3>
                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <div className="bg-amber-500/10 p-4 rounded-xl border border-amber-500/30 text-center">
                      <div className="text-amber-400 font-bold text-sm uppercase mb-1">
                        {getText("heads", lang)}
                      </div>
                      <div className="text-3xl font-black text-white">
                        {headCount}
                      </div>
                      <div className="text-xs text-amber-400/70 font-mono mt-1">
                        {headPct}%
                      </div>
                    </div>
                    <div className="bg-slate-500/10 p-4 rounded-xl border border-slate-500/30 text-center">
                      <div className="text-slate-300 font-bold text-sm uppercase mb-1">
                        {getText("tails", lang)}
                      </div>
                      <div className="text-3xl font-black text-white">
                        {totalCount - headCount}
                      </div>
                      <div className="text-xs text-slate-300/70 font-mono mt-1">
                        {totalCount > 0 ? 100 - headPct : 0}%
                      </div>
                    </div>
                  </div>

                  {/* Bar Chart */}
                  <div className="h-4 bg-slate-700 rounded-full overflow-hidden flex relative">
                    <motion.div
                      className="h-full bg-amber-500"
                      initial={{ width: "50%" }}
                      animate={{ width: `${headPct}%` }}
                      transition={{ duration: 0.5 }}
                    ></motion.div>
                    {/* Center Line for Theoretical 50% */}
                    <div className="absolute left-1/2 top-0 bottom-0 w-0.5 bg-white/50 -translate-x-1/2"></div>
                  </div>
                  <div className="text-center text-xs text-slate-500 mt-2 font-mono">
                    {getText("theory", lang)}
                  </div>
                </div>

                <div className="glass-panel p-6 rounded-3xl flex-1 max-h-[300px] overflow-hidden flex flex-col">
                  <h3 className="text-slate-400 font-bold uppercase mb-4">
                    {getText("history", lang)}
                  </h3>
                  <div className="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                    <div className="flex flex-wrap gap-2 content-start">
                      {history.map((h, i) => (
                        <div
                          key={totalCount - i}
                          className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs shadow-sm border border-black/20 ${
                            h === "heads"
                              ? "bg-amber-400 text-amber-900 border-amber-500"
                              : "bg-slate-300 text-slate-700 border-slate-400"
                          }`}
                        >
                          {h === "heads" ? "H" : "T"}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
