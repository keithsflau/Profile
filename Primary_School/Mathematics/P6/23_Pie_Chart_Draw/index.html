<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°å…­æ•¸å­¸ï¼šç¹ªè£½åœ“å½¢åœ– | Drawing Pie Charts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fce7f3 0%, #ec4899 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;
      function App() {
        // Data input
        const [data, setData] = useState([
          { name: "Red", val: 10, color: "#ef4444" },
          { name: "Blue", val: 20, color: "#3b82f6" },
          { name: "Green", val: 15, color: "#22c55e" },
        ]);

        const total = data.reduce((acc, cur) => acc + cur.val, 0);

        // Helper to calc angles
        let currentAngle = 0;
        const slices = data.map((d) => {
          const angle = (d.val / total) * 360;
          const start = currentAngle;
          const end = currentAngle + angle;
          currentAngle += angle;
          return { ...d, angle, start, end };
        });

        // SVG Path generator for arc
        const getPiePath = (cx, cy, r, startAngle, endAngle) => {
          // Convert to radians, subtract 90 deg to start top
          const start = ((startAngle - 90) * Math.PI) / 180;
          const end = ((endAngle - 90) * Math.PI) / 180;
          const x1 = cx + r * Math.cos(start);
          const y1 = cy + r * Math.sin(start);
          const x2 = cx + r * Math.cos(end);
          const y2 = cy + r * Math.sin(end);

          // Flag for large arcs (> 180 deg)
          const largeArc = endAngle - startAngle > 180 ? 1 : 0;

          if (Math.abs(endAngle - startAngle) >= 360) {
            return `M ${cx} ${cy - r} A ${r} ${r} 0 1 0 ${cx} ${
              cy + r
            } A ${r} ${r} 0 1 0 ${cx} ${cy - r}`;
          }

          return `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
        };

        const updateVal = (idx, newUserVal) => {
          const newData = [...data];
          newData[idx].val = parseInt(newUserVal) || 0;
          setData(newData);
        };

        return (
          <div className="min-h-screen p-8 flex flex-col items-center">
            <h1 className="text-5xl font-black text-pink-900 mb-2">
              ğŸ¥§ ç¹ªè£½åœ“å½¢åœ–
            </h1>
            <p className="text-xl text-pink-700 font-bold mb-8">
              Drawing Pie Charts
            </p>
            <div className="bg-white/90 backdrop-blur rounded-3xl p-8 shadow-2xl max-w-4xl w-full flex flex-col md:flex-row items-center gap-12">
              <div className="flex-1 w-full max-w-sm">
                <svg
                  viewBox="0 0 300 300"
                  className="w-full h-auto drop-shadow-xl"
                >
                  {total > 0 ? (
                    slices.map((s, i) => (
                      <g key={i}>
                        <path
                          d={getPiePath(150, 150, 140, s.start, s.end)}
                          fill={s.color}
                          stroke="white"
                          strokeWidth="2"
                          className="transition-all duration-500 hover:opacity-90"
                        />
                        {s.angle > 15 && (
                          <text
                            x={
                              150 +
                              90 *
                                Math.cos(
                                  ((s.start + s.angle / 2 - 90) * Math.PI) / 180
                                )
                            }
                            y={
                              150 +
                              90 *
                                Math.sin(
                                  ((s.start + s.angle / 2 - 90) * Math.PI) / 180
                                )
                            }
                            textAnchor="middle"
                            dominantBaseline="middle"
                            className="font-bold fill-white text-sm pointer-events-none drop-shadow-md"
                          >
                            {Math.round((s.val / total) * 100)}%
                          </text>
                        )}
                      </g>
                    ))
                  ) : (
                    <circle cx="150" cy="150" r="140" fill="#cbd5e1" />
                  )}
                  <circle cx="150" cy="150" r="5" fill="white" />
                </svg>
              </div>

              <div className="flex-1 w-full">
                <h3 className="text-2xl font-bold text-slate-700 mb-4">
                  è¼¸å…¥æ•¸æ“š Data Input
                </h3>
                <div className="space-y-4">
                  {data.map((d, i) => (
                    <div
                      key={i}
                      className="flex items-center gap-4 bg-slate-50 p-3 rounded-xl border border-slate-200"
                    >
                      <div
                        className="w-8 h-8 rounded-full shadow-sm"
                        style={{ backgroundColor: d.color }}
                      ></div>
                      <div className="flex-1 font-bold text-slate-700">
                        {d.name}
                      </div>
                      <input
                        type="number"
                        min="0"
                        value={d.val}
                        onChange={(e) => updateVal(i, e.target.value)}
                        className="w-20 p-2 text-center font-bold border-2 border-slate-300 rounded-lg focus:border-pink-400 outline-none"
                      />
                      <div className="text-slate-500 text-sm font-mono w-16 text-right">
                        {total > 0 ? ((d.val / total) * 360).toFixed(0) : 0}Â°
                      </div>
                    </div>
                  ))}

                  <div className="pt-4 border-t-2 border-slate-200 flex justify-between items-center font-bold text-lg text-slate-800">
                    <span>ç¸½è¨ˆ Total: {total}</span>
                    <span>360Â°</span>
                  </div>
                </div>

                <div className="mt-6 bg-pink-50 p-4 rounded-xl text-pink-800 text-sm border border-pink-100">
                  <p>ğŸ’¡ è¨ˆç®—åœ“å¿ƒè§’å…¬å¼:</p>
                  <p className="font-mono mt-1">(æ•¸å€¼ Ã· ç¸½å’Œ) Ã— 360Â°</p>
                </div>
              </div>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
