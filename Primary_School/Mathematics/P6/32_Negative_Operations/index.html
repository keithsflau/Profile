<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小六數學：負數運算 | Operations with Negatives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Outfit", "Noto Sans TC", sans-serif;
        background: #0f172a;
        color: white;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector } = window.MathI18n || {
        LanguageSelector: () => null,
      };

      const t = {
        title: {
          en: "Negative Operations",
          zh: "負數運算",
          ja: "負の数の計算",
          ko: "음수 연산",
          es: "Operaciones Negativas",
          de: "Negative Rechenoperationen",
          fi: "Negatiiviset laskutoimitukset",
          fr: "Opérations négatives",
          ar: "العمليات السالبة",
          it: "Operazioni Negative",
        },
        start: {
          en: "Start",
          zh: "開始",
          ja: "開始",
          ko: "시작",
          es: "Inicio",
          de: "Start",
          fi: "Alku",
          fr: "Début",
          ar: "بداية",
          it: "Inizio",
        },
        add: {
          en: "Add",
          zh: "加上",
          ja: "加える",
          ko: "더하기",
          es: "Añadir",
          de: "Hinzufügen",
          fi: "Lisää",
          fr: "Ajouter",
          ar: "إضافة",
          it: "Aggiungi",
        },
        result: {
          en: "Result",
          zh: "結果",
          ja: "結果",
          ko: "결과",
          es: "Resultado",
          de: "Ergebnis",
          fi: "Tulos",
          fr: "Résultat",
          ar: "نتيج",
          it: "Risultato",
        },
        tip: {
          en: "vector addition on the number line",
          zh: "數線上的向量加法",
          ja: "数直線上のベクトル加算",
          ko: "수직선에서의 벡터 덧셈",
          es: "adición vectorial en la recta numérica",
          de: "Vektoraddition auf der Zahlengeraden",
          fi: "vektoriyhteenlasku lukusuoralla",
          fr: "addition vectorielle sur la droite numérique",
          ar: "جمع المتجهات على خط الأعداد",
          it: "addizione vettoriale sulla retta numerica",
        },
      };

      const getText = (key, lang) => t[key]?.[lang] || t[key]?.["en"] || key;

      function App() {
        const [lang, setLang] = useState("zh");
        const [a, setA] = useState(3);
        const [b, setB] = useState(-5);
        const result = a + b;

        // Visual constants
        const RANGE = 20; // -10 to 10
        const WIDTH_PCT = 100;
        const UNIT_PCT = WIDTH_PCT / RANGE;
        const ZERO_OFFSET_PCT = 50;

        const getPos = (val) => ZERO_OFFSET_PCT + val * UNIT_PCT;
        const getWidth = (val) => Math.abs(val) * UNIT_PCT;

        return (
          <div className="min-h-screen flex flex-col items-center p-4 font-sans bg-slate-900 text-white">
            <div className="w-full max-w-5xl flex justify-between items-center mb-8">
              <h1 className="text-4xl font-black text-pink-400 drop-shadow-[0_0_15px_rgba(244,114,182,0.5)]">
                ✖️ {getText("title", lang)}
              </h1>
              <div className="flex bg-slate-800/80 p-1.5 rounded-xl border border-white/10 flex-wrap justify-end gap-1 max-w-[50%]">
                {[
                  "zh",
                  "en",
                  "ja",
                  "ko",
                  "es",
                  "de",
                  "fi",
                  "fr",
                  "ar",
                  "it",
                ].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 rounded-lg font-bold text-xs uppercase transition-all ${
                      lang === l
                        ? "bg-pink-600 text-white shadow-lg scale-105"
                        : "text-slate-400 hover:text-white hover:bg-white/5"
                    }`}
                  >
                    {l}
                  </button>
                ))}
              </div>
            </div>

            <div className="w-full max-w-5xl flex flex-col gap-12">
              {/* Math Expression Input */}
              <div className="glass-panel p-8 rounded-3xl flex justify-center items-center gap-4 text-4xl md:text-6xl font-black font-mono">
                <div className="flex flex-col items-center">
                  <span className="text-sm font-sans font-bold text-cyan-400 mb-2 uppercase tracking-wider">
                    {getText("start", lang)}
                  </span>
                  <input
                    type="number"
                    min="-8"
                    max="8"
                    value={a}
                    onChange={(e) => setA(parseInt(e.target.value) || 0)}
                    className="w-24 md:w-32 bg-slate-800 text-center text-cyan-400 rounded-xl border-2 border-cyan-500/30 focus:border-cyan-400 outline-none pb-2"
                  />
                </div>
                <div className="text-slate-500">+</div>
                <div className="flex flex-col items-center">
                  <span className="text-sm font-sans font-bold text-pink-400 mb-2 uppercase tracking-wider">
                    {getText("add", lang)}
                  </span>
                  <input
                    type="number"
                    min="-8"
                    max="8"
                    value={b}
                    onChange={(e) => setB(parseInt(e.target.value) || 0)}
                    className="w-24 md:w-32 bg-slate-800 text-center text-pink-400 rounded-xl border-2 border-pink-500/30 focus:border-pink-400 outline-none pb-2"
                  />
                </div>
                <div className="text-slate-500">=</div>
                <div className="flex flex-col items-center">
                  <span className="text-sm font-sans font-bold text-white mb-2 uppercase tracking-wider">
                    {getText("result", lang)}
                  </span>
                  <div className="w-24 md:w-32 text-center text-white pb-2 relative">
                    {result}
                    <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-1 bg-white rounded-full"></div>
                  </div>
                </div>
              </div>

              {/* Number Line Visualization */}
              <div className="glass-panel p-8 md:p-12 rounded-3xl relative min-h-[300px] flex items-center">
                <div className="w-full relative h-[200px]">
                  {/* Line */}
                  <div className="absolute top-1/2 left-0 right-0 h-1 bg-slate-600 rounded-full"></div>

                  {/* Ticks */}
                  {Array.from({ length: 21 }, (_, i) => i - 10).map((v) => (
                    <div
                      key={v}
                      className="absolute top-1/2 h-4 w-0.5 bg-slate-600 -translate-x-1/2"
                      style={{ left: `${getPos(v)}%` }}
                    >
                      <div
                        className={`absolute top-6 left-1/2 -translate-x-1/2 text-xs font-bold ${
                          v === 0 ? "text-white text-base" : "text-slate-500"
                        }`}
                      >
                        {v}
                      </div>
                    </div>
                  ))}

                  {/* Zero Marker */}
                  <div className="absolute top-1/2 left-1/2 w-0.5 h-8 bg-white -translate-y-1/2 -translate-x-1/2 z-10"></div>

                  {/* Vector A (Blue) */}
                  <motion.div
                    initial={false}
                    animate={{
                      left: `${a >= 0 ? 50 : 50 + a * UNIT_PCT}%`,
                      width: `${Math.abs(a) * UNIT_PCT}%`,
                    }}
                    className="absolute h-4 bg-cyan-500/50 border border-cyan-400 rounded-full flex items-center justify-center top-[35%]"
                    style={
                      {
                        // If negative, arrow points left. If positive, right.
                      }
                    }
                  >
                    {/* Arrow Head */}
                    <div
                      className={`absolute top-1/2 -translate-y-1/2 w-0 h-0 border-y-[6px] border-y-transparent ${
                        a >= 0
                          ? "border-l-[10px] border-l-cyan-400 -right-2"
                          : "border-r-[10px] border-r-cyan-400 -left-2"
                      }`}
                    ></div>
                    <span className="text-xs font-bold text-cyan-200 drop-shadow-md">
                      {a}
                    </span>
                  </motion.div>

                  {/* Vector B (Red) - Starts at end of A */}
                  <motion.div
                    initial={false}
                    animate={{
                      left: `${
                        50 + a * UNIT_PCT + (b >= 0 ? 0 : b * UNIT_PCT)
                      }%`,
                      width: `${Math.abs(b) * UNIT_PCT}%`,
                    }}
                    transition={{ delay: 0.2 }}
                    className="absolute h-4 bg-pink-500/50 border border-pink-400 rounded-full flex items-center justify-center top-[35%] mt-8" // shift down
                  >
                    {/* Dashed Line Connecting A-end to B-start */}
                    <div
                      className="absolute -top-8 w-px h-8 border-l border-dashed border-slate-400 left-0"
                      style={{ left: b >= 0 ? "0%" : "100%" }}
                    ></div>

                    {/* Arrow Head */}
                    <div
                      className={`absolute top-1/2 -translate-y-1/2 w-0 h-0 border-y-[6px] border-y-transparent ${
                        b >= 0
                          ? "border-l-[10px] border-l-pink-400 -right-2"
                          : "border-r-[10px] border-r-pink-400 -left-2"
                      }`}
                    ></div>
                    <span className="text-xs font-bold text-pink-200 drop-shadow-md">
                      {b > 0 ? "+" + b : b}
                    </span>
                  </motion.div>

                  {/* Result Point */}
                  <motion.div
                    animate={{ left: `${getPos(result)}%` }}
                    transition={{
                      type: "spring",
                      stiffness: 200,
                      damping: 20,
                      delay: 0.4,
                    }}
                    className="absolute top-1/2 w-6 h-6 bg-white rounded-full border-4 border-slate-900 shadow-[0_0_20px_white] -translate-x-1/2 -translate-y-1/2 z-20"
                  />
                </div>
              </div>

              <div className="text-center text-slate-500 font-bold uppercase tracking-widest text-sm">
                {getText("tip", lang)}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
