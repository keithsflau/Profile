<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÊï∏Â≠∏ÔºöÂä†Ê≥ïÂ§ß‰ΩúÊà∞ | Addition Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background-color: #fff7ed; /* Orange tint */
        background-image: radial-gradient(#ffedd5 10%, transparent 10%);
        background-size: 30px 30px;
      }
      .glossy-panel {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
      }
      .input-box {
        background: white;
        border: 2px solid #e2e8f0;
        text-align: center;
        font-weight: 900;
        color: #1e293b;
        transition: all 0.2s;
      }
      .input-box:focus {
        border-color: #f97316;
        transform: scale(1.05);
        outline: none;
        box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.1);
      }
      .carry-box {
        font-size: 0.8em;
        color: #ef4444;
        background: #fef2f2;
        border: 1px dashed #fca5a5;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const ShoppingCart = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <circle cx="8" cy="21" r="1" />
          <circle cx="19" cy="21" r="1" />
          <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" />
        </svg>
      );
      const Check = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M20 6 9 17l-5-5" />
        </svg>
      );
      const X = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M18 6 6 18" />
          <path d="m6 6 12 12" />
        </svg>
      );
      const Plus = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M5 12h14" />
          <path d="M12 5v14" />
        </svg>
      );

      const t = {
        title: {
          en: "Supermarket Shopping",
          zh: "Ë∂ÖÁ¥öÂ∏ÇÂ†¥Â§ßÊêúË≥º",
          ja: "„Çπ„Éº„Éë„Éº„Éû„Éº„Ç±„ÉÉ„Éà„Åß„ÅÆË≤∑„ÅÑÁâ©",
          ko: "ÏäàÌçºÎßàÏºì ÏáºÌïë",
          es: "Compras en el supermercado",
          de: "Supermarkt-Einkauf",
          fi: "Supermarket-ostokset",
          fr: "Achats au supermarch√©",
          ar: "ÿßŸÑÿ™ÿ≥ŸàŸÇ ŸÅŸä ÿßŸÑÿ≥Ÿàÿ®ÿ± ŸÖÿßÿ±ŸÉÿ™",
          it: "Spesa al supermercato",
        },
        product: {
          en: "Product",
          zh: "ÂïÜÂìÅ",
          ja: "ÂïÜÂìÅ",
          ko: "ÏÉÅÌíà",
          es: "Producto",
          de: "Produkt",
          fi: "Tuote",
          fr: "Produit",
          ar: "ŸÖŸÜÿ™ÿ¨",
          it: "Prodotto",
        },
        checkAnswer: {
          en: "Check Answer",
          zh: "Ê†∏Â∞çÁ≠îÊ°à",
          ja: "Á≠î„ÅàÂêà„Çè„Åõ",
          ko: "Ï†ïÎãµ ÌôïÏù∏",
          es: "Comprobar respuesta",
          de: "Antwort pr√ºfen",
          fi: "Tarkista vastaus",
          fr: "V√©rifier la r√©ponse",
          ar: "ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©",
          it: "Controlla la risposta",
        },
        correct: {
          en: "Correct! Total is",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅÁ∏ΩÊï∏ÊòØ",
          ja: "Ê≠£Ëß£ÔºÅÂêàË®à„ÅØ",
          ko: "Ï†ïÎãµ! Ìï©Í≥ÑÎäî",
          es: "¬°Correcto! El total es",
          de: "Richtig! Summe ist",
          fi: "Oikein! Yhteens√§",
          fr: "Correct ! Le total est",
          ar: "ÿµÿ≠Ÿäÿ≠! ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ŸáŸà",
          it: "Corretto! Il totale √®",
        },
        incorrect: {
          en: "Hmm... try again!",
          zh: "Âîî...ÂÜçÁÆóÁÆóÁúãÔºÅ",
          ja: "„ÅÜ„Éº„Çì...„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÔºÅ",
          ko: "Ïùå... Îã§Ïãú Ìï¥Î≥¥ÏÑ∏Ïöî!",
          es: "Mmm... ¬°int√©ntalo de nuevo!",
          de: "Hmm... versuch es nochmal!",
          fi: "Hmm... yrit√§ uudelleen!",
          fr: "Hmm... r√©essayez !",
          ar: "ŸáŸÖŸÖ... ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ!",
          it: "Hmm... riprova!",
        },
        next: {
          en: "Next",
          zh: "‰∏ã‰∏ÄÈ°å",
          ja: "Ê¨°„Å∏",
          ko: "Îã§Ïùå",
          es: "Siguiente",
          de: "Weiter",
          fi: "Seuraava",
          fr: "Suivant",
          ar: "ÿßŸÑÿ™ÿßŸÑŸä",
          it: "Avanti",
        },
        places: [
          { zh: "Ëê¨", en: "10k" },
          { zh: "ÂçÉ", en: "1k" },
          { zh: "Áôæ", en: "100" },
          { zh: "ÂçÅ", en: "10" },
          { zh: "ÂÄã", en: "1" },
        ],
      };

      const ITEMS = [
        {
          name: { zh: "ÈÅäÊà≤Ê©ü", en: "Console" },
          priceRange: [1500, 3500],
          icon: "üéÆ",
        },
        {
          name: { zh: "ÂñÆËªä", en: "Bicycle" },
          priceRange: [800, 2500],
          icon: "üö≤",
        },
        {
          name: { zh: "Êõ∏ÂåÖ", en: "School Bag" },
          priceRange: [200, 500],
          icon: "üéí",
        },
        {
          name: { zh: "Ê≥¢Èûã", en: "Sneakers" },
          priceRange: [300, 900],
          icon: "üëü",
        },
        {
          name: { zh: "ÊâãÈå∂", en: "Watch" },
          priceRange: [1000, 4000],
          icon: "‚åö",
        },
        {
          name: { zh: "Áµê‰ªñ", en: "Guitar" },
          priceRange: [1200, 3000],
          icon: "üé∏",
        },
        {
          name: { zh: "Âπ≥ÊùøÈõªËÖ¶", en: "Tablet" },
          priceRange: [2000, 5000],
          icon: "üì±",
        },
        {
          name: { zh: "Áé©ÂÖ∑Ê©üÊ¢∞‰∫∫", en: "Robot" },
          priceRange: [400, 1000],
          icon: "ü§ñ",
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [item1, setItem1] = useState(null);
        const [item2, setItem2] = useState(null);
        const [userInputs, setUserInputs] = useState(Array(5).fill(""));
        const [carries, setCarries] = useState(Array(4).fill(""));
        const [feedback, setFeedback] = useState(null);

        const generateQuestion = () => {
          const i1 = ITEMS[Math.floor(Math.random() * ITEMS.length)];
          let i2 = ITEMS[Math.floor(Math.random() * ITEMS.length)];
          while (i1 === i2)
            i2 = ITEMS[Math.floor(Math.random() * ITEMS.length)];

          const price1 =
            Math.floor(Math.random() * (i1.priceRange[1] - i1.priceRange[0])) +
            i1.priceRange[0];
          const price2 =
            Math.floor(Math.random() * (i2.priceRange[1] - i2.priceRange[0])) +
            i2.priceRange[0];

          setItem1({ ...i1, price: price1 });
          setItem2({ ...i2, price: price2 });
          setUserInputs(Array(5).fill(""));
          setCarries(Array(4).fill(""));
          setFeedback(null);
        };

        useEffect(() => {
          generateQuestion();
        }, []);

        if (!item1 || !item2) return null;

        const correctSum = item1.price + item2.price;
        const getDigit = (num, posFromRight) => {
          const str = num.toString();
          if (posFromRight >= str.length) return null;
          return str[str.length - 1 - posFromRight];
        };

        const checkAnswer = () => {
          let userString = userInputs.join("");
          if (parseInt(userString) === correctSum) {
            setFeedback("correct");
          } else {
            setFeedback("incorrect");
          }
        };

        const handleInput = (index, val) => {
          if (val.length > 1) val = val.slice(-1);
          const newInputs = [...userInputs];
          newInputs[index] = val;
          setUserInputs(newInputs);
        };

        const handleCarry = (index, val) => {
          if (val.length > 1) val = val.slice(-1);
          const newC = [...carries];
          newC[index] = val;
          setCarries(newC);
        };

        const getItemName = (item) => item.name[lang] || item.name["en"];

        return (
          <div className="min-h-screen p-4 flex flex-col items-center justify-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <header className="mb-8 text-center mt-8">
              <div className="inline-flex items-center gap-2 bg-white px-6 py-2 rounded-full shadow-sm mb-4">
                <ShoppingCart className="text-orange-500" size={20} />
                <span className="font-bold text-slate-600">
                  {t.title[lang] || t.title["en"]}
                </span>
              </div>
            </header>

            <div className="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8">
              <div className="flex flex-col gap-4">
                <div className="glossy-panel rounded-3xl p-6 flex items-center justify-between group cursor-default">
                  <div className="flex items-center gap-4">
                    <div className="text-5xl bg-orange-100 p-4 rounded-2xl group-hover:scale-110 transition-transform">
                      {item1.icon}
                    </div>
                    <div>
                      <div className="text-slate-500 font-bold">
                        {t.product[lang] || t.product["en"]} 1
                      </div>
                      <div className="text-2xl font-black text-slate-800">
                        {getItemName(item1)}
                      </div>
                    </div>
                  </div>
                  <div className="text-3xl font-black text-orange-600 bg-white/50 px-4 py-2 rounded-xl">
                    ${item1.price}
                  </div>
                </div>

                <div className="flex justify-center text-slate-400">
                  <Plus size={32} strokeWidth={4} />
                </div>

                <div className="glossy-panel rounded-3xl p-6 flex items-center justify-between group cursor-default">
                  <div className="flex items-center gap-4">
                    <div className="text-5xl bg-blue-100 p-4 rounded-2xl group-hover:scale-110 transition-transform">
                      {item2.icon}
                    </div>
                    <div>
                      <div className="text-slate-500 font-bold">
                        {t.product[lang] || t.product["en"]} 2
                      </div>
                      <div className="text-2xl font-black text-slate-800">
                        {getItemName(item2)}
                      </div>
                    </div>
                  </div>
                  <div className="text-3xl font-black text-orange-600 bg-white/50 px-4 py-2 rounded-xl">
                    ${item2.price}
                  </div>
                </div>
              </div>

              <div className="glossy-panel rounded-3xl p-8 flex flex-col items-center">
                <div className="w-full max-w-xs">
                  <div className="grid grid-cols-5 gap-2 text-center mb-2 text-slate-400 font-bold text-sm">
                    {t.places.map((p, i) => (
                      <div key={i}>{p[lang === "zh" ? "zh" : "en"]}</div>
                    ))}
                  </div>

                  <div className="grid grid-cols-5 gap-2 mb-2 h-8">
                    <div></div>
                    {[0, 1, 2, 3].map((i) => (
                      <input
                        key={i}
                        type="text"
                        inputMode="numeric"
                        className="carry-box w-full h-8 rounded-lg text-center font-bold"
                        maxLength="1"
                        value={carries[i]}
                        onChange={(e) => handleCarry(i, e.target.value)}
                      />
                    ))}
                  </div>

                  <div className="grid grid-cols-5 gap-2 mb-2 text-2xl font-black text-slate-700 font-mono">
                    <div className="col-span-1"></div>
                    {[3, 2, 1, 0].map((i) => (
                      <div
                        key={i}
                        className="flex items-center justify-center h-12 bg-white/30 rounded-lg"
                      >
                        {getDigit(item1.price, i)}
                      </div>
                    ))}
                  </div>

                  <div className="grid grid-cols-5 gap-2 mb-4 text-2xl font-black text-slate-700 font-mono relative">
                    <div className="absolute -left-6 top-2 text-slate-400">
                      +
                    </div>
                    <div className="col-span-1"></div>
                    {[3, 2, 1, 0].map((i) => (
                      <div
                        key={i}
                        className="flex items-center justify-center h-12 bg-white/30 rounded-lg"
                      >
                        {getDigit(item2.price, i)}
                      </div>
                    ))}
                  </div>

                  <div className="border-b-4 border-slate-300 mb-4"></div>

                  <div className="grid grid-cols-5 gap-2 mb-8">
                    {[0, 1, 2, 3, 4].map((idx) => (
                      <input
                        key={idx}
                        type="text"
                        inputMode="numeric"
                        maxLength="1"
                        className="input-box aspect-square rounded-xl text-2xl"
                        placeholder="?"
                        value={userInputs[idx]}
                        onChange={(e) => handleInput(idx, e.target.value)}
                      />
                    ))}
                  </div>

                  <button
                    onClick={checkAnswer}
                    className="w-full py-4 bg-orange-500 hover:bg-orange-600 text-white rounded-2xl font-bold text-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2"
                  >
                    <Check strokeWidth={3} />{" "}
                    {t.checkAnswer[lang] || t.checkAnswer["en"]}
                  </button>

                  {feedback === "correct" && (
                    <motion.div
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="mt-4 w-full bg-green-100 text-green-700 p-4 rounded-xl font-bold flex flex-col items-center gap-2"
                    >
                      <div className="flex items-center gap-2">
                        <Check /> {t.correct[lang] || t.correct["en"]} $
                        {correctSum}
                      </div>
                      <button
                        onClick={generateQuestion}
                        className="px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700"
                      >
                        {t.next[lang] || t.next["en"]}
                      </button>
                    </motion.div>
                  )}

                  {feedback === "incorrect" && (
                    <motion.div
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="mt-4 w-full bg-red-100 text-red-700 p-4 rounded-xl font-bold flex items-center justify-center gap-2"
                    >
                      <X /> {t.incorrect[lang] || t.incorrect["en"]}
                    </motion.div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
