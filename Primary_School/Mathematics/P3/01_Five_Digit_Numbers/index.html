<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小三數學：五位數的認識</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background-color: #f0fdf4; /* Light Mint */
        background-image: radial-gradient(#dcfce7 10%, transparent 10%);
        background-size: 30px 30px;
      }
      .bead {
        box-shadow: inset -2px -2px 6px rgba(0, 0, 0, 0.2),
          inset 2px 2px 6px rgba(255, 255, 255, 0.4);
      }
      .glossy-panel {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const { motion, AnimatePresence } = window.Motion;

      // Inline Icons to replace Lucide
      const Trophy = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
          <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
          <path d="M4 22h16" />
          <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
          <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
          <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
        </svg>
      );

      const ArrowRight = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M5 12h14" />
          <path d="m12 5 7 7-7 7" />
        </svg>
      );

      const CheckCircle = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
          <path d="m9 11 3 3L22 4" />
        </svg>
      );

      const XCircle = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <circle cx="12" cy="12" r="10" />
          <path d="m15 9-6 6" />
          <path d="m9 9 6 6" />
        </svg>
      );

      const RefreshCw = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
          <path d="M21 3v5h-5" />
          <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
          <path d="M8 16H3v5" />
        </svg>
      );

      const HelpCircle = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <circle cx="12" cy="12" r="10" />
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
          <path d="M12 17h.01" />
        </svg>
      );

      // Sound Effects (Simulated with simple oscillators if real files not avail, or just UI feedback)
      // For simplicity, we'll use visual feedback mostly, maybe simple synth beeps later if requested.

      const PLACES = [
        {
          label: "萬",
          value: 10000,
          color: "bg-red-400",
          border: "border-red-500",
          text: "text-red-600",
        },
        {
          label: "千",
          value: 1000,
          color: "bg-orange-400",
          border: "border-orange-500",
          text: "text-orange-600",
        },
        {
          label: "百",
          value: 100,
          color: "bg-yellow-400",
          border: "border-yellow-500",
          text: "text-yellow-600",
        },
        {
          label: "十",
          value: 10,
          color: "bg-green-400",
          border: "border-green-500",
          text: "text-green-600",
        },
        {
          label: "個",
          value: 1,
          color: "bg-blue-400",
          border: "border-blue-500",
          text: "text-blue-600",
        },
      ];

      function App() {
        const [mode, setMode] = useState("explore"); // explore, challenge_build, challenge_read
        const [beads, setBeads] = useState([0, 0, 0, 0, 0]); // [Wan, Qian, Bai, Shi, Ge]
        const [targetNumber, setTargetNumber] = useState(0);
        const [userAnswer, setUserAnswer] = useState("");
        const [feedback, setFeedback] = useState(null); // 'correct', 'incorrect', null
        const [score, setScore] = useState(0);

        const MAX_BEADS = 9;

        const currentNumber = beads.reduce((acc, count, index) => {
          return acc + count * PLACES[index].value;
        }, 0);

        // Helpers
        const numberToChinese = (num) => {
          // Simplified converter for demo purposes
          // Real implementation would handle zeros (零) correctly which is tricky in Chinese
          // For P3, we act as a "Magic Helper"
          const units = ["", "十", "百", "千", "萬"];
          const chars = [
            "零",
            "一",
            "二",
            "三",
            "四",
            "五",
            "六",
            "七",
            "八",
            "九",
          ];

          let str = num.toString();
          let len = str.length;
          let result = "";
          let zeroFlag = false; // To handle consecutive zeros

          // 20005 -> 二萬零五
          // 20050 -> 二萬零五十

          // Keep it simple map for P3 level (no complex 'Yi' etc)
          // We'll use a basic logic: iterate from highest place

          if (num === 0) return "零";

          let tempNum = num;
          let placeIndex = 0;
          let finalStr = "";

          // Decompose
          let parts = []; // [wan, qian, bai, shi, ge]
          let temp = num;
          for (let i = 0; i < 5; i++) {
            // 10000, 1000, 100, 10, 1
            // Logic:
            // 40502
            // 4 -> 万
            // 0 -> 千
            // 5 -> 百
            // 0 -> 十
            // 2 -> 个
            //
            // Reading: 四萬零五百零二
            //
            // Standard HK Reading Rules:
            // Within a number, any zero or group of zeros is read as a single "ling".
            // Trailing zeros are not read.
          }

          // Let's rely on standard Arabic for identifying, and maybe a simple map for Challenge instructions.
          // For "Challenge Build", we give Arabic for now to ensure accuracy, or simple Chinese.
          return num.toLocaleString("zh-HK-u-nu-hanidec");
        };

        const generateTarget = () => {
          // Generate random 5 digit number (10000 - 99999) or simpler for P3 start
          let newBeads = [
            Math.floor(Math.random() * 9) + 1, // 1-9 for Wan
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
          ];
          let val = newBeads.reduce(
            (acc, c, i) => acc + c * PLACES[i].value,
            0
          );
          setTargetNumber(val);
          setBeads([0, 0, 0, 0, 0]); // Reset board for user to build
          setFeedback(null);
          setUserAnswer("");
          return val;
        };

        const generateReadTarget = () => {
          let newBeads = [
            Math.floor(Math.random() * 9) + 1,
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
          ];
          setBeads(newBeads);
          let val = newBeads.reduce(
            (acc, c, i) => acc + c * PLACES[i].value,
            0
          );
          setTargetNumber(val);
          setFeedback(null);
          setUserAnswer("");
        };

        const addBead = (index) => {
          if (beads[index] < MAX_BEADS) {
            const newBeads = [...beads];
            newBeads[index]++;
            setBeads(newBeads);
            checkRealtime(newBeads);
          }
        };

        const removeBead = (index) => {
          if (beads[index] > 0) {
            const newBeads = [...beads];
            newBeads[index]--;
            setBeads(newBeads);
            checkRealtime(newBeads);
          }
        };

        const checkRealtime = (currentBeads) => {
          if (mode === "challenge_build") {
            const val = currentBeads.reduce(
              (acc, c, i) => acc + c * PLACES[i].value,
              0
            );
            if (val === targetNumber) {
              setFeedback("correct");
            } else {
              setFeedback(null);
            }
          }
        };

        const submitReadAnswer = () => {
          if (parseInt(userAnswer) === targetNumber) {
            setFeedback("correct");
            setScore((s) => s + 10);
          } else {
            setFeedback("incorrect");
          }
        };

        const nextQuestion = () => {
          setFeedback(null);
          if (mode === "challenge_build") generateTarget();
          if (mode === "challenge_read") generateReadTarget();
        };

        useEffect(() => {
          // Initialize
          if (mode === "challenge_build") generateTarget();
          if (mode === "challenge_read") generateReadTarget();
          if (mode === "explore") {
            setBeads([1, 2, 3, 4, 5]); // Demo pattern
          }
        }, [mode]);

        return (
          <div className="min-h-screen p-4 md:p-8 flex flex-col items-center max-w-6xl mx-auto">
            {/* Header */}
            <header className="w-full flex justify-between items-center mb-6 pl-4 pr-4">
              <div className="flex items-center gap-4">
                <div className="p-3 bg-white rounded-2xl shadow-lg text-blue-500">
                  <Trophy size={32} />
                </div>
                <div>
                  <h1 className="text-2xl md:text-3xl font-black text-slate-800 tracking-tight">
                    五位數的認識
                  </h1>
                  <p className="text-slate-500 font-medium">小三數學單元一</p>
                </div>
              </div>

              <div className="flex gap-2">
                <button
                  onClick={() => setMode("explore")}
                  className={`px-4 py-2 rounded-xl font-bold transition-all ${
                    mode === "explore"
                      ? "bg-blue-500 text-white shadow-lg scale-105"
                      : "bg-white text-slate-600 hover:bg-slate-50"
                  }`}
                >
                  探索
                </button>
                <button
                  onClick={() => setMode("challenge_build")}
                  className={`px-4 py-2 rounded-xl font-bold transition-all ${
                    mode === "challenge_build"
                      ? "bg-purple-500 text-white shadow-lg scale-105"
                      : "bg-white text-slate-600 hover:bg-slate-50"
                  }`}
                >
                  砌數挑戰
                </button>
                <button
                  onClick={() => setMode("challenge_read")}
                  className={`px-4 py-2 rounded-xl font-bold transition-all ${
                    mode === "challenge_read"
                      ? "bg-indigo-500 text-white shadow-lg scale-105"
                      : "bg-white text-slate-600 hover:bg-slate-50"
                  }`}
                >
                  讀數挑戰
                </button>
              </div>
            </header>

            {/* Main Content Area */}
            <main className="w-full grid grid-cols-1 lg:grid-cols-12 gap-6">
              {/* Abacus / Visualization Board */}
              <div className="lg:col-span-8 glossy-panel rounded-3xl p-6 md:p-8 relative overflow-hidden flex flex-col items-center justify-center min-h-[500px]">
                {/* Instruction / Target Display */}
                <div className="absolute top-6 left-0 right-0 text-center">
                  {mode === "explore" && (
                    <div className="inline-block bg-white/80 px-6 py-2 rounded-full backdrop-blur text-slate-600 font-bold border border-white">
                      試著點擊上下箭頭來改變算珠數量！
                    </div>
                  )}
                  {mode === "challenge_build" && (
                    <div className="flex flex-col items-center gap-2">
                      <div className="text-slate-500 font-bold">
                        請在算盤上砌出：
                      </div>
                      <div className="text-4xl font-black text-purple-600 tracking-widest">
                        {targetNumber.toLocaleString()}
                      </div>
                    </div>
                  )}
                  {mode === "challenge_read" && (
                    <div className="text-slate-500 font-bold">
                      請寫出算盤上的數值：
                    </div>
                  )}
                </div>

                {/* The Abacus Columns */}
                <div className="flex justify-center items-end gap-2 md:gap-6 mt-16 w-full max-w-2xl">
                  {PLACES.map((place, index) => (
                    <div
                      key={place.label}
                      className="flex flex-col items-center gap-3 flex-1"
                    >
                      {/* Bead Stack */}
                      <div className="relative w-12 md:w-16 h-64 bg-slate-100/50 rounded-full border-2 border-slate-200 flex flex-col-reverse justify-start items-center p-1 overflow-hidden group">
                        {/* Guide Lines */}
                        <div className="absolute inset-0 flex flex-col justify-end pointer-events-none opacity-20">
                          {[...Array(MAX_BEADS)].map((_, i) => (
                            <div
                              key={i}
                              className="h-6 w-full border-t border-slate-400"
                            ></div>
                          ))}
                        </div>

                        {/* Beads */}
                        <AnimatePresence>
                          {[...Array(beads[index])].map((_, i) => (
                            <motion.div
                              key={i}
                              initial={{ y: -200, opacity: 0, scale: 0.5 }}
                              animate={{ y: 0, opacity: 1, scale: 1 }}
                              exit={{ scale: 0, opacity: 0 }}
                              transition={{
                                type: "spring",
                                stiffness: 300,
                                damping: 20,
                              }}
                              className={`w-full aspect-[5/2] rounded-2xl ${place.color} bead mb-1 border-2 border-white/30`}
                            />
                          ))}
                        </AnimatePresence>
                      </div>

                      {/* Controls */}
                      {mode !== "challenge_read" && (
                        <div className="flex flex-col gap-1 w-full">
                          <button
                            onClick={() => addBead(index)}
                            className="w-full py-2 bg-white rounded-xl shadow-sm border border-slate-100 hover:bg-green-50 text-green-600 flex justify-center transition-colors disabled:opacity-50"
                            disabled={beads[index] >= MAX_BEADS}
                          >
                            <div className="w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-[8px] border-b-current"></div>
                          </button>
                          <button
                            onClick={() => removeBead(index)}
                            className="w-full py-2 bg-white rounded-xl shadow-sm border border-slate-100 hover:bg-red-50 text-red-600 flex justify-center transition-colors disabled:opacity-50"
                            disabled={beads[index] <= 0}
                          >
                            <div className="w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[8px] border-t-current"></div>
                          </button>
                        </div>
                      )}

                      {/* Label */}
                      <div
                        className={`mt-2 font-black text-xl md:text-2xl ${place.text} bg-white px-4 py-2 rounded-xl shadow-sm border ${place.border}`}
                      >
                        {place.label}
                      </div>

                      {/* Digit Display (Only in Explore/Build) */}
                      {(mode === "explore" || mode === "challenge_build") && (
                        <div className="font-bold text-3xl text-slate-700">
                          {beads[index]}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>

              {/* Sidebar / Interaction Panel */}
              <div className="lg:col-span-4 flex flex-col gap-6">
                {/* Current Number Display (Explore Mode) */}
                {mode === "explore" && (
                  <div className="glossy-panel rounded-3xl p-6 text-center transform hover:scale-[1.02] transition-transform">
                    <div className="text-slate-500 font-bold mb-2">
                      當前數值
                    </div>
                    <div className="text-5xl font-black text-slate-800 tracking-tighter mb-2">
                      {currentNumber.toLocaleString()}
                    </div>
                    <div className="inline-block bg-blue-100 text-blue-700 px-4 py-1 rounded-full font-bold">
                      {/* Simple dummy text for visual completeness */}
                      五位數
                    </div>
                  </div>
                )}

                {/* Challenge Controls */}
                {(mode === "challenge_build" || mode === "challenge_read") && (
                  <div className="glossy-panel rounded-3xl p-6 flex flex-col gap-4">
                    <div className="flex justify-between items-center mb-2">
                      <span className="font-bold text-slate-500">當前得分</span>
                      <span className="font-black text-2xl text-yellow-500 flex items-center gap-1">
                        <Trophy size={20} className="fill-current" /> {score}
                      </span>
                    </div>

                    {mode === "challenge_read" && (
                      <div className="flex gap-2">
                        <input
                          type="number"
                          value={userAnswer}
                          onChange={(e) => setUserAnswer(e.target.value)}
                          placeholder="輸入數值..."
                          className="flex-1 px-4 py-3 rounded-xl border-2 border-indigo-100 focus:border-indigo-400 outline-none font-bold text-xl text-center"
                          onKeyDown={(e) =>
                            e.key === "Enter" && submitReadAnswer()
                          }
                        />
                        <button
                          onClick={submitReadAnswer}
                          className="bg-indigo-500 text-white px-4 rounded-xl font-bold hover:bg-indigo-600"
                        >
                          確認
                        </button>
                      </div>
                    )}

                    {feedback === "correct" && (
                      <motion.div
                        initial={{ scale: 0.8, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="bg-green-100 text-green-700 p-4 rounded-2xl font-bold flex items-center justify-center gap-2"
                      >
                        <CheckCircle /> 答對了！太棒了！
                      </motion.div>
                    )}

                    {feedback === "incorrect" && (
                      <motion.div
                        initial={{ scale: 0.8, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        className="bg-red-100 text-red-700 p-4 rounded-2xl font-bold flex items-center justify-center gap-2"
                      >
                        <XCircle /> 再試一次吧！
                      </motion.div>
                    )}

                    {feedback === "correct" && (
                      <button
                        onClick={nextQuestion}
                        className="w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 shadow-lg flex items-center justify-center gap-2 animation-pulse"
                      >
                        下一題 <ArrowRight size={20} />
                      </button>
                    )}

                    {feedback !== "correct" && (
                      <button
                        onClick={nextQuestion}
                        className="w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-bold hover:bg-slate-200 flex items-center justify-center gap-2"
                      >
                        <RefreshCw size={18} /> 跳過题目
                      </button>
                    )}
                  </div>
                )}

                {/* Helper Tips */}
                <div className="glossy-panel rounded-3xl p-6 bg-yellow-50/50 border-yellow-200">
                  <div className="flex items-start gap-3">
                    <div className="p-2 bg-yellow-100 text-yellow-600 rounded-lg shrink-0">
                      <HelpCircle size={20} />
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800 mb-1">小貼士</h3>
                      <p className="text-sm text-slate-600 leading-relaxed">
                        五位數是由「萬、千、百、十、個」五個數位組成的。每個數位上的珠子代表不同的數值哦！
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」 耶利米書 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
