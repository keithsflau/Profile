<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÊï∏Â≠∏ÔºöÈÄôÊòØ‰∏ÄÂÄãÂ•ΩÁé©ÁöÑÊ∑∑ÂêàÈÅãÁÆó | Mixed Operations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #f472b6 0%, #db2777 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Mixed Operations",
          zh: "ÂõõÂâáÊ∑∑ÂêàÈÅãÁÆó",
          ja: "ÂõõÂâáÊºîÁÆó",
          ko: "ÌòºÌï© Ïó∞ÏÇ∞",
          es: "Operaciones mixtas",
          de: "Gemischte Operationen",
          fi: "Sekalaskut",
          fr: "Op√©rations mixtes",
          ar: "ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑÿ∑ÿ©",
          it: "Operazioni miste",
        },
        step1: {
          en: "Step 1",
          zh: "Ê≠•È©ü‰∏Ä",
          ja: "„Çπ„ÉÜ„ÉÉ„Éó 1",
          ko: "Îã®Í≥Ñ 1",
          es: "Paso 1",
          de: "Schritt 1",
          fi: "Vaihe 1",
          fr: "√âtape 1",
          ar: "ÿßŸÑÿÆÿ∑Ÿàÿ© 1",
          it: "Passo 1",
        },
        finalAnswer: {
          en: "Final Answer",
          zh: "ÊúÄÁµÇÁ≠îÊ°à",
          ja: "ÊúÄÁµÇÁ≠î„Åà",
          ko: "ÏµúÏ¢Ö Ï†ïÎãµ",
          es: "Respuesta final",
          de: "Endergebnis",
          fi: "Lopullinen vastaus",
          fr: "R√©ponse finale",
          ar: "ÿßŸÑÿ¨Ÿàÿßÿ® ÿßŸÑŸÜŸáÿßÿ¶Ÿä",
          it: "Risposta finale",
        },
        remaining: {
          en: "Remaining: ",
          zh: "Ââ©È§òÁÆóÂºèÔºö",
          ja: "ÊÆã„Çä: ",
          ko: "ÎÇ®ÏùÄ Ïãù: ",
          es: "Restante: ",
          de: "Verbleibend: ",
          fi: "J√§ljell√§: ",
          fr: "Restant : ",
          ar: "ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ",
          it: "Rimanente: ",
        },
        nextStep: {
          en: "Next Step",
          zh: "‰∏ã‰∏ÄÊ≠•",
          ja: "Ê¨°„Å∏",
          ko: "Îã§Ïùå Îã®Í≥Ñ",
          es: "Siguiente",
          de: "Weiter",
          fi: "Seuraava",
          fr: "Suivant",
          ar: "ÿßŸÑÿ™ÿßŸÑŸä",
          it: "Avanti",
        },
        newQuestion: {
          en: "New Question",
          zh: "Êñ∞È°åÁõÆ",
          ja: "Êñ∞„Åó„ÅÑÂïèÈ°å",
          ko: "ÏÉà Î¨∏Ï†ú",
          es: "Nueva pregunta",
          de: "Neue Frage",
          fi: "Uusi kysymys",
          fr: "Nouvelle question",
          ar: "ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ",
          it: "Nuova domanda",
        },
        tip: {
          en: "üí° Tip: BODMAS Rule - Brackets first, then Multiply/Divide, then Add/Subtract!",
          zh: "üí° Ë®òÂæóÂè£Ë®£ÔºöÂÖà‰πòÈô§ÔºåÂæåÂä†Ê∏õÔºåÊúâÊã¨ËôüÂÖàÁÆóÊã¨ËôüÔºÅ",
          ja: "üí° „Éí„É≥„Éà: Êã¨Âºß„ÅåÂÖà„ÄÅÊ¨°„Å´Êéõ„ÅëÁÆó/Ââ≤„ÇäÁÆó„ÄÅÊúÄÂæå„Å´Ë∂≥„ÅóÁÆó/Âºï„ÅçÁÆóÔºÅ",
          ko: "üí° ÌåÅ: Í¥ÑÌò∏ Î®ºÏ†Ä, Í∑∏ Îã§Ïùå Í≥±ÌïòÍ∏∞/ÎÇòÎàÑÍ∏∞, ÎßàÏßÄÎßâÏúºÎ°ú ÎçîÌïòÍ∏∞/ÎπºÍ∏∞!",
          es: "üí° Consejo: ¬°Par√©ntesis primero, luego multiplica/divide, despu√©s suma/resta!",
          de: "üí° Tipp: Klammern zuerst, dann Punkt- vor Strichrechnung!",
          fi: "üí° Vinkki: Sulut ensin, sitten kerto/jako, lopuksi yhteen/v√§hennys!",
          fr: "üí° Astuce : Parenth√®ses d'abord, puis Mult/Div, enfin Add/Soust !",
          ar: "üí° ÿ™ŸÑŸÖŸäÿ≠: ÿßŸÑÿ£ŸÇŸàÿßÿ≥ ÿ£ŸàŸÑÿßŸãÿå ÿ´ŸÖ ÿßŸÑÿ∂ÿ±ÿ®/ÿßŸÑŸÇÿ≥ŸÖÿ©ÿå ÿ´ŸÖ ÿßŸÑÿ¨ŸÖÿπ/ÿßŸÑÿ∑ÿ±ÿ≠!",
          it: "üí° Suggerimento: Prima le parentesi, poi Moltiplica/Dividi, infine Aggiungi/Sottrai!",
        },
        explanations: {
          bracket: {
            en: "Calculate brackets first: {exp}",
            zh: "ÂÖàË®àÁÆóÊã¨ËôüÂÖßÁöÑÔºö{exp}",
            ja: "Êã¨ÂºßÂÜÖ„ÇíÂÖà„Å´Ë®àÁÆó: {exp}",
            ko: "Í¥ÑÌò∏ ÏïàÏùÑ Î®ºÏ†Ä Í≥ÑÏÇ∞: {exp}",
            es: "Calcular par√©ntesis primero: {exp}",
            de: "Klammern zuerst berechnen: {exp}",
            fi: "Laske sulut ensin: {exp}",
            fr: "Calculer les parenth√®ses d'abord : {exp}",
            ar: "ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ£ŸÇŸàÿßÿ≥ ÿ£ŸàŸÑÿßŸã: {exp}",
            it: "Calcola prima le parentesi: {exp}",
          },
          md: {
            en: "Multiply/Divide before Add/Subtract: {exp}",
            zh: "ÂÖà‰πòÈô§ÂæåÂä†Ê∏õÔºö{exp}",
            ja: "Ë∂≥„ÅóÁÆó/Âºï„ÅçÁÆó„ÅÆÂâç„Å´Êéõ„ÅëÁÆó/Ââ≤„ÇäÁÆó: {exp}",
            ko: "ÎçîÌïòÍ∏∞/ÎπºÍ∏∞ Ï†ÑÏóê Í≥±ÌïòÍ∏∞/ÎÇòÎàÑÍ∏∞: {exp}",
            es: "Mult/Div antes de Sumar/Restar: {exp}",
            de: "Punkt vor Strich: {exp}",
            fi: "Kerto/Jako ennen Yhteen/V√§hennyst√§: {exp}",
            fr: "Mult/Div avant Add/Soust : {exp}",
            ar: "ÿßŸÑÿ∂ÿ±ÿ®/ÿßŸÑŸÇÿ≥ŸÖÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ¨ŸÖÿπ/ÿßŸÑÿ∑ÿ±ÿ≠: {exp}",
            it: "Molt/Div prima di Agg/Sott: {exp}",
          },
          lr: {
            en: "Calculate from Left to Right: {exp}",
            zh: "Áî±Â∑¶Ëá≥Âè≥Ë®àÁÆóÔºö{exp}",
            ja: "Â∑¶„Åã„ÇâÂè≥„Å∏Ë®àÁÆó: {exp}",
            ko: "ÏôºÏ™ΩÏóêÏÑú Ïò§Î•∏Ï™ΩÏúºÎ°ú Í≥ÑÏÇ∞: {exp}",
            es: "Calcular de izquierda a derecha: {exp}",
            de: "Von links nach rechts berechnen: {exp}",
            fi: "Laske vasemmalta oikealle: {exp}",
            fr: "Calculer de gauche √† droite : {exp}",
            ar: "ÿ≠ÿ≥ÿßÿ® ŸÖŸÜ ÿßŸÑŸäÿ≥ÿßÿ± ÿ•ŸÑŸâ ÿßŸÑŸäŸÖŸäŸÜ: {exp}",
            it: "Calcola da sinistra a destra: {exp}",
          },
        },
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [step, setStep] = useState(0);
        const [q, setQ] = useState({
          n1: 5,
          n2: 3,
          n3: 2,
          op1: "+",
          op2: "√ó",
          hasBracket: false,
        });

        const generate = () => {
          const ops = ["+", "-", "√ó"];
          const o1 = ops[Math.floor(Math.random() * 3)];
          const o2 = ops[Math.floor(Math.random() * 3)];
          const n1 = Math.floor(Math.random() * 10) + 2;
          const n2 = Math.floor(Math.random() * 10) + 2;
          const n3 = Math.floor(Math.random() * 5) + 2;
          const bracket = Math.random() > 0.7;
          setQ({ n1, n2, n3, op1: o1, op2: o2, hasBracket: bracket });
          setStep(0);
        };

        let step1Val, finalVal, explanationKey, expStr;

        if (q.hasBracket) {
          const inside = eval(`${q.n1} ${q.op1.replace("√ó", "*")} ${q.n2}`);
          step1Val = inside;
          finalVal = eval(`${inside} ${q.op2.replace("√ó", "*")} ${q.n3}`);
          explanationKey = "bracket";
          expStr = `${q.n1} ${q.op1} ${q.n2} = ${inside}`;
        } else {
          const p1 = q.op1 === "√ó";
          const p2 = q.op2 === "√ó";

          if (p1 && !p2) {
            step1Val = q.n1 * q.n2;
            finalVal = eval(`${step1Val} ${q.op2.replace("√ó", "*")} ${q.n3}`);
            explanationKey = "md";
            expStr = `${q.n1} √ó ${q.n2} = ${step1Val}`;
          } else if (!p1 && p2) {
            step1Val = q.n2 * q.n3;
            finalVal = eval(`${q.n1} ${q.op1.replace("√ó", "*")} ${step1Val}`);
            explanationKey = "md";
            expStr = `${q.n2} √ó ${q.n3} = ${step1Val}`;
          } else {
            step1Val = eval(`${q.n1} ${q.op1.replace("√ó", "*")} ${q.n2}`);
            finalVal = eval(`${step1Val} ${q.op2.replace("√ó", "*")} ${q.n3}`);
            explanationKey = "lr";
            expStr = `${q.n1} ${q.op1} ${q.n2} = ${step1Val}`;
          }
        }

        const getExplanation = () =>
          (
            t.explanations[explanationKey][lang] ||
            t.explanations[explanationKey]["en"]
          ).replace("{exp}", expStr);

        return (
          <div className="min-h-screen p-8 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-6xl font-black text-white mb-8 mt-8 drop-shadow-lg text-center">
              üî¢ {t.title[lang] || t.title["en"]}
            </h1>

            <div className="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl max-w-4xl w-full text-center">
              <div className="flex justify-center items-center gap-2 md:gap-4 text-3xl md:text-5xl font-black text-slate-800 mb-12 h-32 flex-wrap">
                {q.hasBracket && <span className="text-pink-500">(</span>}
                <span>{q.n1}</span>
                <span className="text-pink-600">{q.op1}</span>
                <span>{q.n2}</span>
                {q.hasBracket && <span className="text-pink-500">)</span>}
                <span className="text-pink-600">{q.op2}</span>
                <span>{q.n3}</span>
                <span>=</span>
                <span>?</span>
              </div>

              <div className="space-y-4 min-h-[200px]">
                <AnimatePresence mode="wait">
                  {step >= 1 && (
                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="bg-yellow-100 p-6 rounded-2xl border-l-8 border-yellow-400 text-left"
                    >
                      <div className="text-lg font-bold text-yellow-800 mb-2">
                        {t.step1[lang] || t.step1["en"]}
                      </div>
                      <div className="text-xl md:text-2xl font-bold text-slate-800">
                        {getExplanation()}
                      </div>
                      <div className="mt-2 text-slate-500">
                        {t.remaining[lang] || t.remaining["en"]}
                        {q.hasBracket ||
                        (q.op1 === "√ó" && q.op2 !== "√ó") ||
                        (q.op1 !== "√ó" && q.op2 !== "√ó")
                          ? `${step1Val} ${q.op2} ${q.n3}`
                          : `${q.n1} ${q.op1} ${step1Val}`}
                      </div>
                    </motion.div>
                  )}
                  {step >= 2 && (
                    <motion.div
                      initial={{ opacity: 0, scale: 0.9 }}
                      animate={{ opacity: 1, scale: 1 }}
                      transition={{ delay: 0.3 }}
                      className="bg-green-100 p-6 rounded-2xl border-l-8 border-green-500 text-left"
                    >
                      <div className="text-lg font-bold text-green-800 mb-2">
                        {t.finalAnswer[lang] || t.finalAnswer["en"]}
                      </div>
                      <div className="text-4xl font-black text-green-600">
                        {finalVal}
                      </div>
                    </motion.div>
                  )}
                </AnimatePresence>
              </div>

              <div className="mt-12 flex gap-4 justify-center">
                <button
                  onClick={() => setStep((s) => Math.min(2, s + 1))}
                  disabled={step >= 2}
                  className={`px-8 py-4 rounded-xl font-black text-xl transition-all ${
                    step >= 2
                      ? "bg-slate-200 text-slate-400"
                      : "bg-pink-500 text-white hover:bg-pink-600 shadow-lg hover:scale-105"
                  }`}
                >
                  {t.nextStep[lang] || t.nextStep["en"]}
                </button>
                <button
                  onClick={generate}
                  className="px-8 py-4 bg-slate-800 text-white rounded-xl font-black text-xl hover:bg-slate-700 shadow-lg transition-all"
                >
                  {t.newQuestion[lang] || t.newQuestion["en"]}
                </button>
              </div>

              <div className="mt-6 text-slate-500 font-bold text-sm md:text-base">
                {t.tip[lang] || t.tip["en"]}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
