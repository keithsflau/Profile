<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°å››æ•¸å­¸ï¼šåˆ†æ•¸æ¢ç´¢æ¨‚åœ’ | Fraction Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .fraction-line {
        height: 3px;
        background: currentColor;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Fraction Explorer",
          zh: "åˆ†æ•¸æ¢ç´¢æ¨‚åœ’",
          ja: "åˆ†æ•°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼",
          ko: "ë¶„ìˆ˜ íƒí—˜ê°€",
          es: "Explorador de Fracciones",
          de: "Bruchforscher",
          fi: "Murtolukututkika",
          fr: "Explorateur de fractions",
          ar: "Ù…Ø³ØªÙƒØ´Ù Ø§Ù„ÙƒØ³ÙˆØ±",
          it: "Esploratore di frazioni",
        },
        header: {
          en: "P4 Math",
          zh: "å°å››æ•¸å­¸",
          ja: "å°4ç®—æ•°",
          ko: "ì´ˆ4 ìˆ˜í•™",
          es: "MatemÃ¡ticas P4",
          de: "Mathe 4. Klasse",
          fi: "4. luokan matematiikka",
          fr: "Maths P4",
          ar: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù„Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹",
          it: "Matematica 4a elementare",
        },
        subtitle: {
          en: "Visual Learning",
          zh: "å¯è¦–åŒ–åˆ†æ•¸å­¸ç¿’",
          ja: "è¦–è¦šçš„å­¦ç¿’",
          ko: "ì‹œê°ì  í•™ìŠµ",
          es: "Aprendizaje visual",
          de: "Visuelles Lernen",
          fi: "Visuaalinen oppiminen",
          fr: "Apprentissage visuel",
          ar: "Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¨ØµØ±ÙŠ",
          it: "Apprendimento visivo",
        },
        simplified: {
          en: "Simplified",
          zh: "æœ€ç°¡åˆ†æ•¸",
          ja: "ç°¡ç´„åˆ†æ•°",
          ko: "ê¸°ì•½ë¶„ìˆ˜",
          es: "Simplificado",
          de: "Vereinfacht",
          fi: "Yksinkertaistettu",
          fr: "SimplifiÃ©",
          ar: "Ù…Ø¨Ø³Ø·",
          it: "Semplificato",
        },
        circle: {
          en: "Circle",
          zh: "åœ“å½¢",
          ja: "å††",
          ko: "ì›",
          es: "CÃ­rculo",
          de: "Kreis",
          fi: "YmpyrÃ¤",
          fr: "Cercle",
          ar: "Ø¯Ø§Ø¦Ø±Ø©",
          it: "Cerchio",
        },
        rectangle: {
          en: "Grid",
          zh: "æ–¹æ ¼",
          ja: "ã‚°ãƒªãƒƒãƒ‰",
          ko: "ê·¸ë¦¬ë“œ",
          es: "CuadrÃ­cula",
          de: "Gitter",
          fi: "Ruudukko",
          fr: "Grille",
          ar: "Ø´Ø¨ÙƒØ©",
          it: "Griglia",
        },
        strip: {
          en: "Strip",
          zh: "é•·æ¢",
          ja: "å¸¯",
          ko: "ë ",
          es: "Tira",
          de: "Streifen",
          fi: "Kaistale",
          fr: "Bande",
          ar: "Ø´Ø±ÙŠØ·",
          it: "Striscia",
        },
        decimal: {
          en: "Decimal",
          zh: "å°æ•¸",
          ja: "å°æ•°",
          ko: "ì†Œìˆ˜",
          es: "Decimal",
          de: "Dezimal",
          fi: "Desimaali",
          fr: "DÃ©cimal",
          ar: "Ø¹Ø´Ø±ÙŠ",
          it: "Decimale",
        },
        percentage: {
          en: "Percentage",
          zh: "ç™¾åˆ†æ¯”",
          ja: "ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸",
          ko: "ë°±ë¶„ìœ¨",
          es: "Porcentaje",
          de: "Prozentsatz",
          fi: "Prosenttiosuus",
          fr: "Pourcentage",
          ar: "Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©",
          it: "Percentuale",
        },
        adjust: {
          en: "Adjust Fraction",
          zh: "èª¿æ•´åˆ†æ•¸",
          ja: "åˆ†æ•°ã‚’èª¿æ•´",
          ko: "ë¶„ìˆ˜ ì¡°ì •",
          es: "Ajustar fracciÃ³n",
          de: "Bruch anpassen",
          fi: "SÃ¤Ã¤dÃ¤ murtolukua",
          fr: "Ajuster la fraction",
          ar: "Ø¶Ø¨Ø· Ø§Ù„ÙƒØ³Ø±",
          it: "Regola frazione",
        },
        numerator: {
          en: "Numerator (Used)",
          zh: "åˆ†å­ (å·²ç”¨éƒ¨åˆ†)",
          ja: "åˆ†å­ (ä½¿ç”¨æ¸ˆã¿)",
          ko: "ë¶„ì (ì‚¬ìš©ë¨)",
          es: "Numerador (Usado)",
          de: "ZÃ¤hler (Verwendet)",
          fi: "Osoittaja (KÃ¤ytetty)",
          fr: "NumÃ©rateur (UtilisÃ©)",
          ar: "Ø§Ù„Ø¨Ø³Ø· (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)",
          it: "Numeratore (Usato)",
        },
        denominator: {
          en: "Denominator (Total)",
          zh: "åˆ†æ¯ (ç¸½å…±å¹¾ä»½)",
          ja: "åˆ†æ¯ (åˆè¨ˆ)",
          ko: "ë¶„ëª¨ (ì´)",
          es: "Denominador (Total)",
          de: "Nenner (Gesamt)",
          fi: "NimittÃ¤jÃ¤ (YhteensÃ¤)",
          fr: "DÃ©nominateur (Total)",
          ar: "Ø§Ù„Ù…Ù‚Ø§Ù… (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)",
          it: "Denominatore (Totale)",
        },
        knowledge: {
          en: "Fraction Facts",
          zh: "åˆ†æ•¸çŸ¥è­˜",
          ja: "åˆ†æ•°ã®çŸ¥è­˜",
          ko: "ë¶„ìˆ˜ ì§€ì‹",
          es: "Datos de fracciones",
          de: "Fakten zu BrÃ¼chen",
          fi: "Murtolukutietoa",
          fr: "Faits sur les fractions",
          ar: "Ø­Ù‚Ø§Ø¦Ù‚ Ø§Ù„ÙƒØ³ÙˆØ±",
          it: "Fatti sulle frazioni",
        },
        factNum: {
          en: "Numerator: Top number, parts taken",
          zh: "åˆ†å­ï¼šåˆ†æ•¸ç·šä¸Šé¢çš„æ•¸å­—ï¼Œä»£è¡¨å–äº†å¹¾ä»½",
          ja: "åˆ†å­ï¼šä¸Šã®æ•°å­—ã€å–ã‚‰ã‚ŒãŸéƒ¨åˆ†",
          ko: "ë¶„ì: ìœ„ìª½ ìˆ«ì, ì·¨í•œ ë¶€ë¶„",
          es: "Numerador: NÃºmero superior, partes tomadas",
          de: "ZÃ¤hler: Obere Zahl, genommene Teile",
          fi: "Osoittaja: Ylempi luku, otetut osat",
          fr: "NumÃ©rateur : Nombre du haut, parties prises",
          ar: "Ø§Ù„Ø¨Ø³Ø·: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠØŒ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø£Ø®ÙˆØ°Ø©",
          it: "Numeratore: Numero superiore, parti prese",
        },
        factDen: {
          en: "Denominator: Bottom number, total parts",
          zh: "åˆ†æ¯ï¼šåˆ†æ•¸ç·šä¸‹é¢çš„æ•¸å­—ï¼Œä»£è¡¨ç¸½å…±åˆ†æˆå¹¾ä»½",
          ja: "åˆ†æ¯ï¼šä¸‹ã®æ•°å­—ã€åˆè¨ˆéƒ¨åˆ†",
          ko: "ë¶„ëª¨: ì•„ë˜ìª½ ìˆ«ì, ì´ ë¶€ë¶„",
          es: "Denominador: NÃºmero inferior, partes totales",
          de: "Nenner: Untere Zahl, Gesamtteile",
          fi: "NimittÃ¤jÃ¤: Alempi luku, kokonaisosat",
          fr: "DÃ©nominateur : Nombre du bas, parties totales",
          ar: "Ø§Ù„Ù…Ù‚Ø§Ù…: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³ÙÙ„ÙŠØŒ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ÙƒÙ„ÙŠØ©",
          it: "Denominatore: Numero inferiore, parti totali",
        },
        factProper: {
          en: "Proper Fraction: Numerator < Denominator",
          zh: "çœŸåˆ†æ•¸ï¼šåˆ†å­ < åˆ†æ¯",
          ja: "çœŸåˆ†æ•°ï¼šåˆ†å­ < åˆ†æ¯",
          ko: "ì§„ë¶„ìˆ˜: ë¶„ì < ë¶„ëª¨",
          es: "FracciÃ³n propia: Numerador < Denominador",
          de: "Echter Bruch: ZÃ¤hler < Nenner",
          fi: "Aito murtoluku: Osoittaja < NimittÃ¤jÃ¤",
          fr: "Fraction propre : NumÃ©rateur < DÃ©nominateur",
          ar: "ÙƒØ³Ø± Ø­Ù‚ÙŠÙ‚ÙŠ: Ø§Ù„Ø¨Ø³Ø· < Ø§Ù„Ù…Ù‚Ø§Ù…",
          it: "Frazione propria: Numeratore < Denominatore",
        },
        factImproper: {
          en: "Improper Fraction: Numerator â‰¥ Denominator",
          zh: "å‡åˆ†æ•¸ï¼šåˆ†å­ â‰¥ åˆ†æ¯",
          ja: "ä»®åˆ†æ•°ï¼šåˆ†å­ â‰¥ åˆ†æ¯",
          ko: "ê°€ë¶„ìˆ˜: ë¶„ì â‰¥ ë¶„ëª¨",
          es: "FracciÃ³n impropia: Numerador â‰¥ Denominador",
          de: "Unechter Bruch: ZÃ¤hler â‰¥ Nenner",
          fi: "EpÃ¤aito murtoluku: Osoittaja â‰¥ NimittÃ¤jÃ¤",
          fr: "Fraction impropre : NumÃ©rateur â‰¥ DÃ©nominateur",
          ar: "ÙƒØ³Ø± ØºÙŠØ± Ø­Ù‚ÙŠÙ‚ÙŠ: Ø§Ù„Ø¨Ø³Ø· â‰¥ Ø§Ù„Ù…Ù‚Ø§Ù…",
          it: "Frazione impropria: Numeratore â‰¥ Denominatore",
        },
      };

      const PieChart = ({ size = 24, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M21.21 15.89A10 10 0 1 1 8 2.83" />
          <path d="M22 12A10 10 0 0 0 12 2v10z" />
        </svg>
      );

      function App() {
        const [lang, setLang] = useState("zh");
        const [numerator, setNumerator] = useState(1);
        const [denominator, setDenominator] = useState(4);
        const [shape, setShape] = useState("circle"); // circle, rectangle, strip

        const MAX_PARTS = 12;

        const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));
        const simplify = (num, den) => {
          const divisor = gcd(num, den);
          return { num: num / divisor, den: den / divisor };
        };

        const simplified = simplify(numerator, denominator);
        const decimal = (numerator / denominator).toFixed(3);
        const percentage = ((numerator / denominator) * 100).toFixed(1);

        const renderCircle = () => {
          const anglePerPart = 360 / denominator;
          const parts = [];

          return (
            <div className="relative w-64 h-64 mx-auto">
              <svg
                className="absolute inset-0 w-full h-full"
                viewBox="0 0 200 200"
              >
                {[...Array(denominator)].map((_, i) => {
                  const angle = (360 / denominator) * i;
                  const x1 = 100;
                  const y1 = 100;
                  const x2 =
                    100 + 100 * Math.cos(((angle - 90) * Math.PI) / 180);
                  const y2 =
                    100 + 100 * Math.sin(((angle - 90) * Math.PI) / 180);
                  const isFilled = i < numerator;

                  const largeArcFlag = 360 / denominator > 180 ? 1 : 0;
                  const x3 =
                    100 +
                    100 *
                      Math.cos(
                        ((angle - 90 + 360 / denominator) * Math.PI) / 180
                      );
                  const y3 =
                    100 +
                    100 *
                      Math.sin(
                        ((angle - 90 + 360 / denominator) * Math.PI) / 180
                      );

                  // Handle full circle case
                  if (denominator === 1) {
                    return (
                      <motion.circle
                        key={i}
                        cx="100"
                        cy="100"
                        r="100"
                        fill={isFilled ? "#fbbf24" : "#ffffff40"}
                        stroke="white"
                        strokeWidth="2"
                        initial={{ opacity: 0, scale: 0 }}
                        animate={{ opacity: 1, scale: 1 }}
                      />
                    );
                  }

                  return (
                    <motion.path
                      key={i}
                      d={`M ${x1} ${y1} L ${x2} ${y2} A 100 100 0 ${largeArcFlag} 1 ${x3} ${y3} Z`}
                      fill={isFilled ? "#fbbf24" : "#ffffff40"}
                      stroke="white"
                      strokeWidth="2"
                      initial={{ opacity: 0, scale: 0 }}
                      animate={{ opacity: 1, scale: 1 }}
                      transition={{ delay: i * 0.05 }}
                    />
                  );
                })}
              </svg>
            </div>
          );
        };

        const renderRectangle = () => {
          const cols = Math.ceil(Math.sqrt(denominator));
          const rows = Math.ceil(denominator / cols);

          return (
            <div
              className="grid gap-2 w-full max-w-md mx-auto"
              style={{ gridTemplateColumns: `repeat(${cols}, 1fr)` }}
            >
              {[...Array(denominator)].map((_, i) => (
                <motion.div
                  key={i}
                  className={`aspect-square rounded-lg border-2 border-white ${
                    i < numerator ? "bg-yellow-400" : "bg-white/30"
                  }`}
                  initial={{ opacity: 0, scale: 0 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: i * 0.03 }}
                />
              ))}
            </div>
          );
        };

        const renderStrip = () => {
          return (
            <div className="w-full max-w-2xl mx-auto">
              <div
                className="grid gap-1"
                style={{ gridTemplateColumns: `repeat(${denominator}, 1fr)` }}
              >
                {[...Array(denominator)].map((_, i) => (
                  <motion.div
                    key={i}
                    className={`h-24 rounded-lg border-2 border-white ${
                      i < numerator ? "bg-yellow-400" : "bg-white/30"
                    }`}
                    initial={{ opacity: 0, scaleX: 0 }}
                    animate={{ opacity: 1, scaleX: 1 }}
                    transition={{ delay: i * 0.05 }}
                  />
                ))}
              </div>
            </div>
          );
        };

        const getText = (key) => t[key][lang] || t[key]["en"];

        return (
          <div className="min-h-screen p-8 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <header className="text-center mb-8 mt-8">
              <div className="inline-flex items-center gap-3 bg-white/20 backdrop-blur-md px-6 py-3 rounded-full mb-4">
                <PieChart className="text-white" size={24} />
                <span className="text-white font-bold text-lg">
                  {getText("header")}
                </span>
              </div>
              <h1 className="text-4xl md:text-6xl font-black text-white mb-2 tracking-tight">
                {getText("title")}
              </h1>
              <p className="text-xl text-white/80 font-medium">
                {getText("subtitle")}
              </p>
            </header>

            <main className="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-8">
              {/* Visualization Area */}
              <div className="lg:col-span-8 bg-white/95 backdrop-blur-md rounded-3xl p-8 shadow-2xl">
                {/* Fraction Display */}
                <div className="text-center mb-8">
                  <div className="inline-flex flex-col items-center justify-center text-slate-800">
                    <div className="text-6xl font-black">{numerator}</div>
                    <div className="fraction-line my-2"></div>
                    <div className="text-6xl font-black">{denominator}</div>
                  </div>
                  {simplified.num !== numerator && (
                    <div className="mt-4 text-2xl font-bold text-purple-600">
                      = {simplified.num}/{simplified.den}{" "}
                      <span className="text-lg">({getText("simplified")})</span>
                    </div>
                  )}
                </div>

                {/* Shape Selector */}
                <div className="flex justify-center gap-4 mb-8 flex-wrap">
                  <button
                    onClick={() => setShape("circle")}
                    className={`px-6 py-3 rounded-2xl font-bold transition-all ${
                      shape === "circle"
                        ? "bg-purple-600 text-white shadow-lg"
                        : "bg-white/50 text-slate-700"
                    }`}
                  >
                    {getText("circle")}
                  </button>
                  <button
                    onClick={() => setShape("rectangle")}
                    className={`px-6 py-3 rounded-2xl font-bold transition-all ${
                      shape === "rectangle"
                        ? "bg-purple-600 text-white shadow-lg"
                        : "bg-white/50 text-slate-700"
                    }`}
                  >
                    {getText("rectangle")}
                  </button>
                  <button
                    onClick={() => setShape("strip")}
                    className={`px-6 py-3 rounded-2xl font-bold transition-all ${
                      shape === "strip"
                        ? "bg-purple-600 text-white shadow-lg"
                        : "bg-white/50 text-slate-700"
                    }`}
                  >
                    {getText("strip")}
                  </button>
                </div>

                {/* Visual Representation */}
                <div className="min-h-[300px] flex items-center justify-center py-8">
                  {shape === "circle" && renderCircle()}
                  {shape === "rectangle" && renderRectangle()}
                  {shape === "strip" && renderStrip()}
                </div>

                {/* Info Panel */}
                <div className="grid grid-cols-2 gap-4 mt-8">
                  <div className="bg-blue-50 rounded-2xl p-4 text-center">
                    <div className="text-sm font-bold text-slate-600 mb-1">
                      {getText("decimal")}
                    </div>
                    <div className="text-3xl font-black text-blue-600">
                      {decimal}
                    </div>
                  </div>
                  <div className="bg-green-50 rounded-2xl p-4 text-center">
                    <div className="text-sm font-bold text-slate-600 mb-1">
                      {getText("percentage")}
                    </div>
                    <div className="text-3xl font-black text-green-600">
                      {percentage}%
                    </div>
                  </div>
                </div>
              </div>

              {/* Control Panel */}
              <div className="lg:col-span-4 flex flex-col gap-6">
                <div className="bg-white/95 backdrop-blur-md rounded-3xl p-6 shadow-lg">
                  <h3 className="text-xl font-black text-purple-600 mb-4">
                    {getText("adjust")}
                  </h3>

                  <div className="mb-6">
                    <label className="block text-sm font-bold text-slate-600 mb-2">
                      {getText("numerator")}
                    </label>
                    <input
                      type="range"
                      min="0"
                      max={denominator}
                      value={numerator}
                      onChange={(e) => setNumerator(parseInt(e.target.value))}
                      className="w-full"
                    />
                    <div className="text-4xl font-black text-center text-slate-800 mt-2">
                      {numerator}
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-bold text-slate-600 mb-2">
                      {getText("denominator")}
                    </label>
                    <input
                      type="range"
                      min="1"
                      max={MAX_PARTS}
                      value={denominator}
                      onChange={(e) => {
                        const newDen = parseInt(e.target.value);
                        setDenominator(newDen);
                        if (numerator > newDen) setNumerator(newDen);
                      }}
                      className="w-full"
                    />
                    <div className="text-4xl font-black text-center text-slate-800 mt-2">
                      {denominator}
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-2">
                    <button
                      onClick={() => {
                        setNumerator(1);
                        setDenominator(2);
                      }}
                      className="py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl font-bold text-sm transition-all"
                    >
                      1/2
                    </button>
                    <button
                      onClick={() => {
                        setNumerator(1);
                        setDenominator(4);
                      }}
                      className="py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl font-bold text-sm transition-all"
                    >
                      1/4
                    </button>
                    <button
                      onClick={() => {
                        setNumerator(3);
                        setDenominator(4);
                      }}
                      className="py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl font-bold text-sm transition-all"
                    >
                      3/4
                    </button>
                    <button
                      onClick={() => {
                        setNumerator(1);
                        setDenominator(3);
                      }}
                      className="py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl font-bold text-sm transition-all"
                    >
                      1/3
                    </button>
                  </div>
                </div>

                <div className="bg-white/95 backdrop-blur-md rounded-3xl p-6 shadow-lg">
                  <h3 className="text-lg font-black text-slate-800 mb-3 flex items-center gap-2">
                    ğŸ’¡ {getText("knowledge")}
                  </h3>
                  <div className="text-sm text-slate-600 leading-relaxed space-y-2">
                    <p>
                      <strong>{getText("factNum")}</strong>
                    </p>
                    <p>
                      <strong>{getText("factDen")}</strong>
                    </p>
                    <p>
                      <strong>{getText("factProper")}</strong>
                    </p>
                    <p>
                      <strong>{getText("factImproper")}</strong>
                    </p>
                  </div>
                </div>
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
