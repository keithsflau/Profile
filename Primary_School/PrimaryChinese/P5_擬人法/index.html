<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°äº”ä¸­æ–‡ç§‘ï¼šæ“¬äººæ³•å¤§å¸«ç­ | Elite Personification Masterclass</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Outfit:wght@400;600;800&family=Noto+Serif+TC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Noto Sans TC"', '"Outfit"', "sans-serif"],
              serif: ['"Noto Serif TC"', "serif"],
            },
            colors: {
              brand: {
                dark: "#1A202C",
                primary: "#6C63FF",
                secondary: "#FF6584",
                accent: "#38A3A5",
                glass: "rgba(255, 255, 255, 0.1)",
                glassBorder: "rgba(255, 255, 255, 0.2)",
                text: "#F7FAFC",
                muted: "#A0AEC0",
              },
            },
            backgroundImage: {
              mesh: "radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%)",
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #0f172a;
        background-image: radial-gradient(
            at 0% 0%,
            rgba(108, 99, 255, 0.3) 0,
            transparent 50%
          ),
          radial-gradient(
            at 100% 100%,
            rgba(255, 101, 132, 0.3) 0,
            transparent 50%
          ),
          url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4wNSkiLz48L3N2Zz4=");
        background-attachment: fixed;
        color: #f7fafc;
      }

      .glass-panel {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      .glass-btn {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0)
        );
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        transition: all 0.3s ease;
      }

      .glass-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 12px 40px 0 rgba(108, 99, 255, 0.4);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .text-glow {
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }

      .option-choice {
        cursor: pointer;
        transition: all 0.2s;
      }
      .option-choice:hover {
        background-color: rgba(108, 99, 255, 0.2);
        border-color: #6c63ff;
      }
      .option-choice.selected {
        background-color: #6c63ff;
        border-color: #6c63ff;
        color: white;
      }
      .option-choice.correct {
        background-color: #10b981 !important; /* Green */
        border-color: #10b981 !important;
      }
      .option-choice.wrong {
        background-color: #ef4444 !important; /* Red */
        border-color: #ef4444 !important;
      }

      .highlight-phrase {
        border-bottom: 2px dashed #ff6584;
        cursor: help;
      }

      /* Custom Audio Player Styles */
      .speaking {
        animation: ring 2s infinite;
      }
      @keyframes ring {
        0% {
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
        }
      }

      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </head>
  <body class="h-screen w-screen overflow-hidden flex flex-col items-center">
    <!-- Top Navigation -->
    <header
      class="w-full glass-panel z-50 px-6 py-4 flex justify-between items-center border-b border-white/10"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center shadow-lg shadow-brand-primary/30"
        >
          <i class="fa-solid fa-feather-pointed text-white text-lg"></i>
        </div>
        <div>
          <h1 class="text-xl font-bold tracking-wide">æ“¬äººæ³•å¤§å¸«ç­</h1>
          <p class="text-xs text-brand-muted tracking-widest uppercase">
            Elite Personification Masterclass
          </p>
        </div>
      </div>

      <div class="flex items-center gap-6">
        <div
          class="hidden md:flex items-center gap-2 px-4 py-1.5 rounded-full bg-black/20 border border-white/5"
        >
          <i class="fa-solid fa-star text-brand-secondary"></i>
          <span class="font-bold text-lg" id="score-display">0</span>
          <span class="text-xs text-gray-400">XP</span>
        </div>

        <!-- Global Audio Control -->
        <button
          onclick="toggleGlobalMute()"
          class="w-10 h-10 rounded-full glass-btn flex items-center justify-center hover:text-brand-primary"
          title="é–‹å•Ÿ/é—œé–‰éŸ³æ•ˆ"
        >
          <i class="fa-solid fa-volume-high" id="global-mute-icon"></i>
        </button>
      </div>
    </header>

    <!-- Main Workspace -->
    <div class="flex-grow w-full max-w-7xl flex overflow-hidden relative">
      <!-- Sidebar Navigation -->
      <nav
        class="w-64 glass-panel border-r border-white/10 hidden md:flex flex-col p-4 gap-2 z-40"
      >
        <div
          class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 pl-2"
        >
          èª²ç¨‹å°èˆª
        </div>

        <button
          onclick="gotoSection('intro')"
          class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-left border border-transparent hover:border-white/10 relative overflow-hidden"
          data-id="intro"
        >
          <div
            class="w-8 h-8 rounded-lg bg-blue-500/20 text-blue-400 flex items-center justify-center group-hover:scale-110 transition"
          >
            <i class="fa-solid fa-lightbulb"></i>
          </div>
          <div class="flex-grow">
            <div class="font-bold text-sm">æ¦‚å¿µç²¾ç ”</div>
            <div class="text-xs text-gray-500">ä»€éº¼æ˜¯æ“¬äººç™¼ï¼Ÿ</div>
          </div>
        </button>

        <button
          onclick="gotoSection('quiz')"
          class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-left border border-transparent hover:border-white/10"
          data-id="quiz"
        >
          <div
            class="w-8 h-8 rounded-lg bg-purple-500/20 text-purple-400 flex items-center justify-center group-hover:scale-110 transition"
          >
            <i class="fa-solid fa-puzzle-piece"></i>
          </div>
          <div class="flex-grow">
            <div class="font-bold text-sm">è¾¨ææŒ‘æˆ°</div>
            <div class="text-xs text-gray-500">æ“¬äºº vs æ¯”å–»</div>
          </div>
        </button>

        <button
          onclick="gotoSection('reading')"
          class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-left border border-transparent hover:border-white/10"
          data-id="reading"
        >
          <div
            class="w-8 h-8 rounded-lg bg-green-500/20 text-green-400 flex items-center justify-center group-hover:scale-110 transition"
          >
            <i class="fa-solid fa-book-open-reader"></i>
          </div>
          <div class="flex-grow">
            <div class="font-bold text-sm">é–±æ–‡è³æ</div>
            <div class="text-xs text-gray-500">æ·±åº¦é•·æ–‡ç†è§£</div>
          </div>
        </button>

        <button
          onclick="gotoSection('writing')"
          class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5 text-left border border-transparent hover:border-white/10"
          data-id="writing"
        >
          <div
            class="w-8 h-8 rounded-lg bg-pink-500/20 text-pink-400 flex items-center justify-center group-hover:scale-110 transition"
          >
            <i class="fa-solid fa-pen-nib"></i>
          </div>
          <div class="flex-grow">
            <div class="font-bold text-sm">å¦™ç­†ç”ŸèŠ±</div>
            <div class="text-xs text-gray-500">å¯¦æˆ°å¯«ä½œæŠ€å·§</div>
          </div>
        </button>

        <div
          class="mt-auto p-4 rounded-xl bg-gradient-to-br from-white/5 to-transparent border border-white/5"
        >
          <div class="text-xs text-gray-400 mb-2">å­¸ç¿’é€²åº¦</div>
          <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
            <div
              id="progress-bar"
              class="h-full bg-gradient-to-r from-brand-primary to-brand-secondary w-0 transition-all duration-500"
            ></div>
          </div>
          <div class="text-right text-xs mt-1 text-gray-300">
            <span id="progress-text">0</span>%
          </div>
        </div>
      </nav>

      <!-- Content Area -->
      <main
        class="flex-grow relative overflow-y-auto overflow-x-hidden p-6 md:p-10 scrollbar-hide"
        id="main-content"
      >
        <!-- SECTION: INTRO (Theory) -->
        <div
          id="section-intro"
          class="section-content w-full max-w-4xl mx-auto space-y-12 pb-20 fade-in"
        >
          <!-- Hero -->
          <div class="text-center space-y-4 mb-16">
            <span
              class="px-4 py-1.5 rounded-full border border-blue-400/30 bg-blue-500/10 text-blue-300 text-xs font-bold tracking-widest uppercase"
              >Chapter 1</span
            >
            <h2
              class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-400"
            >
              è³¦äºˆè¬ç‰©éˆé­‚çš„é­”æ³•
            </h2>
            <p class="text-lg text-gray-300 max-w-2xl mx-auto leading-relaxed">
              ã€Œæ“¬äººæ³•ã€ä¸åªæ˜¯è®“å‹•ç‰©èªªè©±ï¼Œè€Œæ˜¯å°‡äººé¡çš„<span
                class="text-white font-bold underline decoration-pink-500 decoration-2"
                >æƒ…æ„Ÿã€æ€§æ ¼ã€æ„å¿—</span
              >æŠ•å°„åœ¨ç„¡ç”Ÿå‘½çš„äº‹ç‰©ä¸Šï¼Œè®“è®€è€…ç”¢ç”Ÿå¼·çƒˆçš„å…±é³´ã€‚
            </p>
          </div>

          <!-- Concept Cards -->
          <div class="grid md:grid-cols-3 gap-6">
            <div
              class="glass-panel p-6 rounded-2xl hover:bg-white/5 transition duration-300 group"
            >
              <div
                class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mb-4 text-xl shadow-lg shadow-blue-500/40 group-hover:scale-110 transition"
              >
                ğŸƒ
              </div>
              <h3 class="text-xl font-bold mb-2">æ“¬å‹•ä½œ (Action)</h3>
              <p class="text-sm text-gray-400 leading-relaxed mb-4">
                è³¦äºˆäº‹ç‰©äººçš„å‹•ä½œã€‚
              </p>
              <div
                class="bg-black/30 p-3 rounded-lg text-sm border-l-2 border-blue-400"
              >
                <span class="text-gray-500 block text-xs mb-1">ä¾‹å¥ï¼š</span>
                é¢¨å…’<span class="text-blue-300 font-bold">è·‘</span
                >éè‰åŸï¼Œèˆ‡å°è‰<span class="text-blue-300 font-bold">æ¡æ‰‹</span
                >ã€‚
              </div>
            </div>

            <div
              class="glass-panel p-6 rounded-2xl hover:bg-white/5 transition duration-300 group"
            >
              <div
                class="w-12 h-12 bg-pink-500 rounded-full flex items-center justify-center mb-4 text-xl shadow-lg shadow-pink-500/40 group-hover:scale-110 transition"
              >
                ğŸ˜­
              </div>
              <h3 class="text-xl font-bold mb-2">æ“¬æƒ…æ„Ÿ (Emotion)</h3>
              <p class="text-sm text-gray-400 leading-relaxed mb-4">
                è³¦äºˆäº‹ç‰©äººçš„å–œæ€’å“€æ¨‚ã€‚
              </p>
              <div
                class="bg-black/30 p-3 rounded-lg text-sm border-l-2 border-pink-400"
              >
                <span class="text-gray-500 block text-xs mb-1">ä¾‹å¥ï¼š</span>
                è½è‘‰<span class="text-pink-300 font-bold">ä¾ä¾ä¸æ¨</span
                >åœ°å‘Šåˆ¥äº†å¤§æ¨¹ï¼Œ<span class="text-pink-300 font-bold"
                  >å˜†äº†å£æ°£</span
                >ã€‚
              </div>
            </div>

            <div
              class="glass-panel p-6 rounded-2xl hover:bg-white/5 transition duration-300 group"
            >
              <div
                class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mb-4 text-xl shadow-lg shadow-purple-500/40 group-hover:scale-110 transition"
              >
                ğŸ©
              </div>
              <h3 class="text-xl font-bold mb-2">æ“¬æ€§æ ¼ (Character)</h3>
              <p class="text-sm text-gray-400 leading-relaxed mb-4">
                è³¦äºˆäº‹ç‰©äººçš„å“å¾·æˆ–æ€§æ ¼ã€‚
              </p>
              <div
                class="bg-black/30 p-3 rounded-lg text-sm border-l-2 border-purple-400"
              >
                <span class="text-gray-500 block text-xs mb-1">ä¾‹å¥ï¼š</span>
                æ¢…èŠ±åƒä¸€ä½<span class="text-purple-300 font-bold">å …è²ä¸å±ˆ</span
                >çš„æˆ°å£«ï¼Œåœ¨å¯’é¢¨ä¸­<span class="text-purple-300 font-bold"
                  >å‚²ç„¶æŒºç«‹</span
                >ã€‚
              </div>
            </div>
          </div>

          <!-- Advanced Tip -->
          <div
            class="glass-panel p-8 rounded-2xl border-l-4 border-yellow-400 relative overflow-hidden"
          >
            <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl">ğŸ’¡</div>
            <h3
              class="text-xl font-bold text-yellow-400 mb-4 flex items-center gap-2"
            >
              <i class="fa-solid fa-triangle-exclamation"></i> å°–å­ç­†è¨˜ï¼šæ“¬äºº vs
              ç«¥è©±
            </h3>
            <p class="text-gray-300 leading-loose">
              <span class="font-bold text-white">æ³¨æ„ï¼š</span>
              åœ¨ç«¥è©±æ•…äº‹ä¸­ï¼Œå‹•ç‰©ç©¿è‘—è¡£æœèªªè©±ï¼ˆå¦‚ã€Šä¸‰éš»å°è±¬ã€‹ï¼‰ï¼Œåªè¦ç‰ å€‘å…·æœ‰ã€Œäººå½¢ã€æˆ–ã€Œäººæ€§ã€ï¼Œé€™é€šå¸¸ç¨±ç‚º<span
                class="text-yellow-300 font-bold"
                >ã€Œæ“¬äººåŒ–ã€ (Anthropomorphism)</span
              >ã€‚ä½†åœ¨ä¿®è¾­æ‰‹æ³•ä¸­ï¼Œæˆ‘å€‘æ›´é—œæ³¨çš„æ˜¯<span
                class="underline decoration-wavy decoration-yellow-500"
                >å´é‡æå¯«äº‹ç‰©çš„æŸä¸€é¢</span
              >åƒäººï¼Œè€Œä¸æ˜¯æŠŠå®ƒå®Œå…¨è®Šæˆä¸€å€‹äººã€‚
            </p>
          </div>

          <div class="flex justify-center pt-8">
            <button
              onclick="gotoSection('quiz')"
              class="glass-btn px-8 py-4 rounded-full text-xl font-bold flex items-center gap-3 hover:text-brand-primary group"
            >
              é€²å…¥æŒ‘æˆ°
              <i
                class="fa-solid fa-arrow-right group-hover:translate-x-1 transition"
              ></i>
            </button>
          </div>
        </div>

        <!-- SECTION: QUIZ (MCQs) -->
        <div
          id="section-quiz"
          class="section-content hidden w-full max-w-3xl mx-auto space-y-8 pb-20 fade-in"
        >
          <div class="flex items-center justify-between mb-8">
            <div>
              <span
                class="px-3 py-1 rounded text-xs font-bold bg-purple-500/20 text-purple-300 border border-purple-500/30"
                >LEVEL 2</span
              >
              <h2 class="text-3xl font-bold mt-2">è¾¨ææŒ‘æˆ°</h2>
            </div>
            <div class="text-right">
              <div class="text-4xl font-black text-white/20" id="quiz-progress">
                01<span class="text-lg">/10</span>
              </div>
            </div>
          </div>

          <!-- Question Card -->
          <div
            class="glass-panel p-8 md:p-12 rounded-3xl relative min-h-[400px] flex flex-col justify-center"
          >
            <div class="absolute top-0 left-0 w-full h-1 bg-white/10">
              <div
                id="quiz-bar"
                class="h-full bg-purple-500 w-10% transition-all duration-300"
              ></div>
            </div>

            <h3
              class="text-2xl md:text-3xl font-bold text-center mb-8 leading-relaxed"
              id="quiz-question"
            >
              é¡Œç›®åŠ è¼‰ä¸­...
            </h3>

            <div
              class="grid grid-cols-1 md:grid-cols-2 gap-4"
              id="quiz-options"
            >
              <!-- Options injected via JS -->
            </div>

            <!-- Feedback Overlay -->
            <div
              id="quiz-feedback"
              class="hidden mt-6 p-4 rounded-xl border border-white/10 bg-black/40 backdrop-blur text-center animate-pulse"
            >
              <span
                id="feedback-text"
                class="font-bold block text-lg mb-1"
              ></span>
              <span id="feedback-detail" class="text-sm text-gray-400"></span>
            </div>

            <div
              class="mt-8 flex justify-center hidden"
              id="quiz-next-btn-container"
            >
              <button
                onclick="nextQuestion()"
                class="glass-btn px-8 py-3 rounded-xl font-bold text-white hover:bg-purple-600/50"
              >
                ä¸‹ä¸€é¡Œ <i class="fa-solid fa-chevron-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- SECTION: READING (Comprehension) -->
        <div
          id="section-reading"
          class="section-content hidden w-full max-w-6xl mx-auto space-y-8 pb-20 fade-in"
        >
          <div class="flex flex-col md:flex-row gap-8 h-full">
            <!-- Article Panel -->
            <div
              class="md:w-3/5 glass-panel p-8 rounded-2xl h-[700px] flex flex-col border-t-4 border-green-400 relative"
            >
              <!-- Audio Control for Article -->
              <div class="absolute top-4 right-4 z-10">
                <button
                  onclick="toggleArticleReader()"
                  id="article-read-btn"
                  class="glass-btn px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 hover:bg-green-500/20 text-green-300 border border-green-500/30"
                >
                  <i class="fa-solid fa-volume-high"></i> æœ—è®€æ–‡ç«  (TTS)
                </button>
              </div>

              <h3 class="text-3xl font-bold mb-2 text-green-300 font-serif">
                ã€Šè€æ¨¹çš„è‡ªè¿°ã€‹
              </h3>
              <p class="text-sm text-gray-500 mb-6 italic">
                æ–‡ç« è¼ƒé•·ï¼Œè«‹ä½¿ç”¨ Text-to-Speech (TTS) åŠŸèƒ½è†è½æˆ–ç´°é–±ã€‚
              </p>

              <div
                class="overflow-y-auto scrollbar-hide pr-4 text-justify"
                id="article-content"
              >
                <article
                  class="space-y-6 text-lg leading-loose text-gray-300 font-serif"
                >
                  <p>
                    æˆ‘æ˜¯ä¸€æ£µåœ¨é€™åº§ç¦¿é ­å±±ä¸˜ä¸Šç«™å´—äº†æ•´æ•´ä¸‰ç™¾å¹´çš„è€æ¦•æ¨¹ã€‚æˆ‘çš„æ ¹ï¼Œåƒä¸€é›™é›™è’¼å‹æœ‰åŠ›çš„å¤§æ‰‹ï¼Œæ­»æ­»åœ°æŠ“ä½äº†è…³ä¸‹é€™ç‰‡è²§ç˜ çš„åœŸåœ°ï¼Œç”Ÿæ€•ä¸€é¬†æ‰‹ï¼Œå°±è¢«æ­²æœˆçš„æ´ªæµæ²–èµ°ã€‚
                  </p>

                  <p>
                    æ˜¥å§‘å¨˜ç¸½æ˜¯æœ€èª¿çš®çš„ï¼Œå¥¹å–œæ­¡è¶æˆ‘æ‰“ç›¹çš„æ™‚å€™ï¼Œæ‚„æ‚„åœ°ç”¨æº«æš–çš„æŒ‡å°–æ’“æˆ‘çš„ç™¢ç™¢ã€‚ç•¶æˆ‘å¿ä¸ä½ã€Œå™—å—¤ã€ä¸€ç¬‘æ™‚ï¼Œæé ­ä¾¿é‘½å‡ºäº†ç„¡æ•¸å«©ç¶ çš„å°è…¦è¢‹â€”â€”é‚£æ˜¯æˆ‘çš„å­©å­å€‘ï¼Œæ­£å¥½å¥‡åœ°å¼µæœ›è‘—é€™å€‹å¶„æ–°çš„ä¸–ç•Œã€‚å°é³¥å€‘ä¹Ÿæ˜¯åœ¨é€™å€‹æ™‚å€™å›ä¾†çš„ï¼Œç‰ å€‘åƒä¸€ç¾¤å˜®å¨çš„è€æœ‹å‹ï¼Œç«™åœ¨æˆ‘çš„è‚©è†€ä¸Šï¼Œå˜°å˜°å–³å–³åœ°è¨´èªªè‘—å—æ–¹çš„è¶£èï¼Œåµå¾—æˆ‘è€³æ ¹å­ä¸å¾—æ¸…æ·¨ï¼Œå¿ƒè£¡å»æ˜¯æš–æ´‹æ´‹çš„ã€‚
                  </p>

                  <p>
                    å¤æ—¥çš„å¤ªé™½æ˜¯å€‹è »ä¸è¬›ç†çš„æš´å›ã€‚ä»–æ¯å¤©éƒ½é§•é§›è‘—ç«æˆ°è»Šåœ¨å¤©ç©ºä¸­æ©«è¡ç›´æ’ï¼ŒæŠŠæ»¾ç‡™çš„ç«çƒæ¯«ä¸ç•™æƒ…åœ°æ‰”å‘å¤§åœ°ï¼Œçƒ¤å¾—æ³¥åœŸéƒ½å¼µé–‹å˜´å·´å–˜è‘—ç²—æ°£ã€‚é€™æ™‚å€™ï¼Œæˆ‘ä¾¿æ’é–‹æˆ‘é‚£æŠŠå·¨å¤§çš„ç¿ ç¶ é™½å‚˜ï¼ŒæŒºç›´äº†è…°æ¿ï¼Œç‚ºæ¨¹ä¸‹ä¹˜æ¶¼çš„è€äººå’Œå­©å­é®æ“‹é‚£ç„¡æƒ…çš„çƒˆç„°ã€‚è½è‘—å­©å­å€‘åœ¨æˆ‘è…³é‚Šå¬‰æˆ²çš„æ­¡ç¬‘è²ï¼Œçœ‹è‘—è€äººå®¶æ–è‘—è‘µæ‰‡å®‰è©³çš„ç¥æƒ…ï¼Œå°±ç®—æ±—æ°´æ¿•é€äº†æˆ‘çš„æ¨¹çš®ï¼Œæˆ‘ä¹Ÿè§‰å¾—å¿ƒæ»¿æ„è¶³ï¼Œé‚„å¿ä¸ä½ã€Œæ²™æ²™ã€åœ°å“¼èµ·äº†å°æ›²ã€‚
                  </p>

                  <p>
                    ç§‹é¢¨æ˜¯ä¸€å€‹å¤šæ„å–„æ„Ÿçš„ç•«å®¶ï¼Œä»–å¸¶è‘—ä¸€èº«çš„é¡æ–™ï¼ŒæŠŠæˆ‘é‚£ä¸€é ­æ¿ƒå¯†çš„ç¶ é«®æ¼¸æ¼¸æŸ“æˆäº†é‡‘é»ƒã€‚ä»–åˆæ˜¯ä¸€å€‹ç„¡æƒ…çš„åŠŠå­æ‰‹ï¼Œåœ¨æ·±å¤œè£¡æ®èˆè‘—å†°å†·çš„åˆ€åŠï¼Œé€¼è¿«æˆ‘çš„å­©å­å€‘é›¢é–‹æˆ‘çš„æ‡·æŠ±ã€‚æˆ‘çœ‹è‘—è½è‘‰ä¸€ç‰‡ç‰‡åœ°é£„è½ï¼Œåƒä¸€éš»éš»æ–·äº†ç·šçš„è´è¶ï¼Œåœ¨ç©ºä¸­è·³è‘—æœ€å¾Œçš„èˆã€‚æˆ‘å‚·å¿ƒåœ°è½ä¸‹äº†æ¯é»ƒçš„çœ¼æ·šï¼Œå®ƒå€‘é‹ªæ»¿äº†å›å®¶çš„å°è·¯ï¼Œç™¼å‡ºã€Œå’”åš“ã€å’”åš“ã€çš„ç¢è£‚è²ï¼Œé‚£æ˜¯æˆ‘å¿ƒç¢çš„è²éŸ³ã€‚
                  </p>

                  <p>
                    å†¬çˆºçˆºæ˜¯ä½åš´è‚…çš„æ³•å®˜ï¼Œä»–ç¸½æ¿è‘—ä¸€å¼µå†·å†°å†°çš„é¢å­”ã€‚åŒ—é¢¨é€™é ­éš±å½¢çš„çŒ›ç¸ï¼Œåœ¨ä»–çš„æŒ‡æ®ä¸‹ï¼Œå’†å“®è‘—å‘æˆ‘æ’²ä¾†ï¼Œè©¦åœ–æ’•è£‚æˆ‘çš„è»€å¹¹ã€‚ä½†æˆ‘ä¸æœƒå±ˆæœï¼Œæˆ‘è„«å»äº†è¯éº—çš„å¤–è¡£ï¼Œéœ²å‡ºäº†éµä¸€èˆ¬çš„ç­‹éª¨ã€‚æˆ‘å’¬ç·Šç‰™é—œï¼Œåœ¨åˆºéª¨çš„å¯’é¢¨ä¸­å±¹ç«‹ä¸å€’ï¼Œèˆ‡æš´é¢¨é›ªé€²è¡Œè‘—ç„¡è²çš„æé¬¥ã€‚å› ç‚ºæˆ‘çŸ¥é“ï¼Œåªè¦ç†¬éäº†é€™ä½å†·é…·æ³•å®˜çš„å¯©åˆ¤ï¼Œæ˜¥å§‘å¨˜é‚£æº«æŸ”çš„ç¬‘è‡‰ï¼Œä¾¿æœƒåœ¨ä¸é è™•ç­‰è‘—æˆ‘ã€‚
                  </p>

                  <p>
                    ä¸‰ç™¾å¹´äº†ï¼Œæˆ‘çœ‹è‘—å±±è…³ä¸‹çš„æ‘èŠè®Šæˆäº†åŸå¸‚ï¼Œçœ‹è‘—é‚£äº›åç‚ºã€Œæ±½è»Šã€çš„ç”²èŸ²åœ¨ç°è‰²çš„å¸¶å­ä¸ŠåŒ†å¿™çˆ¬è¡Œï¼Œçœ‹è‘—ä¸€æ£Ÿæ£Ÿé‹¼ç­‹æ°´æ³¥çš„å·¨äººæ‹”åœ°è€Œèµ·ï¼Œå‚²æ…¢åœ°é®æ“‹äº†æˆ‘çš„è¦–ç·šã€‚ä½†æˆ‘ä¾ç„¶å®ˆåœ¨é€™è£¡ï¼Œç·˜é»˜ä¸èªã€‚å› ç‚ºæˆ‘æ˜¯ä¸€æ£µæ¨¹ï¼Œä¸€æ£µçœ‹é€äº†ä¸–é–“ç¹è¯èˆ‡æ»„æ¡‘çš„è€æ¨¹ã€‚
                  </p>
                </article>
              </div>
            </div>

            <!-- Question Panel -->
            <div class="md:w-2/5 flex flex-col gap-4">
              <div class="glass-panel p-6 rounded-2xl flex-grow flex flex-col">
                <div class="mb-4 flex justify-between items-center">
                  <span class="text-xs font-bold text-green-400 uppercase"
                    >Question <span id="rc-num">1</span>/5</span
                  >
                  <div class="flex gap-1" id="rc-dots">
                    <!-- Dots generated by JS -->
                  </div>
                </div>

                <div
                  id="rc-container"
                  class="flex-grow flex flex-col justify-center"
                >
                  <!-- RC Content injected here -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION: WRITING (Builder) -->
        <div
          id="section-writing"
          class="section-content hidden w-full max-w-4xl mx-auto space-y-8 pb-20 fade-in"
        >
          <div class="text-center mb-8">
            <span
              class="px-3 py-1 rounded text-xs font-bold bg-pink-500/20 text-pink-300 border border-pink-500/30"
              >FINAL BOSS</span
            >
            <h2 class="text-3xl font-bold mt-2">å¦™ç­†ç”ŸèŠ±ï¼šæ“¬äººå¥å‰µä½œ</h2>
            <p class="text-gray-400 mt-2">é¸æ“‡æœ€ç”Ÿå‹•çš„è©èªï¼Œè®“å¥å­æ´»èµ·ä¾†ã€‚</p>
          </div>

          <div
            class="glass-panel p-10 rounded-3xl border border-pink-500/20 shadow-[0_0_50px_rgba(236,72,153,0.1)]"
          >
            <div id="writing-scenario-container">
              <!-- Writing Scenario injected via JS -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Scripts -->
    <script>
      // --- Audio System ---
      let audioEnabled = true;

      // TTS Speech Synthesis setup
      const synth = window.speechSynthesis;
      let articleUtterance = null;

      function toggleGlobalMute() {
        audioEnabled = !audioEnabled;
        const icon = document.getElementById("global-mute-icon");
        if (audioEnabled) {
          icon.classList.remove("fa-volume-xmark");
          icon.classList.add("fa-volume-high");
          playSystemSound("hover"); // Feedback
        } else {
          icon.classList.remove("fa-volume-high");
          icon.classList.add("fa-volume-xmark");
          synth.cancel(); // Stop talking if muted
          document
            .getElementById("article-read-btn")
            .classList.remove("speaking");
          document.getElementById("article-read-btn").innerHTML =
            '<i class="fa-solid fa-volume-high"></i> æœ—è®€æ–‡ç«  (TTS)';
        }
      }

      // Simple beep synthesizer for system sounds
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      function playSystemSound(type) {
        if (!audioEnabled) return;
        if (audioCtx.state === "suspended") audioCtx.resume();

        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === "correct") {
          // Happy chord
          oscillator.type = "sine";
          oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
          oscillator.frequency.exponentialRampToValueAtTime(
            1046.5,
            audioCtx.currentTime + 0.1
          ); // C6
          gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioCtx.currentTime + 0.5
          );
          oscillator.start();
          oscillator.stop(audioCtx.currentTime + 0.5);
        } else if (type === "wrong") {
          // Low thud
          oscillator.type = "sawtooth";
          oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
          oscillator.frequency.linearRampToValueAtTime(
            50,
            audioCtx.currentTime + 0.3
          );
          gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioCtx.currentTime + 0.3
          );
          oscillator.start();
          oscillator.stop(audioCtx.currentTime + 0.3);
        } else if (type === "hover") {
          // Tiny click
          oscillator.type = "sine";
          oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
          gainNode.gain.setValueAtTime(0.02, audioCtx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.001,
            audioCtx.currentTime + 0.05
          );
          oscillator.start();
          oscillator.stop(audioCtx.currentTime + 0.05);
        }
      }

      function toggleArticleReader() {
        if (!audioEnabled) {
          Swal.fire("éŸ³æ•ˆå·²é—œé–‰", "è«‹å…ˆåœ¨å³ä¸Šè§’é–‹å•ŸéŸ³æ•ˆåŠŸèƒ½ã€‚", "warning");
          return;
        }

        const btn = document.getElementById("article-read-btn");

        if (synth.speaking) {
          synth.cancel();
          btn.classList.remove("speaking");
          btn.innerHTML =
            '<i class="fa-solid fa-volume-high"></i> æœ—è®€æ–‡ç«  (TTS)';
          return;
        }

        const textEl = document.querySelector("#article-content article");
        const text = textEl.innerText;

        articleUtterance = new SpeechSynthesisUtterance(text);
        articleUtterance.lang = "zh-HK"; // Cantonese
        articleUtterance.rate = 0.9; // Slightly slower for reading
        articleUtterance.pitch = 1;

        articleUtterance.onend = () => {
          btn.classList.remove("speaking");
          btn.innerHTML =
            '<i class="fa-solid fa-volume-high"></i> æœ—è®€æ–‡ç«  (TTS)';
        };

        btn.classList.add("speaking");
        btn.innerHTML = '<i class="fa-solid fa-stop"></i> åœæ­¢æœ—è®€';
        synth.speak(articleUtterance);
      }

      // --- Data ---

      // Level 2: Quiz Data (10 questions)
      const quizData = [
        {
          q: "ã€Œæœˆäº®å®³ç¾åœ°èº²é€²é›²å±¤è£ã€‚ã€é€™å¥å­é‹ç”¨äº†å“ªç¨®ä¿®è¾­æ‰‹æ³•ï¼Ÿ",
          options: ["æ¯”å–»", "æ“¬äºº", "èª‡å¼µ", "æ’æ¯”"],
          answer: 1, // index of correct option
          explanation:
            "è³¦äºˆäº†æœˆäº®ã€Œå®³ç¾ã€é€™ç¨®äººçš„æƒ…æ„Ÿï¼Œä»¥åŠã€Œèº²ã€é€™å€‹äººçš„å‹•ä½œã€‚",
        },
        {
          q: "ã€Œé‚£å€‹äººå£¯å¾—åƒä¸€é ­ç‰›ã€‚ã€é€™å¥å­é‹ç”¨äº†æ“¬äººæ³•å—ï¼Ÿ",
          options: ["æ˜¯", "å¦"],
          answer: 1, // No
          explanation: "é€™æ˜¯ã€Œæ¯”å–»ã€ï¼ˆæ˜å–»ï¼‰ï¼ŒæŠŠäººæ¯”ä½œç‰›ï¼Œè€Œä¸æ˜¯æŠŠç‰©ç•¶ä½œäººå¯«ã€‚",
        },
        {
          q: "ã€Œç‹‚é¢¨å’†å“®ï¼Œå¤§æ¨¹åœ¨ç—›è‹¦åœ°å‘»åŸã€‚ã€é€™å¥å­ä¸»è¦çš„ä¿®è¾­æ•ˆæœæ˜¯ä»€éº¼ï¼Ÿ",
          options: [
            "å¢åŠ è¶£å‘³æ€§",
            "çªå‡ºç’°å¢ƒçš„æƒ¡åŠ£èˆ‡å¯æ€•",
            "èªªæ˜æ¨¹æœ¨ç¨®é¡",
            "è¡¨é”ä½œè€…çš„é–‹å¿ƒ",
          ],
          answer: 1,
          explanation: "ç”¨ã€Œå’†å“®ã€å’Œã€Œå‘»åŸã€ç‡Ÿé€ å‡ºä¸€ç¨®ææ‡¼ã€å—æŠ˜ç£¨çš„æ°›åœã€‚",
        },
        {
          q: "ä»¥ä¸‹å“ªä¸€å¥ä½¿ç”¨äº†ã€Œæ“¬äººæ³•ã€ï¼Ÿ",
          options: [
            "é€™è˜‹æœç´…å¾—åƒå°å§‘å¨˜çš„è‡‰è›‹ã€‚",
            "å°é³¥åœ¨é›»ç·šæ¡¿ä¸Šå˜°å˜°å–³å–³åœ°é–‹æœƒã€‚",
            "ä»–è·‘å¾—æ¯”ç«ç®­é‚„å¿«ã€‚",
            "å¤©ä¸Šçš„ç™½é›²åƒä¸€åœ˜æ£‰èŠ±ã€‚",
          ],
          answer: 1,
          explanation: "ã€Œé–‹æœƒã€æ˜¯äººçš„ç¤¾æœƒè¡Œç‚ºï¼Œè³¦äºˆå°é³¥é€™ç¨®è¡Œç‚ºå°±æ˜¯æ“¬äººã€‚",
        },
        {
          q: "ã€Œå¤§æµ·å±•ç¾äº†å»£é—Šçš„èƒ¸è¥Ÿï¼ŒåŒ…å®¹äº†ä¸€åˆ‡ã€‚ã€é€™æ˜¯å±¬æ–¼å“ªä¸€é¡æ“¬äººï¼Ÿ",
          options: ["æ“¬å‹•ä½œ", "æ“¬è²éŸ³", "æ“¬æ€§æ ¼/å“è³ª", "æ“¬å¤–è²Œ"],
          answer: 2,
          explanation: "ã€Œèƒ¸è¥Ÿã€å’Œã€ŒåŒ…å®¹ã€é«”ç¾çš„æ˜¯äººçš„å“å¾·å’Œæ€§æ ¼ã€‚",
        },
        {
          q: "ã€Œé¬§é˜æ¯å¤©æ—©ä¸Šæº–æ™‚å”±æ­Œã€‚ã€å¥ä¸­çš„ã€Œå”±æ­Œã€æ˜¯æŠŠä»€éº¼è²éŸ³æ“¬äººåŒ–ï¼Ÿ",
          options: ["èªªè©±è²", "è…³æ­¥è²", "éŸ¿éˆ´è²", "å‘¼å¸è²"],
          answer: 2,
          explanation: "æŠŠå–®èª¿çš„é¬§é˜éˆ´è²æ¯”ä½œå‹•è½çš„ã€Œå”±æ­Œã€ã€‚",
        },
        {
          q: "ã€Œè¡—é“ä¸Šçš„è»Šè¼›æ’æˆäº†ä¸€æ¢é•·é¾ã€‚ã€é€™æ˜¯æ“¬äººæ³•å—ï¼Ÿ",
          options: ["æ˜¯", "å¦"],
          answer: 1,
          explanation:
            "é€™æ˜¯ã€Œå€Ÿå–»ã€æˆ–ã€Œæ¯”å–»ã€ï¼ŒæŠŠè»Šæµæ¯”ä½œé¾ï¼Œé¾é›–æœ‰éˆæ€§ä½†æ­¤è™•é‡é»åœ¨å½¢ç‹€ã€‚",
        },
        {
          q: "åˆ†è¾¨æŠ€å·§ï¼šå¦‚æœå¥å­ä¸­å‡ºç¾ã€Œåƒã€ã€ã€Œå½·å½¿ã€ï¼Œé€šå¸¸æ˜¯ï¼Ÿ",
          options: ["æ“¬äºº", "æ¯”å–»", "å°å¶", "åè¦†"],
          answer: 1,
          explanation:
            "å‡ºç¾å–»è©ï¼ˆåƒã€ä¼¼ã€å¦‚ï¼‰é€šå¸¸æ˜¯æ¯”å–»ï¼ˆæ˜å–»ï¼‰çš„ç‰¹å¾µã€‚æ“¬äººé€šå¸¸ç›´æ¥æŠŠç‰©ç•¶äººå¯«ï¼Œä¸ç”¨ã€Œåƒã€ã€‚",
        },
        {
          q: "ã€Œå°è‰å·å·åœ°å¾åœŸè£¡é‘½å‡ºä¾†ã€‚ã€é€™å¥ç”¨äº†æ“¬äººæ³•ï¼Œçªé¡¯äº†å°è‰çš„ä»€éº¼ç‰¹é»ï¼Ÿ",
          options: ["ç”Ÿæ©Ÿå‹ƒå‹ƒèˆ‡é ‘çš®", "é¡è‰²é®®è±”", "æ•¸é‡å¾ˆå¤š", "éå¸¸çŸ®å°"],
          answer: 0,
          explanation: "ã€Œå·å·åœ°ã€å’Œã€Œé‘½ã€è³¦äºˆå°è‰é ‘çš®ã€éˆå‹•çš„ç”Ÿå‘½åŠ›ã€‚",
        },
        {
          q: "æŒ‘æˆ°é¡Œï¼šã€Œæ˜Ÿæ˜Ÿåœ¨å¤œç©ºä¸­çœ¨çœ¼ç›ã€èˆ‡ã€Œæ˜Ÿæ˜Ÿåƒå¯¶çŸ³ä¸€æ¨£é–ƒäº®ã€ï¼Œå“ªå¥æ˜¯æ“¬äººï¼Ÿ",
          options: ["ç¬¬ä¸€å¥", "ç¬¬äºŒå¥", "å…©å¥éƒ½æ˜¯", "å…©å¥éƒ½ä¸æ˜¯"],
          answer: 0,
          explanation:
            "ç¬¬ä¸€å¥ã€Œçœ¨çœ¼ç›ã€æ˜¯äºº/å‹•ç‰©å‹•ä½œï¼Œæ˜¯æ“¬äººï¼›ç¬¬äºŒå¥æœ‰ã€Œåƒ...ä¸€æ¨£ã€æ˜¯æ¯”å–»ã€‚",
        },
      ];

      // Level 3: Reading Comprehension Data (Updated for longer article)
      const rcData = [
        {
          type: "mc",
          question:
            "ç¬¬ä¸€æ®µä¸­ï¼Œä½œè€…å½¢å®¹è‡ªå·±çš„æ ¹ã€Œåƒä¸€é›™é›™è’¼å‹æœ‰åŠ›çš„å¤§æ‰‹ï¼Œæ­»æ­»åœ°æŠ“ä½äº†è…³ä¸‹é€™ç‰‡è²§ç˜ çš„åœŸåœ°ã€ã€‚é€™è£¡é‹ç”¨äº†ä»€éº¼ä¿®è¾­ï¼Ÿ",
          options: ["æ“¬äºº", "æ˜å–»åŠæ“¬äºº", "èª‡å¼µ", "æ’æ¯”"],
          answer: 1,
          explanation:
            "ã€Œåƒ...å¤§æ‰‹ã€æ˜¯æ˜å–»ï¼›ã€Œæ­»æ­»åœ°æŠ“ä½ã€ã€ã€Œç”Ÿæ€•...æ²–èµ°ã€è³¦äºˆäº†æ ¹äººçš„ææ‡¼æƒ…æ„Ÿå’Œæ„å¿—ï¼Œæ˜¯æ“¬äººã€‚",
        },
        {
          type: "mc",
          question:
            "æ–‡ä¸­æå¯«ã€Œæ˜¥å§‘å¨˜ã€æœƒã€Œæ’“æˆ‘çš„ç™¢ç™¢ã€ï¼Œé€™è®“ã€Œæˆ‘ã€ç”¢ç”Ÿäº†ä»€éº¼åæ‡‰ï¼Ÿ",
          options: [
            "æ„Ÿåˆ°ç–¼ç—›",
            "ç”Ÿæ°£åœ°å’†å“®",
            "å¿ä¸ä½ç¬‘å‡ºå«©ç¶ çš„èŠ½å…’",
            "å‚·å¿ƒåœ°è½æ·š",
          ],
          answer: 2,
          explanation:
            "æ–‡ä¸­æåˆ°ã€Œç•¶æˆ‘å¿ä¸ä½ã€å™—å—¤ã€ä¸€ç¬‘æ™‚ï¼Œæé ­ä¾¿é‘½å‡ºäº†ç„¡æ•¸å«©ç¶ çš„å°è…¦è¢‹ã€ã€‚",
        },
        {
          type: "mc",
          question:
            "ä½œè€…æŠŠå¤æ—¥çš„å¤ªé™½æ¯”ä½œã€Œæš´å›ã€ï¼Œä¸¦æå¯«æ³¥åœŸã€Œå¼µé–‹å˜´å·´å–˜è‘—ç²—æ°£ã€ï¼Œé€™çªé¡¯äº†å¤å¤©çš„ä»€éº¼ç‰¹é»ï¼Ÿ",
          options: ["ç†±é¬§", "ç”Ÿæ©Ÿå‹ƒå‹ƒ", "é…·ç†±é›£è€", "å…‰ç·šå……è¶³"],
          answer: 2,
          explanation:
            "ã€Œæš´å›ã€ã€ã€Œæ»¾ç‡™çš„ç«çƒã€ã€ã€Œå–˜è‘—ç²—æ°£ã€éƒ½å¼·èª¿äº†å¤å¤©çš„ç‚ç†±æ˜¯ä»¤äººç—›è‹¦çš„ã€‚",
        },
        {
          type: "mc",
          question: "åœ¨ç§‹å¤©çš„æå¯«ä¸­ï¼Œç‚ºä»€éº¼ä½œè€…èªªè½è‘‰çš„è²éŸ³æ˜¯ã€Œå¿ƒç¢çš„è²éŸ³ã€ï¼Ÿ",
          options: [
            "å› ç‚ºæ¨¹è‘‰å¾ˆè„†",
            "å› ç‚ºä½œè€…ä¸æ¨å¾—ã€Œå­©å­å€‘ã€(è‘‰å­)é›¢é–‹",
            "å› ç‚ºç§‹é¢¨å¾ˆåµ",
            "å› ç‚ºè¢«äººè¸©ç¢äº†",
          ],
          answer: 1,
          explanation: "ä½œè€…æŠŠè½è‘‰çœ‹ä½œé›¢é–‹æ‡·æŠ±çš„å­©å­ï¼Œå› æ­¤æ„Ÿåˆ°å‚·å¿ƒå’Œå¿ƒç¢ã€‚",
        },
        {
          type: "short",
          question:
            "æœ€å¾Œä¸€æ®µï¼Œè€æ¨¹çœ‹è‘—åŸå¸‚è®Šé·ï¼ˆæ±½è»Šåƒç”²èŸ²ï¼Œå¤§å»ˆåƒå·¨äººï¼‰ï¼Œä½†ä»–é¸æ“‡ã€Œç·˜é»˜ä¸èªã€ã€‚é€™è¡¨ç¾äº†è€æ¨¹æ€æ¨£çš„æ€§æ ¼ç‰¹è³ªï¼Ÿ",
          answer: "é€™è¡¨ç¾äº†è€æ¨¹æ²ˆç©©ã€å†·éœã€å……æ»¿æ™ºæ…§ä¸”è¶…ç„¶ç‰©å¤–çš„æ€§æ ¼ã€‚",
          keywords: ["æ²ˆç©©", "å†·éœ", "æ™ºæ…§", "çœ‹é€", "æ·¡å®š"],
        },
      ];

      // Level 4: Writing Data
      const writingData = [
        {
          scenario:
            "æƒ…å¢ƒï¼šæå¯« <span class='text-blue-400'>ã€Œæ™‚é˜ã€</span> èµ°å‹•çš„è²éŸ³ã€‚",
          base: "æ™‚é˜åœ¨ç‰†ä¸ŠéŸ¿è‘—ï¼Œæ™‚é–“éå»äº†ã€‚",
          question: "è«‹é¸æ“‡æœ€èƒ½è¡¨ç¾ã€Œæ™‚é–“åŒ†åŒ†æµé€ï¼Œä¸ç­‰äººã€çš„æ“¬äººå¥ï¼š",
          options: [
            "æ™‚é˜æ»´ç­”æ»´ç­”åœ°éŸ¿ï¼Œåƒå¿ƒè·³ä¸€æ¨£ã€‚",
            "æ™‚é˜é‚è‘—åŒ†å¿™çš„è…³æ­¥ï¼Œé ­ä¹Ÿä¸å›åœ°å‘å‰å¥”è·‘ã€‚",
            "æ™‚é˜åœ¨ç‰†ä¸Šæ›è‘—ï¼Œçœ‹èµ·ä¾†å¾ˆè‘—æ€¥ã€‚",
            "æ™‚é–“åƒæµæ°´ä¸€æ¨£æµèµ°äº†ã€‚",
          ],
          answer: 1,
          feedback:
            "Excellent! ã€Œé‚è‘—åŒ†å¿™çš„è…³æ­¥ã€ã€ã€Œé ­ä¹Ÿä¸å›ã€ç”Ÿå‹•åœ°è¡¨ç¾äº†æ™‚é–“çš„ç„¡æƒ…æµé€ã€‚",
        },
        {
          scenario:
            "æƒ…å¢ƒï¼šæå¯« <span class='text-yellow-400'>ã€Œè·¯ç‡ˆã€</span> åœ¨é»‘å¤œä¸­ã€‚",
          base: "è·¯ç‡ˆäº®è‘—å…‰ã€‚",
          question: "è«‹é¸æ“‡æœ€èƒ½è¡¨ç¾ã€Œå­¤ç¨ä½†å …å®ˆè·è²¬ã€çš„æ“¬äººå¥ï¼š",
          options: [
            "è·¯ç‡ˆåƒä¸€åå¿ èª çš„è¡›å£«ï¼Œåœ¨å¯’é¢¨ä¸­é»˜é»˜ç«™å´—ã€‚",
            "è·¯ç‡ˆç™¼å‡ºé»ƒè‰²çš„å…‰èŠ’ï¼Œå¾ˆåˆºçœ¼ã€‚",
            "è·¯ç‡ˆå­¤ç¨åœ°ç«™åœ¨é‚£è£¡ï¼Œå¥½åƒåœ¨å“­ã€‚",
            "è·¯ç‡ˆæ¯”æ˜Ÿæ˜Ÿé‚„è¦äº®ã€‚",
          ],
          answer: 0,
          feedback:
            "å¾ˆå¥½çš„é¸æ“‡ï¼æŠŠè·¯ç‡ˆæ¯”ä½œã€Œè¡›å£«ã€ã€ã€Œç«™å´—ã€ï¼Œé«”ç¾äº†å®ƒçš„å …æ¯…å’Œè·è²¬ã€‚",
        },
      ];

      // --- State ---
      let state = {
        xp: 0,
        quizIndex: 0,
        rcIndex: 0,
        writingIndex: 0,
        section: "intro", // intro, quiz, reading, writing
      };

      // --- Core Functions ---

      function init() {
        updateProgress();
        renderQuiz();
        renderRC();
        renderWriting();

        // Highlight active nav
        updateNavHighlights();

        // Interaction sounds for nav
        document.querySelectorAll("button").forEach((btn) => {
          btn.addEventListener("mouseenter", () => playSystemSound("hover"));
        });
      }

      function gotoSection(sectionId) {
        state.section = sectionId;

        // Hide all sections
        document.querySelectorAll(".section-content").forEach((el) => {
          el.classList.add("hidden");
        });

        // Show target section
        document
          .getElementById(`section-${sectionId}`)
          .classList.remove("hidden");

        // Scroll to top
        document.getElementById("main-content").scrollTo(0, 0);

        updateNavHighlights();

        // Stop speaking if switching away
        if (synth.speaking) {
          synth.cancel();
          const btn = document.getElementById("article-read-btn");
          if (btn) {
            btn.classList.remove("speaking");
            btn.innerHTML =
              '<i class="fa-solid fa-volume-high"></i> æœ—è®€æ–‡ç«  (TTS)';
          }
        }
      }

      function updateNavHighlights() {
        document.querySelectorAll(".nav-item").forEach((btn) => {
          if (btn.dataset.id === state.section) {
            btn.classList.add("bg-white/10", "border-white/10");
            btn.classList.remove("border-transparent");
          } else {
            btn.classList.remove("bg-white/10", "border-white/10");
            btn.classList.add("border-transparent");
          }
        });
      }

      function addXP(amount) {
        const oldXp = state.xp;
        state.xp += amount;

        // Animation
        const diff = state.xp - oldXp;
        const display = document.getElementById("score-display");

        // Simple count up
        let start = oldXp;
        const end = state.xp;
        const duration = 1000;
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // Ease out quart
          const ease = 1 - Math.pow(1 - progress, 4);

          const val = Math.floor(start + (end - start) * ease);
          display.innerText = val;

          if (progress < 1) {
            requestAnimationFrame(update);
          } else {
            Swal.fire({
              title: `+${amount} XP!`,
              icon: "success",
              toast: true,
              position: "top-end",
              showConfirmButton: false,
              timer: 1500,
              background: "#1A202C",
              color: "#fff",
            });
          }
        }
        requestAnimationFrame(update);
        updateProgress();
      }

      function updateProgress() {
        // Calculate total progress
        // Rough estimate logic
        const totalSteps = quizData.length + rcData.length + writingData.length;
        const doneSteps = state.quizIndex + state.rcIndex + state.writingIndex;
        const pct = Math.min(100, Math.round((doneSteps / totalSteps) * 100));

        document.getElementById("progress-bar").style.width = `${pct}%`;
        document.getElementById("progress-text").innerText = pct;
      }

      // --- Logic: Quiz ---

      function renderQuiz() {
        if (state.quizIndex >= quizData.length) {
          // Quiz set done
          document.getElementById("quiz-question").innerText = "è¾¨ææŒ‘æˆ°å®Œæˆï¼";
          document.getElementById("quiz-options").innerHTML = `
                    <div class="col-span-1 md:col-span-2 text-center py-10">
                        <div class="text-6xl mb-4">ğŸ‰</div>
                        <p class="text-xl text-gray-300 mb-6">ä½ å·²ç¶“å®Œæˆäº†æ‰€æœ‰è¾¨æé¡Œç›®ï¼</p>
                        <button onclick="gotoSection('reading')" class="glass-btn px-8 py-3 rounded-full text-white font-bold">
                            é€²å…¥ä¸‹ä¸€é—œï¼šé–±æ–‡è³æ
                        </button>
                    </div>
                `;
          document.getElementById("quiz-bar").style.width = "100%";
          return;
        }

        const q = quizData[state.quizIndex];
        document.getElementById("quiz-question").innerText = q.q;
        document.getElementById("quiz-progress").innerHTML = `${String(
          state.quizIndex + 1
        ).padStart(2, "0")}<span class="text-lg">/${quizData.length}</span>`;

        document.getElementById("quiz-bar").style.width = `${
          (state.quizIndex / quizData.length) * 100
        }%`;

        const container = document.getElementById("quiz-options");
        container.innerHTML = "";

        q.options.forEach((opt, idx) => {
          const btn = document.createElement("div");
          btn.className =
            "option-choice glass-btn p-4 rounded-xl text-lg font-medium flex items-center gap-3";
          btn.innerHTML = `<div class="w-8 h-8 rounded-full border border-white/20 flex items-center justify-center text-sm font-bold text-gray-400">${String.fromCharCode(
            65 + idx
          )}</div> <span>${opt}</span>`;
          btn.onclick = () => checkQuiz(idx, btn);
          container.appendChild(btn);
        });

        document.getElementById("quiz-feedback").classList.add("hidden");
        document
          .getElementById("quiz-next-btn-container")
          .classList.add("hidden");
      }

      function checkQuiz(selectedIndex, btnElement) {
        // Prevent multiple clicks
        if (
          document.querySelector(".option-choice.correct") ||
          document.querySelector(".option-choice.wrong")
        )
          return;

        const q = quizData[state.quizIndex];
        const isCorrect = selectedIndex === q.answer;

        if (isCorrect) {
          btnElement.classList.add("correct");
          playSystemSound("correct");
          addXP(20);
          showFeedback(true, q.explanation);
        } else {
          btnElement.classList.add("wrong");
          // Highlight correct one
          const allBtns = document.getElementById("quiz-options").children;
          allBtns[q.answer].classList.add("correct");
          playSystemSound("wrong");
          showFeedback(false, q.explanation);
        }

        document
          .getElementById("quiz-next-btn-container")
          .classList.remove("hidden");
      }

      function showFeedback(isCorrect, text) {
        const fbBox = document.getElementById("quiz-feedback");
        const fbTitle = document.getElementById("feedback-text");
        const fbDetail = document.getElementById("feedback-detail");

        fbBox.classList.remove("hidden");
        if (isCorrect) {
          fbTitle.innerHTML =
            "<span class='text-green-400'><i class='fa-solid fa-check-circle'></i> ç­”å°äº†ï¼</span>";
          fbBox.classList.add("border-green-500/30");
        } else {
          fbTitle.innerHTML =
            "<span class='text-red-400'><i class='fa-solid fa-times-circle'></i> ç­”éŒ¯äº†...</span>";
          fbBox.classList.add("border-red-500/30");
        }
        fbDetail.innerText = text;
      }

      function nextQuestion() {
        state.quizIndex++;
        renderQuiz();
      }

      // --- Logic: Reading Comprehension ---

      function renderRC() {
        const container = document.getElementById("rc-container");
        const dotsContainer = document.getElementById("rc-dots");
        document.getElementById("rc-num").innerText = state.rcIndex + 1;

        // Render Dots
        dotsContainer.innerHTML = "";
        rcData.forEach((_, i) => {
          const dot = document.createElement("div");
          dot.className = `w-2 h-2 rounded-full ${
            i === state.rcIndex ? "bg-green-400" : "bg-gray-600"
          }`;
          dotsContainer.appendChild(dot);
        });

        if (state.rcIndex >= rcData.length) {
          container.innerHTML = `
                   <div class="text-center">
                        <h3 class="text-2xl font-bold mb-4">é–±è®€ç†è§£æŒ‘æˆ°å®Œæˆï¼</h3>
                        <p class="text-gray-400 mb-6">ä½ å°æ“¬äººæ³•çš„é‹ç”¨æœ‰äº†æ·±åˆ»çš„é«”æœƒã€‚</p>
                        <button onclick="gotoSection('writing')" class="glass-btn px-8 py-3 rounded-full text-white font-bold">
                            é€²å…¥æœ€çµ‚é—œå¡ï¼šå¦™ç­†ç”ŸèŠ±
                        </button>
                    </div>
                `;
          return;
        }

        const q = rcData[state.rcIndex];
        let html = `<h4 class="text-xl font-bold mb-6">${q.question}</h4>`;

        if (q.type === "mc") {
          html += `<div class="space-y-3">`;
          q.options.forEach((opt, idx) => {
            html += `
                        <button onclick="checkRC(${idx})" class="w-full text-left glass-btn p-4 rounded-xl hover:bg-white/10 transition flex items-center justify-between group rc-opt">
                            <span>${opt}</span>
                            <i class="fa-solid fa-chevron-right opacity-0 group-hover:opacity-100 transition"></i>
                        </button>
                    `;
          });
          html += `</div>`;
        } else if (q.type === "short") {
          html += `
                    <div class="space-y-4">
                        <textarea id="rc-short-input" class="w-full h-32 bg-black/20 border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-green-400 transition" placeholder="è«‹åœ¨æ­¤è¼¸å…¥ä½ çš„ç­”æ¡ˆ..."></textarea>
                        <button onclick="checkRCShort()" class="w-full bg-green-500/80 hover:bg-green-500 text-white font-bold py-3 rounded-xl transition">
                            æäº¤ç­”æ¡ˆ
                        </button>
                    </div>
                `;
        }

        // Feedback area for RC
        html += `<div id="rc-feedback" class="hidden mt-4 p-4 rounded-xl bg-black/40 border border-white/10 text-sm"></div>`;
        html += `<button id="rc-next-btn" onclick="nextRC()" class="hidden mt-4 w-full bg-blue-500/20 hover:bg-blue-500/40 text-blue-300 font-bold py-2 rounded-lg transition">ä¸‹ä¸€é¡Œ</button>`;

        container.innerHTML = html;
      }

      function checkRC(selectedIndex) {
        const btns = document.querySelectorAll(".rc-opt");
        if (document.getElementById("rc-next-btn").classList.contains("flex"))
          return; // already answered

        const q = rcData[state.rcIndex];
        const isCorrect = selectedIndex === q.answer;
        const feedbackEl = document.getElementById("rc-feedback");

        btns.forEach((btn, idx) => {
          if (idx === q.answer) {
            btn.classList.add("bg-green-500/20", "border-green-500");
          } else if (idx === selectedIndex && !isCorrect) {
            btn.classList.add("bg-red-500/20", "border-red-500");
          } else {
            btn.classList.add("opacity-50");
          }
          btn.disabled = true;
        });

        feedbackEl.classList.remove("hidden");
        if (isCorrect) {
          feedbackEl.innerHTML = `<span class="text-green-400 font-bold">æ­£ç¢ºï¼</span> ${q.explanation}`;
          playSystemSound("correct");
          addXP(30);
        } else {
          feedbackEl.innerHTML = `<span class="text-red-400 font-bold">éŒ¯èª¤ã€‚</span> ${q.explanation}`;
          playSystemSound("wrong");
        }

        document.getElementById("rc-next-btn").classList.remove("hidden");
        document.getElementById("rc-next-btn").classList.add("block");
      }

      function checkRCShort() {
        const input = document.getElementById("rc-short-input").value;
        const q = rcData[state.rcIndex];
        const feedbackEl = document.getElementById("rc-feedback");

        if (input.length < 5) {
          Swal.fire("å¤ªçŸ­äº†", "è«‹è¼¸å…¥å®Œæ•´çš„å¥å­ã€‚", "warning");
          return;
        }

        // Simple keyword check
        let hits = 0;
        q.keywords.forEach((k) => {
          if (input.includes(k)) hits++;
        });

        feedbackEl.classList.remove("hidden");
        if (hits > 0) {
          feedbackEl.innerHTML = `<span class="text-green-400 font-bold">ä¸éŒ¯çš„å›ç­”ï¼</span> åƒè€ƒç­”æ¡ˆï¼š${q.answer}`;
          playSystemSound("correct");
          addXP(30); // Subjective grading, give points for effort
        } else {
          feedbackEl.innerHTML = `<span class="text-yellow-400 font-bold">å¯ä»¥å†è£œå……ä¸€ä¸‹ã€‚</span> åƒè€ƒç­”æ¡ˆï¼š${q.answer}`;
          playSystemSound("correct"); // Encouragement for trying
          addXP(10);
        }

        document.getElementById("rc-next-btn").classList.remove("hidden");
        document.getElementById("rc-next-btn").classList.add("block");
      }

      function nextRC() {
        state.rcIndex++;
        renderRC();
      }

      // --- Logic: Writing ---

      function renderWriting() {
        const container = document.getElementById("writing-scenario-container");

        if (state.writingIndex >= writingData.length) {
          container.innerHTML = `
                    <div class="text-center py-10">
                        <div class="text-6xl mb-6 text-yellow-400"><i class="fa-solid fa-crown"></i></div>
                        <h2 class="text-4xl font-bold mb-4">å¤§å¸«ç´šèª²ç¨‹å®Œæˆï¼</h2>
                        <p class="text-xl text-gray-300 mb-8">ä½ å·²ç¶“å‡ºè‰²åœ°å®Œæˆäº†æ“¬äººæ³•çš„é«˜éšè¨“ç·´ã€‚</p>
                        <div class="bg-white/10 p-6 rounded-2xl inline-block">
                            <div class="text-sm text-gray-400 uppercase tracking-widest mb-2">Total XP</div>
                            <div class="text-5xl font-black text-white">${state.xp}</div>
                        </div>
                        <div class="mt-10">
                            <button onclick="location.reload()" class="glass-btn px-8 py-3 rounded-full text-white font-bold">
                                é‡æ–°æŒ‘æˆ°
                            </button>
                        </div>
                    </div>
                 `;
          return;
        }

        const item = writingData[state.writingIndex];

        let html = `
                <div class="mb-8">
                    <div class="text-lg bg-white/5 p-4 rounded-xl border-l-4 border-pink-500 mb-4">
                        ${item.scenario}
                    </div>
                    <div class="flex items-center gap-4 text-gray-400 mb-6">
                        <span>åŸå¥ï¼š</span>
                        <span class="line-through decoration-red-500/50">${item.base}</span>
                    </div>
                    <h4 class="text-xl font-bold mb-6">${item.question}</h4>
                    <div class="grid gap-4">
             `;

        item.options.forEach((opt, idx) => {
          html += `
                    <button onclick="checkWriting(${idx})" class="w-full text-left glass-btn p-5 rounded-2xl hover:border-pink-500/50 transition flex items-center justify-between group writing-opt">
                        <span class="text-lg">${opt}</span>
                    </button>
                 `;
        });

        html += `</div>
                <div id="writing-feedback" class="hidden mt-6 p-6 rounded-xl bg-gradient-to-r from-pink-900/40 to-purple-900/40 border border-pink-500/20"></div>
                <button id="writing-next-btn" onclick="nextWriting()" class="hidden mt-6 ml-auto bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-pink-500/30 transition transform hover:scale-105">
                    ä¸‹ä¸€é¡Œ <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
             </div>`;

        container.innerHTML = html;
      }

      function checkWriting(selectedIndex) {
        if (
          document
            .getElementById("writing-next-btn")
            .classList.contains("block")
        )
          return;

        const item = writingData[state.writingIndex];
        const isCorrect = selectedIndex === item.answer;
        const feedbackEl = document.getElementById("writing-feedback");
        const btns = document.querySelectorAll(".writing-opt");

        btns.forEach((btn, idx) => {
          if (idx === item.answer) {
            btn.classList.add("bg-green-500/20", "border-green-500");
            btn.innerHTML += '<i class="fa-solid fa-check text-green-400"></i>';
          } else if (idx === selectedIndex && !isCorrect) {
            btn.classList.add("bg-red-500/20", "border-red-500");
            btn.innerHTML += '<i class="fa-solid fa-xmark text-red-400"></i>';
          } else {
            btn.classList.add("opacity-40");
          }
        });

        feedbackEl.classList.remove("hidden");
        if (isCorrect) {
          feedbackEl.innerHTML = `<h4 class="font-bold text-green-400 text-xl mb-2">å¤ªæ£’äº†ï¼</h4><p>${item.feedback}</p>`;
          addXP(50);
          playSystemSound("correct");
        } else {
          feedbackEl.innerHTML = `<h4 class="font-bold text-yellow-400 text-xl mb-2">å†æ¥å†å²</h4><p>æ­£ç¢ºç­”æ¡ˆæ›´ç”Ÿå‹•åœ°é«”ç¾äº†æ“¬äººæ³•çš„ç²¾é«“ã€‚${item.feedback}</p>`;
          playSystemSound("wrong");
        }

        document.getElementById("writing-next-btn").classList.remove("hidden");
        document.getElementById("writing-next-btn").classList.add("block");
      }

      function nextWriting() {
        state.writingIndex++;
        renderWriting();
      }

      // Initialize
      window.onload = init;
    </script>
  </body>
</html>
