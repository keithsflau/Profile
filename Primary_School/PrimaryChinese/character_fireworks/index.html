<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä¸­æ–‡å­—ç…™èŠ± | æ¼¢å­—å­¸ç¿’éŠæˆ²</title>
    <meta
      name="description"
      content="é€éç…™èŠ±å‹•ç•«å­¸ç¿’ä¸­æ–‡å­—ï¼Œé©åˆå°å­¸ç”Ÿçš„äº’å‹•å­¸ç¿’éŠæˆ²"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #ff6b6b;
        --secondary: #4ecdc4;
        --accent: #ffe66d;
        --dark: #1a1a2e;
        --darker: #0f0f1a;
        --text: #ffffff;
        --text-dim: rgba(255, 255, 255, 0.7);
        --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --glow: 0 0 20px rgba(255, 107, 107, 0.5);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans TC", sans-serif;
        background: var(--darker);
        min-height: 100vh;
        overflow-x: hidden;
        color: var(--text);
      }

      /* Animated Background */
      .bg-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f0f1a 100%
        );
        overflow: hidden;
      }

      .stars {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .star {
        position: absolute;
        width: 3px;
        height: 3px;
        background: white;
        border-radius: 50%;
        animation: twinkle 2s infinite ease-in-out;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      /* Fireworks Canvas */
      #fireworks-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
      }

      /* Main Container */
      .container {
        position: relative;
        z-index: 2;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        min-height: 100vh;
      }

      /* Header */
      header {
        text-align: center;
        padding: 2rem 0 3rem;
      }

      .logo {
        font-size: 3.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #ff6b6b, #ffe66d, #4ecdc4, #667eea);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: gradientShift 5s ease infinite;
        text-shadow: 0 0 30px rgba(255, 107, 107, 0.3);
        margin-bottom: 0.5rem;
      }

      @keyframes gradientShift {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .subtitle {
        font-size: 1.2rem;
        color: var(--text-dim);
        letter-spacing: 3px;
      }

      /* Game Stats */
      .stats-bar {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 1rem 2rem;
        border-radius: 50px;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .stat-item:hover {
        transform: translateY(-3px);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .stat-icon {
        font-size: 1.5rem;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent);
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--text-dim);
      }

      /* Game Area */
      .game-area {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      @media (max-width: 900px) {
        .game-area {
          grid-template-columns: 1fr;
        }
      }

      /* Character Display */
      .character-display {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 30px;
        padding: 3rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .character-display::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 107, 107, 0.1) 0%,
          transparent 50%
        );
        animation: pulse 4s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.5;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
      }

      .character-label {
        font-size: 1rem;
        color: var(--text-dim);
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 3px;
      }

      .main-character {
        font-size: 10rem;
        font-weight: 900;
        line-height: 1;
        background: var(--gradient-2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1.5rem;
        position: relative;
        z-index: 1;
        transition: all 0.3s ease;
      }

      .main-character.correct {
        animation: celebrate 0.5s ease;
      }

      @keyframes celebrate {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .pinyin {
        font-size: 2rem;
        color: var(--secondary);
        margin-bottom: 0.5rem;
      }

      .meaning {
        font-size: 1.2rem;
        color: var(--text-dim);
      }

      /* Answer Section */
      .answer-section {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 30px;
        padding: 3rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .options-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }

      .option-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 1.5rem;
        font-size: 3rem;
        font-family: "Noto Sans TC", sans-serif;
        color: var(--text);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .option-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .option-btn:hover::before {
        left: 100%;
      }

      .option-btn:hover {
        transform: translateY(-5px);
        border-color: var(--secondary);
        box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
      }

      .option-btn.correct {
        background: linear-gradient(135deg, #00b894, #00cec9);
        border-color: #00b894;
        animation: correctPulse 0.5s ease;
      }

      .option-btn.wrong {
        background: linear-gradient(135deg, #d63031, #e17055);
        border-color: #d63031;
        animation: shake 0.5s ease;
      }

      @keyframes correctPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      /* Progress Bar */
      .progress-section {
        margin-top: 2rem;
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-dim);
      }

      .progress-bar {
        height: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: var(--gradient-3);
        border-radius: 10px;
        transition: width 0.5s ease;
      }

      /* Mode Selection */
      .mode-selection {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .mode-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        padding: 0.75rem 2rem;
        font-size: 1rem;
        font-family: "Noto Sans TC", sans-serif;
        color: var(--text);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .mode-btn:hover {
        border-color: var(--primary);
      }

      .mode-btn.active {
        background: var(--gradient-1);
        border-color: transparent;
      }

      /* Streak Display */
      .streak-container {
        position: fixed;
        top: 2rem;
        right: 2rem;
        z-index: 100;
      }

      .streak-badge {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        padding: 1rem 1.5rem;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4);
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .streak-fire {
        font-size: 1.5rem;
      }

      .streak-number {
        font-size: 1.5rem;
        font-weight: 700;
      }

      /* Result Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 1000;
        display: none;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .modal-overlay.active {
        display: flex;
        opacity: 1;
      }

      .modal-content {
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        border-radius: 30px;
        padding: 3rem;
        text-align: center;
        max-width: 500px;
        width: 90%;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }

      .modal-overlay.active .modal-content {
        transform: scale(1);
      }

      .modal-icon {
        font-size: 5rem;
        margin-bottom: 1rem;
      }

      .modal-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        background: var(--gradient-2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .modal-stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin: 2rem 0;
      }

      .modal-stat {
        text-align: center;
      }

      .modal-stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--accent);
      }

      .modal-stat-label {
        font-size: 0.9rem;
        color: var(--text-dim);
      }

      .modal-btn {
        background: var(--gradient-1);
        border: none;
        border-radius: 50px;
        padding: 1rem 3rem;
        font-size: 1.2rem;
        font-family: "Noto Sans TC", sans-serif;
        color: var(--text);
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
      }

      .modal-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      /* Footer */
      footer {
        text-align: center;
        padding: 2rem;
        color: var(--text-dim);
        font-size: 0.9rem;
      }

      footer a {
        color: var(--secondary);
        text-decoration: none;
      }

      /* Responsive */
      @media (max-width: 600px) {
        .logo {
          font-size: 2.5rem;
        }

        .main-character {
          font-size: 6rem;
        }

        .stats-bar {
          gap: 1rem;
        }

        .stat-item {
          padding: 0.75rem 1.25rem;
        }

        .option-btn {
          font-size: 2rem;
          padding: 1rem;
        }

        .streak-container {
          top: 1rem;
          right: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-animation">
      <div class="stars" id="stars"></div>
    </div>

    <canvas id="fireworks-canvas"></canvas>

    <div class="streak-container" id="streak-container" style="display: none">
      <div class="streak-badge">
        <span class="streak-fire">ğŸ”¥</span>
        <span class="streak-number" id="streak-number">0</span>
      </div>
    </div>

    <div class="container">
      <header>
        <h1 class="logo">ğŸ† ä¸­æ–‡å­—ç…™èŠ± ğŸ†</h1>
        <p class="subtitle">çœ‹æ‹¼éŸ³é¸æ¼¢å­— Â· ç­”å°æ”¾ç…™èŠ±</p>
      </header>

      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-icon">âœ…</span>
          <div>
            <div class="stat-value" id="correct-count">0</div>
            <div class="stat-label">æ­£ç¢º</div>
          </div>
        </div>
        <div class="stat-item">
          <span class="stat-icon">âŒ</span>
          <div>
            <div class="stat-value" id="wrong-count">0</div>
            <div class="stat-label">éŒ¯èª¤</div>
          </div>
        </div>
        <div class="stat-item">
          <span class="stat-icon">ğŸ¯</span>
          <div>
            <div class="stat-value" id="accuracy">0%</div>
            <div class="stat-label">æº–ç¢ºç‡</div>
          </div>
        </div>
      </div>

      <div class="mode-selection">
        <button class="mode-btn active" data-mode="p1">å°ä¸€</button>
        <button class="mode-btn" data-mode="p2">å°äºŒ</button>
        <button class="mode-btn" data-mode="p3">å°ä¸‰</button>
        <button class="mode-btn" data-mode="p4">å°å››</button>
        <button class="mode-btn" data-mode="p5">å°äº”</button>
        <button class="mode-btn" data-mode="p6">å°å…­</button>
      </div>

      <div class="game-area">
        <div class="character-display">
          <div class="character-label">è«‹é¸æ“‡æ­£ç¢ºçš„æ¼¢å­—</div>
          <div class="pinyin" id="pinyin">zÃ¬</div>
          <div class="main-character" id="main-character">?</div>
          <div class="meaning" id="meaning">ç­‰å¾…é¸æ“‡...</div>
        </div>

        <div class="answer-section">
          <h2 class="section-title">ğŸ¯ é¸æ“‡ç­”æ¡ˆ</h2>
          <div class="options-grid" id="options-grid">
            <button class="option-btn" data-index="0">å­—</button>
            <button class="option-btn" data-index="1">å­</button>
            <button class="option-btn" data-index="2">è‡ª</button>
            <button class="option-btn" data-index="3">ç´«</button>
          </div>

          <div class="progress-section">
            <div class="progress-header">
              <span>é€²åº¦</span>
              <span id="progress-text">0 / 10</span>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="progress-fill"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <p>ğŸ’¡ å°æç¤ºï¼šä»”ç´°çœ‹æ‹¼éŸ³ï¼Œé¸æ“‡æ­£ç¢ºçš„æ¼¢å­— ğŸ’¡</p>
      </footer>
    </div>

    <!-- Result Modal -->
    <div class="modal-overlay" id="result-modal">
      <div class="modal-content">
        <div class="modal-icon">ğŸŠ</div>
        <h2 class="modal-title">æ­å–œå®Œæˆï¼</h2>
        <div class="modal-stats">
          <div class="modal-stat">
            <div class="modal-stat-value" id="final-correct">0</div>
            <div class="modal-stat-label">æ­£ç¢º</div>
          </div>
          <div class="modal-stat">
            <div class="modal-stat-value" id="final-accuracy">0%</div>
            <div class="modal-stat-label">æº–ç¢ºç‡</div>
          </div>
          <div class="modal-stat">
            <div class="modal-stat-value" id="final-streak">0</div>
            <div class="modal-stat-label">æœ€é«˜é€£æ“Š</div>
          </div>
        </div>
        <button class="modal-btn" id="restart-btn">å†ç©ä¸€æ¬¡ ğŸ®</button>
      </div>
    </div>

    <!-- Visit Counter -->
    <div id="visit-counter-container"></div>
    <script src="../../../visit-counter.js"></script>

    <script>
      // Character Database by Grade Level
      const characterDB = {
        p1: [
          {
            char: "äºº",
            pinyin: "rÃ©n",
            meaning: "äººé¡",
            options: ["äºº", "å…¥", "å…«", "å¤§"],
          },
          {
            char: "å¤§",
            pinyin: "dÃ ",
            meaning: "å¤§å°",
            options: ["å¤§", "å¤ª", "å¤©", "å¤«"],
          },
          {
            char: "å°",
            pinyin: "xiÇo",
            meaning: "å°å¤§",
            options: ["å°", "å°‘", "å°–", "æ°´"],
          },
          {
            char: "ä¸Š",
            pinyin: "shÃ ng",
            meaning: "ä¸Šé¢",
            options: ["ä¸Š", "ä¸‹", "æ­¢", "æ­£"],
          },
          {
            char: "ä¸‹",
            pinyin: "xiÃ ",
            meaning: "ä¸‹é¢",
            options: ["ä¸‹", "ä¸Š", "ä¸", "ä¸"],
          },
          {
            char: "å¤©",
            pinyin: "tiÄn",
            meaning: "å¤©ç©º",
            options: ["å¤©", "å¤§", "å¤ª", "å¤«"],
          },
          {
            char: "æ—¥",
            pinyin: "rÃ¬",
            meaning: "å¤ªé™½",
            options: ["æ—¥", "ç›®", "ç™½", "ç”°"],
          },
          {
            char: "æœˆ",
            pinyin: "yuÃ¨",
            meaning: "æœˆäº®",
            options: ["æœˆ", "ç”¨", "æ˜", "æœ‹"],
          },
          {
            char: "æ°´",
            pinyin: "shuÇ",
            meaning: "æ°´æµ",
            options: ["æ°´", "æœ¨", "ç«", "åœŸ"],
          },
          {
            char: "ç«",
            pinyin: "huÇ’",
            meaning: "ç«ç„°",
            options: ["ç«", "æ°´", "æœ¨", "åœŸ"],
          },
          {
            char: "å±±",
            pinyin: "shÄn",
            meaning: "å±±å³°",
            options: ["å±±", "å‡º", "å±¯", "å²³"],
          },
          {
            char: "çŸ³",
            pinyin: "shÃ­",
            meaning: "çŸ³é ­",
            options: ["çŸ³", "å³", "å·¦", "å¸ƒ"],
          },
          {
            char: "ç”°",
            pinyin: "tiÃ¡n",
            meaning: "ç”°åœ°",
            options: ["ç”°", "ç”±", "ç”²", "ç”³"],
          },
          {
            char: "èŠ±",
            pinyin: "huÄ",
            meaning: "èŠ±æœµ",
            options: ["èŠ±", "è‰", "è¯", "åŒ–"],
          },
          {
            char: "é³¥",
            pinyin: "niÇo",
            meaning: "å°é³¥",
            options: ["é³¥", "çƒ", "é¦¬", "é­š"],
          },
        ],
        p2: [
          {
            char: "æ˜",
            pinyin: "mÃ­ng",
            meaning: "æ˜äº®",
            options: ["æ˜", "æœ‹", "æœ", "æœŸ"],
          },
          {
            char: "æ˜Ÿ",
            pinyin: "xÄ«ng",
            meaning: "æ˜Ÿæ˜Ÿ",
            options: ["æ˜Ÿ", "ç”Ÿ", "æ€§", "å§“"],
          },
          {
            char: "é›²",
            pinyin: "yÃºn",
            meaning: "é›²æœµ",
            options: ["é›²", "é›ª", "é›·", "é›»"],
          },
          {
            char: "é¢¨",
            pinyin: "fÄ“ng",
            meaning: "é¢¨å¹",
            options: ["é¢¨", "é¢±", "é¢±", "é£„"],
          },
          {
            char: "é›¨",
            pinyin: "yÇ”",
            meaning: "ä¸‹é›¨",
            options: ["é›¨", "é›ª", "é›²", "é›»"],
          },
          {
            char: "é›ª",
            pinyin: "xuÄ›",
            meaning: "é›ªèŠ±",
            options: ["é›ª", "é›¨", "é›²", "éœœ"],
          },
          {
            char: "æ›¸",
            pinyin: "shÅ«",
            meaning: "æ›¸æœ¬",
            options: ["æ›¸", "ç•«", "æ™", "ç›¡"],
          },
          {
            char: "è®€",
            pinyin: "dÃº",
            meaning: "é–±è®€",
            options: ["è®€", "èª²", "è«‹", "èªª"],
          },
          {
            char: "å¯«",
            pinyin: "xiÄ›",
            meaning: "æ›¸å¯«",
            options: ["å¯«", "å¯«", "å†©", "å†©"],
          },
          {
            char: "å­¸",
            pinyin: "xuÃ©",
            meaning: "å­¸ç¿’",
            options: ["å­¸", "å­¸", "è¦º", "æ¨‚"],
          },
          {
            char: "æ ¡",
            pinyin: "xiÃ o",
            meaning: "å­¸æ ¡",
            options: ["æ ¡", "æ•ˆ", "è¼ƒ", "æ•™"],
          },
          {
            char: "è€",
            pinyin: "lÇo",
            meaning: "è€å¸«",
            options: ["è€", "è€ƒ", "å­", "æ•ˆ"],
          },
          {
            char: "å¸«",
            pinyin: "shÄ«",
            meaning: "è€å¸«",
            options: ["å¸«", "å¸¥", "æ­¸", "ç…"],
          },
          {
            char: "å‹",
            pinyin: "yÇ’u",
            meaning: "æœ‹å‹",
            options: ["å‹", "æœ‰", "åˆ", "å"],
          },
          {
            char: "å®¶",
            pinyin: "jiÄ",
            meaning: "å®¶åº­",
            options: ["å®¶", "è±ª", "è±¡", "åƒ"],
          },
        ],
        p3: [
          {
            char: "åœ‹",
            pinyin: "guÃ³",
            meaning: "åœ‹å®¶",
            options: ["åœ‹", "åœ’", "åœ“", "å›°"],
          },
          {
            char: "åŸ",
            pinyin: "chÃ©ng",
            meaning: "åŸå¸‚",
            options: ["åŸ", "æˆ", "èª ", "ç››"],
          },
          {
            char: "è·¯",
            pinyin: "lÃ¹",
            meaning: "é“è·¯",
            options: ["è·¯", "éœ²", "é™¸", "éŒ„"],
          },
          {
            char: "è»Š",
            pinyin: "chÄ“",
            meaning: "æ±½è»Š",
            options: ["è»Š", "è»", "è¼ª", "è½‰"],
          },
          {
            char: "èˆ¹",
            pinyin: "chuÃ¡n",
            meaning: "èˆ¹éš»",
            options: ["èˆ¹", "èˆª", "èˆ«", "èˆ¬"],
          },
          {
            char: "é£›",
            pinyin: "fÄ“i",
            meaning: "é£›è¡Œ",
            options: ["é£›", "é", "ç¿”", "ç¿…"],
          },
          {
            char: "æ©Ÿ",
            pinyin: "jÄ«",
            meaning: "æ©Ÿå™¨",
            options: ["æ©Ÿ", "é›", "è‚Œ", "é£¢"],
          },
          {
            char: "é›»",
            pinyin: "diÃ n",
            meaning: "é›»åŠ›",
            options: ["é›»", "é›·", "é›²", "éœ§"],
          },
          {
            char: "è©±",
            pinyin: "huÃ ",
            meaning: "èªªè©±",
            options: ["è©±", "ç•«", "è¯", "å˜©"],
          },
          {
            char: "è¦–",
            pinyin: "shÃ¬",
            meaning: "é›»è¦–",
            options: ["è¦–", "æ˜¯", "äº‹", "è©¦"],
          },
          {
            char: "è…¦",
            pinyin: "nÇo",
            meaning: "é›»è…¦",
            options: ["è…¦", "æƒ±", "æ‚©", "ç‘™"],
          },
          {
            char: "ç¶²",
            pinyin: "wÇng",
            meaning: "ç¶²çµ¡",
            options: ["ç¶²", "å¾€", "ç‹", "äº¡"],
          },
          {
            char: "éŠ",
            pinyin: "yÃ³u",
            meaning: "éŠæˆ²",
            options: ["éŠ", "æ¸¸", "æ²¹", "ç”±"],
          },
          {
            char: "æˆ²",
            pinyin: "xÃ¬",
            meaning: "éŠæˆ²",
            options: ["æˆ²", "æˆ¯", "æˆˆ", "æˆ"],
          },
          {
            char: "æ¨‚",
            pinyin: "lÃ¨",
            meaning: "å¿«æ¨‚",
            options: ["æ¨‚", "è—¥", "èº", "ç´„"],
          },
        ],
        p4: [
          {
            char: "æ­·",
            pinyin: "lÃ¬",
            meaning: "æ­·å²",
            options: ["æ­·", "æ›†", "å²", "å‹µ"],
          },
          {
            char: "å²",
            pinyin: "shÇ",
            meaning: "æ­·å²",
            options: ["å²", "å", "ä½¿", "é§›"],
          },
          {
            char: "ç§‘",
            pinyin: "kÄ“",
            meaning: "ç§‘å­¸",
            options: ["ç§‘", "èª²", "æ£µ", "é¡†"],
          },
          {
            char: "æŠ€",
            pinyin: "jÃ¬",
            meaning: "æŠ€è¡“",
            options: ["æŠ€", "æ", "æ”¯", "ä¼"],
          },
          {
            char: "è¡“",
            pinyin: "shÃ¹",
            meaning: "è—è¡“",
            options: ["è¡“", "è¿°", "æ¨¹", "è±"],
          },
          {
            char: "è—",
            pinyin: "yÃ¬",
            meaning: "è—è¡“",
            options: ["è—", "ç¾©", "è­°", "æ†¶"],
          },
          {
            char: "éŸ³",
            pinyin: "yÄ«n",
            meaning: "éŸ³æ¨‚",
            options: ["éŸ³", "é™°", "å› ", "æ®·"],
          },
          {
            char: "èˆ",
            pinyin: "wÇ”",
            meaning: "è·³èˆ",
            options: ["èˆ", "æ­¦", "åˆ", "ç„¡"],
          },
          {
            char: "ç•«",
            pinyin: "huÃ ",
            meaning: "ç¹ªç•«",
            options: ["ç•«", "è©±", "è¯", "åŠƒ"],
          },
          {
            char: "é‹",
            pinyin: "yÃ¹n",
            meaning: "é‹å‹•",
            options: ["é‹", "é›²", "æšˆ", "éŸ»"],
          },
          {
            char: "å‹•",
            pinyin: "dÃ²ng",
            meaning: "é‹å‹•",
            options: ["å‹•", "åƒ", "å‹¤", "å‹"],
          },
          {
            char: "å¥",
            pinyin: "jiÃ n",
            meaning: "å¥åº·",
            options: ["å¥", "å»º", "éµ", "è…±"],
          },
          {
            char: "åº·",
            pinyin: "kÄng",
            meaning: "å¥åº·",
            options: ["åº·", "ç³ ", "æ…·", "ç‚•"],
          },
          {
            char: "å¼·",
            pinyin: "qiÃ¡ng",
            meaning: "å¼·å£¯",
            options: ["å¼·", "ç‰†", "å½Š", "ç–†"],
          },
          {
            char: "å‹‡",
            pinyin: "yÇ’ng",
            meaning: "å‹‡æ•¢",
            options: ["å‹‡", "è¸Š", "æ¹§", "ä¿‘"],
          },
        ],
        p5: [
          {
            char: "ç’°",
            pinyin: "huÃ¡n",
            meaning: "ç’°å¢ƒ",
            options: ["ç’°", "é‚„", "å£", "æ›"],
          },
          {
            char: "å¢ƒ",
            pinyin: "jÃ¬ng",
            meaning: "ç’°å¢ƒ",
            options: ["å¢ƒ", "ç«Ÿ", "é¡", "éœ"],
          },
          {
            char: "ä¿",
            pinyin: "bÇo",
            meaning: "ä¿è­·",
            options: ["ä¿", "å ¡", "å®", "é£½"],
          },
          {
            char: "è­·",
            pinyin: "hÃ¹",
            meaning: "ä¿è­·",
            options: ["è­·", "æˆ¶", "æ»¬", "è”­"],
          },
          {
            char: "æ±¡",
            pinyin: "wÅ«",
            meaning: "æ±¡æŸ“",
            options: ["æ±¡", "çƒ", "å·«", "å—š"],
          },
          {
            char: "æŸ“",
            pinyin: "rÇn",
            meaning: "æ±¡æŸ“",
            options: ["æŸ“", "æ¢", "ç²±", "æ¶¼"],
          },
          {
            char: "ç¯€",
            pinyin: "jiÃ©",
            meaning: "ç¯€ç´„",
            options: ["ç¯€", "çµ", "å‚‘", "æˆª"],
          },
          {
            char: "ç´„",
            pinyin: "yuÄ“",
            meaning: "ç¯€ç´„",
            options: ["ç´„", "æ¨‚", "è—¥", "èº"],
          },
          {
            char: "æº",
            pinyin: "yuÃ¡n",
            meaning: "è³‡æº",
            options: ["æº", "åŸ", "é¡˜", "åœ’"],
          },
          {
            char: "èƒ½",
            pinyin: "nÃ©ng",
            meaning: "èƒ½æº",
            options: ["èƒ½", "æ…‹", "ç†Š", "é¾"],
          },
          {
            char: "æ¸›",
            pinyin: "jiÇn",
            meaning: "æ¸›å°‘",
            options: ["æ¸›", "æ¸›", "æ„Ÿ", "é¹¹"],
          },
          {
            char: "å»¢",
            pinyin: "fÃ¨i",
            meaning: "å»¢ç‰©",
            options: ["å»¢", "ç™¼", "æ³•", "ä¹"],
          },
          {
            char: "ç‰©",
            pinyin: "wÃ¹",
            meaning: "å‹•ç‰©",
            options: ["ç‰©", "å‹¿", "å‹™", "æ‚Ÿ"],
          },
          {
            char: "æ”¶",
            pinyin: "shÅu",
            meaning: "å›æ”¶",
            options: ["æ”¶", "å—", "æˆ", "ç˜¦"],
          },
          {
            char: "å†",
            pinyin: "zÃ i",
            meaning: "å†ç”¨",
            options: ["å†", "åœ¨", "è¼‰", "æ ½"],
          },
        ],
        p6: [
          {
            char: "è²¬",
            pinyin: "zÃ©",
            meaning: "è²¬ä»»",
            options: ["è²¬", "å‚µ", "ç¸¾", "ç©"],
          },
          {
            char: "ä»»",
            pinyin: "rÃ¨n",
            meaning: "è²¬ä»»",
            options: ["ä»»", "ä»", "èª", "å¿"],
          },
          {
            char: "èª ",
            pinyin: "chÃ©ng",
            meaning: "èª å¯¦",
            options: ["èª ", "åŸ", "æˆ", "ç››"],
          },
          {
            char: "å¯¦",
            pinyin: "shÃ­",
            meaning: "èª å¯¦",
            options: ["å¯¦", "çŸ³", "è­˜", "é£Ÿ"],
          },
          {
            char: "å°Š",
            pinyin: "zÅ«n",
            meaning: "å°Šé‡",
            options: ["å°Š", "æ¨½", "éµ", "é‘½"],
          },
          {
            char: "é‡",
            pinyin: "zhÃ²ng",
            meaning: "å°Šé‡",
            options: ["é‡", "ç¨®", "é˜", "è¸µ"],
          },
          {
            char: "å‹¤",
            pinyin: "qÃ­n",
            meaning: "å‹¤å‹",
            options: ["å‹¤", "å‹•", "å‹", "å‹‰"],
          },
          {
            char: "å‹",
            pinyin: "lÃ¡o",
            meaning: "å‹¤å‹",
            options: ["å‹", "æ’ˆ", "å¶—", "ç™†"],
          },
          {
            char: "è¬™",
            pinyin: "qiÄn",
            meaning: "è¬™è™›",
            options: ["è¬™", "å«Œ", "å»‰", "éŒ"],
          },
          {
            char: "è™›",
            pinyin: "xÅ«",
            meaning: "è¬™è™›",
            options: ["è™›", "æ…®", "è™•", "è™"],
          },
          {
            char: "ç¦®",
            pinyin: "lÇ",
            meaning: "ç¦®è²Œ",
            options: ["ç¦®", "è£", "ç†", "é‡Œ"],
          },
          {
            char: "è²Œ",
            pinyin: "mÃ o",
            meaning: "ç¦®è²Œ",
            options: ["è²Œ", "å¸½", "å†’", "èŒ‚"],
          },
          {
            char: "æ™º",
            pinyin: "zhÃ¬",
            meaning: "æ™ºæ…§",
            options: ["æ™º", "çŸ¥", "è‡³", "å¿—"],
          },
          {
            char: "æ…§",
            pinyin: "huÃ¬",
            meaning: "æ™ºæ…§",
            options: ["æ…§", "å½—", "æƒ ", "æœƒ"],
          },
          {
            char: "å¾·",
            pinyin: "dÃ©",
            meaning: "é“å¾·",
            options: ["å¾·", "å¾—", "å¾·", "æ‚³"],
          },
        ],
      };

      // Game State
      let currentMode = "p1";
      let currentQuestions = [];
      let currentQuestionIndex = 0;
      let correctCount = 0;
      let wrongCount = 0;
      let streak = 0;
      let maxStreak = 0;
      let isAnswering = false;

      // DOM Elements
      const pinyinEl = document.getElementById("pinyin");
      const mainCharacterEl = document.getElementById("main-character");
      const meaningEl = document.getElementById("meaning");
      const optionsGrid = document.getElementById("options-grid");
      const correctCountEl = document.getElementById("correct-count");
      const wrongCountEl = document.getElementById("wrong-count");
      const accuracyEl = document.getElementById("accuracy");
      const progressFill = document.getElementById("progress-fill");
      const progressText = document.getElementById("progress-text");
      const streakContainer = document.getElementById("streak-container");
      const streakNumber = document.getElementById("streak-number");
      const resultModal = document.getElementById("result-modal");

      // Initialize Stars
      function initStars() {
        const starsContainer = document.getElementById("stars");
        for (let i = 0; i < 100; i++) {
          const star = document.createElement("div");
          star.className = "star";
          star.style.left = Math.random() * 100 + "%";
          star.style.top = Math.random() * 100 + "%";
          star.style.animationDelay = Math.random() * 2 + "s";
          star.style.opacity = Math.random() * 0.5 + 0.3;
          starsContainer.appendChild(star);
        }
      }

      // Fireworks
      const canvas = document.getElementById("fireworks-canvas");
      const ctx = canvas.getContext("2d");
      let fireworks = [];
      let particles = [];

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      class Firework {
        constructor(x, y, targetY) {
          this.x = x;
          this.y = y;
          this.targetY = targetY;
          this.speed = 8;
          this.alive = true;
          this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
        }

        update() {
          this.y -= this.speed;
          if (this.y <= this.targetY) {
            this.alive = false;
            this.explode();
          }
        }

        explode() {
          const particleCount = 80;
          for (let i = 0; i < particleCount; i++) {
            const angle = (Math.PI * 2 * i) / particleCount;
            const speed = Math.random() * 6 + 2;
            particles.push(
              new Particle(
                this.x,
                this.y,
                Math.cos(angle) * speed,
                Math.sin(angle) * speed,
                this.color
              )
            );
          }
        }

        draw() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
        }
      }

      class Particle {
        constructor(x, y, vx, vy, color) {
          this.x = x;
          this.y = y;
          this.vx = vx;
          this.vy = vy;
          this.color = color;
          this.alpha = 1;
          this.decay = Math.random() * 0.02 + 0.01;
          this.size = Math.random() * 3 + 1;
        }

        update() {
          this.x += this.vx;
          this.y += this.vy;
          this.vy += 0.05; // gravity
          this.alpha -= this.decay;
          this.vx *= 0.99;
          this.vy *= 0.99;
        }

        draw() {
          ctx.save();
          ctx.globalAlpha = this.alpha;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
          ctx.restore();
        }
      }

      function launchFireworks(count = 5) {
        for (let i = 0; i < count; i++) {
          setTimeout(() => {
            const x = Math.random() * canvas.width * 0.6 + canvas.width * 0.2;
            const targetY =
              Math.random() * canvas.height * 0.3 + canvas.height * 0.1;
            fireworks.push(new Firework(x, canvas.height, targetY));
          }, i * 200);
        }
      }

      function animateFireworks() {
        ctx.fillStyle = "rgba(15, 15, 26, 0.1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        fireworks = fireworks.filter((f) => f.alive);
        particles = particles.filter((p) => p.alpha > 0);

        fireworks.forEach((f) => {
          f.update();
          f.draw();
        });

        particles.forEach((p) => {
          p.update();
          p.draw();
        });

        requestAnimationFrame(animateFireworks);
      }

      // Shuffle Array
      function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      // Start Game
      function startGame() {
        currentQuestions = shuffleArray(characterDB[currentMode]).slice(0, 10);
        currentQuestionIndex = 0;
        correctCount = 0;
        wrongCount = 0;
        streak = 0;
        maxStreak = 0;
        updateStats();
        loadQuestion();
      }

      // Load Question
      function loadQuestion() {
        if (currentQuestionIndex >= currentQuestions.length) {
          showResults();
          return;
        }

        const question = currentQuestions[currentQuestionIndex];
        pinyinEl.textContent = question.pinyin;
        mainCharacterEl.textContent = "?";
        meaningEl.textContent = question.meaning;

        const shuffledOptions = shuffleArray(question.options);
        const buttons = optionsGrid.querySelectorAll(".option-btn");
        buttons.forEach((btn, i) => {
          btn.textContent = shuffledOptions[i];
          btn.className = "option-btn";
          btn.disabled = false;
        });

        updateProgress();
      }

      // Handle Answer
      function handleAnswer(selectedChar, button) {
        if (isAnswering) return;
        isAnswering = true;

        const question = currentQuestions[currentQuestionIndex];
        const isCorrect = selectedChar === question.char;

        if (isCorrect) {
          correctCount++;
          streak++;
          if (streak > maxStreak) maxStreak = streak;
          button.classList.add("correct");
          mainCharacterEl.textContent = question.char;
          mainCharacterEl.classList.add("correct");
          launchFireworks(streak >= 3 ? 8 : 5);

          if (streak >= 2) {
            streakContainer.style.display = "block";
            streakNumber.textContent = streak;
          }
        } else {
          wrongCount++;
          streak = 0;
          streakContainer.style.display = "none";
          button.classList.add("wrong");

          // Show correct answer
          const buttons = optionsGrid.querySelectorAll(".option-btn");
          buttons.forEach((btn) => {
            if (btn.textContent === question.char) {
              btn.classList.add("correct");
            }
          });
          mainCharacterEl.textContent = question.char;
        }

        // Disable all buttons
        const buttons = optionsGrid.querySelectorAll(".option-btn");
        buttons.forEach((btn) => (btn.disabled = true));

        updateStats();

        setTimeout(() => {
          mainCharacterEl.classList.remove("correct");
          currentQuestionIndex++;
          isAnswering = false;
          loadQuestion();
        }, 1500);
      }

      // Update Stats
      function updateStats() {
        correctCountEl.textContent = correctCount;
        wrongCountEl.textContent = wrongCount;
        const total = correctCount + wrongCount;
        const accuracy =
          total > 0 ? Math.round((correctCount / total) * 100) : 0;
        accuracyEl.textContent = accuracy + "%";
      }

      // Update Progress
      function updateProgress() {
        const progress = (currentQuestionIndex / currentQuestions.length) * 100;
        progressFill.style.width = progress + "%";
        progressText.textContent = `${currentQuestionIndex} / ${currentQuestions.length}`;
      }

      // Show Results
      function showResults() {
        document.getElementById("final-correct").textContent = correctCount;
        const total = correctCount + wrongCount;
        const accuracy =
          total > 0 ? Math.round((correctCount / total) * 100) : 0;
        document.getElementById("final-accuracy").textContent = accuracy + "%";
        document.getElementById("final-streak").textContent = maxStreak;
        resultModal.classList.add("active");
        launchFireworks(10);
      }

      // Event Listeners
      optionsGrid.addEventListener("click", (e) => {
        if (e.target.classList.contains("option-btn")) {
          handleAnswer(e.target.textContent, e.target);
        }
      });

      document.querySelectorAll(".mode-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".mode-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          currentMode = btn.dataset.mode;
          startGame();
        });
      });

      document.getElementById("restart-btn").addEventListener("click", () => {
        resultModal.classList.remove("active");
        startGame();
      });

      // Initialize
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
      initStars();
      animateFireworks();
      startGame();

      // Visit Counter
      if (typeof VisitCounter !== "undefined") {
        const SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycby5jEjDAcEM6TttPbwwh1tvXPo_-W7YrNlKfJRV82PjkmAHvR_wILhA7h-zIRPF7oTRTw/exec";
        VisitCounter.init("primary_school/primarychinese/character_fireworks", {
          scriptUrl: SCRIPT_URL,
          containerId: "visit-counter-container",
        });
      }
    </script>
  </body>
</html>
