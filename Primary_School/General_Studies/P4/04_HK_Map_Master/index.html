<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - HK Map Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: skyblue;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Hong Kong Map Master",
          zh: "È¶ôÊ∏ØÂú∞ÂúñÂ§ßÂ∏´",
          ja: "È¶ôÊ∏ØÂú∞Âõ≥„Éû„Çπ„Çø„Éº",
          ko: "ÌôçÏΩ© ÏßÄÎèÑ ÎßàÏä§ÌÑ∞",
          es: "Maestro del Mapa de Hong Kong",
          de: "Hongkong-Kartenmeister",
          fi: "Hongkongin karttamestari",
          fr: "Ma√Ætre de la carte de Hong Kong",
          ar: "ÿÆÿ®Ÿäÿ± ÿÆÿ±Ÿäÿ∑ÿ© ŸáŸàŸÜÿ∫ ŸÉŸàŸÜÿ∫",
          it: "Maestro della Mappa di Hong Kong",
        },
        instruction: {
          en: "Identify the districts!",
          zh: "Ëæ®Ë™çÈÄô‰∫õÂú∞ÂçÄÔºÅ",
          ja: "Âú∞Âå∫„ÇíÁâπÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÏßÄÏó≠ÏùÑ ÏãùÎ≥ÑÌïòÏÑ∏Ïöî!",
          es: "¬°Identifica los distritos!",
          de: "Erkenne die Bezirke!",
          fi: "Tunnista alueet!",
          fr: "Identifiez les quartiers !",
          ar: "ÿ≠ÿØÿØ ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ!",
          it: "Identifica i distretti!",
        },
        hk_island: {
          en: "Hong Kong Island",
          zh: "È¶ôÊ∏ØÂ≥∂",
          ja: "È¶ôÊ∏ØÂ≥∂",
          ko: "ÌôçÏΩ© ÏÑ¨",
          es: "Isla de Hong Kong",
          de: "Hongkong-Insel",
          fi: "Hongkongin saari",
          fr: "√éle de Hong Kong",
          ar: "ÿ¨ÿ≤Ÿäÿ±ÿ© ŸáŸàŸÜÿ∫ ŸÉŸàŸÜÿ∫",
          it: "Isola di Hong Kong",
        },
        kowloon: {
          en: "Kowloon",
          zh: "‰πùÈæç",
          ja: "‰πùÈæç",
          ko: "Íµ¨Î£°",
          es: "Kowloon",
          de: "Kowloon",
          fi: "Kowloon",
          fr: "Kowloon",
          ar: "ŸÉŸàŸÑŸàŸÜ",
          it: "Kowloon",
        },
        nt: {
          en: "New Territories",
          zh: "Êñ∞Áïå",
          ja: "Êñ∞Áïå",
          ko: "Ïã†Í≥Ñ",
          es: "Nuevos Territorios",
          de: "Neue Territorien",
          fi: "Uudet alueet",
          fr: "Nouveaux Territoires",
          ar: "ÿßŸÑÿ£ŸÇÿßŸÑŸäŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿ©",
          it: "Nuovi Territori",
        },
        lantau: {
          en: "Lantau Island",
          zh: "Â§ßÂ∂ºÂ±±",
          ja: "„É©„É≥„Çø„Ç™Â≥∂",
          ko: "ÎûÄÌÉÄÏö∞ ÏÑ¨",
          es: "Isla Lantau",
          de: "Lantau-Insel",
          fi: "Lantaun saari",
          fr: "√éle de Lantau",
          ar: "ÿ¨ÿ≤Ÿäÿ±ÿ© ŸÑÿßŸÜÿ™ÿßŸà",
          it: "Isola di Lantau",
        },
        correct: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµ!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        wrong: {
          en: "Try Again",
          zh: "ÂÜçË©¶‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶",
          ko: "Îã§Ïãú ÏãúÎèÑ",
          es: "Intentar de nuevo",
          de: "Versuch es nochmal",
          fi: "Yrit√§ uudelleen",
          fr: "R√©essayez",
          ar: "ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Riprova",
        },
      };

      const districts = [
        { id: "hk_island", x: 60, y: 70, w: 20, h: 10, color: "bg-red-400" },
        { id: "kowloon", x: 60, y: 55, w: 15, h: 10, color: "bg-orange-400" },
        { id: "nt", x: 50, y: 30, w: 40, h: 25, color: "bg-green-400" },
        { id: "lantau", x: 25, y: 65, w: 20, h: 15, color: "bg-purple-400" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [selectedId, setSelectedId] = useState(null);
        const [feedback, setFeedback] = useState(null);
        const [completed, setCompleted] = useState({});

        const getText = (key) => t[key][lang] || t[key]["en"];

        const handleSelect = (id) => {
          if (completed[id]) return;

          if (!selectedId) {
            return;
          }

          if (selectedId === id) {
            setCompleted((prev) => ({ ...prev, [id]: true }));
            setFeedback("correct");
            setSelectedId(null);
            setTimeout(() => setFeedback(null), 1000);
          } else {
            setFeedback("wrong");
            setTimeout(() => setFeedback(null), 500);
          }
        };

        const startSelection = (id) => {
          setSelectedId(id);
        };

        return (
          <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden bg-blue-300">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-3xl font-black text-white drop-shadow-md mb-4 absolute top-8">
              {getText("title")}
            </h1>

            <div className="bg-white/90 p-6 rounded-xl shadow-lg z-10 w-full max-w-4xl h-[600px] relative mt-16 flex flex-col items-center">
              {/* Map Container */}
              <div className="relative w-full flex-grow bg-blue-100 rounded-xl overflow-hidden mb-4">
                {/* Simplified Map Areas created with absolute divs for now. SVG preferred in production */}
                {districts.map((d) => (
                  <motion.div
                    key={d.id}
                    initial={{ opacity: 0.8 }}
                    whileHover={{ opacity: 1, scale: 1.05 }}
                    className={`absolute rounded-2xl cursor-pointer flex items-center justify-center text-center shadow-lg border-2 border-white
                           ${d.color} ${completed[d.id] ? "brightness-110" : ""}
                        `}
                    style={{
                      left: d.x + "%",
                      top: d.y + "%",
                      width: d.w + "%",
                      height: d.h + "%",
                    }}
                    onClick={() => handleSelect(d.id)}
                  >
                    {completed[d.id] && (
                      <span className="font-bold text-white drop-shadow-md text-sm md:text-xl">
                        {getText(d.id)}
                      </span>
                    )}
                  </motion.div>
                ))}
              </div>

              {/* Labels to drag/click */}
              <div className="flex flex-wrap gap-2 justify-center">
                <div className="w-full text-center font-bold text-slate-700 bg-white/80 p-2 rounded mb-2">
                  {feedback ? getText(feedback) : getText("instruction")}
                </div>
                {districts.map(
                  (d) =>
                    !completed[d.id] && (
                      <button
                        key={d.id}
                        onClick={() => startSelection(d.id)}
                        className={`px-4 py-2 rounded-lg font-bold shadow-md transition-all text-left
                              ${
                                selectedId === d.id
                                  ? "bg-yellow-400 text-slate-900 border-2 border-slate-900 scale-105"
                                  : "bg-white text-slate-700 hover:bg-slate-100"
                              }
                           `}
                      >
                        üìç {getText(d.id)}
                      </button>
                    )
                )}
                {Object.keys(completed).length === districts.length && (
                  <div className="bg-green-500 text-white font-bold p-4 rounded-xl text-center animate-bounce">
                    {getText("correct")}
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
