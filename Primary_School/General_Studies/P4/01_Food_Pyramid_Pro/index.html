<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Food Pyramid Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: linear-gradient(135deg, #fef9c3 0%, #dbeafe 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Food Pyramid",
          zh: "é£Ÿç‰©é‡‘å­—å¡”",
          ja: "é£Ÿå“ãƒ”ãƒ©ãƒŸãƒƒãƒ‰",
          ko: "ì‹í’ˆ í”¼ë¼ë¯¸ë“œ",
          es: "PirÃ¡mide Alimenticia",
          de: "Lebensmittelpyramide",
          fi: "Ruokapyramidi",
          fr: "Pyramide alimentaire",
          ar: "Ø§Ù„Ù‡Ø±Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ",
          it: "Piramide Alimentare",
        },
        instruction: {
          en: "Drag the food to the correct level!",
          zh: "å°‡é£Ÿç‰©æ‹–åˆ°æ­£ç¢ºçš„å±¤ç´šï¼",
          ja: "é£Ÿã¹ç‰©ã‚’æ­£ã—ã„ãƒ¬ãƒ™ãƒ«ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„ï¼",
          ko: "ìŒì‹ì„ ì˜¬ë°”ë¥¸ ë‹¨ê³„ë¡œ ë“œëž˜ê·¸í•˜ì„¸ìš”!",
          es: "Â¡Arrastra la comida al nivel correcto!",
          de: "Ziehe das Essen auf die richtige Ebene!",
          fi: "VedÃ¤ ruoka oikealle tasolle!",
          fr: "Faites glisser la nourriture au bon niveau !",
          ar: "Ø§Ø³Ø­Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ­ÙŠØ­!",
          it: "Trascina il cibo al livello corretto!",
        },
        correct: {
          en: "Correct!",
          zh: "ç­”å°äº†ï¼",
          ja: "æ­£è§£ï¼",
          ko: "ì •ë‹µ!",
          es: "Â¡Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ØµØ­ÙŠØ­!",
          it: "Corretto!",
        },
        wrong: {
          en: "Try Again",
          zh: "å†è©¦ä¸€æ¬¡",
          ja: "ã‚‚ã†ä¸€åº¦",
          ko: "ë‹¤ì‹œ ì‹œë„",
          es: "IntÃ©ntalo de nuevo",
          de: "Versuch es nochmal",
          fi: "YritÃ¤ uudelleen",
          fr: "RÃ©essayez",
          ar: "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",
          it: "Riprova",
        },
        level1: {
          en: "Eat Most",
          zh: "åƒæœ€å¤š",
          ja: "æœ€ã‚‚å¤šãé£Ÿã¹ã‚‹",
          ko: "ê°€ìž¥ ë§Žì´ ì„­ì·¨",
          es: "Comer mÃ¡s",
          de: "Am meisten essen",
          fi: "SyÃ¶ eniten",
          fr: "Manger le plus",
          ar: "ÙƒÙ„ Ø£ÙƒØ«Ø±",
          it: "Mangia di piÃ¹",
        },
        level2: {
          en: "Eat More",
          zh: "åƒå¤šäº›",
          ja: "å¤šã‚ã«é£Ÿã¹ã‚‹",
          ko: "ë§Žì´ ì„­ì·¨",
          es: "Comer mucho",
          de: "Mehr essen",
          fi: "SyÃ¶ enemmÃ¤n",
          fr: "Manger plus",
          ar: "ÙƒÙ„ ÙƒØ«ÙŠØ±Ø§",
          it: "Mangia molto",
        },
        level3: {
          en: "Eat Moderately",
          zh: "åƒé©é‡",
          ja: "é©åº¦ã«é£Ÿã¹ã‚‹",
          ko: "ì ë‹¹ížˆ ì„­ì·¨",
          es: "Comer moderadamente",
          de: "MÃ¤ÃŸig essen",
          fi: "SyÃ¶ kohtuullisesti",
          fr: "Manger modÃ©rÃ©ment",
          ar: "ÙƒÙ„ Ø¨Ø§Ø¹ØªØ¯Ø§Ù„",
          it: "Mangia moderatamente",
        },
        level4: {
          en: "Eat Less",
          zh: "åƒæœ€å°‘",
          ja: "æŽ§ãˆã‚ã«é£Ÿã¹ã‚‹",
          ko: "ì ê²Œ ì„­ì·¨",
          es: "Comer menos",
          de: "Weniger essen",
          fi: "SyÃ¶ vÃ¤hemmÃ¤n",
          fr: "Manger moins",
          ar: "ÙƒÙ„ Ø£Ù‚Ù„",
          it: "Mangia meno",
        },
        grains: {
          en: "Grains",
          zh: "ç©€ç‰©é¡ž",
          ja: "ç©€ç‰©",
          ko: "ê³¡ë¬¼",
          es: "Granos",
          de: "Getreide",
          fi: "Viljat",
          fr: "CÃ©rÃ©ales",
          ar: "Ø§Ù„Ø­Ø¨ÙˆØ¨",
          it: "Cereali",
        },
        veg_fruit: {
          en: "Vegetables & Fruits",
          zh: "è”¬èœåŠæ°´æžœé¡ž",
          ja: "é‡Žèœã¨æžœç‰©",
          ko: "ì±„ì†Œ ë° ê³¼ì¼",
          es: "Verduras y Frutas",
          de: "GemÃ¼se & Obst",
          fi: "Vihannekset & HedelmÃ¤t",
          fr: "LÃ©gumes et fruits",
          ar: "Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª ÙˆØ§Ù„ÙÙˆØ§ÙƒÙ‡",
          it: "Verdura e Frutta",
        },
        meat_dairy: {
          en: "Meat, Fish, Egg & Dairy",
          zh: "è‚‰ã€é­šã€è›‹åŠå¥¶é¡ž",
          ja: "è‚‰ã€é­šã€åµã€ä¹³è£½å“",
          ko: "ê³ ê¸°, ìƒì„ , ê³„ëž€ ë° ìœ ì œí’ˆ",
          es: "Carne, pescado, huevo y lÃ¡cteos",
          de: "Fleisch, Fisch, Ei & Milchprodukte",
          fi: "Liha, kala, muna ja maitotuotteet",
          fr: "Viande, poisson, Å“uf et produits laitiers",
          ar: "Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ùƒ ÙˆØ§Ù„Ø¨ÙŠØ¶ ÙˆÙ…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ù„Ø¨Ø§Ù†",
          it: "Carne, Pesce, Uova e Latticini",
        },
        fat_sugar: {
          en: "Fat, Oil, Sugar & Salt",
          zh: "æ²¹ã€é¹½ã€ç³–",
          ja: "è„‚è‚ªã€æ²¹ã€ç ‚ç³–ã€å¡©",
          ko: "ì§€ë°©, ê¸°ë¦„, ì„¤íƒ• ë° ì†Œê¸ˆ",
          es: "Grasa, aceite, azÃºcar y sal",
          de: "Fett, Ã–l, Zucker & Salz",
          fi: "Rasva, Ã¶ljy, sokeri ja suola",
          fr: "Graisse, huile, sucre et sel",
          ar: "Ø§Ù„Ø¯Ù‡ÙˆÙ† ÙˆØ§Ù„Ø²ÙŠØª ÙˆØ§Ù„Ø³ÙƒØ± ÙˆØ§Ù„Ù…Ù„Ø­",
          it: "Grasso, Olio, Zucchero e Sale",
        },
      };

      const foods = [
        { id: "rice", icon: "ðŸš", name: "Rice", level: 1 },
        { id: "bread", icon: "ðŸž", name: "Bread", level: 1 },
        { id: "noodle", icon: "ðŸœ", name: "Noodle", level: 1 },
        { id: "corn", icon: "ðŸŒ½", name: "Corn", level: 1 },
        { id: "broccoli", icon: "ðŸ¥¦", name: "Broccoli", level: 2 },
        { id: "apple", icon: "ðŸŽ", name: "Apple", level: 2 },
        { id: "carrot", icon: "ðŸ¥•", name: "Carrot", level: 2 },
        { id: "banana", icon: "ðŸŒ", name: "Banana", level: 2 },
        { id: "fish", icon: "ðŸŸ", name: "Fish", level: 3 },
        { id: "meat", icon: "ðŸ¥©", name: "Meat", level: 3 },
        { id: "milk", icon: "ðŸ¥›", name: "Milk", level: 3 },
        { id: "egg", icon: "ðŸ¥š", name: "Egg", level: 3 },
        { id: "candy", icon: "ðŸ¬", name: "Candy", level: 4 },
        { id: "cake", icon: "ðŸ°", name: "Cake", level: 4 },
        { id: "chips", icon: "ðŸŸ", name: "Chips", level: 4 },
        { id: "cola", icon: "ðŸ¥¤", name: "Cola", level: 4 },
      ];

      const levels = [
        { id: 4, name: "fat_sugar", label: "level4", color: "bg-red-200" },
        { id: 3, name: "meat_dairy", label: "level3", color: "bg-yellow-200" },
        { id: 2, name: "veg_fruit", label: "level2", color: "bg-green-200" },
        { id: 1, name: "grains", label: "level1", color: "bg-orange-200" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [queue, setQueue] = useState([]);
        const [currentFood, setCurrentFood] = useState(null);
        const [feedback, setFeedback] = useState(null);
        const [score, setScore] = useState(0);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          startGame();
        }, []);

        const startGame = () => {
          const shuffled = [...foods].sort(() => Math.random() - 0.5);
          setQueue(shuffled);
          setCurrentFood(shuffled[0]);
          setFeedback(null);
          setScore(0);
        };

        const handleDrop = (levelId) => {
          if (feedback) return;

          if (currentFood.level === levelId) {
            setFeedback("correct");
            setScore(score + 10);
            setTimeout(() => {
              setFeedback(null);
              const nextIndex = queue.indexOf(currentFood) + 1;
              if (nextIndex < queue.length) {
                setCurrentFood(queue[nextIndex]);
              } else {
                setCurrentFood(null); // GameOver
              }
            }, 1000);
          } else {
            setFeedback("wrong");
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        return (
          <div className="min-h-screen flex flex-col items-center justify-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-4 text-slate-800">
              {getText("title")}
            </h1>
            <p className="mb-4 text-xl text-slate-600">
              {getText("instruction")}
            </p>

            <div className="flex flex-col md:flex-row gap-8 w-full max-w-5xl items-center justify-center">
              {/* Pyramid */}
              <div className="flex flex-col items-center w-full md:w-1/2 gap-1">
                {levels.map((lvl) => (
                  <div
                    key={lvl.id}
                    onClick={() => handleDrop(lvl.id)}
                    className={`w-full ${
                      lvl.id === 4
                        ? "w-[40%]"
                        : lvl.id === 3
                        ? "w-[60%]"
                        : lvl.id === 2
                        ? "w-[80%]"
                        : "w-full"
                    } 
                      ${
                        lvl.color
                      } p-4 rounded-xl text-center cursor-pointer hover:opacity-80 transition-all border-2 border-white shadow-md relative`}
                  >
                    <div className="font-bold text-slate-700">
                      {getText(lvl.name)}
                    </div>
                    <div className="text-xs text-slate-500">
                      {getText(lvl.label)}
                    </div>
                  </div>
                ))}
              </div>

              {/* Food Item */}
              <div className="flex flex-col items-center justify-center w-full md:w-1/2 h-64 bg-white/50 rounded-3xl relative">
                {currentFood ? (
                  <motion.div
                    key={currentFood.id}
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className="flex flex-col items-center"
                    draggable
                  >
                    <div className="text-9xl mb-2 filter drop-shadow-xl cursor-grab active:cursor-grabbing hover:scale-110 transition-transform">
                      {currentFood.icon}
                    </div>
                    <div className="text-2xl font-bold text-slate-700 bg-white/80 px-4 py-1 rounded-full">
                      {/* Name usually not translated in this simple mock, but good to have icon */}
                      {/* We can use icon for language independent */}
                    </div>
                  </motion.div>
                ) : (
                  <div className="text-center">
                    <div className="text-6xl mb-2">ðŸŽ‰</div>
                    <div className="text-2xl font-bold text-slate-700">
                      {getText("correct")}
                    </div>
                    <button
                      onClick={startGame}
                      className="mt-4 bg-blue-500 text-white px-6 py-2 rounded-full font-bold hover:bg-blue-600"
                    >
                      Play Again
                    </button>
                  </div>
                )}

                {feedback && (
                  <div
                    className={`absolute top-0 left-0 w-full h-full flex items-center justify-center rounded-3xl bg-black/50 z-10`}
                  >
                    <div
                      className={`text-4xl font-bold px-8 py-4 rounded-xl ${
                        feedback === "correct"
                          ? "bg-green-500 text-white"
                          : "bg-red-500 text-white"
                      }`}
                    >
                      {getText(feedback)}
                    </div>
                  </div>
                )}
              </div>
            </div>
            <div className="mt-8 font-bold text-xl text-slate-600">
              Score: {score}
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
