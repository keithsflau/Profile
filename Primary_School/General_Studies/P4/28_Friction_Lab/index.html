<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Friction Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #f3f4f6;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Friction Lab",
          zh: "Êë©Êì¶ÂäõÂØ¶È©óÂÆ§",
          ja: "Êë©Êì¶ÂÆüÈ®ìÂÆ§",
          ko: "ÎßàÏ∞∞ Ïã§ÌóòÏã§",
          es: "Laboratorio de fricci√≥n",
          de: "Reibungslabor",
          fi: "Kitkalaboratorio",
          fr: "Laboratoire de friction",
          ar: "ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿßÿ≠ÿ™ŸÉÿßŸÉ",
          it: "Laboratorio di Attrito",
        },
        instruction: {
          en: "Choose a surface and slide the car!",
          zh: "ÈÅ∏Êìá‰∏ÄÂÄãË°®Èù¢‰∏¶ÊªëÂãïÊ±ΩËªäÔºÅ",
          ja: "Ë°®Èù¢„ÇíÈÅ∏„Çì„ÅßËªä„Çí„Çπ„É©„Ç§„Éâ„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÌëúÎ©¥ÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Ï∞®Î•º ÎØ∏ÎÅÑÎü¨Îú®Î¶¨ÏÑ∏Ïöî!",
          es: "¬°Elige una superficie y desliza el coche!",
          de: "W√§hle eine Oberfl√§che und lass das Auto rutschen!",
          fi: "Valitse pinta ja liu'uta autoa!",
          fr: "Choisissez une surface et faites glisser la voiture !",
          ar: "ÿßÿÆÿ™ÿ± ÿ≥ÿ∑ÿ≠ÿß Ÿàÿ≠ÿ±ŸÉ ÿßŸÑÿ≥Ÿäÿßÿ±ÿ©!",
          it: "Scegli una superficie e fai scorrere l'auto!",
        },
        ice: {
          en: "Ice (Low Friction)",
          zh: "ÂÜ∞Èù¢ (‰ΩéÊë©Êì¶Âäõ)",
          ja: "Ê∞∑ (‰ΩéÊë©Êì¶)",
          ko: "ÏñºÏùå (ÎÇÆÏùÄ ÎßàÏ∞∞)",
          es: "Hielo (Baja fricci√≥n)",
          de: "Eis (Geringe Reibung)",
          fi: "J√§√§ (Pieni kitka)",
          fr: "Glace (Faible friction)",
          ar: "ÿ¨ŸÑŸäÿØ (ÿßÿ≠ÿ™ŸÉÿßŸÉ ŸÖŸÜÿÆŸÅÿ∂)",
          it: "Ghiaccio (Basso attrito)",
        },
        wood: {
          en: "Wood (Medium Friction)",
          zh: "Êú®Êùø (‰∏≠Êë©Êì¶Âäõ)",
          ja: "Êú® (‰∏≠Êë©Êì¶)",
          ko: "ÎÇòÎ¨¥ (Ï§ëÍ∞Ñ ÎßàÏ∞∞)",
          es: "Madera (Fricci√≥n media)",
          de: "Holz (Mittlere Reibung)",
          fi: "Puu (Keskitason kitka)",
          fr: "Bois (Friction moyenne)",
          ar: "ÿÆÿ¥ÿ® (ÿßÿ≠ÿ™ŸÉÿßŸÉ ŸÖÿ™Ÿàÿ≥ÿ∑)",
          it: "Legno (Medio attrito)",
        },
        carpet: {
          en: "Carpet (High Friction)",
          zh: "Âú∞ÊØØ (È´òÊë©Êì¶Âäõ)",
          ja: "„Ç´„Éº„Éö„ÉÉ„Éà (È´òÊë©Êì¶)",
          ko: "Ïπ¥Ìé´ (ÎÜíÏùÄ ÎßàÏ∞∞)",
          es: "Alfombra (Alta fricci√≥n)",
          de: "Teppich (Hohe Reibung)",
          fi: "Matto (Korkea kitka)",
          fr: "Tapis (Friction √©lev√©e)",
          ar: "ÿ≥ÿ¨ÿßÿØ (ÿßÿ≠ÿ™ŸÉÿßŸÉ ÿπÿßŸÑŸä)",
          it: "Tappeto (Alto attrito)",
        },
        push: {
          en: "Push!",
          zh: "Êé®ÔºÅ",
          ja: "Êäº„ÅôÔºÅ",
          ko: "Î∞ÄÍ∏∞!",
          es: "¬°Empujar!",
          de: "Dr√ºcken!",
          fi: "Ty√∂nn√§!",
          fr: "Pousser !",
          ar: "ÿßÿØŸÅÿπ!",
          it: "Spingi!",
        },
        reset: {
          en: "Reset",
          zh: "ÈáçÁΩÆ",
          ja: "„É™„Çª„ÉÉ„Éà",
          ko: "Ï¥àÍ∏∞Ìôî",
          es: "Reiniciar",
          de: "Zur√ºcksetzen",
          fi: "Nollaa",
          fr: "R√©initialiser",
          ar: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ",
          it: "Ripristina",
        },
      };

      const surfaces = [
        { id: "ice", friction: 0.1, color: "bg-cyan-200" },
        { id: "wood", friction: 0.5, color: "bg-amber-700" },
        { id: "carpet", friction: 0.9, color: "bg-red-800" }, // carpet visual
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [surface, setSurface] = useState(surfaces[0]);
        const [carPos, setCarPos] = useState(0); // 0 to 100
        const [animating, setAnimating] = useState(false);

        const getText = (key) => t[key][lang] || t[key]["en"];

        const handlePush = () => {
          setAnimating(true);
          // Simple physics sim: Distance = Force / Friction
          // Assume Force constant 100.
          // Distance = 100 * (1 - friction) ... simplified

          let distance = 0;
          if (surface.id === "ice") distance = 95;
          if (surface.id === "wood") distance = 60;
          if (surface.id === "carpet") distance = 30;

          setCarPos(distance);
        };

        const reset = () => {
          setAnimating(false);
          setCarPos(0);
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-8 text-slate-700">
              {getText("title")}
            </h1>

            <div className="w-full max-w-4xl bg-white p-8 rounded-3xl shadow-xl">
              {/* Scene */}
              <div className="relative w-full h-64 bg-sky-200 rounded-xl overflow-hidden mb-8 border-4 border-slate-300">
                {/* Track Surface */}
                <div
                  className={`absolute bottom-0 w-full h-24 ${surface.color} transition-colors duration-500`}
                >
                  {surface.id === "wood" && (
                    <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]"></div>
                  )}
                  {surface.id === "carpet" && (
                    <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]"></div>
                  )}
                </div>

                {/* Car */}
                <motion.div
                  className="absolute bottom-24 left-10 text-8xl"
                  animate={{ x: animating ? `${carPos}%` : "0%" }}
                  transition={{
                    type: "spring",
                    stiffness: 50,
                    damping: surface.friction * 40, // Higher friction = faster stop/damping
                  }}
                >
                  üèéÔ∏è
                </motion.div>
              </div>

              {/* Controls */}
              <div className="flex flex-col gap-6">
                <div className="flex gap-4 justify-center">
                  {surfaces.map((s) => (
                    <button
                      key={s.id}
                      onClick={() => {
                        setSurface(s);
                        reset();
                      }}
                      className={`px-6 py-3 rounded-xl font-bold border-4 transition-transform active:scale-95
                              ${
                                surface.id === s.id
                                  ? "border-blue-500 scale-110"
                                  : "border-transparent bg-slate-100 text-slate-500"
                              }
                           `}
                    >
                      {getText(s.id)}
                    </button>
                  ))}
                </div>

                <div className="flex justify-center gap-4">
                  <button
                    onClick={handlePush}
                    disabled={animating}
                    className="bg-green-500 text-white px-12 py-4 rounded-full font-black text-2xl shadow-lg hover:bg-green-600 disabled:opacity-50"
                  >
                    {getText("push")}
                  </button>
                  <button
                    onClick={reset}
                    className="bg-slate-500 text-white px-8 py-4 rounded-full font-bold text-xl hover:bg-slate-600"
                  >
                    {getText("reset")}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
