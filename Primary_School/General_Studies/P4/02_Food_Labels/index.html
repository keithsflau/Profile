<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Food Labels</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: radial-gradient(circle, #f0fdf4 0%, #dcfce7 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Food Label Detective",
          zh: "È£üÁâ©Ê®ôÁ±§ÂÅµÊé¢",
          ja: "È£üÂìÅ„É©„Éô„É´Êé¢ÂÅµ",
          ko: "ÏãùÌíà ÎùºÎ≤® ÌÉêÏ†ï",
          es: "Detective de Etiquetas de Alimentos",
          de: "Lebensmitteletiketten-Detektiv",
          fi: "Ruokaetikettietsiv√§",
          fr: "D√©tective d'√©tiquettes alimentaires",
          ar: "ŸÖÿÆÿ®ÿ± ŸÖŸÑÿµŸÇÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ°",
          it: "Investigatore di Etichette Alimentari",
        },
        instruction: {
          en: "Read the label and answer the question.",
          zh: "Èñ±ËÆÄÊ®ôÁ±§‰∏¶ÂõûÁ≠îÂïèÈ°å„ÄÇ",
          ja: "„É©„Éô„É´„ÇíË™≠„Çì„ÅßË≥™Âïè„Å´Á≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
          ko: "ÎùºÎ≤®ÏùÑ ÏùΩÍ≥† ÏßàÎ¨∏Ïóê ÎãµÌïòÏÑ∏Ïöî.",
          es: "Lee la etiqueta y responde la pregunta.",
          de: "Lies das Etikett und antworte auf die Frage.",
          fi: "Lue etiketti ja vastaa kysymykseen.",
          fr: "Lisez l'√©tiquette et r√©pondez √† la question.",
          ar: "ÿßŸÇÿ±ÿ£ ÿßŸÑŸÖŸÑÿµŸÇ Ÿàÿ£ÿ¨ÿ® ÿπŸÜ ÿßŸÑÿ≥ÿ§ÿßŸÑ.",
          it: "Leggi l'etichetta e rispondi alla domanda.",
        },
        correct: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµ!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        wrong: {
          en: "Try Again",
          zh: "ÂÜçË©¶‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶",
          ko: "Îã§Ïãú ÏãúÎèÑ",
          es: "Int√©ntalo de nuevo",
          de: "Versuch es nochmal",
          fi: "Yrit√§ uudelleen",
          fr: "R√©essayez",
          ar: "ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Riprova",
        },
        expiry: {
          en: "Expiry Date",
          zh: "Âà∞ÊúüÊó•",
          ja: "ÊúâÂäπÊúüÈôê",
          ko: "Ïú†ÌÜµÍ∏∞Ìïú",
          es: "Fecha de caducidad",
          de: "Verfallsdatum",
          fi: "Viimeinen k√§ytt√∂p√§iv√§",
          fr: "Date d'expiration",
          ar: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©",
          it: "Data di Scadenza",
        },
        sugar: {
          en: "Sugar",
          zh: "Á≥ñ",
          ja: "Á†ÇÁ≥ñ",
          ko: "ÏÑ§ÌÉï",
          es: "Az√∫car",
          de: "Zucker",
          fi: "Sokeri",
          fr: "Sucre",
          ar: "ÿ≥ŸÉÿ±",
          it: "Zucchero",
        },
        protein: {
          en: "Protein",
          zh: "ËõãÁôΩË≥™",
          ja: "„Çø„É≥„Éë„ÇØË≥™",
          ko: "Îã®Î∞±Ïßà",
          es: "Prote√≠na",
          de: "Protein",
          fi: "Proteiini",
          fr: "Prot√©ines",
          ar: "ÿ®ÿ±Ÿàÿ™ŸäŸÜ",
          it: "Proteine",
        },
        energy: {
          en: "Energy",
          zh: "ËÉΩÈáè",
          ja: "„Ç®„Éç„É´„ÇÆ„Éº",
          ko: "ÏóêÎÑàÏßÄ",
          es: "Energ√≠a",
          de: "Energie",
          fi: "Energia",
          fr: "√ânergie",
          ar: "ÿ∑ÿßŸÇÿ©",
          it: "Energia",
        },
        q_sugar: {
          en: "How much sugar is in this?",
          zh: "ÈÄôË£°Âê´ÊúâÂ§öÂ∞ëÁ≥ñÔºü",
          ja: "Á†ÇÁ≥ñ„ÅØ„Å©„Çå„Åè„Çâ„ÅÑÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü",
          ko: "ÏÑ§ÌÉïÏùÄ ÏñºÎßàÎÇò Îì§Ïñ¥ ÏûàÏäµÎãàÍπå?",
          es: "¬øCu√°nta az√∫car hay en esto?",
          de: "Wie viel Zucker ist darin enthalten?",
          fi: "Kuinka paljon sokeria t√§ss√§ on?",
          fr: "Combien de sucre y a-t-il ?",
          ar: "ŸÉŸÖ ŸÉŸÖŸäÿ© ÿßŸÑÿ≥ŸÉÿ± ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ŸÅŸä Ÿáÿ∞ÿßÿü",
          it: "Quanto zucchero c'√®?",
        },
        q_expiry: {
          en: "When does this expire?",
          zh: "ÈÄô‰ªÄÈ∫ºÊôÇÂÄôÈÅéÊúüÔºü",
          ja: "„Åì„Çå„ÅØ„ÅÑ„Å§ÊúüÈôêÂàá„Çå„Å´„Å™„Çä„Åæ„Åô„ÅãÔºü",
          ko: "Ïñ∏Ï†ú ÎßåÎ£åÎê©ÎãàÍπå?",
          es: "¬øCu√°ndo caduca esto?",
          de: "Wann l√§uft das ab?",
          fi: "Milloin t√§m√§ vanhenee?",
          fr: "Quand cela expire-t-il ?",
          ar: "ŸÖÿ™Ÿâ ÿ™ŸÜÿ™ŸáŸä ÿµŸÑÿßÿ≠Ÿäÿ© Ÿáÿ∞ÿßÿü",
          it: "Quando scade?",
        },
      };

      const foods = [
        {
          id: 1,
          name: "Juice Box",
          color: "bg-orange-100",
          label: {
            energy: "120 kcal",
            protein: "0 g",
            sugar: "25 g",
            expiry: "2025-12-31",
          },
          questions: [
            {
              type: "q_sugar",
              correct: "25 g",
              options: ["10 g", "25 g", "0 g", "100 g"],
            },
            {
              type: "q_expiry",
              correct: "2025-12-31",
              options: ["2024-01-01", "2025-12-31", "2026-06-01"],
            },
          ],
        },
        {
          id: 2,
          name: "Yogurt",
          color: "bg-blue-100",
          label: {
            energy: "90 kcal",
            protein: "5 g",
            sugar: "12 g",
            expiry: "2024-05-20",
          },
          questions: [
            {
              type: "q_sugar",
              correct: "12 g",
              options: ["5 g", "12 g", "20 g"],
            },
            {
              type: "q_expiry",
              correct: "2024-05-20",
              options: ["2024-05-20", "2025-12-01", "2023-10-10"],
            },
          ],
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [level, setLevel] = useState(0);
        const [qIndex, setQIndex] = useState(0);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];
        const currentItem = foods[level];
        const currentQ = currentItem?.questions[qIndex];

        const checkAnswer = (ans) => {
          if (feedback) return;
          if (ans === currentQ.correct) {
            setFeedback("correct");
            setTimeout(() => {
              setFeedback(null);
              if (qIndex < currentItem.questions.length - 1) {
                setQIndex(qIndex + 1);
              } else {
                if (level < foods.length - 1) {
                  setLevel(level + 1);
                  setQIndex(0);
                } else {
                  setLevel(0); // Loop
                  setQIndex(0);
                }
              }
            }, 1000);
          } else {
            setFeedback("wrong");
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        return (
          <div className="min-h-screen flex flex-col items-center justify-center p-6">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-3xl font-black text-green-700 mb-6 bg-white/50 px-6 py-2 rounded-full">
              üîç {getText("title")}
            </h1>

            <div className="flex flex-col md:flex-row gap-8 items-center bg-white p-8 rounded-3xl shadow-xl border-4 border-green-200">
              {/* Product Packaging View */}
              <div
                className={`w-64 h-80 ${currentItem.color} rounded-2xl flex flex-col items-center justify-center border-4 border-slate-300 relative`}
              >
                <div className="text-6xl mb-4">üßÉ</div>
                <div className="font-bold text-2xl text-slate-700">
                  {currentItem.name}
                </div>

                {/* Label on Back */}
                <div className="absolute top-2 right-2 cursor-pointer group">
                  <div className="bg-white p-2 rounded-full shadow-md text-2xl">
                    üìã
                  </div>
                  <div className="absolute top-10 right-0 w-48 bg-white border border-slate-300 p-4 rounded-xl shadow-xl hidden group-hover:block z-10 text-left text-sm">
                    <div className="font-bold border-b mb-2">
                      Nutrition Facts
                    </div>
                    <div className="flex justify-between">
                      <span>{getText("energy")}</span>{" "}
                      <span>{currentItem.label.energy}</span>
                    </div>
                    <div className="flex justify-between">
                      <span>{getText("protein")}</span>{" "}
                      <span>{currentItem.label.protein}</span>
                    </div>
                    <div className="flex justify-between font-bold text-red-500">
                      <span>{getText("sugar")}</span>{" "}
                      <span>{currentItem.label.sugar}</span>
                    </div>
                    <div className="mt-2 text-xs text-slate-500 border-t pt-1">
                      {getText("expiry")}: {currentItem.label.expiry}
                    </div>
                  </div>
                </div>

                {/* Simplified label visible always for ease */}
                <div className="bg-white/90 p-4 rounded-xl mt-4 text-left text-sm w-5/6 shadow-inner border border-slate-200">
                  <div className="flex justify-between">
                    <span>‚ö° {getText("energy")}</span>{" "}
                    <span>{currentItem.label.energy}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>üí™ {getText("protein")}</span>{" "}
                    <span>{currentItem.label.protein}</span>
                  </div>
                  <div className="flex justify-between font-bold text-red-600">
                    <span>üç¨ {getText("sugar")}</span>{" "}
                    <span>{currentItem.label.sugar}</span>
                  </div>
                  <div className="mt-2 text-xs text-slate-500 border-t pt-1 flex justify-between">
                    <span>üìÖ {getText("expiry")}</span>{" "}
                    <span>{currentItem.label.expiry}</span>
                  </div>
                </div>
              </div>

              {/* Question Panel */}
              <div className="flex flex-col gap-4 w-full md:w-80">
                <div className="font-bold text-xl text-slate-800">
                  {getText(currentQ.type)}
                </div>
                <div className="grid grid-cols-1 gap-3">
                  {currentQ.options.map((opt) => (
                    <button
                      key={opt}
                      onClick={() => checkAnswer(opt)}
                      className="bg-green-100 hover:bg-green-200 text-green-900 font-bold py-3 px-6 rounded-xl border-2 border-green-300 transition-colors"
                    >
                      {opt}
                    </button>
                  ))}
                </div>
                {feedback && (
                  <div
                    className={`text-center font-bold text-xl p-3 rounded-xl ${
                      feedback === "correct"
                        ? "bg-green-500 text-white"
                        : "bg-red-500 text-white"
                    }`}
                  >
                    {getText(feedback)}
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
