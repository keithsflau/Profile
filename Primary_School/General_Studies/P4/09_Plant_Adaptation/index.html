<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Plant Adaptation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #fef3c7;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Plant Adaptation",
          zh: "Ê§çÁâ©ÁöÑÈÅ©Êáâ",
          ja: "Ê§çÁâ©„ÅÆÈÅ©Âøú",
          ko: "ÏãùÎ¨ºÏùò Ï†ÅÏùë",
          es: "Adaptaci√≥n de las plantas",
          de: "Pflanzenanpassung",
          fi: "Kasvien sopeutuminen",
          fr: "Adaptation des plantes",
          ar: "ÿ™ŸÉŸäŸÅ ÿßŸÑŸÜÿ®ÿßÿ™",
          it: "Adattamento delle Piante",
        },
        instruction: {
          en: "Match the feature to the environment!",
          zh: "Â∞áÁâπÂæµÈÖçÂ∞çÂà∞Ê≠£Á¢∫ÁöÑÁí∞Â¢ÉÔºÅ",
          ja: "ÁâπÂæ¥„ÇíÁí∞Â¢É„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÌäπÏßïÏùÑ ÌôòÍ≤ΩÏóê ÎßûÏ∂îÏÑ∏Ïöî!",
          es: "¬°Combina la caracter√≠stica con el entorno!",
          de: "Ordne das Merkmal der Umgebung zu!",
          fi: "Yhdist√§ ominaisuus ymp√§rist√∂√∂n!",
          fr: "Associez la caract√©ristique √† l'environnement !",
          ar: "ÿ∑ÿßÿ®ŸÇ ÿßŸÑŸÖŸäÿ≤ÿ© ÿ®ÿßŸÑÿ®Ÿäÿ¶ÿ©!",
          it: "Abbina la caratteristica all'ambiente!",
        },
        correct: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµ!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        desert: {
          en: "Desert (Dry)",
          zh: "Ê≤ôÊº† (‰πæÁá•)",
          ja: "Á†ÇÊº† (‰πæÁá•)",
          ko: "ÏÇ¨Îßâ (Í±¥Ï°∞)",
          es: "Desierto (Seco)",
          de: "W√ºste (Trocken)",
          fi: "Aavikko (Kuiva)",
          fr: "D√©sert (Sec)",
          ar: "ÿµÿ≠ÿ±ÿßÿ° (ÿ¨ÿßŸÅ)",
          it: "Deserto (Secco)",
        },
        rainforest: {
          en: "Rainforest (Wet)",
          zh: "Èõ®Êûó (ÊΩÆÊøï)",
          ja: "ÁÜ±Â∏ØÈõ®Êûó (ÊπøÊΩ§)",
          ko: "Ïó¥ÎåÄÏö∞Î¶º (ÏäµÌï®)",
          es: "Selva tropical (H√∫medo)",
          de: "Regenwald (Nass)",
          fi: "Sademets√§ (M√§rk√§)",
          fr: "For√™t tropicale (Humide)",
          ar: "ÿ∫ÿßÿ®ÿ© ŸÖÿ∑Ÿäÿ±ÿ© (ÿ±ÿ∑ÿ®)",
          it: "Foresta Pluviale (Umido)",
        },
        cactus: {
          en: "Cactus",
          zh: "‰ªô‰∫∫Êéå",
          ja: "„Çµ„Éú„ÉÜ„É≥",
          ko: "ÏÑ†Ïù∏Ïû•",
          es: "Cactus",
          de: "Kaktus",
          fi: "Kaktus",
          fr: "Cactus",
          ar: "ÿµÿ®ÿßÿ±",
          it: "Cactus",
        },
        fern: {
          en: "Fern",
          zh: "Ëï®È°û",
          ja: "„Ç∑„ÉÄ",
          ko: "Í≥†ÏÇ¨Î¶¨",
          es: "Helecho",
          de: "Farn",
          fi: "Saniainen",
          fr: "Foug√®re",
          ar: "ÿ≥ÿ±ÿÆÿ≥",
          it: "Felce",
        },
        feature_needles: {
          en: "Needle leaves (Save water)",
          zh: "ÈáùÁãÄËëâ (‰øùÊ∞¥)",
          ja: "ÈáùÁä∂Ëëâ (ÁØÄÊ∞¥)",
          ko: "Î∞îÎäòÏûé (Î¨º Ï†àÏïΩ)",
          es: "Hojas de aguja (Ahorrar agua)",
          de: "Nadelbl√§tter (Wasser sparen)",
          fi: "Neulaslehdet (S√§√§st√§√§ vett√§)",
          fr: "Feuilles en aiguilles (√âconomiser l'eau)",
          ar: "ÿ£Ÿàÿ±ÿßŸÇ ÿ•ÿ®ÿ±Ÿäÿ© (ÿ™ŸàŸÅŸäÿ± ÿßŸÑŸÖÿßÿ°)",
          it: "Foglie ad ago (Risparmia acqua)",
        },
        feature_stem: {
          en: "Thick stem (Store water)",
          zh: "ËÇ•ÂéöËéñ (ÂÑ≤Ê∞¥)",
          ja: "Â§™„ÅÑËåé (Ë≤ØÊ∞¥)",
          ko: "ÎëêÍ∫ºÏö¥ Ï§ÑÍ∏∞ (Î¨º Ï†ÄÏû•)",
          es: "Tallo grueso (Almacenar agua)",
          de: "Dicker Stamm (Wasser speichern)",
          fi: "Paksu varsi (Varastoi vett√§)",
          fr: "Tige √©paisse (Stocker l'eau)",
          ar: "ÿ¨ÿ∞ÿπ ÿ≥ŸÖŸäŸÉ (ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿßÿ°)",
          it: "Gambo spesso (Immagazzina acqua)",
        },
        feature_broad: {
          en: "Broad leaves (Catch sun)",
          zh: "ÈóäÂ§ßËëâÁâá (Âê∏Êî∂ÈôΩÂÖâ)",
          ja: "Â∫É„ÅÑËëâ (Êó•ÂÖâ„ÇíÊµ¥„Å≥„Çã)",
          ko: "ÎÑìÏùÄ Ïûé (ÌñáÎπõ Ìè¨Ï∞©)",
          es: "Hojas anchas (Captar sol)",
          de: "Breite Bl√§tter (Sonne einfangen)",
          fi: "Leve√§t lehdet (Ker√§√§ auringonvaloa)",
          fr: "Feuilles larges (Capter le soleil)",
          ar: "ÿ£Ÿàÿ±ÿßŸÇ ÿπÿ±Ÿäÿ∂ÿ© (ÿßŸÑÿ™ŸÇÿßÿ∑ ÿßŸÑÿ¥ŸÖÿ≥)",
          it: "Foglie larghe (Cattura sole)",
        },
        feature_drip: {
          en: "Drip tips (Drain water)",
          zh: "Êª¥Ê∞¥ËëâÂ∞ñ (ÊéíÊ∞¥)",
          ja: "„Éâ„É™„ÉÉ„Éó„ÉÅ„ÉÉ„Éó (ÊéíÊ∞¥)",
          ko: "ÎìúÎ¶Ω ÌåÅ (Î∞∞Ïàò)",
          es: "Puntas de goteo (Drenar agua)",
          de: "Tropfspitzen (Wasser ableiten)",
          fi: "Tippuk√§rjet (Valuttaa vett√§)",
          fr: "Pointes d'√©gouttement (Drainer l'eau)",
          ar: "ÿ±ÿ§Ÿàÿ≥ ÿ™ŸÇÿßÿ∑ÿ± (ÿµÿ±ŸÅ ÿßŸÑŸÖÿßÿ°)",
          it: "Punte a goccia (Drenare acqua)",
        },
      };

      const traits = [
        { id: "feature_needles", target: "desert", icon: "üåµ" },
        { id: "feature_stem", target: "desert", icon: "ü•í" },
        { id: "feature_broad", target: "rainforest", icon: "üçÉ" },
        { id: "feature_drip", target: "rainforest", icon: "üíß" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [queue, setQueue] = useState([]);
        const [currentTrait, setCurrentTrait] = useState(null);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          resetGame();
        }, []);

        const resetGame = () => {
          const shuf = [...traits].sort(() => Math.random() - 0.5);
          setQueue(shuf);
          setCurrentTrait(shuf[0]);
          setFeedback(null);
        };

        const handleChoice = (envId) => {
          if (feedback) return;

          if (currentTrait.target === envId) {
            setFeedback("correct");
            setTimeout(() => {
              setFeedback(null);
              const nextIdx = queue.indexOf(currentTrait) + 1;
              if (nextIdx < queue.length) {
                setCurrentTrait(queue[nextIdx]);
              } else {
                setCurrentTrait(null); // GameOver
              }
            }, 1000);
          } else {
            setFeedback("wrong"); // reuse from i18n if possible, but simplest is state
            setTimeout(() => setFeedback(null), 800);
          }
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-8 text-amber-800">
              {getText("title")}
            </h1>

            <div className="flex w-full max-w-5xl h-[600px] border-4 border-amber-900 rounded-3xl overflow-hidden relative shadow-2xl">
              {/* Desert Side */}
              <div
                onClick={() => handleChoice("desert")}
                className="flex-1 bg-gradient-to-b from-blue-200 to-amber-200 relative cursor-pointer hover:opacity-90 transition-opacity border-r-4 border-white"
              >
                <div className="absolute top-4 left-1/2 -translate-x-1/2 font-bold text-2xl text-amber-900 bg-white/60 px-4 py-1 rounded-full">
                  {getText("desert")}
                </div>
                <div className="absolute bottom-10 left-10 text-9xl">üåµ</div>
                <div className="absolute top-10 right-10 text-6xl animate-pulse">
                  ‚òÄÔ∏è
                </div>
              </div>

              {/* Rainforest Side */}
              <div
                onClick={() => handleChoice("rainforest")}
                className="flex-1 bg-gradient-to-b from-blue-800 to-green-900 relative cursor-pointer hover:opacity-90 transition-opacity"
              >
                <div className="absolute top-4 left-1/2 -translate-x-1/2 font-bold text-2xl text-white bg-black/40 px-4 py-1 rounded-full">
                  {getText("rainforest")}
                </div>
                <div className="absolute bottom-10 right-10 text-9xl">üåø</div>
                <div className="absolute top-10 left-10 text-6xl animate-bounce">
                  üåßÔ∏è
                </div>
              </div>

              {/* Draggable/Selectable Trait Card */}
              {currentTrait ? (
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center">
                  <div className="text-8xl mb-4">{currentTrait.icon}</div>
                  <div className="font-bold text-2xl text-slate-800 text-center">
                    {getText(currentTrait.id)}
                  </div>
                  <div className="text-slate-500 mt-2">
                    {getText("instruction")}
                  </div>

                  {feedback && (
                    <div
                      className={`absolute inset-0 flex items-center justify-center rounded-3xl 
                           ${
                             feedback === "correct"
                               ? "bg-green-500/90 text-white"
                               : "bg-red-500/90 text-white"
                           }
                        `}
                    >
                      <div className="text-4xl font-black">
                        {getText("correct")}
                      </div>
                    </div>
                  )}
                </div>
              ) : (
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-8 rounded-3xl shadow-2xl text-center">
                  <div className="text-6xl mb-4">üéâ</div>
                  <button
                    onClick={resetGame}
                    className="bg-amber-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-amber-700"
                  >
                    Play Again
                  </button>
                </div>
              )}
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
