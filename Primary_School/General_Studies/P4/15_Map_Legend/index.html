<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Map Legend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #f0fdfa;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Map Legend Master",
          zh: "åœ°åœ–åœ–ä¾‹å¤§å¸«",
          ja: "åœ°å›³å‡¡ä¾‹ãƒžã‚¹ã‚¿ãƒ¼",
          ko: "ì§€ë„ ë²”ë¡€ ë§ˆìŠ¤í„°",
          es: "Maestro de Leyendas de Mapas",
          de: "Kartenlegenden-Meister",
          fi: "Karttaselitemestari",
          fr: "MaÃ®tre de la lÃ©gende de la carte",
          ar: "Ø®Ø¨ÙŠØ± Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø±ÙŠØ·Ø©",
          it: "Maestro della Legenda Mappa",
        },
        instruction: {
          en: "Drag the symbol to the correct map location!",
          zh: "å°‡åœ–ä¾‹ç¬¦è™Ÿæ‹–åˆ°åœ°åœ–ä¸Šçš„æ­£ç¢ºä½ç½®ï¼",
          ja: "è¨˜å·ã‚’åœ°å›³ã®æ­£ã—ã„å ´æ‰€ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„ï¼",
          ko: "ê¸°í˜¸ë¥¼ ì˜¬ë°”ë¥¸ ì§€ë„ ìœ„ì¹˜ë¡œ ë“œëž˜ê·¸í•˜ì„¸ìš”!",
          es: "Â¡Arrastra el sÃ­mbolo a la ubicaciÃ³n correcta en el mapa!",
          de: "Ziehe das Symbol auf die richtige Kartenposition!",
          fi: "VedÃ¤ symboli oikeaan karttasijaintiin!",
          fr: "Faites glisser le symbole au bon endroit sur la carte !",
          ar: "Ø§Ø³Ø­Ø¨ Ø§Ù„Ø±Ù…Ø² Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØµØ­ÙŠØ­!",
          it: "Trascina il simbolo nella posizione corretta sulla mappa!",
        },
        hospital: {
          en: "Hospital",
          zh: "é†«é™¢",
          ja: "ç—…é™¢",
          ko: "ë³‘ì›",
          es: "Hospital",
          de: "Krankenhaus",
          fi: "Sairaala",
          fr: "HÃ´pital",
          ar: "Ù…Ø³ØªØ´ÙÙ‰",
          it: "Ospedale",
        },
        school: {
          en: "School",
          zh: "å­¸æ ¡",
          ja: "å­¦æ ¡",
          ko: "í•™êµ",
          es: "Escuela",
          de: "Schule",
          fi: "Koulu",
          fr: "Ã‰cole",
          ar: "Ù…Ø¯Ø±Ø³Ø©",
          it: "Scuola",
        },
        police: {
          en: "Police Station",
          zh: "è­¦ç½²",
          ja: "è­¦å¯Ÿç½²",
          ko: "ê²½ì°°ì„œ",
          es: "EstaciÃ³n de policÃ­a",
          de: "Polizeistation",
          fi: "Poliisiasema",
          fr: "Poste de police",
          ar: "Ù…Ø±ÙƒØ² Ø´Ø±Ø·Ø©",
          it: "Stazione di Polizia",
        },
        mtr: {
          en: "MTR Station",
          zh: "æ¸¯éµç«™",
          ja: "MTRé§…",
          ko: "MTR ì—­",
          es: "EstaciÃ³n de MTR",
          de: "MTR-Station",
          fi: "MTR-asema",
          fr: "Station MTR",
          ar: "Ù…Ø­Ø·Ø© MTR",
          it: "Stazione MTR",
        },
        park: {
          en: "Park",
          zh: "å…¬åœ’",
          ja: "å…¬åœ’",
          ko: "ê³µì›",
          es: "Parque",
          de: "Park",
          fi: "Puisto",
          fr: "Parc",
          ar: "Ø­Ø¯ÙŠÙ‚Ø©",
          it: "Parco",
        },
        correct: {
          en: "Correct!",
          zh: "æ­£ç¢ºï¼",
          ja: "æ­£è§£ï¼",
          ko: "ì •ë‹µ!",
          es: "Â¡Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ØµØ­ÙŠØ­!",
          it: "Corretto!",
        },
      };

      const symbols = [
        { id: "hospital", icon: "ðŸ¥", x: 100, y: 100 },
        { id: "school", icon: "ðŸ«", x: 300, y: 150 },
        { id: "police", icon: "ðŸ‘®", x: 500, y: 80 },
        { id: "mtr", icon: "ðŸš‡", x: 200, y: 300 },
        { id: "park", icon: "ðŸŒ³", x: 450, y: 250 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [placed, setPlaced] = useState({}); // { id: boolean }

        const getText = (key) => t[key][lang] || t[key]["en"];

        const handleDragStart = (e, id) => {
          e.dataTransfer.setData("id", id);
        };

        const handleDrop = (e, targetId) => {
          const id = e.dataTransfer.getData("id");
          if (id === targetId) {
            setPlaced((p) => ({ ...p, [id]: true }));
          }
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-4 text-teal-700">
              {getText("title")}
            </h1>

            <p className="mb-4 text-slate-500 font-bold">
              {getText("instruction")}
            </p>

            <div className="flex flex-col md:flex-row gap-8 w-full max-w-6xl items-start">
              {/* Map Area */}
              <div className="relative w-full md:w-3/4 h-[500px] bg-emerald-50 rounded-3xl border-4 border-teal-200 overflow-hidden shadow-lg bg-[url('https://www.transparenttextures.com/patterns/city.png')]">
                {/* Grid Lines Overlay */}
                <div className="absolute inset-0 grid grid-cols-4 grid-rows-4 pointer-events-none opacity-20">
                  {[...Array(16)].map((_, i) => (
                    <div key={i} className="border border-teal-500"></div>
                  ))}
                </div>

                {/* Drop Zones */}
                {symbols.map((s) => (
                  <div
                    key={s.id}
                    onDragOver={(e) => e.preventDefault()}
                    onDrop={(e) => handleDrop(e, s.id)}
                    className={`absolute w-24 h-24 rounded-full flex flex-col items-center justify-center transition-all bg-white/50 border-2 border-dashed border-teal-400
                           ${
                             placed[s.id]
                               ? "bg-white border-solid border-teal-600 shadow-xl scale-110"
                               : ""
                           }
                        `}
                    style={{ left: s.x, top: s.y }}
                  >
                    {placed[s.id] ? (
                      <>
                        <div className="text-4xl">{s.icon}</div>
                        <div className="text-xs font-bold text-teal-800 bg-white px-2 rounded">
                          {getText(s.id)}
                        </div>
                        <div className="absolute -top-2 -right-2 text-2xl animate-bounce">
                          âœ…
                        </div>
                      </>
                    ) : (
                      <div className="text-xs text-center p-2 text-teal-600 font-bold">
                        {getText(s.id)} <br /> Location
                      </div>
                    )}
                  </div>
                ))}
              </div>

              {/* Legend / Tools */}
              <div className="w-full md:w-1/4 flex flex-col gap-4 bg-white p-6 rounded-2xl shadow-xl">
                <h2 className="text-xl font-bold border-b-2 border-slate-200 pb-2 mb-2">
                  Legend
                </h2>
                {symbols.map(
                  (s) =>
                    !placed[s.id] && (
                      <div
                        key={s.id}
                        draggable
                        onDragStart={(e) => handleDragStart(e, s.id)}
                        className="flex items-center gap-4 bg-slate-50 p-4 rounded-xl cursor-grab active:cursor-grabbing hover:bg-teal-50 border border-slate-200"
                      >
                        <div className="text-4xl">{s.icon}</div>
                        <div className="font-bold text-slate-700">
                          {getText(s.id)}
                        </div>
                      </div>
                    )
                )}
                {Object.keys(placed).length === symbols.length && (
                  <div className="text-center p-4 bg-teal-100 text-teal-800 rounded-xl font-bold animate-pulse">
                    {getText("correct")}
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
