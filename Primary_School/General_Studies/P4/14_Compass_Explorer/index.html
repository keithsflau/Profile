<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Compass Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: skyblue;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, animate } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Compass Explorer",
          zh: "æŒ‡å—é‡æ¢éšªå®¶",
          ja: "ã‚³ãƒ³ãƒ‘ã‚¹ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼",
          ko: "ë‚˜ì¹¨ë°˜ íƒí—˜ê°€",
          es: "Explorador de BrÃºjula",
          de: "Kompass-Entdecker",
          fi: "Kompassitutkija",
          fr: "Explorateur de boussole",
          ar: "Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ø¨ÙˆØµÙ„Ø©",
          it: "Esploratore di Bussola",
        },
        instruction: {
          en: "Point the compass to the destination!",
          zh: "å°‡æŒ‡å—é‡æŒ‡å‘ç›®çš„åœ°ï¼",
          ja: "ã‚³ãƒ³ãƒ‘ã‚¹ã‚’ç›®çš„åœ°ã«å‘ã‘ã¦ãã ã•ã„ï¼",
          ko: "ë‚˜ì¹¨ë°˜ì„ ëª©ì ì§€ë¡œ í–¥í•˜ê²Œ í•˜ì„¸ìš”!",
          es: "Â¡Apunta la brÃºjula al destino!",
          de: "Richte den Kompass auf das Ziel!",
          fi: "Osoita kompassilla mÃ¤Ã¤rÃ¤npÃ¤Ã¤hÃ¤n!",
          fr: "Pointez la boussole vers la destination !",
          ar: "ÙˆØ¬Ù‡ Ø§Ù„Ø¨ÙˆØµÙ„Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡Ø©!",
          it: "Punta la bussola verso la destinazione!",
        },
        N: {
          en: "North",
          zh: "åŒ—",
          ja: "åŒ—",
          ko: "ë¶",
          es: "Norte",
          de: "Nord",
          fi: "Pohjoinen",
          fr: "Nord",
          ar: "Ø´Ù…Ø§Ù„",
          it: "Nord",
        },
        E: {
          en: "East",
          zh: "æ±",
          ja: "æ±",
          ko: "ë™",
          es: "Este",
          de: "Ost",
          fi: "ItÃ¤",
          fr: "Est",
          ar: "Ø´Ø±Ù‚",
          it: "Est",
        },
        S: {
          en: "South",
          zh: "å—",
          ja: "å—",
          ko: "ë‚¨",
          es: "Sur",
          de: "SÃ¼d",
          fi: "EtelÃ¤",
          fr: "Sud",
          ar: "Ø¬Ù†ÙˆØ¨",
          it: "Sud",
        },
        W: {
          en: "West",
          zh: "è¥¿",
          ja: "è¥¿",
          ko: "ì„œ",
          es: "Oeste",
          de: "West",
          fi: "LÃ¤nsi",
          fr: "Ouest",
          ar: "ØºØ±Ø¨",
          it: "Ovest",
        },
        NE: {
          en: "North-East",
          zh: "æ±åŒ—",
          ja: "åŒ—æ±",
          ko: "ë¶ë™",
          es: "Noreste",
          de: "Nordost",
          fi: "Koillinen",
          fr: "Nord-Est",
          ar: "Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚",
          it: "Nord-Est",
        },
        SE: {
          en: "South-East",
          zh: "æ±å—",
          ja: "å—æ±",
          ko: "ë‚¨ë™",
          es: "Sureste",
          de: "SÃ¼dost",
          fi: "Kaakko",
          fr: "Sud-Est",
          ar: "Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚",
          it: "Sud-Est",
        },
        SW: {
          en: "South-West",
          zh: "è¥¿å—",
          ja: "å—è¥¿",
          ko: "ë‚¨ì„œ",
          es: "Suroeste",
          de: "SÃ¼dwest",
          fi: "Lounas",
          fr: "Sud-Ouest",
          ar: "Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨",
          it: "Sud-Ovest",
        },
        NW: {
          en: "North-West",
          zh: "è¥¿åŒ—",
          ja: "åŒ—è¥¿",
          ko: "ë¶ì„œ",
          es: "Noroeste",
          de: "Nordwest",
          fi: "Luode",
          fr: "Nord-Ouest",
          ar: "Ø´Ù…Ø§Ù„ ØºØ±Ø¨",
          it: "Nord-Ovest",
        },
        match: {
          en: "Match!",
          zh: "åŒ¹é…ï¼",
          ja: "ãƒãƒƒãƒï¼",
          ko: "ì¼ì¹˜!",
          es: "Â¡Coincidencia!",
          de: "Passt!",
          fi: "Osuma!",
          fr: "Match !",
          ar: "Ø·Ø§Ø¨Ù‚!",
          it: "Corrispondenza!",
        },
      };

      const directions = [
        { id: "N", angle: 0 },
        { id: "NE", angle: 45 },
        { id: "E", angle: 90 },
        { id: "SE", angle: 135 },
        { id: "S", angle: 180 },
        { id: "SW", angle: 225 },
        { id: "W", angle: 270 },
        { id: "NW", angle: 315 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [targetDir, setTargetDir] = useState(directions[1]);
        const [rotation, setRotation] = useState(0); // Current compass rotation
        const [score, setScore] = useState(0);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          newTarget();
        }, []);

        const newTarget = () => {
          const rand =
            directions[Math.floor(Math.random() * directions.length)];
          setTargetDir(rand);
          // reset rotation slightly for UX? No keep as is
        };

        const checkAngle = () => {
          // Normalize rotation to 0-360
          let r = rotation % 360;
          if (r < 0) r += 360;

          // Target needs Red arrow (North) to point to Target?
          // NO, instruction usually: "Where is North-East?"
          // If we rotate the compass housing, the needle stays North.
          // Let's make it simpler: "Turn the Compass so the Arrow points to [Target]"
          // Let's say Arrow is fixed North on screen, map rotates?
          // Or: Arrow rotate by user input.

          // Simpler Game: "The Treasure is to the [Target]. Rotate the arrow to point there."
          // Arrow starts at 0 (North).

          const diff = Math.abs(r - targetDir.angle);
          const isCorrect = diff < 10 || diff > 350;

          if (isCorrect) {
            setScore(score + 1);
            newTarget();
          }
        };

        const handleRotate = (val) => {
          setRotation(val);
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4 bg-sky-200">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-4 text-sky-800 drop-shadow-md">
              ğŸ§­ {getText("title")}
            </h1>

            <div className="bg-white/80 p-6 rounded-2xl shadow-xl text-center mb-8">
              <div className="text-xl text-slate-600 mb-2">
                {getText("instruction")}
              </div>
              <div className="text-4xl font-black text-slate-800 animate-pulse">
                {getText(targetDir.id)}
              </div>
            </div>

            {/* Compass UI */}
            <div className="relative w-80 h-80">
              {/* Background Rose */}
              <div className="absolute inset-0 bg-white rounded-full border-8 border-slate-300 shadow-2xl flex items-center justify-center">
                <div className="absolute top-2 font-bold text-slate-400">N</div>
                <div className="absolute bottom-2 font-bold text-slate-400">
                  S
                </div>
                <div className="absolute right-2 font-bold text-slate-400">
                  E
                </div>
                <div className="absolute left-2 font-bold text-slate-400">
                  W
                </div>

                {/* Ticks */}
                {[0, 45, 90, 135, 180, 225, 270, 315].map((deg) => (
                  <div
                    key={deg}
                    className="absolute w-full h-1 bg-slate-200"
                    style={{ transform: `rotate(${deg}deg)` }}
                  ></div>
                ))}
              </div>

              {/* Rotating Needle */}
              <motion.div
                className="absolute inset-0 flex items-center justify-center cursor-grab active:cursor-grabbing"
                style={{ rotate: rotation }}
                drag
                dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}
                dragElastic={0}
                onDrag={(event, info) => {
                  // Calculate angle from center
                  // Simplified: just use X movement for rotation speed
                  setRotation((r) => r + info.delta.x);
                }}
              >
                {/* Needle Graphic */}
                <div className="w-4 h-60 relative filter drop-shadow-lg">
                  <div className="absolute top-0 w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-b-[120px] border-b-red-600"></div>
                  <div className="absolute bottom-0 w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[120px] border-t-slate-600"></div>
                  <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-yellow-400 rounded-full border-2 border-white"></div>
                </div>
              </motion.div>
            </div>

            <button
              onClick={checkAngle}
              className="mt-12 bg-blue-600 text-white px-10 py-4 rounded-full font-black text-2xl shadow-xl hover:bg-blue-700 transition-transform active:scale-95"
            >
              {getText("match")}
            </button>

            <div className="mt-8 font-bold text-slate-500">Score: {score}</div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          ã€Œè€¶å’Œè¯ç”¨èƒ½åŠ›å‰µé€ å¤§åœ°ï¼Œç”¨æ™ºæ…§å»ºç«‹ä¸–ç•Œï¼Œç”¨è°æ˜é‹ªå¼µç©¹è’¼ã€‚ã€ è€¶åˆ©ç±³æ›¸ 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
