<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Photosynthesis Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: linear-gradient(180deg, #bae6fd 0%, #a3e635 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Photosynthesis Lab",
          zh: "ÂÖâÂêà‰ΩúÁî®ÂØ¶È©óÂÆ§",
          ja: "ÂÖâÂêàÊàê„É©„Éú",
          ko: "Í¥ëÌï©ÏÑ± Ïã§ÌóòÏã§",
          es: "Laboratorio de Fotos√≠ntesis",
          de: "Photosynthese-Labor",
          fi: "Yhteytt√§mislaboratorio",
          fr: "Laboratoire de photosynth√®se",
          ar: "ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿ™ÿ±ŸÉŸäÿ® ÿßŸÑÿ∂Ÿàÿ¶Ÿä",
          it: "Laboratorio Fotosintesi",
        },
        instruction: {
          en: "Provide what the plant needs!",
          zh: "Êèê‰æõÊ§çÁâ©ÈúÄË¶ÅÁöÑÊù±Ë•øÔºÅ",
          ja: "Ê§çÁâ©„Å´ÂøÖË¶Å„Å™„ÇÇ„ÅÆ„Çí‰∏é„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÏãùÎ¨ºÏóêÍ≤å ÌïÑÏöîÌïú Í≤ÉÏùÑ Ï†úÍ≥µÌïòÏÑ∏Ïöî!",
          es: "¬°Proporciona lo que la planta necesita!",
          de: "Gib der Pflanze, was sie braucht!",
          fi: "Anna kasville mit√§ se tarvitsee!",
          fr: "Donnez √† la plante ce dont elle a besoin !",
          ar: "ŸàŸÅÿ± ŸÖÿß Ÿäÿ≠ÿ™ÿßÿ¨Ÿá ÿßŸÑŸÜÿ®ÿßÿ™!",
          it: "Fornisci ci√≤ di cui la pianta ha bisogno!",
        },
        sun: {
          en: "Sunlight",
          zh: "ÈôΩÂÖâ",
          ja: "Êó•ÂÖâ",
          ko: "ÌñáÎπõ",
          es: "Luz solar",
          de: "Sonnenlicht",
          fi: "Auringonvalo",
          fr: "Lumi√®re du soleil",
          ar: "ÿ∂Ÿàÿ° ÿßŸÑÿ¥ŸÖÿ≥",
          it: "Luce solare",
        },
        water: {
          en: "Water",
          zh: "Ê∞¥",
          ja: "Ê∞¥",
          ko: "Î¨º",
          es: "Agua",
          de: "Wasser",
          fi: "Vesi",
          fr: "Eau",
          ar: "ŸÖÿßÿ°",
          it: "Acqua",
        },
        co2: {
          en: "Carbon Dioxide",
          zh: "‰∫åÊ∞ßÂåñÁ¢≥",
          ja: "‰∫åÈÖ∏ÂåñÁÇ≠Á¥†",
          ko: "Ïù¥ÏÇ∞ÌôîÌÉÑÏÜå",
          es: "Di√≥xido de carbono",
          de: "Kohlendioxid",
          fi: "Hiilidioksidi",
          fr: "Dioxyde de carbone",
          ar: "ÿ´ÿßŸÜŸä ÿ£ŸÉÿ≥ŸäÿØ ÿßŸÑŸÉÿ±ÿ®ŸàŸÜ",
          it: "Anidride Carbonica",
        },
        oxygen: {
          en: "Oxygen",
          zh: "Ê∞ßÊ∞£",
          ja: "ÈÖ∏Á¥†",
          ko: "ÏÇ∞ÏÜå",
          es: "Ox√≠geno",
          de: "Sauerstoff",
          fi: "Happi",
          fr: "Oxyg√®ne",
          ar: "ÿ£ŸÉÿ≥ÿ¨ŸäŸÜ",
          it: "Ossigeno",
        },
        food: {
          en: "Food (Sugar)",
          zh: "È§äÂàÜ (Á≥ñ)",
          ja: "È§äÂàÜ (Á≥ñ)",
          ko: "ÏñëÎ∂Ñ (ÏÑ§ÌÉï)",
          es: "Alimento (Az√∫car)",
          de: "Nahrung (Zucker)",
          fi: "Ravinto (Sokeri)",
          fr: "Nourriture (Sucre)",
          ar: "ÿ∫ÿ∞ÿßÿ° (ÿ≥ŸÉÿ±)",
          it: "Cibo (Zucchero)",
        },
        growing: {
          en: "Growing...",
          zh: "ÁîüÈï∑‰∏≠...",
          ja: "ÊàêÈï∑‰∏≠...",
          ko: "ÏûêÎùºÎäî Ï§ë...",
          es: "Creciendo...",
          de: "W√§chst...",
          fi: "Kasvaa...",
          fr: "Pousse...",
          ar: "ŸäŸÜŸÖŸà...",
          it: "Crescita...",
        },
        done: {
          en: "Completed!",
          zh: "ÂÆåÊàê‰∫ÜÔºÅ",
          ja: "ÂÆå‰∫ÜÔºÅ",
          ko: "ÏôÑÎ£å!",
          es: "¬°Completado!",
          de: "Fertig!",
          fi: "Valmis!",
          fr: "Termin√© !",
          ar: "ŸÖŸÜÿ™ŸáŸâ!",
          it: "Completato!",
        },
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [inputs, setInputs] = useState({
          sun: false,
          water: false,
          co2: false,
        });
        const [progress, setProgress] = useState(0);

        const getText = (key) => t[key][lang] || t[key]["en"];

        const toggleInput = (key) => {
          setInputs((prev) => ({ ...prev, [key]: !prev[key] }));
        };

        useEffect(() => {
          if (inputs.sun && inputs.water && inputs.co2) {
            const interval = setInterval(() => {
              setProgress((p) => {
                if (p >= 100) {
                  clearInterval(interval);
                  return 100;
                }
                return p + 1;
              });
            }, 50);
            return () => clearInterval(interval);
          } else {
            // Maybe regress if not all inputs?
            // Simplification: stop growing
          }
        }, [inputs]);

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-4 text-green-800 drop-shadow-sm">
              {getText("title")}
            </h1>

            <div className="flex-1 w-full max-w-4xl relative flex items-end justify-center pb-8">
              {/* Scene */}

              {/* Ground */}
              <div className="absolute bottom-0 w-full h-32 bg-amber-800 rounded-t-3xl z-10"></div>

              {/* Plant */}
              <div
                className="relative z-20 flex flex-col items-center"
                style={{ marginBottom: "20px" }}
              >
                <motion.div
                  className="w-4 bg-green-600 rounded-full"
                  style={{ height: `${50 + progress * 2}px` }}
                ></motion.div>
                {/* Leaves */}
                <motion.div
                  className="absolute w-12 h-12 bg-green-500 rounded-tr-[30px] rounded-bl-[30px]"
                  animate={{
                    scale: inputs.sun && inputs.water && inputs.co2 ? 1.2 : 1,
                  }}
                  style={{
                    top: "20%",
                    left: "-30px",
                    opacity: progress > 20 ? 1 : 0,
                  }}
                ></motion.div>
                <motion.div
                  className="absolute w-12 h-12 bg-green-500 rounded-tl-[30px] rounded-br-[30px]"
                  animate={{
                    scale: inputs.sun && inputs.water && inputs.co2 ? 1.2 : 1,
                  }}
                  style={{
                    top: "40%",
                    right: "-30px",
                    opacity: progress > 40 ? 1 : 0,
                  }}
                ></motion.div>

                {/* Products being released */}
                {progress > 80 && (
                  <>
                    <div className="absolute -right-16 top-0 text-white font-bold animate-bounce">
                      üí® {getText("oxygen")}
                    </div>
                    <div className="absolute -left-16 bottom-0 text-yellow-200 font-bold animate-pulse">
                      üç¨ {getText("food")}
                    </div>
                  </>
                )}
              </div>

              {/* Inputs UI Controls */}
              <div className="absolute top-4 left-4 right-4 flex justify-center gap-6 z-30">
                <button
                  onClick={() => toggleInput("sun")}
                  className={`p-4 rounded-full shadow-xl transition-all ${
                    inputs.sun
                      ? "bg-yellow-400 scale-110 ring-4 ring-yellow-200"
                      : "bg-gray-200 opacity-50"
                  }`}
                >
                  <div className="text-4xl">‚òÄÔ∏è</div>
                  <div className="text-xs font-bold text-slate-700">
                    {getText("sun")}
                  </div>
                </button>
                <button
                  onClick={() => toggleInput("water")}
                  className={`p-4 rounded-full shadow-xl transition-all ${
                    inputs.water
                      ? "bg-blue-400 scale-110 ring-4 ring-blue-200"
                      : "bg-gray-200 opacity-50"
                  }`}
                >
                  <div className="text-4xl">üíß</div>
                  <div className="text-xs font-bold text-slate-700">
                    {getText("water")}
                  </div>
                </button>
                <button
                  onClick={() => toggleInput("co2")}
                  className={`p-4 rounded-full shadow-xl transition-all ${
                    inputs.co2
                      ? "bg-gray-400 scale-110 ring-4 ring-gray-200"
                      : "bg-gray-200 opacity-50"
                  }`}
                >
                  <div className="text-4xl">üå´Ô∏è</div>
                  <div className="text-xs font-bold text-slate-700">
                    {getText("co2")}
                  </div>
                </button>
              </div>

              {/* Status */}
              <div className="absolute bottom-4 left-0 right-0 text-center z-40 text-white font-black text-2xl drop-shadow-md">
                {progress === 100
                  ? getText("done")
                  : inputs.sun && inputs.water && inputs.co2
                  ? getText("growing")
                  : getText("instruction")}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
