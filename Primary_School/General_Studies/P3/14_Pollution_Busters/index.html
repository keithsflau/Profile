<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸‰å¸¸è­˜ï¼šæ±¡æŸ“å‰‹æ˜Ÿ | Pollution Busters</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #a1a1aa 0%, #71717a 100%);
        cursor: crosshair;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Pollution Busters",
          zh: "æ±¡æŸ“å‰‹æ˜Ÿ",
          ja: "æ±šæŸ“ãƒã‚¹ã‚¿ãƒ¼ã‚º",
          ko: "ì˜¤ì—¼ ë²„ìŠ¤í„°ì¦ˆ",
          es: "Cazadores de ContaminaciÃ³n",
          de: "Umweltverschmutzungs-JÃ¤ger",
          fi: "Saasteentorjujat",
          fr: "Chasseurs de pollution",
          ar: "Ù…ÙƒØ§ÙØ­Ùˆ Ø§Ù„ØªÙ„ÙˆØ«",
          it: "Cacciatori di Inquinamento",
        },
        instruction: {
          en: "Tap all pollution sources!",
          zh: "æ‰¾å‡ºæ‰€æœ‰æ±¡æŸ“æºé ­ï¼",
          ja: "ã™ã¹ã¦ã®æ±šæŸ“æºã‚’ã‚¿ãƒƒãƒ—ã—ã‚ˆã†ï¼",
          ko: "ëª¨ë“  ì˜¤ì—¼ì›ì„ íƒ­í•˜ì„¸ìš”!",
          es: "Â¡Toca todas las fuentes de contaminaciÃ³n!",
          de: "Tippe auf alle Verschmutzungsquellen!",
          fi: "Napauta kaikkia saastelÃ¤hteitÃ¤!",
          fr: "Touchez toutes les sources de pollution !",
          ar: "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªÙ„ÙˆØ«!",
          it: "Tocca tutte le fonti di inquinamento!",
        },

        air: {
          en: "Air Pollution",
          zh: "ç©ºæ°£æ±¡æŸ“",
          ja: "å¤§æ°—æ±šæŸ“",
          ko: "ëŒ€ê¸° ì˜¤ì—¼",
          es: "ContaminaciÃ³n del Aire",
          de: "Luftverschmutzung",
          fi: "Ilmansaasteet",
          fr: "Pollution de l'air",
          ar: "ØªÙ„ÙˆØ« Ø§Ù„Ù‡ÙˆØ§Ø¡",
          it: "Inquinamento dell'Aria",
        },
        sound: {
          en: "Noise Pollution",
          zh: "å™ªéŸ³æ±¡æŸ“",
          ja: "é¨’éŸ³å…¬å®³",
          ko: "ì†ŒìŒ ê³µí•´",
          es: "ContaminaciÃ³n AcÃºstica",
          de: "LÃ¤rmbelÃ¤stigung",
          fi: "Melusaaste",
          fr: "Pollution sonore",
          ar: "ØªÙ„ÙˆØ« Ø¶ÙˆØ¶Ø§Ø¦ÙŠ",
          it: "Inquinamento Acustico",
        },
        light: {
          en: "Light Pollution",
          zh: "å…‰æ±¡æŸ“",
          ja: "å…‰å®³",
          ko: "ë¹› ê³µí•´",
          es: "ContaminaciÃ³n LumÃ­nica",
          de: "Lichtverschmutzung",
          fi: "Valosaaste",
          fr: "Pollution lumineuse",
          ar: "ØªÙ„ÙˆØ« Ø¶ÙˆØ¦ÙŠ",
          it: "Inquinamento Luminoso",
        },
        land: {
          en: "Land Pollution",
          zh: "åœŸåœ°æ±¡æŸ“",
          ja: "åœŸå£Œæ±šæŸ“",
          ko: "í† ì–‘ ì˜¤ì—¼",
          es: "ContaminaciÃ³n del Suelo",
          de: "Bodenverschmutzung",
          fi: "MaaperÃ¤n saastuminen",
          fr: "Pollution des sols",
          ar: "ØªÙ„ÙˆØ« Ø§Ù„Ø£Ø±Ø¶",
          it: "Inquinamento del Suolo",
        },

        found: {
          en: "Found:",
          zh: "ç™¼ç¾ï¼š",
          ja: "ç™ºè¦‹:",
          ko: "ë°œê²¬:",
          es: "Encontrado:",
          de: "Gefunden:",
          fi: "LÃ¶ydetty:",
          fr: "TrouvÃ© :",
          ar: "ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡:",
          it: "Trovato:",
        },
        cleared: {
          en: "Pollution Cleared!",
          zh: "æ±¡æŸ“å·²æ¸…é™¤ï¼",
          ja: "æ±šæŸ“é™¤å»å®Œäº†ï¼",
          ko: "ì˜¤ì—¼ ì œê±° ì™„ë£Œ!",
          es: "Â¡ContaminaciÃ³n Eliminada!",
          de: "Verschmutzung beseitigt!",
          fi: "Saasteet poistettu!",
          fr: "Pollution Ã©liminÃ©e !",
          ar: "ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„ÙˆØ«!",
          it: "Inquinamento eliminato!",
        },
        reset: {
          en: "Play Again",
          zh: "å†ç©ä¸€æ¬¡",
          ja: "ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤",
          ko: "ë‹¤ì‹œ í•˜ê¸°",
          es: "Jugar de Nuevo",
          de: "Nochmal spielen",
          fi: "Pelaa uudelleen",
          fr: "Rejouer",
          ar: "Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",
          it: "Gioca di Nuovo",
        },

        desc_exhaust: {
          en: "Car Exhaust",
          zh: "æ±½è»Šå»¢æ°£",
          ja: "è»Šã®æ’æ°—ã‚¬ã‚¹",
          ko: "ìë™ì°¨ ë°°ê¸°ê°€ìŠ¤",
          es: "Escape de coche",
          de: "Autoabgase",
          fi: "Auton pakokaasut",
          fr: "Ã‰chappement de voiture",
          ar: "Ø¹ÙˆØ§Ø¯Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª",
          it: "Scarico auto",
        },
        desc_drill: {
          en: "Construction Noise",
          zh: "åœ°ç›¤å™ªéŸ³",
          ja: "å·¥äº‹ã®é¨’éŸ³",
          ko: "ê³µì‚¬ ì†ŒìŒ",
          es: "Ruido de construcciÃ³n",
          de: "BaulÃ¤rm",
          fi: "RakennustyÃ¶maan melu",
          fr: "Bruit de construction",
          ar: "Ø¶ÙˆØ¶Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø§Ø¡",
          it: "Rumore di costruzione",
        },
        desc_trash: {
          en: "Litter",
          zh: "åƒåœ¾",
          ja: "ã‚´ãƒŸ",
          ko: "ì“°ë ˆê¸°",
          es: "Basura",
          de: "MÃ¼ll",
          fi: "Roska",
          fr: "DÃ©chets",
          ar: "Ù‚Ù…Ø§Ù…Ø©",
          it: "Rifiuti",
        },
        desc_neon: {
          en: "Bright Signs",
          zh: "éœ“è™¹ç‡ˆæ‹›ç‰Œ",
          ja: "æ˜ã‚‹ã„çœ‹æ¿",
          ko: "ë°ì€ ê°„íŒ",
          es: "Carteles brillantes",
          de: "Helle Schilder",
          fi: "Kirkkaat kyltit",
          fr: "Enseignes lumineuses",
          ar: "Ø¹Ù„Ø§Ù…Ø§Øª Ø³Ø§Ø·Ø¹Ø©",
          it: "Insegne luminose",
        },
        desc_smoke: {
          en: "Factory Smoke",
          zh: "å·¥å» é»‘ç…™",
          ja: "å·¥å ´ã®ç…™",
          ko: "ê³µì¥ ì—°ê¸°",
          es: "Humo de fÃ¡brica",
          de: "Fabrikrauch",
          fi: "Tehtaan savu",
          fr: "FumÃ©e d'usine",
          ar: "Ø¯Ø®Ø§Ù† Ø§Ù„Ù…ØµØ§Ù†Ø¹",
          it: "Fumo di fabbrica",
        },
        desc_sewage: {
          en: "Dirty Water",
          zh: "æ±¡æ°´",
          ja: "æ±šæ°´",
          ko: "ë”ëŸ¬ìš´ ë¬¼",
          es: "Agua sucia",
          de: "Schmutzwasser",
          fi: "Likainen vesi",
          fr: "Eau sale",
          ar: "Ù…ÙŠØ§Ù‡ Ù‚Ø°Ø±Ø©",
          it: "Acqua sporca",
        },
      };

      const pollutions = [
        {
          id: 1,
          type: "air",
          icon: "ğŸ’¨",
          x: 20,
          y: 30,
          desc: "desc_smoke",
          color: "text-slate-500",
        },
        {
          id: 2,
          type: "sound",
          icon: "ğŸ”¨",
          x: 80,
          y: 60,
          desc: "desc_drill",
          color: "text-yellow-600",
        },
        {
          id: 3,
          type: "land",
          icon: "ğŸš®",
          x: 50,
          y: 80,
          desc: "desc_trash",
          color: "text-slate-400",
        },
        {
          id: 4,
          type: "air",
          icon: "ğŸš—",
          x: 30,
          y: 70,
          desc: "desc_exhaust",
          color: "text-slate-500",
        },
        {
          id: 5,
          type: "light",
          icon: "ğŸ’¡",
          x: 70,
          y: 20,
          desc: "desc_neon",
          color: "text-yellow-300",
        },
        {
          id: 6,
          type: "land",
          icon: "ğŸ§ª",
          x: 60,
          y: 85,
          desc: "desc_sewage",
          color: "text-green-600",
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [found, setFound] = useState([]); // ids
        const [cleared, setCleared] = useState(false);
        const [popups, setPopups] = useState([]); // visual text popups

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          if (found.length === pollutions.length) {
            setCleared(true);
          }
        }, [found]);

        const handleClick = (p) => {
          if (found.includes(p.id)) return;

          setFound((prev) => [...prev, p.id]);

          // Add popup
          const pid = Date.now();
          setPopups((prev) => [
            ...prev,
            { id: pid, x: p.x, y: p.y, text: getText(p.desc) },
          ]);
          setTimeout(() => {
            setPopups((prev) => prev.filter((pp) => pp.id !== pid));
          }, 1000);
        };

        const reset = () => {
          setFound([]);
          setCleared(false);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none font-sans relative overflow-hidden">
            <LanguageSelector lang={lang} setLang={setLang} />

            <h1 className="text-4xl md:text-5xl font-black text-rose-500 mb-2 mt-8 drop-shadow-md z-10 bg-white/80 px-6 py-2 rounded-full">
              ğŸ•µï¸ {getText("title")}
            </h1>

            <div className="absolute top-4 left-4 z-20 font-black text-2xl text-white bg-black/40 px-4 py-2 rounded-xl">
              {found.length} / {pollutions.length}
            </div>

            {/* Game Scene (City Background) */}
            <div className="absolute inset-0 z-0">
              {/* Sky */}
              <div
                className={`absolute inset-0 transition-colors duration-1000 ${
                  cleared ? "bg-sky-300" : "bg-slate-400"
                }`}
              ></div>

              {/* Buildings */}
              <div className="absolute bottom-0 w-full h-[60%] flex items-end justify-center opacity-50 pointer-events-none">
                <div className="w-20 h-64 bg-slate-700 mx-1"></div>
                <div className="w-32 h-96 bg-slate-800 mx-1"></div>
                <div className="w-24 h-48 bg-slate-600 mx-1"></div>
                <div className="w-40 h-80 bg-slate-700 mx-1"></div>
                <div className="w-16 h-40 bg-slate-600 mx-1"></div>
              </div>

              {/* Pollution Items */}
              {pollutions.map((p) => {
                const isFound = found.includes(p.id);
                return (
                  <button
                    key={p.id}
                    onClick={() => handleClick(p)}
                    className={`absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500 focus:outline-none
                                 ${
                                   isFound
                                     ? "opacity-0 scale-150 pointer-events-none"
                                     : "opacity-100 scale-100 hover:scale-110"
                                 }
                             `}
                    style={{ left: `${p.x}%`, top: `${p.y}%` }}
                  >
                    <div
                      className={`text-6xl md:text-8xl drop-shadow-2xl ${p.color}`}
                    >
                      {p.icon}
                    </div>
                    {/* Hint Pulse */}
                    {!isFound && (
                      <div className="absolute inset-0 bg-red-500 rounded-full animate-ping opacity-20 -z-10"></div>
                    )}
                  </button>
                );
              })}

              {/* Cleared FX */}
              {cleared && (
                <div className="absolute inset-0 pointer-events-none">
                  <div className="absolute top-[20%] left-[20%] text-6xl animate-bounce">
                    ğŸ¦‹
                  </div>
                  <div className="absolute top-[30%] right-[30%] text-6xl animate-bounce delay-100">
                    ğŸ•Šï¸
                  </div>
                  <div className="absolute bottom-[20%] left-[40%] text-6xl animate-bounce delay-200">
                    ğŸŒ»
                  </div>
                </div>
              )}

              {/* Popups */}
              <AnimatePresence>
                {popups.map((pp) => (
                  <motion.div
                    key={pp.id}
                    initial={{ opacity: 0, y: 0 }}
                    animate={{ opacity: 1, y: -50 }}
                    exit={{ opacity: 0 }}
                    className="absolute bg-white text-slate-800 px-4 py-2 rounded-xl font-bold border-2 border-green-400 shadow-xl z-30 pointer-events-none transform -translate-x-1/2"
                    style={{ left: `${pp.x}%`, top: `${pp.y}%` }}
                  >
                    âœ… {pp.text}
                  </motion.div>
                ))}
              </AnimatePresence>
            </div>

            {/* Win Screen */}
            {cleared && (
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white/90 p-12 rounded-[3rem] shadow-2xl text-center z-50 backdrop-blur-md"
              >
                <div className="text-8xl mb-4">ğŸŒ¿</div>
                <h2 className="text-4xl font-black text-green-600 mb-6">
                  {getText("cleared")}
                </h2>
                <button
                  onClick={reset}
                  className="bg-green-500 text-white px-10 py-4 rounded-full font-black text-xl hover:bg-green-600 shadow-xl"
                >
                  {getText("reset")} ğŸ”„
                </button>
              </motion.div>
            )}

            <div className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-white/80 px-6 py-2 rounded-full font-bold text-slate-600 z-10 shadow-lg pointer-events-none">
              {getText("instruction")}
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
