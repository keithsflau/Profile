<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÂ∏∏Ë≠òÔºö‰ªäÊòîÈ¶ôÊ∏Ø | Then And Now</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #d6d3d1 0%, #a8a29e 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Then And Now",
          zh: "‰ªäÊòîÈ¶ôÊ∏Ø",
          ja: "Êòî„Å®‰ªä",
          ko: "Í∑∏ÎïåÏôÄ ÏßÄÍ∏à",
          es: "Antes y Ahora",
          de: "Damals und Heute",
          fi: "Silloin ja nyt",
          fr: "Avant et Maintenant",
          ar: "ÿßŸÑŸÖÿßÿ∂Ÿä ŸàÿßŸÑÿ≠ÿßÿ∂ÿ±",
          it: "Allora e Adesso",
        },
        instruction: {
          en: "Match the Old with the New!",
          zh: "Â∞áËàä‰∫ãÁâ©ËàáÊñ∞‰∫ãÁâ©ÈÖçÂ∞çÔºÅ",
          ja: "Âè§„ÅÑ„ÇÇ„ÅÆ„Å®Êñ∞„Åó„ÅÑ„ÇÇ„ÅÆ„ÇíÂêà„Çè„Åõ„Çà„ÅÜÔºÅ",
          ko: "Ïòõ Í≤ÉÍ≥º ÏÉà Í≤ÉÏùÑ ÏßùÏßÄÏúºÏÑ∏Ïöî!",
          es: "¬°Combina lo Viejo con lo Nuevo!",
          de: "Ordne Alt und Neu zu!",
          fi: "Yhdist√§ vanha ja uusi!",
          fr: "Associez l'Ancien avec le Nouveau !",
          ar: "ÿ∑ÿßÿ®ŸÇ ÿßŸÑŸÇÿØŸäŸÖ ÿ®ÿßŸÑÿ¨ÿØŸäÿØ!",
          it: "Abbina il Vecchio con il Nuovo!",
        },

        rickshaw: {
          en: "Rickshaw",
          zh: "‰∫∫ÂäõËªä",
          ja: "‰∫∫ÂäõËªä",
          ko: "Ïù∏Î†•Í±∞",
          es: "Rickshaw",
          de: "Rikscha",
          fi: "Riksa",
          fr: "Pousse-pousse",
          ar: "ÿ±ŸäŸÉÿßÿ¥ÿ©",
          it: "Risci√≤",
        },
        taxi: {
          en: "Taxi",
          zh: "ÁöÑÂ£´",
          ja: "„Çø„ÇØ„Ç∑„Éº",
          ko: "ÌÉùÏãú",
          es: "Taxi",
          de: "Taxi",
          fi: "Taksi",
          fr: "Taxi",
          ar: "ÿ≥Ÿäÿßÿ±ÿ© ÿ£ÿ¨ÿ±ÿ©",
          it: "Taxi",
        },

        abacus: {
          en: "Abacus",
          zh: "ÁÆóÁõ§",
          ja: "„Åù„Çç„Å∞„Çì",
          ko: "Ï£ºÌåê",
          es: "√Åbaco",
          de: "Abakus",
          fi: "Helmitaulu",
          fr: "Abaque",
          ar: "ÿπÿØÿßÿØ",
          it: "Abaco",
        },
        calculator: {
          en: "Calculator",
          zh: "Ë®àÁÆóÊ©ü",
          ja: "ÈõªÂçì",
          ko: "Í≥ÑÏÇ∞Í∏∞",
          es: "Calculadora",
          de: "Taschenrechner",
          fi: "Laskin",
          fr: "Calculatrice",
          ar: "ÿ¢ŸÑÿ© ÿ≠ÿßÿ≥ÿ®ÿ©",
          it: "Calcolatrice",
        },

        letter: {
          en: "Letter",
          zh: "Êõ∏‰ø°",
          ja: "ÊâãÁ¥ô",
          ko: "Ìé∏ÏßÄ",
          es: "Carta",
          de: "Brief",
          fi: "Kirje",
          fr: "Lettre",
          ar: "ÿ±ÿ≥ÿßŸÑÿ©",
          it: "Lettera",
        },
        email: {
          en: "Email/Phone",
          zh: "ÈõªÈÉµ/ÊâãÊ©ü",
          ja: "„É°„Éº„É´/ÈõªË©±",
          ko: "Ïù¥Î©îÏùº/Ï†ÑÌôî",
          es: "Email/Tel√©fono",
          de: "E-Mail/Telefon",
          fi: "S√§hk√∂posti/Puhelin",
          fr: "Email/T√©l√©phone",
          ar: "ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä/Ÿáÿßÿ™ŸÅ",
          it: "Email/Telefono",
        },

        fan: {
          en: "Hand Fan",
          zh: "ËëµÊâá",
          ja: "„ÅÜ„Å°„Çè",
          ko: "Î∂ÄÏ±Ñ",
          es: "Abanico",
          de: "F√§cher",
          fi: "Viuhka",
          fr: "√âventail",
          ar: "ŸÖÿ±Ÿàÿ≠ÿ© ŸäÿØŸàŸäÿ©",
          it: "Ventaglio",
        },
        ac: {
          en: "Air Con",
          zh: "ÂÜ∑Ê∞£Ê©ü",
          ja: "„Ç®„Ç¢„Ç≥„É≥",
          ko: "ÏóêÏñ¥Ïª®",
          es: "Aire Acondicionado",
          de: "Klimaanlage",
          fi: "Ilmastointi",
          fr: "Climatisation",
          ar: "ŸÖŸÉŸäŸÅ ŸáŸàÿßÿ°",
          it: "Aria Condizionata",
        },

        well: {
          en: "Water Well",
          zh: "‰∫ï",
          ja: "‰∫ïÊà∏",
          ko: "Ïö∞Î¨º",
          es: "Pozo de agua",
          de: "Brunnen",
          fi: "Kaivo",
          fr: "Puits",
          ar: "ÿ®ÿ¶ÿ±",
          it: "Pozzo",
        },
        tap: {
          en: "Water Tap",
          zh: "Ê∞¥ÈæçÈ†≠",
          ja: "ËõáÂè£",
          ko: "ÏàòÎèÑÍº≠ÏßÄ",
          es: "Grifo",
          de: "Wasserhahn",
          fi: "Vesihana",
          fr: "Robinet",
          ar: "ÿµŸÜÿ®Ÿàÿ±",
          it: "Rubinetto",
        },

        candle: {
          en: "Candle/Oil Lamp",
          zh: "Ë†üÁá≠/Ê≤πÁáà",
          ja: "„Çç„ÅÜ„Åù„Åè/„É©„É≥„Éó",
          ko: "ÏñëÏ¥à/Í∏∞Î¶Ñ Îû®ÌîÑ",
          es: "Vela/L√°mpara de aceite",
          de: "Kerze/√ñllampe",
          fi: "Kynttil√§/√ñljylamppu",
          fr: "Bougie/Lampe √† huile",
          ar: "ÿ¥ŸÖÿπÿ©/ŸÖÿµÿ®ÿßÿ≠ ÿ≤Ÿäÿ™",
          it: "Candela/Lampada a olio",
        },
        lightbulb: {
          en: "Electric Light",
          zh: "ÈõªÁáà",
          ja: "ÈõªÁêÉ",
          ko: "Ï†ÑÎì±",
          es: "Luz el√©ctrica",
          de: "Gl√ºhbirne",
          fi: "S√§hk√∂valo",
          fr: "Lumi√®re √©lectrique",
          ar: "ŸÖÿµÿ®ÿßÿ≠ ŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä",
          it: "Luce Elettrica",
        },

        old: {
          en: "Then (Old)",
          zh: "ÊòîÊó• (Ëàä)",
          ja: "Êòî",
          ko: "Í≥ºÍ±∞ (Íµ¨)",
          es: "Antes (Viejo)",
          de: "Damals (Alt)",
          fi: "Silloin (Vanha)",
          fr: "Avant (Vieux)",
          ar: "ÿ´ŸÖ (ŸÇÿØŸäŸÖ)",
          it: "Allora (Vecchio)",
        },
        new: {
          en: "Now (New)",
          zh: "‰ªäÊó• (Êñ∞)",
          ja: "‰ªä",
          ko: "ÌòÑÏû¨ (Ïã†)",
          es: "Ahora (Nuevo)",
          de: "Heute (Neu)",
          fi: "Nyt (Uusi)",
          fr: "Maintenant (Nouveau)",
          ar: "ÿßŸÑÿ¢ŸÜ (ÿ¨ÿØŸäÿØ)",
          it: "Adesso (Nuovo)",
        },

        correct: {
          en: "Correct Match!",
          zh: "ÈÖçÂ∞çÊ≠£Á¢∫ÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµÏûÖÎãàÎã§!",
          es: "¬°Pareja Correcta!",
          de: "Richtig zugeordnet!",
          fi: "Oikea pari!",
          fr: "Bonne correspondance !",
          ar: "ÿ™ÿ∑ÿßÿ®ŸÇ ÿµÿ≠Ÿäÿ≠!",
          it: "Abbinamento Corretto!",
        },
        wrong: {
          en: "Not a match!",
          zh: "ÈÖçÂ∞çÈåØË™§ÔºÅ",
          ja: "ÈÅï„ÅÑ„Åæ„ÅôÔºÅ",
          ko: "ÏßùÏù¥ ÏïÑÎãàÏóêÏöî!",
          es: "¬°No coincide!",
          de: "Kein Treffer!",
          fi: "Ei t√§sm√§√§!",
          fr: "Pas de correspondance !",
          ar: "ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ÿ∑ÿßÿ®ŸÇ!",
          it: "Non corrisponde!",
        },
        completed: {
          en: "History Expert!",
          zh: "Ê≠∑Âè≤Â∞àÂÆ∂ÔºÅ",
          ja: "Ê≠¥Âè≤„ÅÆ„Ç®„Ç≠„Çπ„Éë„Éº„ÉàÔºÅ",
          ko: "Ïó≠ÏÇ¨ Ï†ÑÎ¨∏Í∞Ä!",
          es: "¬°Experto en Historia!",
          de: "Geschichtsexperte!",
          fi: "Historia-asiantuntija!",
          fr: "Expert en histoire !",
          ar: "ÿÆÿ®Ÿäÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ!",
          it: "Esperto di Storia!",
        },
        reset: {
          en: "Play Again",
          zh: "ÂÜçÁé©‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§",
          ko: "Îã§Ïãú ÌïòÍ∏∞",
          es: "Jugar de Nuevo",
          de: "Nochmal spielen",
          fi: "Pelaa uudelleen",
          fr: "Rejouer",
          ar: "ÿßŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Gioca di Nuovo",
        },
      };

      const pairs = [
        {
          id: 1,
          old: { id: "rickshaw", icon: "üõ∫" },
          new: { id: "taxi", icon: "üöï" },
        },
        {
          id: 2,
          old: { id: "abacus", icon: "üßÆ" },
          new: { id: "calculator", icon: "üì±" },
        }, // Calculator app on phone
        {
          id: 3,
          old: { id: "letter", icon: "‚úâÔ∏è" },
          new: { id: "email", icon: "üìß" },
        },
        { id: 4, old: { id: "fan", icon: "ü™≠" }, new: { id: "ac", icon: "‚ùÑÔ∏è" } },
        {
          id: 5,
          old: { id: "well", icon: "üï≥Ô∏è" },
          new: { id: "tap", icon: "üö∞" },
        },
        {
          id: 6,
          old: { id: "candle", icon: "üïØÔ∏è" },
          new: { id: "lightbulb", icon: "üí°" },
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [queue, setQueue] = useState([]);
        const [current, setCurrent] = useState(null);
        const [options, setOptions] = useState([]);
        const [feedback, setFeedback] = useState(null);
        const [score, setScore] = useState(0);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          initGame();
        }, []);

        const initGame = () => {
          const q = [...pairs].sort(() => Math.random() - 0.5);
          setQueue(q);
          nextRound(q[0]);
          setScore(0);
        };

        const nextRound = (round) => {
          if (!round) {
            setCurrent(null);
            return;
          }
          setCurrent(round);
          setFeedback(null);

          // Generate options: Correct answer + 3 distractors (from 'new' category of other pairs)
          const distractors = pairs
            .filter((p) => p.id !== round.id)
            .map((p) => p.new)
            .sort(() => Math.random() - 0.5)
            .slice(0, 3);
          const opts = [round.new, ...distractors].sort(
            () => Math.random() - 0.5
          );
          setOptions(opts);
        };

        const handleChoice = (opt) => {
          if (feedback) return;

          if (opt.id === current.new.id) {
            setFeedback("correct");
            setScore((s) => s + 1);
            setTimeout(() => {
              const nextIdx = queue.indexOf(current) + 1;
              if (nextIdx < queue.length) nextRound(queue[nextIdx]);
              else setCurrent(null);
            }, 1000);
          } else {
            setFeedback("wrong");
            setTimeout(() => setFeedback(null), 800);
          }
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none font-sans overflow-hidden">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-stone-700 mb-2 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              üï∞Ô∏è {getText("title")}
            </h1>

            <div className="font-bold text-stone-600 mb-8 bg-white/40 px-4 py-1 rounded-full">
              {getText("instruction")}
            </div>

            {current ? (
              <div className="w-full max-w-4xl flex flex-col md:flex-row gap-8 items-center flex-1 justify-center relative">
                {/* The Old Item (Target) */}
                <div className="relative flex flex-col items-center">
                  <div className="bg-sepia-200 p-12 rounded-[2rem] shadow-2xl border-8 border-stone-400 sepia bg-[url('https://www.transparenttextures.com/patterns/aged-paper.png')] w-64 h-64 flex flex-col items-center justify-center">
                    <div className="text-8xl mb-4 opacity-80">
                      {current.old.icon}
                    </div>
                    <div className="font-black text-2xl text-stone-800 uppercase tracking-widest">
                      {getText("old")}
                    </div>
                    <div className="text-xl font-bold text-stone-700">
                      {getText(current.old.id)}
                    </div>
                  </div>
                  {/* Arrow */}
                  <div className="md:hidden text-4xl text-stone-500 my-4">
                    ‚¨áÔ∏è
                  </div>
                </div>

                <div className="hidden md:block text-6xl text-stone-400">
                  ‚û°Ô∏è
                </div>

                {/* The New Options */}
                <div className="flex-1 w-full grid grid-cols-2 gap-4">
                  {options.map((opt) => (
                    <button
                      key={opt.id}
                      onClick={() => handleChoice(opt)}
                      disabled={feedback}
                      className="bg-white p-6 rounded-2xl shadow-lg border-2 border-stone-200 hover:border-blue-400 hover:bg-blue-50 transition-all active:scale-95 flex flex-col items-center"
                    >
                      <div className="text-5xl mb-2">{opt.icon}</div>
                      <div className="font-black text-lg text-slate-700">
                        {getText(opt.id)}
                      </div>
                    </button>
                  ))}
                </div>

                {feedback && (
                  <div
                    className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 px-8 py-4 rounded-3xl font-black text-3xl shadow-2xl whitespace-nowrap ${
                      feedback === "correct"
                        ? "bg-green-600 text-white"
                        : "bg-red-500 text-white"
                    }`}
                  >
                    {getText(feedback)}
                  </div>
                )}
              </div>
            ) : (
              <div className="bg-white/90 p-12 rounded-3xl shadow-xl text-center mt-20 backdrop-blur-sm">
                <div className="text-8xl mb-4">‚åõ</div>
                <h2 className="text-4xl font-black text-stone-800 mb-6">
                  {getText("completed")}
                </h2>
                <button
                  onClick={initGame}
                  className="bg-stone-600 text-white px-10 py-4 rounded-full font-black text-2xl hover:bg-stone-700 shadow-xl"
                >
                  {getText("reset")} üîÑ
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
