<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸‰å¸¸è­˜ï¼šç¦®è²Œå¥½å­©å­ | Cultural Manners</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: radial-gradient(circle at center, #fce7f3 0%, #db2777 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Cultural Manners",
          zh: "ç¦®è²Œå¥½å­©å­",
          ja: "ãƒãƒŠãƒ¼æ•™å®¤",
          ko: "ì˜ˆì ˆ êµì‹¤",
          es: "Modales Culturales",
          de: "Kulturelle Manieren",
          fi: "Kulttuuriset tavat",
          fr: "ManiÃ¨res culturelles",
          ar: "Ø§Ù„Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ©",
          it: "Buone Maniere",
        },
        instruction: {
          en: "What should you do?",
          zh: "ä½ æ‡‰è©²æ€æ¨£åšï¼Ÿ",
          ja: "ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ",
          ko: "ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?",
          es: "Â¿QuÃ© deberÃ­as hacer?",
          de: "Was solltest du tun?",
          fi: "MitÃ¤ sinun pitÃ¤isi tehdÃ¤?",
          fr: "Que devriez-vous faire ?",
          ar: "Ù…Ø§Ø°Ø§ ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ¹Ù„ØŸ",
          it: "Cosa dovresti fare?",
        },

        tea_scene: {
          en: "Giving tea to elders",
          zh: "å‘é•·è¼©æ•¬èŒ¶",
          ja: "å¹´é•·è€…ã«ãŠèŒ¶ã‚’å‡ºã™",
          ko: "ì–´ë¥¸ê»˜ ì°¨ ë“œë¦¬ê¸°",
          es: "Dar tÃ© a los mayores",
          de: "Tee an Ã„ltere servieren",
          fi: "Teen tarjoilu vanhuksille",
          fr: "Donner du thÃ© aux aÃ®nÃ©s",
          ar: "ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø´Ø§ÙŠ Ù„Ù„ÙƒØ¨Ø§Ø±",
          it: "Dare il tÃ¨ agli anziani",
        },
        tea_good: {
          en: "Use both hands",
          zh: "é›™æ‰‹å¥‰èŒ¶",
          ja: "ä¸¡æ‰‹ã‚’ä½¿ã†",
          ko: "ë‘ ì†ìœ¼ë¡œ ë“œë¦¬ê¸°",
          es: "Usar ambas manos",
          de: "Benutze beide HÃ¤nde",
          fi: "KÃ¤ytÃ¤ molempia kÃ¤siÃ¤",
          fr: "Utiliser les deux mains",
          ar: "Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙ„ØªØ§ Ø§Ù„ÙŠØ¯ÙŠÙ†",
          it: "Usa entrambe le mani",
        },
        tea_bad: {
          en: "Use one hand",
          zh: "å–®æ‰‹éèŒ¶",
          ja: "ç‰‡æ‰‹ã‚’ä½¿ã†",
          ko: "í•œ ì†ìœ¼ë¡œ ë“œë¦¬ê¸°",
          es: "Usar una mano",
          de: "Benutze eine Hand",
          fi: "KÃ¤ytÃ¤ yhtÃ¤ kÃ¤ttÃ¤",
          fr: "Utiliser une main",
          ar: "Ø§Ø³ØªØ®Ø¯Ù… ÙŠØ¯ ÙˆØ§Ø­Ø¯Ø©",
          it: "Usa una mano",
        },

        gift_scene: {
          en: "Receiving a gift",
          zh: "æ”¶åˆ°ç¦®ç‰©",
          ja: "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’å—ã‘å–ã‚‹",
          ko: "ì„ ë¬¼ ë°›ê¸°",
          es: "Recibir un regalo",
          de: "Ein Geschenk erhalten",
          fi: "Lahjan vastaanottaminen",
          fr: "Recevoir un cadeau",
          ar: "ØªÙ„Ù‚ÙŠ Ù‡Ø¯ÙŠØ©",
          it: "Ricevere un regalo",
        },
        gift_good: {
          en: "Say 'Thank you' with both hands",
          zh: "é›™æ‰‹æ¥éä¸¦èªªè¬è¬",
          ja: "ä¸¡æ‰‹ã§ã€Œã‚ã‚ŠãŒã¨ã†ã€ã¨è¨€ã†",
          ko: "ë‘ ì†ìœ¼ë¡œ ë°›ê³  ê°ì‚¬ ì¸ì‚¬í•˜ê¸°",
          es: "Decir 'Gracias' con ambas manos",
          de: "Mit beiden HÃ¤nden 'Danke' sagen",
          fi: "Sano 'Kiitos' molemmin kÃ¤sin",
          fr: "Dire 'Merci' avec les deux mains",
          ar: "Ù‚Ù„ 'Ø´ÙƒØ±Ù‹Ø§' Ø¨ÙƒÙ„ØªØ§ Ø§Ù„ÙŠØ¯ÙŠÙ†",
          it: "DÃ¬ 'Grazie' con entrambe le mani",
        },
        gift_bad: {
          en: "Snatch it quickly",
          zh: "ä¸€æ‰‹æ¶é",
          ja: "ç´ æ—©ãã²ã£ãŸãã‚‹",
          ko: "ë‚šì•„ì±„ê¸°",
          es: "Arrebatarlo rÃ¡pidamente",
          de: "Schnell wegschnappen",
          fi: "Nappaa se nopeasti",
          fr: "L'arracher rapidement",
          ar: "Ø§Ø®Ø·ÙÙ‡Ø§ Ø¨Ø³Ø±Ø¹Ø©",
          it: "Strappalo velocemente",
        },

        table_scene: {
          en: "Dining with family",
          zh: "èˆ‡å®¶äººåƒé£¯",
          ja: "å®¶æ—ã¨é£Ÿäº‹",
          ko: "ê°€ì¡±ê³¼ ì‹ì‚¬",
          es: "Cenando con la familia",
          de: "Essen mit der Familie",
          fi: "Ruokailu perheen kanssa",
          fr: "DÃ®ner en famille",
          ar: "ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø·Ø¹Ø§Ù… Ù…Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©",
          it: "Cenare con la famiglia",
        },
        table_good: {
          en: "Wait for elders to start",
          zh: "ç­‰é•·è¼©èµ·ç­·",
          ja: "å¹´é•·è€…ãŒé£Ÿã¹ã‚‹ã®ã‚’å¾…ã¤",
          ko: "ì–´ë¥¸ì´ ë“œì‹¤ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°",
          es: "Esperar a que los mayores empiecen",
          de: "Warte auf die Ã„lteren",
          fi: "Odota vanhempien aloittavan",
          fr: "Attendre que les aÃ®nÃ©s commencent",
          ar: "Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙƒØ¨Ø§Ø±",
          it: "Aspetta che gli anziani inizino",
        },
        table_bad: {
          en: "Eat immediately",
          zh: "è‡ªå·±å…ˆåƒ",
          ja: "ã™ãã«é£Ÿã¹ã‚‹",
          ko: "ë¨¼ì € ë¨¹ê¸°",
          es: "Comer inmediatamente",
          de: "Sofort essen",
          fi: "SyÃ¶ heti",
          fr: "Manger immÃ©diatement",
          ar: "ÙƒÙ„ ÙÙˆØ±Ø§",
          it: "Mangia subito",
        },

        bus_scene: {
          en: "On the bus",
          zh: "åœ¨å·´å£«ä¸Š",
          ja: "ãƒã‚¹ã®ä¸­ã§",
          ko: "ë²„ìŠ¤ì—ì„œ",
          es: "En el autobÃºs",
          de: "Im Bus",
          fi: "Bussissa",
          fr: "Dans le bus",
          ar: "ÙÙŠ Ø§Ù„Ø­Ø§ÙÙ„Ø©",
          it: "Sull'autobus",
        },
        bus_good: {
          en: "Give seat to elderly",
          zh: "è®“åº§çµ¦é•·è€…",
          ja: "å¹´é•·è€…ã«å¸­ã‚’è­²ã‚‹",
          ko: "ì–´ë¥´ì‹ ê»˜ ìë¦¬ ì–‘ë³´í•˜ê¸°",
          es: "Ceder el asiento a los mayores",
          de: "Platz fÃ¼r Ã„ltere freimachen",
          fi: "Anna istuin vanhukselle",
          fr: "CÃ©der sa place aux personnes Ã¢gÃ©es",
          ar: "ØªØ®Ù„ÙŠ Ø¹Ù† Ø§Ù„Ù…Ù‚Ø¹Ø¯ Ù„Ù„Ù…Ø³Ù†ÙŠÙ†",
          it: "Cedi il posto agli anziani",
        },
        bus_bad: {
          en: "Pretend to sleep",
          zh: "å‡è£ç¡è¦º",
          ja: "å¯ãŸãµã‚Šã‚’ã™ã‚‹",
          ko: "ìëŠ” ì²™í•˜ê¸°",
          es: "Fingir dormir",
          de: "Schlafen vortÃ¤uschen",
          fi: "Teeskentele nukkuvasi",
          fr: "Faire semblant de dormir",
          ar: "ØªØ¸Ø§Ù‡Ø± Ø¨Ø§Ù„Ù†ÙˆÙ…",
          it: "Fingi di dormire",
        },

        correct: {
          en: "Very Polite!",
          zh: "ä¹–å·§æœ‰ç¦®ï¼",
          ja: "ã¨ã¦ã‚‚ç¤¼å„€æ­£ã—ã„ï¼",
          ko: "ì˜ˆì˜ ë°”ë¥´ë„¤ìš”!",
          es: "Â¡Muy Educado!",
          de: "Sehr hÃ¶flich!",
          fi: "ErittÃ¤in kohtelias!",
          fr: "TrÃ¨s poli !",
          ar: "Ù…Ù‡Ø°Ø¨ Ø¬Ø¯Ø§!",
          it: "Molto Educato!",
        },
        wrong: {
          en: "Not polite!",
          zh: "é€™æ¨£ä¸å¤ªå¥½ï¼",
          ja: "å¤±ç¤¼ã§ã™ï¼",
          ko: "ì˜ˆì˜ê°€ ì•„ë‹ˆì—ìš”!",
          es: "Â¡No es educado!",
          de: "Nicht hÃ¶flich!",
          fi: "Ei kohteliasta!",
          fr: "Pas poli !",
          ar: "ØºÙŠØ± Ù…Ù‡Ø°Ø¨!",
          it: "Non educato!",
        },
        completed: {
          en: "Manners Expert!",
          zh: "ç¦®è²Œå¤§ä½¿ï¼",
          ja: "ãƒãƒŠãƒ¼ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆï¼",
          ko: "ì˜ˆì ˆ ì „ë¬¸ê°€!",
          es: "Â¡Experto en Modales!",
          de: "Manieren-Experte!",
          fi: "KÃ¤ytÃ¶sasiantuntija!",
          fr: "Expert en bonnes maniÃ¨res !",
          ar: "Ø®Ø¨ÙŠØ± Ø§Ù„Ø¢Ø¯Ø§Ø¨!",
          it: "Esperto di Buone Maniere!",
        },
        reset: {
          en: "Play Again",
          zh: "å†ç©ä¸€æ¬¡",
          ja: "ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤",
          ko: "ë‹¤ì‹œ í•˜ê¸°",
          es: "Jugar de Nuevo",
          de: "Nochmal spielen",
          fi: "Pelaa uudelleen",
          fr: "Rejouer",
          ar: "Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",
          it: "Gioca di Nuovo",
        },
      };

      const scenarios = [
        {
          id: "tea",
          scene: "tea_scene",
          icon: "ğŸµ",
          good: { id: "tea_good", icon: "ğŸ‘" },
          bad: { id: "tea_bad", icon: "âœ‹" },
        },
        {
          id: "gift",
          scene: "gift_scene",
          icon: "ğŸ",
          good: { id: "gift_good", icon: "ğŸ™‡" },
          bad: { id: "gift_bad", icon: "ğŸƒ" },
        },
        {
          id: "table",
          scene: "table_scene",
          icon: "ğŸš",
          good: { id: "table_good", icon: "ğŸ¥¢" },
          bad: { id: "table_bad", icon: "ğŸ˜‹" },
        },
        {
          id: "bus",
          scene: "bus_scene",
          icon: "ğŸšŒ",
          good: { id: "bus_good", icon: "ğŸ‘µ" },
          bad: { id: "bus_bad", icon: "ğŸ˜´" },
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [queue, setQueue] = useState([]);
        const [current, setCurrent] = useState(null);
        const [feedback, setFeedback] = useState(null);
        const [score, setScore] = useState(0);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          initGame();
        }, []);

        const initGame = () => {
          const q = [...scenarios].sort(() => Math.random() - 0.5);
          setQueue(q);
          setCurrent(q[0]);
          setScore(0);
          setFeedback(null);
        };

        const handleChoice = (isGood) => {
          if (feedback) return;

          if (isGood) {
            setFeedback("correct");
            setScore((s) => s + 10);
            setTimeout(() => {
              setFeedback(null);
              const nextIdx = queue.indexOf(current) + 1;
              if (nextIdx < queue.length) setCurrent(queue[nextIdx]);
              else setCurrent(null);
            }, 1200);
          } else {
            setFeedback("wrong");
            const nextIdx = queue.indexOf(current) + 1; // Actually, maybe force retry? Or just next.
            // Let's force retry or delay longer
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        // Randomize button positions
        const getOptions = () => {
          if (!current) return [];
          const opts = [
            { ...current.good, isGood: true },
            { ...current.bad, isGood: false },
          ];
          // Simple shuffle based on current ID char code sum to be deterministic per render but random-ish
          return current.id.charCodeAt(0) % 2 === 0 ? opts : opts.reverse();
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none font-sans overflow-hidden">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-rose-900 mb-2 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              ğŸ™‡ {getText("title")}
            </h1>

            <div className="font-bold text-rose-800 mb-6 bg-white/40 px-4 py-1 rounded-full text-xl">
              {score} Points
            </div>

            {current ? (
              <div className="w-full max-w-4xl flex flex-col items-center flex-1 justify-center relative">
                {/* Scene Card */}
                <div className="bg-white p-8 rounded-[3rem] shadow-2xl border-8 border-rose-300 w-full max-w-2xl mb-8 flex flex-col items-center">
                  <div className="text-8xl mb-6">{current.icon}</div>
                  <div className="text-2xl md:text-3xl font-black text-rose-800 text-center mb-2">
                    {getText(current.scene)}
                  </div>
                  <div className="text-lg font-bold text-slate-500">
                    {getText("instruction")}
                  </div>
                </div>

                {/* Choices */}
                <div className="flex flex-col md:flex-row gap-6 w-full max-w-4xl">
                  {getOptions().map((opt, i) => (
                    <button
                      key={i}
                      onClick={() => handleChoice(opt.isGood)}
                      disabled={!!feedback}
                      className="flex-1 bg-rose-100 hover:bg-rose-200 border-b-8 border-rose-300 rounded-3xl p-8 flex flex-col items-center shadow-lg active:scale-95 transition-all group"
                    >
                      <div className="text-6xl mb-4 group-hover:scale-110 transition-transform">
                        {opt.icon}
                      </div>
                      <div className="font-black text-xl md:text-2xl text-rose-900">
                        {getText(opt.id)}
                      </div>
                    </button>
                  ))}
                </div>

                {feedback && (
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 p-12 rounded-[3rem] font-black text-4xl shadow-2xl whitespace-nowrap flex flex-col items-center ${
                      feedback === "correct"
                        ? "bg-green-500 text-white"
                        : "bg-red-500 text-white"
                    }`}
                  >
                    <div className="text-8xl mb-4">
                      {feedback === "correct" ? "ğŸŒŸ" : "ğŸ˜…"}
                    </div>
                    {getText(feedback)}
                  </motion.div>
                )}
              </div>
            ) : (
              <div className="bg-white/90 p-12 rounded-3xl shadow-xl text-center mt-20">
                <div className="text-8xl mb-4">ğŸ’®</div>
                <h2 className="text-4xl font-black text-rose-800 mb-6">
                  {getText("completed")}
                </h2>
                <button
                  onClick={initGame}
                  className="bg-rose-600 text-white px-10 py-4 rounded-full font-black text-2xl hover:bg-rose-700 shadow-xl"
                >
                  {getText("reset")} ğŸ”„
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
