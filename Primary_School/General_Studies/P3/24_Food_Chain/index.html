<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÂ∏∏Ë≠òÔºöÈ£üÁâ©Èèà | Food Chain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Food Chain",
          zh: "È£üÁâ©Èèà",
          ja: "È£üÁâ©ÈÄ£Èéñ",
          ko: "Î®πÏù¥ ÏÇ¨Ïä¨",
          es: "Cadena Alimentaria",
          de: "Nahrungskette",
          fi: "Ravintoketju",
          fr: "Cha√Æne alimentaire",
          ar: "ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ© ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©",
          it: "Catena Alimentare",
        },
        instruction: {
          en: "Who eats whom? Build the chain!",
          zh: "Ë™∞ÂêÉË™∞ÔºüÊéíÂàóÈ£üÁâ©ÈèàÔºÅ",
          ja: "Ë™∞„ÅåË™∞„ÇíÈ£ü„Åπ„ÇãÔºüÈéñ„Çí‰Ωú„Çç„ÅÜÔºÅ",
          ko: "ÎàÑÍ∞Ä ÎàÑÍµ¨Î•º Î®πÎÇòÏöî? ÏÇ¨Ïä¨ÏùÑ ÎßåÎìúÏÑ∏Ïöî!",
          es: "¬øQui√©n come a qui√©n? ¬°Construye la cadena!",
          de: "Wer frisst wen? Baue die Kette!",
          fi: "Kuka sy√∂ kenet? Rakenna ketju!",
          fr: "Qui mange qui ? Construisez la cha√Æne !",
          ar: "ŸÖŸÜ Ÿäÿ£ŸÉŸÑ ŸÖŸÜÿü ÿßÿ®ŸÜŸä ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ©!",
          it: "Chi mangia chi? Costruisci la catena!",
        },

        sun: {
          en: "Sun",
          zh: "Â§™ÈôΩ",
          ja: "Â§™ÈôΩ",
          ko: "ÌÉúÏñë",
          es: "Sol",
          de: "Sonne",
          fi: "Aurinko",
          fr: "Soleil",
          ar: "ÿ¥ŸÖÿ≥",
          it: "Sole",
        },
        grass: {
          en: "Grass",
          zh: "Ëçâ",
          ja: "Ëçâ",
          ko: "ÌíÄ",
          es: "Hierba",
          de: "Gras",
          fi: "Ruoho",
          fr: "Herbe",
          ar: "ÿπÿ¥ÿ®",
          it: "Erba",
        },
        rabbit: {
          en: "Rabbit",
          zh: "ÂÖîÂ≠ê",
          ja: "„Ç¶„Çµ„ÇÆ",
          ko: "ÌÜ†ÎÅº",
          es: "Conejo",
          de: "Kaninchen",
          fi: "Kani",
          fr: "Lapin",
          ar: "ÿ£ÿ±ŸÜÿ®",
          it: "Coniglio",
        },
        snake: {
          en: "Snake",
          zh: "Ëõá",
          ja: "Ëõá",
          ko: "Î±Ä",
          es: "Serpiente",
          de: "Schlange",
          fi: "K√§√§rme",
          fr: "Serpent",
          ar: "ÿ´ÿπÿ®ÿßŸÜ",
          it: "Serpente",
        },
        eagle: {
          en: "Eagle",
          zh: "ËÄÅÈ∑π",
          ja: "È∑≤",
          ko: "ÎèÖÏàòÎ¶¨",
          es: "√Åguila",
          de: "Adler",
          fi: "Kotka",
          fr: "Aigle",
          ar: "ŸÜÿ≥ÿ±",
          it: "Aquila",
        },

        caterpillar: {
          en: "Caterpillar",
          zh: "ÊØõËü≤",
          ja: "ËäãËô´",
          ko: "Ïï†Î≤åÎ†à",
          es: "Oruga",
          de: "Raupe",
          fi: "Toukka",
          fr: "Chenille",
          ar: "Ÿäÿ±ŸÇÿ©",
          it: "Bruco",
        },
        bird: {
          en: "Bird",
          zh: "Â∞èÈ≥•",
          ja: "È≥•",
          ko: "ÏÉà",
          es: "P√°jaro",
          de: "Vogel",
          fi: "Lintu",
          fr: "Oiseau",
          ar: "ÿ∑ÿßÿ¶ÿ±",
          it: "Uccello",
        },

        corn: {
          en: "Corn",
          zh: "Á≤üÁ±≥",
          ja: "„Éà„Ç¶„É¢„É≠„Ç≥„Ç∑",
          ko: "Ïò•ÏàòÏàò",
          es: "Ma√≠z",
          de: "Mais",
          fi: "Maissi",
          fr: "Ma√Øs",
          ar: "ÿ∞ÿ±ÿ©",
          it: "Mais",
        },
        rat: {
          en: "Rat",
          zh: "ËÄÅÈº†",
          ja: "„Éç„Ç∫„Éü",
          ko: "Ï•ê",
          es: "Rata",
          de: "Ratte",
          fi: "Rotta",
          fr: "Rat",
          ar: "ÿ¨ÿ±ÿ∞",
          it: "Ratto",
        },
        owl: {
          en: "Owl",
          zh: "Ë≤ìÈ†≠È∑π",
          ja: "„Éï„ÇØ„É≠„Ç¶",
          ko: "Î∂ÄÏóâÏù¥",
          es: "B√∫ho",
          de: "Eule",
          fi: "P√∂ll√∂",
          fr: "Hibou",
          ar: "ÿ®ŸàŸÖÿ©",
          it: "Gufo",
        },

        check: {
          en: "Check",
          zh: "Ê™¢Êü•",
          ja: "Á¢∫Ë™ç",
          ko: "ÌôïÏù∏",
          es: "Comprobar",
          de: "Pr√ºfen",
          fi: "Tarkista",
          fr: "V√©rifier",
          ar: "ÿ™ÿ≠ŸÇŸÇ",
          it: "Controlla",
        },
        correct: {
          en: "Correct Chain!",
          zh: "È£üÁâ©ÈèàÊ≠£Á¢∫ÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµÏûÖÎãàÎã§!",
          es: "¬°Cadena Correcta!",
          de: "Richtige Kette!",
          fi: "Oikea ketju!",
          fr: "Cha√Æne correcte !",
          ar: "ÿ≥ŸÑÿ≥ŸÑÿ© ÿµÿ≠Ÿäÿ≠ÿ©!",
          it: "Catena Corretta!",
        },
        wrong: {
          en: "Chain Broken!",
          zh: "È£üÁâ©ÈèàÈåØË™§ÔºÅ",
          ja: "Èéñ„ÅåÂàá„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ",
          ko: "ÏÇ¨Ïä¨Ïù¥ ÎÅäÏñ¥Ï°åÏñ¥Ïöî!",
          es: "¬°Cadena Rota!",
          de: "Kette unterbrochen!",
          fi: "Ketju rikki!",
          fr: "Cha√Æne bris√©e !",
          ar: "ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ© ŸÖŸÉÿ≥Ÿàÿ±ÿ©!",
          it: "Catena Espzzata!",
        },
        reset: {
          en: "Next Chain",
          zh: "‰∏ã‰∏ÄÂÄã",
          ja: "Ê¨°„ÅÆÈéñ",
          ko: "Îã§Ïùå ÏÇ¨Ïä¨",
          es: "Siguiente Cadena",
          de: "N√§chste Kette",
          fi: "Seuraava ketju",
          fr: "Cha√Æne suivante",
          ar: "ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©",
          it: "Prossima Catena",
        },
        level: {
          en: "Level",
          zh: "ÈóúÂç°",
          ja: "„É¨„Éô„É´",
          ko: "Î†àÎ≤®",
          es: "Nivel",
          de: "Level",
          fi: "Taso",
          fr: "Niveau",
          ar: "ŸÖÿ≥ÿ™ŸàŸâ",
          it: "Livello",
        },
      };

      const chains = [
        // Level 1: Simple 3
        {
          items: ["sun", "grass", "rabbit", "eagle"],
          order: ["sun", "grass", "rabbit", "eagle"],
        },
        // Level 2:
        {
          items: ["sun", "grass", "caterpillar", "bird", "eagle"],
          order: ["sun", "grass", "caterpillar", "bird", "eagle"],
        },
        // Level 3:
        {
          items: ["sun", "corn", "rat", "snake", "eagle"],
          order: ["sun", "corn", "rat", "snake", "eagle"],
        },
      ];

      const visuals = {
        sun: "‚òÄÔ∏è",
        grass: "üå±",
        rabbit: "üêá",
        snake: "üêç",
        eagle: "ü¶Ö",
        caterpillar: "üêõ",
        bird: "üê¶",
        corn: "üåΩ",
        rat: "üêÄ",
        owl: "ü¶â",
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [level, setLevel] = useState(0);
        const [pool, setPool] = useState([]);
        const [line, setLine] = useState([]);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          loadLevel(0);
        }, []);

        const loadLevel = (lvl) => {
          if (lvl >= chains.length) {
            setLevel(0); // Loop or end
            loadLevel(0);
            return;
          }
          setLevel(lvl);
          setFeedback(null);
          setLine([]);
          // Shuffle pool
          const newPool = [...chains[lvl].items].sort(
            () => Math.random() - 0.5
          );
          setPool(newPool);
        };

        const moveToLine = (item) => {
          if (feedback === "correct") return;
          setLine((prev) => [...prev, item]);
          setPool((prev) => prev.filter((i) => i !== item));
          setFeedback(null);
        };

        const moveToPool = (item) => {
          if (feedback === "correct") return;
          setPool((prev) => [...prev, item]);
          setLine((prev) => prev.filter((i) => i !== item));
          setFeedback(null);
        };

        const check = () => {
          const currentChain = chains[level];
          if (line.length !== currentChain.order.length) {
            setFeedback("wrong");
            return;
          }

          // Check exact match
          const isCorrect = line.every(
            (item, i) => item === currentChain.order[i]
          );
          if (isCorrect) {
            setFeedback("correct");
          } else {
            setFeedback("wrong");
          }
        };

        const nextLevel = () => {
          loadLevel(level + 1);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none font-sans overflow-hidden">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-amber-700 mb-2 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              üîó {getText("title")}
            </h1>
            <div className="font-bold text-amber-800 mb-6 bg-white/40 px-4 py-1 rounded-full">
              {getText("level")}: {level + 1}
            </div>

            <p className="font-bold text-amber-900 mb-4 text-xl">
              {getText("instruction")}
            </p>

            {/* Chain Area */}
            <div className="w-full max-w-5xl min-h-[160px] bg-white/80 rounded-3xl p-6 border-4 border-amber-300 flex flex-wrap items-center justify-center gap-2 mb-8 shadow-inner">
              {line.length === 0 && (
                <div className="text-amber-800/30 text-2xl font-black animate-pulse">
                  Drag items here
                </div>
              )}

              <AnimatePresence>
                {line.map((item, i) => (
                  <div key={`${item}-${i}`} className="flex items-center">
                    {i > 0 && (
                      <div className="text-3xl text-amber-600 mx-1 font-black">
                        ‚û°
                      </div>
                    )}
                    <motion.button
                      layoutId={item}
                      onClick={() => moveToPool(item)}
                      className="bg-white p-4 rounded-xl shadow-lg border-2 border-amber-500 hover:bg-red-50 hover:border-red-400 transition-colors"
                    >
                      <div className="text-4xl md:text-5xl">
                        {visuals[item]}
                      </div>
                      <div className="text-xs font-bold mt-1 text-slate-700">
                        {getText(item)}
                      </div>
                    </motion.button>
                  </div>
                ))}
              </AnimatePresence>
            </div>

            {/* Controls */}
            <div className="h-16 mb-6">
              {feedback ? (
                <div className="flex gap-4 items-center">
                  <div
                    className={`px-8 py-2 rounded-2xl font-black text-2xl shadow-xl ${
                      feedback === "correct"
                        ? "bg-green-500 text-white"
                        : "bg-red-500 text-white"
                    }`}
                  >
                    {getText(feedback)}
                  </div>
                  {feedback === "correct" && (
                    <button
                      onClick={nextLevel}
                      className="bg-blue-600 text-white px-8 py-2 rounded-2xl font-black text-2xl shadow-xl hover:bg-blue-700 animate-bounce"
                    >
                      {getText("reset")} ‚û°
                    </button>
                  )}
                </div>
              ) : (
                line.length === chains[level].items.length && (
                  <button
                    onClick={check}
                    className="bg-green-600 text-white px-10 py-3 rounded-full font-black text-2xl shadow-xl hover:bg-green-700"
                  >
                    {getText("check")}
                  </button>
                )
              )}
            </div>

            {/* Pool Area */}
            <div className="w-full max-w-4xl p-6 bg-amber-200/50 rounded-3xl flex flex-wrap justify-center gap-4 border-t-4 border-amber-300">
              <AnimatePresence>
                {pool.map((item) => (
                  <motion.button
                    key={item}
                    layoutId={item}
                    onClick={() => moveToLine(item)}
                    className="bg-white p-4 rounded-xl shadow border-2 border-white hover:border-amber-500 transition-all active:scale-95"
                  >
                    <div className="text-4xl md:text-5xl">{visuals[item]}</div>
                    <div className="text-xs font-bold mt-1 text-slate-700">
                      {getText(item)}
                    </div>
                  </motion.button>
                ))}
              </AnimatePresence>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
