<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÂ∏∏Ë≠òÔºöÊ∞¥Âæ™Áí∞ | Water Cycle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(180deg, #bae6fd 0%, #3b82f6 100%);
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "The Water Cycle",
          zh: "Ê∞¥Âæ™Áí∞",
          ja: "Ê∞¥„ÅÆÂæ™Áí∞",
          ko: "Î¨ºÏùò ÏàúÌôò",
          es: "El Ciclo del Agua",
          de: "Der Wasserkreislauf",
          fi: "Veden kiertokulku",
          fr: "Le cycle de l'eau",
          ar: "ÿØŸàÿ±ÿ© ÿßŸÑŸÖŸäÿßŸá",
          it: "Il Ciclo dell'Acqua",
        },
        instruction: {
          en: "Drag the labels to the right spot!",
          zh: "Â∞áÊ®ôÁ±§ÊãñÊîæÂà∞Ê≠£Á¢∫‰ΩçÁΩÆÔºÅ",
          ja: "„É©„Éô„É´„ÇíÊ≠£„Åó„ÅÑÂ†¥ÊâÄ„Å´„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÎùºÎ≤®ÏùÑ Ïò¨Î∞îÎ•∏ ÏúÑÏπòÎ°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî!",
          es: "¬°Arrastra las etiquetas al lugar correcto!",
          de: "Ziehe die Etiketten an die richtige Stelle!",
          fi: "Ved√§ etiketit oikeaan paikkaan!",
          fr: "Faites glisser les √©tiquettes au bon endroit !",
          ar: "ÿßÿ≥ÿ≠ÿ® ÿßŸÑŸÖŸÑÿµŸÇÿßÿ™ ÿ•ŸÑŸâ ÿßŸÑŸÖŸÉÿßŸÜ ÿßŸÑÿµÿ≠Ÿäÿ≠!",
          it: "Trascina le etichette nel posto giusto!",
        },

        sun: {
          en: "Sun",
          zh: "Â§™ÈôΩ",
          ja: "Â§™ÈôΩ",
          ko: "ÌÉúÏñë",
          es: "Sol",
          de: "Sonne",
          fi: "Aurinko",
          fr: "Soleil",
          ar: "ÿ¥ŸÖÿ≥",
          it: "Sole",
        },
        evaporation: {
          en: "Evaporation",
          zh: "Ëí∏Áôº",
          ja: "Ëí∏Áô∫",
          ko: "Ï¶ùÎ∞ú",
          es: "Evaporaci√≥n",
          de: "Verdunstung",
          fi: "Haihtuminen",
          fr: "√âvaporation",
          ar: "ÿ™ÿ®ÿÆÿ±",
          it: "Evaporazione",
        },
        condensation: {
          en: "Condensation",
          zh: "ÂáùÁµê",
          ja: "ÂáùÁ∏Æ",
          ko: "ÏùëÍ≤∞",
          es: "Condensaci√≥n",
          de: "Kondensation",
          fi: "Tiivistyminen",
          fr: "Condensation",
          ar: "ÿ™ŸÉÿ´ŸäŸÅ",
          it: "Condensazione",
        },
        cloud: {
          en: "Cloud",
          zh: "Èõ≤",
          ja: "Èõ≤",
          ko: "Íµ¨Î¶Ñ",
          es: "Nube",
          de: "Wolke",
          fi: "Pilvi",
          fr: "Nuage",
          ar: "ÿ≥ÿ≠ÿßÿ®ÿ©",
          it: "Nuvola",
        },
        rain: {
          en: "Precipitation",
          zh: "ÈôçÈõ®",
          ja: "ÈôçÊ∞¥",
          ko: "Í∞ïÏàò",
          es: "Precipitaci√≥n",
          de: "Niederschlag",
          fi: "Sade",
          fr: "Pr√©cipitations",
          ar: "Ÿáÿ∑ŸàŸÑ",
          it: "Precipitazione",
        },
        river: {
          en: "Collection",
          zh: "Ê≤≥ÊµÅ/Êµ∑Ê¥ã",
          ja: "ÈõÜÊ∞¥",
          ko: "ÏàòÏßë",
          es: "Recolecci√≥n",
          de: "Sammlung",
          fi: "Ker√§√§ntyminen",
          fr: "Collection",
          ar: "ÿ™ÿ¨ŸÖŸäÿπ",
          it: "Raccolta",
        },

        desc_sun: {
          en: "Heats the water",
          zh: "Âä†ÁÜ±Êµ∑Ê∞¥",
          ja: "Ê∞¥„ÇíÊ∏©„ÇÅ„Çã",
          ko: "Î¨ºÏùÑ Îç∞ÏõÄ",
          es: "Calienta el agua",
          de: "Erw√§rmt das Wasser",
          fi: "L√§mmitt√§√§ veden",
          fr: "Chauffe l'eau",
          ar: "Ÿäÿ≥ÿÆŸÜ ÿßŸÑŸÖÿßÿ°",
          it: "Riscalda l'acqua",
        },
        desc_evap: {
          en: "Water turns to vapor",
          zh: "Ê∞¥ËÆäÊàêÊ∞¥Ëí∏Ê∞£",
          ja: "Ê∞¥„ÅåËí∏Ê∞ó„Å´„Å™„Çã",
          ko: "Î¨ºÏù¥ Ï¶ùÍ∏∞Î°ú Î≥ÄÌï®",
          es: "El agua se convierte en vapor",
          de: "Wasser wird zu Dampf",
          fi: "Vesi muuttuu h√∂yryksi",
          fr: "L'eau se transforme en vapeur",
          ar: "Ÿäÿ™ÿ≠ŸàŸÑ ÿßŸÑŸÖÿßÿ° ÿ•ŸÑŸâ ÿ®ÿÆÿßÿ±",
          it: "L'acqua si trasforma in vapore",
        },
        desc_cond: {
          en: "Vapor turns to drops",
          zh: "Ê∞¥Ëí∏Ê∞£ËÆäÊàêÊ∞¥Èªû",
          ja: "Ëí∏Ê∞ó„ÅåÊ∞¥Êª¥„Å´„Å™„Çã",
          ko: "Ï¶ùÍ∏∞Í∞Ä Î¨ºÎ∞©Ïö∏Î°ú Î≥ÄÌï®",
          es: "Vapor se convierte en gotas",
          de: "Dampf wird zu Tropfen",
          fi: "H√∂yry muuttuu pisaroiksi",
          fr: "La vapeur se transforme en gouttes",
          ar: "Ÿäÿ™ÿ≠ŸàŸÑ ÿßŸÑÿ®ÿÆÿßÿ± ÿ•ŸÑŸâ ŸÇÿ∑ÿ±ÿßÿ™",
          it: "Il vapore si trasforma in gocce",
        },
        desc_cloud: {
          en: "Tiny drops gather",
          zh: "Â∞èÊ∞¥ÈªûËÅöÈõÜ",
          ja: "Â∞è„Åï„Å™Ê∞¥Êª¥„ÅåÈõÜ„Åæ„Çã",
          ko: "ÏûëÏùÄ Î¨ºÎ∞©Ïö∏Ïù¥ Î™®ÏûÑ",
          es: "Peque√±as gotas se juntan",
          de: "Winzige Tropfen sammeln sich",
          fi: "Pienet pisarat ker√§√§ntyv√§t",
          fr: "De minuscules gouttes se rassemblent",
          ar: "ÿ™ÿ™ÿ¨ŸÖÿπ ÿßŸÑŸÇÿ∑ÿ±ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ©",
          it: "Piccole gocce si radunano",
        },
        desc_rain: {
          en: "Water falls down",
          zh: "Èõ®Ê∞¥ËêΩ‰∏ã",
          ja: "Ê∞¥„ÅåËêΩ„Å°„Çã",
          ko: "Î¨ºÏù¥ Îñ®Ïñ¥Ïßê",
          es: "El agua cae",
          de: "Wasser f√§llt herunter",
          fi: "Vesi sataa alas",
          fr: "L'eau tombe",
          ar: "Ÿäÿ≥ŸÇÿ∑ ÿßŸÑŸÖÿßÿ°",
          it: "L'acqua cade gi√π",
        },
        desc_river: {
          en: "Water flows back",
          zh: "Èõ®Ê∞¥ÂåØËÅö",
          ja: "Ê∞¥„ÅåÊàª„Çã",
          ko: "Î¨ºÏù¥ Îã§Ïãú ÌùêÎ¶Ñ",
          es: "El agua fluye de vuelta",
          de: "Wasser flie√üt zur√ºck",
          fi: "Vesi virtaa takaisin",
          fr: "L'eau reflue",
          ar: "ÿßŸÑŸÖÿßÿ° Ÿäÿ™ÿØŸÅŸÇ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "L'acqua scorre indietro",
        },

        completed: {
          en: "Cycle Complete!",
          zh: "Âæ™Áí∞ÂÆåÊàêÔºÅ",
          ja: "„Çµ„Ç§„ÇØ„É´ÂÆå‰∫ÜÔºÅ",
          ko: "ÏàúÌôò ÏôÑÎ£å!",
          es: "¬°Ciclo Completo!",
          de: "Kreislauf abgeschlossen!",
          fi: "Kierto valmis!",
          fr: "Cycle termin√© !",
          ar: "ÿßŸÉÿ™ŸÖŸÑÿ™ ÿßŸÑÿØŸàÿ±ÿ©!",
          it: "Ciclo Completo!",
        },
        reset: {
          en: "Reset",
          zh: "ÈáçÁΩÆ",
          ja: "„É™„Çª„ÉÉ„Éà",
          ko: "Ï¥àÍ∏∞Ìôî",
          es: "Reiniciar",
          de: "Zur√ºcksetzen",
          fi: "Nollaa",
          fr: "R√©initialiser",
          ar: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ",
          it: "Reimposta",
        },
      };

      const stages = [
        { id: "sun", x: 15, y: 15, w: 15, h: 15, icon: "‚òÄÔ∏è" },
        { id: "evaporation", x: 30, y: 60, w: 20, h: 20, icon: "‚ô®Ô∏è" }, // Rising arrows
        { id: "condensation", x: 40, y: 30, w: 15, h: 15, icon: "üå´Ô∏è" },
        { id: "cloud", x: 60, y: 20, w: 20, h: 15, icon: "‚òÅÔ∏è" },
        { id: "rain", x: 75, y: 45, w: 15, h: 25, icon: "üåßÔ∏è" },
        { id: "river", x: 60, y: 80, w: 25, h: 15, icon: "üåä" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [placed, setPlaced] = useState({});
        const [dragging, setDragging] = useState(null);
        const [completed, setCompleted] = useState(false);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          if (Object.keys(placed).length === stages.length) {
            setCompleted(true);
          }
        }, [placed]);

        const handleDrop = (stageId) => {
          if (dragging && dragging.id === stageId) {
            setPlaced((prev) => ({ ...prev, [stageId]: true }));
            setDragging(null);
          }
        };

        const reset = () => {
          setPlaced({});
          setCompleted(false);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none font-sans cursor-default">
            <LanguageSelector lang={lang} setLang={setLang} />

            <h1 className="text-4xl md:text-5xl font-black text-white mb-2 mt-8 drop-shadow-md z-10">
              üíß {getText("title")}
            </h1>
            <p className="font-bold text-white/90 mb-4 z-10 bg-black/20 px-4 py-1 rounded-full">
              {getText("instruction")}
            </p>

            <div className="flex flex-col md:flex-row gap-8 w-full max-w-6xl items-center md:items-start flex-1">
              {/* Scene (Drop Zones) */}
              <div className="relative w-full aspect-[16/9] bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-white/50">
                {/* Background Art - Using simplistic shapes/CSS gradients for diagram feel */}

                {/* Sky */}
                <div className="absolute inset-0 bg-sky-200"></div>

                {/* Ocean */}
                <div className="absolute bottom-0 w-full h-[30%] bg-blue-500">
                  <div className="animate-wave w-[200%] h-full bg-[url('data:image/svg+xml;utf8,<svg width=\'100\' height=\'20\' viewBox=\'0 0 100 20\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'M0 10 Q25 0 50 10 T100 10\' fill=\'none\' stroke=\'white\' stroke-width=\'2\'/></svg>')] opacity-30"></div>
                </div>

                {/* Mountain */}
                <div className="absolute bottom-[20%] right-0 w-[40%] h-[50%] bg-emerald-600 rounded-tl-full"></div>

                {/* Sun */}
                <div className="absolute top-[5%] left-[5%] text-[8rem] opacity-50">
                  ‚òÄÔ∏è
                </div>

                {/* Drop Zones */}
                {stages.map((s) => (
                  <div
                    key={s.id}
                    className={`absolute border-4 border-dashed rounded-xl transition-all flex items-center justify-center z-20 
                                 ${
                                   placed[s.id]
                                     ? "border-transparent bg-white/80"
                                     : "border-white/50 bg-black/10 hover:bg-white/20"
                                 }
                             `}
                    style={{
                      left: `${s.x}%`,
                      top: `${s.y}%`,
                      width: `${s.w}%`,
                      height: `${s.h}%`,
                    }}
                    onDragOver={(e) => e.preventDefault()}
                    onDrop={() => handleDrop(s.id)}
                  >
                    {placed[s.id] ? (
                      <motion.div
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        className="text-center"
                      >
                        <div className="text-3xl lg:text-5xl">{s.icon}</div>
                        <div className="font-bold text-slate-800 text-xs md:text-sm lg:text-base leading-tight mt-1">
                          {getText(s.id)}
                        </div>
                      </motion.div>
                    ) : (
                      <div className="text-white/50 text-2xl animate-pulse">
                        ?
                      </div>
                    )}
                  </div>
                ))}

                {/* Arrows (Animated CSS or just visible when placed) */}
                {Object.keys(placed).length > 2 && (
                  <svg
                    className="absolute inset-0 pointer-events-none opacity-50"
                    viewBox="0 0 100 100"
                  >
                    {/* Evap */}
                    <path
                      d="M25 80 Q25 50 35 40"
                      stroke="white"
                      strokeWidth="1"
                      fill="none"
                      strokeDasharray="5,5"
                      className="animate-dash"
                    />
                    {/* Cond */}
                    <path
                      d="M45 35 Q55 25 65 25"
                      stroke="white"
                      strokeWidth="1"
                      fill="none"
                      strokeDasharray="5,5"
                    />
                    {/* Rain */}
                    <path
                      d="M75 35 Q80 50 82 70"
                      stroke="blue"
                      strokeWidth="1"
                      fill="none"
                      strokeDasharray="5,5"
                    />
                    {/* River */}
                    <path
                      d="M80 85 Q60 90 40 85"
                      stroke="blue"
                      strokeWidth="1"
                      fill="none"
                      strokeDasharray="5,5"
                    />
                  </svg>
                )}
              </div>

              {/* Labels (Draggable) */}
              <div className="bg-white/20 backdrop-blur-md rounded-3xl p-6 w-full md:w-64 flex flex-col gap-4 border-2 border-white/30 z-20">
                <h3 className="text-white font-bold text-center border-b border-white/30 pb-2">
                  Labels
                </h3>

                {stages.map(
                  (s) =>
                    !placed[s.id] && (
                      <div
                        key={s.id}
                        draggable
                        onDragStart={() => setDragging(s)}
                        className="bg-white rounded-xl p-3 shadow-lg cursor-grab active:cursor-grabbing hover:scale-105 transition-transform flex items-center gap-3"
                      >
                        <span className="text-3xl">{s.icon}</span>
                        <div>
                          <div className="font-bold text-slate-800 leading-tight">
                            {getText(s.id)}
                          </div>
                          <div className="text-[10px] text-slate-500 font-bold">
                            {getText(
                              `desc_${
                                s.id === "sun"
                                  ? "sun"
                                  : s.id === "evaporation"
                                  ? "evap"
                                  : s.id === "condensation"
                                  ? "cond"
                                  : s.id === "rain"
                                  ? "rain"
                                  : s.id === "river"
                                  ? "river"
                                  : "cloud"
                              }`
                            )}
                          </div>
                        </div>
                      </div>
                    )
                )}

                {completed && (
                  <div className="text-center animate-fade-in">
                    <div className="text-5xl mb-2">üéâ</div>
                    <div className="font-black text-white text-xl mb-4">
                      {getText("completed")}
                    </div>
                    <button
                      onClick={reset}
                      className="bg-white text-blue-600 px-6 py-2 rounded-full font-bold shadow-lg hover:bg-blue-50"
                    >
                      {getText("reset")}
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
