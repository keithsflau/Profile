<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÂ∏∏Ë≠òÔºöÈößÈÅìÊî∂Ë≤ªÂì° | Tunnel Toll</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Tunnel Toll",
          zh: "ÈößÈÅìÊî∂Ë≤ªÂì°",
          ja: "„Éà„É≥„Éç„É´ÊñôÈáë",
          ko: "ÌÑ∞ÎÑê ÌÜµÌñâÎ£å",
          es: "Peaje del T√∫nel",
          de: "Tunnelmaut",
          fi: "Tunnelimaksu",
          fr: "P√©age du tunnel",
          ar: "ÿ±ÿ≥ŸàŸÖ ÿßŸÑŸÜŸÅŸÇ",
          it: "Pedaggio del Tunnel",
        },
        instruction: {
          en: "Calculate the total toll!",
          zh: "Ë®àÁÆóÁ∏ΩÊî∂Ë≤ªÔºÅ",
          ja: "ÂêàË®àÊñôÈáë„ÇíË®àÁÆó„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "Ï¥ù ÌÜµÌñâÎ£åÎ•º Í≥ÑÏÇ∞ÌïòÏÑ∏Ïöî!",
          es: "¬°Calcula el peaje total!",
          de: "Berechne die Gesamtmaut!",
          fi: "Laske kokonaismaksu!",
          fr: "Calculez le p√©age total !",
          ar: "ÿßÿ≠ÿ≥ÿ® ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ±ÿ≥ŸàŸÖ!",
          it: "Calcola il pedaggio totale!",
        },

        car: {
          en: "Car ($5)",
          zh: "ÁßÅÂÆ∂Ëªä ($5)",
          ja: "Ëªä ($5)",
          ko: "ÏûêÎèôÏ∞® ($5)",
          es: "Coche ($5)",
          de: "Auto ($5)",
          fi: "Auto ($5)",
          fr: "Voiture ($5)",
          ar: "ÿ≥Ÿäÿßÿ±ÿ© ($5)",
          it: "Auto ($5)",
        },
        van: {
          en: "Van ($10)",
          zh: "ËºïÂûãË≤®Ëªä ($10)",
          ja: "„Éê„É≥ ($10)",
          ko: "Î∞¥ ($10)",
          es: "Furgoneta ($10)",
          de: "Transporter ($10)",
          fi: "Pakettiauto ($10)",
          fr: "Camionnette ($10)",
          ar: "ŸÅÿßŸÜ ($10)",
          it: "Furgone ($10)",
        },
        bus: {
          en: "Bus ($20)",
          zh: "Â∑¥Â£´ ($20)",
          ja: "„Éê„Çπ ($20)",
          ko: "Î≤ÑÏä§ ($20)",
          es: "Autob√∫s ($20)",
          de: "Bus ($20)",
          fi: "Bussi ($20)",
          fr: "Bus ($20)",
          ar: "ÿ≠ÿßŸÅŸÑÿ© ($20)",
          it: "Autobus ($20)",
        },

        total: {
          en: "Total:",
          zh: "Á∏ΩË®à:",
          ja: "ÂêàË®à:",
          ko: "Ìï©Í≥Ñ:",
          es: "Total:",
          de: "Gesamt:",
          fi: "Yhteens√§:",
          fr: "Total :",
          ar: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπ:",
          it: "Totale:",
        },
        submit: {
          en: "Collect",
          zh: "Êî∂Ë≤ª",
          ja: "Âæ¥Âèé",
          ko: "ÏßïÏàò",
          es: "Cobrar",
          de: "Kassieren",
          fi: "Ker√§√§",
          fr: "Collecter",
          ar: "ÿ¨ŸÖÿπ",
          it: "Riscuoti",
        },

        correct: {
          en: "Fees Collected!",
          zh: "Êî∂Ë≤ªÊ≠£Á¢∫ÔºÅ",
          ja: "ÊñôÈáëÂæ¥ÂèéÂÆå‰∫ÜÔºÅ",
          ko: "ÏöîÍ∏à ÏßïÏàò ÏôÑÎ£å!",
          es: "¬°Tasas Cobradas!",
          de: "Geb√ºhren kassiert!",
          fi: "Maksut ker√§tty!",
          fr: "Frais collect√©s !",
          ar: "ÿ™ŸÖ ÿ™ÿ≠ÿµŸäŸÑ ÿßŸÑÿ±ÿ≥ŸàŸÖ!",
          it: "Pedaggi Riscossi!",
        },
        wrong: {
          en: "Wrong amount!",
          zh: "ÈáëÈ°çÈåØË™§ÔºÅ",
          ja: "ÈáëÈ°ç„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ",
          ko: "Í∏àÏï°Ïù¥ ÌãÄÎ†∏ÏäµÎãàÎã§!",
          es: "¬°Cantidad incorrecta!",
          de: "Falscher Betrag!",
          fi: "V√§√§r√§ summa!",
          fr: "Mauvais montant !",
          ar: "ŸÖÿ®ŸÑÿ∫ ÿÆÿßÿ∑ÿ¶!",
          it: "Importo errato!",
        },
        score: {
          en: "Revenue",
          zh: "Êî∂ÂÖ•",
          ja: "ÂèéÁõä",
          ko: "ÏàòÏûÖ",
          es: "Ingresos",
          de: "Einnahmen",
          fi: "Tulot",
          fr: "Revenu",
          ar: "ÿ•Ÿäÿ±ÿßÿØÿßÿ™",
          it: "Entrate",
        },
      };

      const prices = {
        car: 5,
        van: 10,
        bus: 20,
      };

      const vehicles = [
        { id: "car", icon: "üöó", price: 5 },
        { id: "van", icon: "üöê", price: 10 },
        { id: "bus", icon: "üöå", price: 20 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [queue, setQueue] = useState([]);
        const [input, setInput] = useState(0);
        const [score, setScore] = useState(0);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          generateQueue();
        }, []);

        const generateQueue = () => {
          // Random 2-4 vehicles
          const count = Math.floor(Math.random() * 3) + 2;
          const newQueue = [];
          for (let i = 0; i < count; i++) {
            newQueue.push(
              vehicles[Math.floor(Math.random() * vehicles.length)]
            );
          }
          setQueue(newQueue);
          setInput(0);
          setFeedback(null);
        };

        const correctTotal = queue.reduce((acc, v) => acc + v.price, 0);

        const check = () => {
          if (input === correctTotal) {
            setScore((s) => s + correctTotal);
            setFeedback("correct");
            setTimeout(generateQueue, 1500);
          } else {
            setFeedback("wrong");
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none font-sans overflow-hidden text-white">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-yellow-400 mb-4 mt-8 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]">
              üõÇ {getText("title")}
            </h1>

            <div className="w-full max-w-4xl flex flex-col items-center flex-1 relative">
              <div className="absolute top-0 right-0 font-black text-2xl text-green-400 border-2 border-green-500 rounded-xl px-4 py-2">
                {getText("score")}: ${score}
              </div>

              {/* Tunnel Queue Scene */}
              <div className="w-full h-48 bg-slate-800 rounded-3xl border-b-8 border-slate-600 relative overflow-hidden flex items-end px-12 mb-8 mt-16 shadow-inner">
                {/* Road Markings */}
                <div className="absolute bottom-4 left-0 w-full h-0 border-t-4 border-dashed border-white/20"></div>

                <AnimatePresence>
                  {queue.map((v, i) => (
                    <motion.div
                      key={`${i}-${v.id}`} // Unique key per generation
                      initial={{ x: 300, opacity: 0 }}
                      animate={{ x: 0, opacity: 1 }}
                      exit={{ x: -300, opacity: 0 }}
                      transition={{ delay: i * 0.2 }}
                      className="relative mr-4 mb-2"
                    >
                      <div className="text-7xl drop-shadow-lg">{v.icon}</div>
                      <div className="absolute top-0 right-0 bg-black/50 text-white text-xs font-bold px-1 rounded backdrop-blur">
                        ${v.price}
                      </div>
                    </motion.div>
                  ))}
                </AnimatePresence>

                {/* Toll Booth */}
                <div className="absolute right-0 bottom-0 h-full w-24 bg-yellow-600 border-l-4 border-yellow-700 z-10 flex items-center justify-center">
                  <div className="bg-black p-2 rounded text-red-500 font-mono font-bold">
                    STOP
                  </div>
                </div>
              </div>

              {/* Calculator / Input */}
              <div className="bg-slate-700 p-8 rounded-[2rem] shadow-2xl w-full max-w-md border-4 border-slate-600">
                <div className="bg-black/40 rounded-xl p-4 mb-6 text-right font-mono text-5xl text-green-400 shadow-inner">
                  ${input}
                </div>

                <div className="grid grid-cols-3 gap-4">
                  {[1, 2, 3, 4, 5, 6, 7, 8, 9, "C", 0].map((btn) => (
                    <button
                      key={btn}
                      onClick={() => {
                        if (btn === "C") setInput(0);
                        else
                          setInput((curr) =>
                            parseInt(`${curr}${btn}`.substring(0, 3))
                          ); // Limit length
                      }}
                      className="bg-slate-600 hover:bg-slate-500 text-white font-black text-2xl py-4 rounded-xl shadow active:scale-95 transition-transform border-b-4 border-slate-800 active:border-b-0 active:translate-y-1"
                    >
                      {btn}
                    </button>
                  ))}
                  <button
                    onClick={check}
                    className="bg-green-500 hover:bg-green-600 text-white font-black text-xl py-4 rounded-xl shadow active:scale-95 transition-transform border-b-4 border-green-700 active:border-b-0 active:translate-y-1"
                  >
                    {getText("submit")}
                  </button>
                </div>
              </div>

              {feedback && (
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-3xl font-black text-3xl shadow-2xl z-20 whitespace-nowrap ${
                    feedback === "correct"
                      ? "bg-green-500 text-white"
                      : "bg-red-500 text-white"
                  }`}
                >
                  {getText(feedback)}
                </motion.div>
              )}
            </div>

            <div className="mt-8 flex gap-4 opacity-70 text-sm">
              <div className="flex flex-col items-center">
                <span className="text-2xl">üöó</span> ${prices.car}
              </div>
              <div className="flex flex-col items-center">
                <span className="text-2xl">üöê</span> ${prices.van}
              </div>
              <div className="flex flex-col items-center">
                <span className="text-2xl">üöå</span> ${prices.bus}
              </div>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
