<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏âÂ∏∏Ë≠òÔºöÁáüÈ§äÈÖçÂ∞ç | Nutrient Match</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fff1f2 0%, #ffe4e6 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Nutrient Match",
          zh: "ÁáüÈ§äÈÖçÂ∞ç",
          ja: "Ê†ÑÈ§äÁ¥†„Éû„ÉÉ„ÉÅ",
          ko: "ÏòÅÏñëÏÜå ÎßûÏ∂îÍ∏∞",
          es: "Emparejar Nutrientes",
          de: "N√§hrstoff-Zuordnung",
          fi: "Ravintoaineiden yhdist√§minen",
          fr: "Association des nutriments",
          ar: "ŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©",
          it: "Abbina Nutrienti",
        },
        instruction: {
          en: "Drag foods to their main nutrient!",
          zh: "Â∞áÈ£üÁâ©ÊãñÊîæÂà∞Â∞çÊáâÁöÑ‰∏ªË¶ÅÁáüÈ§äÁ¥†ÔºÅ",
          ja: "È£ü„ÅπÁâ©„Çí‰∏ª„Å™Ê†ÑÈ§äÁ¥†„Å´„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÏùåÏãùÏùÑ Ï£ºÏöî ÏòÅÏñëÏÜåÎ°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî!",
          es: "¬°Arrastra los alimentos a su nutriente principal!",
          de: "Ziehe Lebensmittel zu ihrem Hauptn√§hrstoff!",
          fi: "Ved√§ ruoat niiden p√§√§ravintoaineisiin!",
          fr: "Faites glisser les aliments vers leur nutriment principal !",
          ar: "ÿßÿ≥ÿ≠ÿ® ÿßŸÑÿ£ÿ∑ÿπŸÖÿ© ÿ•ŸÑŸâ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä!",
          it: "Trascina gli alimenti nel loro nutriente principale!",
        },

        carbs: {
          en: "Carbohydrates",
          zh: "Á¢≥Ê∞¥ÂåñÂêàÁâ©",
          ja: "ÁÇ≠Ê∞¥ÂåñÁâ©",
          ko: "ÌÉÑÏàòÌôîÎ¨º",
          es: "Carbohidratos",
          de: "Kohlenhydrate",
          fi: "Hiilihydraatit",
          fr: "Glucides",
          ar: "ŸÉÿ±ÿ®ŸàŸáŸäÿØÿ±ÿßÿ™",
          it: "Carboidrati",
        },
        protein: {
          en: "Protein",
          zh: "ËõãÁôΩË≥™",
          ja: "„Çø„É≥„Éë„ÇØË≥™",
          ko: "Îã®Î∞±Ïßà",
          es: "Prote√≠na",
          de: "Protein",
          fi: "Proteiini",
          fr: "Prot√©ines",
          ar: "ÿ®ÿ±Ÿàÿ™ŸäŸÜ",
          it: "Proteine",
        },
        vitamins: {
          en: "Vitamins & Minerals",
          zh: "Á∂≠ÁîüÁ¥†ÂíåÁ§¶Áâ©Ë≥™",
          ja: "„Éì„Çø„Éü„É≥„Å®„Éü„Éç„É©„É´",
          ko: "ÎπÑÌÉÄÎØº Î∞è ÎØ∏ÎÑ§ÎûÑ",
          es: "Vitaminas y Minerales",
          de: "Vitamine & Mineralien",
          fi: "Vitamiinit & Kivenn√§isaineet",
          fr: "Vitamines et Min√©raux",
          ar: "ŸÅŸäÿ™ÿßŸÖŸäŸÜÿßÿ™ ŸàŸÖÿπÿßÿØŸÜ",
          it: "Vitamine e Minerali",
        },
        fats: {
          en: "Fats",
          zh: "ËÑÇËÇ™",
          ja: "ËÑÇËÇ™",
          ko: "ÏßÄÎ∞©",
          es: "Grasas",
          de: "Fette",
          fi: "Rasvat",
          fr: "Graisses",
          ar: "ÿØŸáŸàŸÜ",
          it: "Grassi",
        },

        rice: {
          en: "Rice",
          zh: "Á±≥È£Ø",
          ja: "Á±≥",
          ko: "Î∞•",
          es: "Arroz",
          de: "Reis",
          fi: "Riisi",
          fr: "Riz",
          ar: "ÿ£ÿ±ÿ≤",
          it: "Riso",
        },
        bread: {
          en: "Bread",
          zh: "È∫µÂåÖ",
          ja: "„Éë„É≥",
          ko: "Îπµ",
          es: "Pan",
          de: "Brot",
          fi: "Leip√§",
          fr: "Pain",
          ar: "ÿÆÿ®ÿ≤",
          it: "Pane",
        },
        noodle: {
          en: "Noodles",
          zh: "È∫µÊ¢ù",
          ja: "È∫∫",
          ko: "Íµ≠Ïàò",
          es: "Fideos",
          de: "Nudeln",
          fi: "Nuudelit",
          fr: "Nouilles",
          ar: "ŸÖÿπŸÉÿ±ŸàŸÜÿ©",
          it: "Spaghetti",
        },

        meat: {
          en: "Meat",
          zh: "ËÇâÈ°û",
          ja: "ËÇâ",
          ko: "Í≥†Í∏∞",
          es: "Carne",
          de: "Fleisch",
          fi: "Liha",
          fr: "Viande",
          ar: "ŸÑÿ≠ŸÖ",
          it: "Carne",
        },
        egg: {
          en: "Egg",
          zh: "ÈõûËõã",
          ja: "Âçµ",
          ko: "Í≥ÑÎûÄ",
          es: "Huevo",
          de: "Ei",
          fi: "Kananmuna",
          fr: "≈íuf",
          ar: "ÿ®Ÿäÿ∂",
          it: "Uovo",
        },
        fish: {
          en: "Fish",
          zh: "È≠ö",
          ja: "È≠ö",
          ko: "Î¨ºÍ≥†Í∏∞",
          es: "Pescado",
          de: "Fisch",
          fi: "Kala",
          fr: "Poisson",
          ar: "ÿ≥ŸÖŸÉ",
          it: "Pesce",
        },

        apple: {
          en: "Apple",
          zh: "ËòãÊûú",
          ja: "„É™„É≥„Ç¥",
          ko: "ÏÇ¨Í≥º",
          es: "Manzana",
          de: "Apfel",
          fi: "Omena",
          fr: "Pomme",
          ar: "ÿ™ŸÅÿßÿ≠ÿ©",
          it: "Mela",
        },
        veg: {
          en: "Vegetables",
          zh: "Ëî¨Ëèú",
          ja: "ÈáéËèú",
          ko: "Ï±ÑÏÜå",
          es: "Verduras",
          de: "Gem√ºse",
          fi: "Vihannekset",
          fr: "L√©gumes",
          ar: "ÿÆÿ∂ÿ±Ÿàÿßÿ™",
          it: "Verdure",
        },
        orange: {
          en: "Orange",
          zh: "Ê©ô",
          ja: "„Ç™„É¨„É≥„Ç∏",
          ko: "Ïò§Î†åÏßÄ",
          es: "Naranja",
          de: "Orange",
          fi: "Appelsiini",
          fr: "Orange",
          ar: "ÿ®ÿ±ÿ™ŸÇÿßŸÑ",
          it: "Arancia",
        },

        oil: {
          en: "Oil",
          zh: "È£üÁî®Ê≤π",
          ja: "Ê≤π",
          ko: "Í∏∞Î¶Ñ",
          es: "Aceite",
          de: "√ñl",
          fi: "√ñljy",
          fr: "Huile",
          ar: "ÿ≤Ÿäÿ™",
          it: "Olio",
        },
        butter: {
          en: "Butter",
          zh: "ÁâõÊ≤π",
          ja: "„Éê„Çø„Éº",
          ko: "Î≤ÑÌÑ∞",
          es: "Mantequilla",
          de: "Butter",
          fi: "Voi",
          fr: "Beurre",
          ar: "ÿ≤ÿ®ÿØÿ©",
          it: "Burro",
        },

        correct: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµÏûÖÎãàÎã§!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        wrong: {
          en: "Try Again!",
          zh: "ÂÜçË©¶‰∏ÄÊ¨°ÔºÅ",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÔºÅ",
          ko: "Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî!",
          es: "¬°Int√©ntalo de nuevo!",
          de: "Versuch es nochmal!",
          fi: "Yrit√§ uudelleen!",
          fr: "R√©essayez !",
          ar: "ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ!",
          it: "Riprova!",
        },

        completed: {
          en: "Nutrition Expert!",
          zh: "ÁáüÈ§äÂ∞èÂ∞àÂÆ∂ÔºÅ",
          ja: "Ê†ÑÈ§ä„Ç®„Ç≠„Çπ„Éë„Éº„ÉàÔºÅ",
          ko: "ÏòÅÏñë Ï†ÑÎ¨∏Í∞Ä!",
          es: "¬°Experto en Nutrici√≥n!",
          de: "Ern√§hrungsexperte!",
          fi: "Ravintoasiantuntija!",
          fr: "Expert en nutrition !",
          ar: "ÿÆÿ®Ÿäÿ± ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ©!",
          it: "Esperto di Nutrizione!",
        },
        reset: {
          en: "Play Again",
          zh: "ÂÜçÁé©‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§",
          ko: "Îã§Ïãú ÌïòÍ∏∞",
          es: "Jugar de Nuevo",
          de: "Nochmal spielen",
          fi: "Pelaa uudelleen",
          fr: "Rejouer",
          ar: "ÿßŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Gioca di Nuovo",
        },

        desc_carbs: {
          en: "Energy Source",
          zh: "ËÉΩÈáè‰æÜÊ∫ê",
          ja: "„Ç®„Éç„É´„ÇÆ„ÉºÊ∫ê",
          ko: "ÏóêÎÑàÏßÄÏõê",
          es: "Fuente de Energ√≠a",
          de: "Energiequelle",
          fi: "Energianl√§hde",
          fr: "Source d'√©nergie",
          ar: "ŸÖÿµÿØÿ± ÿ∑ÿßŸÇÿ©",
          it: "Fonte di Energia",
        },
        desc_protein: {
          en: "Builds Body",
          zh: "Âπ´Âä©ÁîüÈï∑",
          ja: "‰Ωì„Çí‰Ωú„Çã",
          ko: "Ïã†Ï≤¥ ÌòïÏÑ±",
          es: "Construye el Cuerpo",
          de: "Baut den K√∂rper auf",
          fi: "Rakentaa kehoa",
          fr: "Construit le corps",
          ar: "Ÿäÿ®ŸÜŸä ÿßŸÑÿ¨ÿ≥ŸÖ",
          it: "Costruisce il Corpo",
        },
        desc_vitamins: {
          en: "Health Guard",
          zh: "Á∂≠ÊåÅÂÅ•Â∫∑",
          ja: "ÂÅ•Â∫∑„ÇíÂÆà„Çã",
          ko: "Í±¥Í∞ï Ïú†ÏßÄ",
          es: "Guardi√°n de la Salud",
          de: "Gesundheitsw√§chter",
          fi: "Terveyden vartija",
          fr: "Gardien de la sant√©",
          ar: "ÿ≠ÿßÿ±ÿ≥ ÿßŸÑÿµÿ≠ÿ©",
          it: "Guardiano della Salute",
        },
        desc_fats: {
          en: "Energy Storage",
          zh: "ÂÑ≤Â≠òËÉΩÈáè",
          ja: "„Ç®„Éç„É´„ÇÆ„ÉºË≤ØËîµ",
          ko: "ÏóêÎÑàÏßÄ Ï†ÄÏû•",
          es: "Almacenamiento de Energ√≠a",
          de: "Energiespeicher",
          fi: "Energiavarasto",
          fr: "Stockage d'√©nergie",
          ar: "ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ∑ÿßŸÇÿ©",
          it: "Riserva di Energia",
        },
      };

      const categories = [
        {
          id: "carbs",
          color: "bg-yellow-100",
          border: "border-yellow-400",
          text: "text-yellow-700",
          icon: "‚ö°",
        },
        {
          id: "protein",
          color: "bg-red-100",
          border: "border-red-400",
          text: "text-red-700",
          icon: "üí™",
        },
        {
          id: "vitamins",
          color: "bg-green-100",
          border: "border-green-400",
          text: "text-green-700",
          icon: "üõ°Ô∏è",
        },
        {
          id: "fats",
          color: "bg-orange-100",
          border: "border-orange-400",
          text: "text-orange-700",
          icon: "üîã",
        },
      ];

      const foods = [
        { id: "rice", icon: "üçö", type: "carbs" },
        { id: "bread", icon: "üçû", type: "carbs" },
        { id: "meat", icon: "ü•©", type: "protein" },
        { id: "egg", icon: "ü•ö", type: "protein" },
        { id: "apple", icon: "üçé", type: "vitamins" },
        { id: "veg", icon: "ü•¨", type: "vitamins" },
        { id: "oil", icon: "ü´ó", type: "fats" },
        { id: "butter", icon: "üßà", type: "fats" },
        { id: "fish", icon: "üêü", type: "protein" },
        { id: "noodle", icon: "üçú", type: "carbs" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [queue, setQueue] = useState([]);
        const [current, setCurrent] = useState(null);
        const [feedback, setFeedback] = useState(null);
        const [completedCategories, setCompletedCategories] = useState({}); // Counts

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          initGame();
        }, []);

        const initGame = () => {
          const q = [...foods].sort(() => Math.random() - 0.5);
          setQueue(q);
          setCurrent(q[0]);
          setFeedback(null);
          setCompletedCategories({});
        };

        const handleSort = (catId) => {
          if (feedback) return;
          if (current.type === catId) {
            setFeedback({ status: "correct", catId });
            setTimeout(() => {
              setFeedback(null);
              const nextIdx = queue.indexOf(current) + 1;
              if (nextIdx < queue.length) setCurrent(queue[nextIdx]);
              else setCurrent(null);
            }, 800);
          } else {
            setFeedback({ status: "wrong" });
            setTimeout(() => setFeedback(null), 800);
          }
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none overflow-hidden font-sans">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-rose-800 mb-4 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              ü•ó {getText("title")}
            </h1>

            {/* Draggable Item */}
            <div className="flex-1 flex flex-col items-center justify-center w-full relative">
              <AnimatePresence mode="wait">
                {current ? (
                  <motion.div
                    key={current.id}
                    initial={{ scale: 0, y: 50, rotate: -10 }}
                    animate={{ scale: 1, y: 0, rotate: 0 }}
                    exit={{ scale: 0, opacity: 0 }}
                    className="bg-white p-8 rounded-full shadow-2xl border-8 border-rose-200 w-48 h-48 flex flex-col items-center justify-center z-20 cursor-grab active:cursor-grabbing hover:scale-105 transition-transform"
                    drag
                    dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}
                    dragElastic={0.2}
                    onDragEnd={(e, info) => {
                      // Simple proximity Logic could go here, but button tapping is smoother for P3 on tablets
                      // We keep instructions simple: Drag visually, but Tap to select is easier to impl reliably
                    }}
                  >
                    <div className="text-7xl mb-2">{current.icon}</div>
                    <div className="font-bold text-slate-600">
                      {getText(current.id)}
                    </div>
                  </motion.div>
                ) : (
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className="bg-white/90 p-12 rounded-3xl shadow-xl text-center z-20"
                  >
                    <div className="text-8xl mb-4">üèÜ</div>
                    <h2 className="text-3xl font-black text-rose-800 mb-6">
                      {getText("completed")}
                    </h2>
                    <button
                      onClick={initGame}
                      className="bg-rose-500 text-white px-10 py-4 rounded-full font-black text-xl hover:bg-rose-600 shadow-xl"
                    >
                      {getText("reset")} üîÑ
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>

              {feedback && (
                <motion.div
                  initial={{ opacity: 0, scale: 0.5 }}
                  animate={{ opacity: 1, scale: 1 }}
                  className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-3xl font-black text-4xl shadow-2xl z-30 whitespace-nowrap ${
                    feedback.status === "correct"
                      ? "bg-green-500 text-white"
                      : "bg-red-500 text-white"
                  }`}
                >
                  {getText(feedback.status)}
                </motion.div>
              )}
            </div>

            <p className="font-bold text-rose-800 text-lg mb-6 bg-white/60 px-4 py-1 rounded-full">
              {getText("instruction")}
            </p>

            {/* Buckets */}
            <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-6xl mb-8">
              {categories.map((cat) => (
                <button
                  key={cat.id}
                  onClick={() => handleSort(cat.id)}
                  className={`${cat.color} ${cat.border} border-y-4 rounded-3xl p-4 flex flex-col items-center shadow-lg active:scale-95 transition-all relative overflow-hidden group h-40 justify-between`}
                >
                  <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity text-6xl">
                    {cat.icon}
                  </div>
                  <div className="text-4xl">{cat.icon}</div>
                  <div
                    className={`font-black text-xl md:text-2xl ${cat.text} text-center leading-none`}
                  >
                    {getText(cat.id)}
                  </div>
                  <div className="text-xs font-bold text-slate-500 bg-white/50 px-2 py-1 rounded-full">
                    {getText(`desc_${cat.id}`)}
                  </div>
                </button>
              ))}
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
