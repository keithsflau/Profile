<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸€å¸¸è­˜ï¼šæ ¡åœ’å°‹å¯¶è¨˜ | School Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #f0f9ff 0%, #cbebff 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "School Treasure Hunt",
          zh: "æ ¡åœ’å°‹å¯¶è¨˜",
          ja: "å­¦æ ¡ã®å®æ¢ã—",
          ko: "í•™êµ ë³´ë¬¼ ì°¾ê¸°",
          es: "BÃºsqueda del tesoro escolar",
          de: "Schulschatzsuche",
          fi: "Koulun aarteenmetsÃ¤stys",
          fr: "Chasse au trÃ©sor scolaire",
          ar: "Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ†Ø² ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",
          it: "Caccia al tesoro scolastica",
        },
        instruction: {
          en: "Where should I go?",
          zh: "æˆ‘æ‡‰è©²å»å“ªè£¡ï¼Ÿ",
          ja: "ã©ã“ã«è¡Œã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ",
          ko: "ì–´ë””ë¡œ ê°€ì•¼ í•˜ë‚˜ìš”?",
          es: "Â¿A dÃ³nde debo ir?",
          de: "Wohin soll ich gehen?",
          fi: "Minne minun pitÃ¤isi mennÃ¤?",
          fr: "OÃ¹ dois-je aller ?",
          ar: "Ø¥Ù„Ù‰ Ø£ÙŠÙ† ÙŠØ¬Ø¨ Ø£Ù† Ø£Ø°Ù‡Ø¨ØŸ",
          it: "Dove dovrei andare?",
        },
        q1: {
          en: "I want to read storybooks.",
          zh: "æˆ‘æƒ³çœ‹æ•…äº‹æ›¸ã€‚",
          ja: "çµµæœ¬ã‚’èª­ã¿ãŸã„ã§ã™ã€‚",
          ko: "ë™í™”ì±…ì„ ì½ê³  ì‹¶ì–´ìš”.",
        },
        q2: {
          en: "I need to wash my hands.",
          zh: "æˆ‘è¦æ´—æ‰‹ã€‚",
          ja: "æ‰‹ã‚’æ´—ã„ãŸã„ã§ã™ã€‚",
          ko: "ì†ì„ ì”»ì–´ì•¼ í•´ìš”.",
        },
        q3: {
          en: "I want to run and play.",
          zh: "æˆ‘æƒ³è·‘æ­¥å’Œç©è€ã€‚",
          ja: "èµ°ã£ã¦éŠã³ãŸã„ã§ã™ã€‚",
          ko: "ë›°ê³  ì‹¶ì–´ìš”.",
        },
        q4: {
          en: "I have a question about school fees.",
          zh: "æˆ‘æœ‰é—œæ–¼å­¸è²»çš„å•é¡Œã€‚",
          ja: "å­¦è²»ã«ã¤ã„ã¦è³ªå•ãŒã‚ã‚Šã¾ã™ã€‚",
          ko: "ìˆ˜ì—…ë£Œì— ëŒ€í•´ ì§ˆë¬¸ì´ ìˆì–´ìš”.",
        },
        q5: {
          en: "It is time for Maths lesson.",
          zh: "ç¾åœ¨æ˜¯æ•¸å­¸èª²ã€‚",
          ja: "æ•°å­¦ã®æˆæ¥­ã®æ™‚é–“ã§ã™ã€‚",
          ko: "ìˆ˜í•™ ìˆ˜ì—… ì‹œê°„ì´ì—ìš”.",
        },
        q6: {
          en: "Let's sing a song!",
          zh: "ä¸€èµ·å”±æ­Œå§ï¼",
          ja: "æ­Œã‚’æ­Œã„ã¾ã—ã‚‡ã†ï¼",
          ko: "ë…¸ë˜ë¥¼ ë¶ˆëŸ¬ìš”!",
        },
        office: { en: "General Office", zh: "æ ¡å‹™è™•" },
        library: { en: "Library", zh: "åœ–æ›¸é¤¨" },
        toilet: { en: "Toilet", zh: "æ´—æ‰‹é–“" },
        classroom: { en: "Classroom", zh: "èª²å®¤" },
        playground: { en: "Playground", zh: "æ“å ´" },
        musicroom: { en: "Music Room", zh: "éŸ³æ¨‚å®¤" },
        correct: { en: "Correct! great job!", zh: "ç­”å°äº†ï¼åšå¾—å¥½ï¼" },
        tryAgain: { en: "Not here, try again!", zh: "ä¸æ˜¯é€™è£¡ï¼Œå†è©¦ä¸€æ¬¡ï¼" },
        next: { en: "Next Question", zh: "ä¸‹ä¸€é¡Œ" },
        completed: { en: "Mission Complete!", zh: "ä»»å‹™å®Œæˆï¼" },
        restart: { en: "Play Again", zh: "å†ç©ä¸€æ¬¡" },
      };

      const rooms = [
        { id: "office", color: "bg-blue-400" },
        { id: "library", color: "bg-yellow-400" },
        { id: "toilet", color: "bg-cyan-400" },
        { id: "classroom", color: "bg-green-400" },
        { id: "playground", color: "bg-orange-400" },
        { id: "musicroom", color: "bg-purple-400" },
      ];

      const questions = [
        { textKey: "q1", answerId: "library" },
        { textKey: "q2", answerId: "toilet" },
        { textKey: "q3", answerId: "playground" },
        { textKey: "q4", answerId: "office" },
        { textKey: "q5", answerId: "classroom" },
        { textKey: "q6", answerId: "musicroom" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [qIndex, setQIndex] = useState(0);
        const [feedback, setFeedback] = useState(null); // 'correct' | 'wrong'
        const [showConfetti, setShowConfetti] = useState(false);

        const getText = (key, subKey) => {
          if (subKey) return t[key][subKey][lang] || t[key][subKey]["en"];
          return t[key][lang] || t[key]["en"];
        };

        const currentQ = questions[qIndex];

        const handleRoomClick = (roomId) => {
          if (feedback === "correct") return;

          if (roomId === currentQ.answerId) {
            setFeedback("correct");
            playSound("correct");
          } else {
            setFeedback("wrong");
            playSound("wrong");
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        const nextQ = () => {
          setFeedback(null);
          if (qIndex < questions.length - 1) {
            setQIndex(qIndex + 1);
          } else {
            setQIndex(-1); // Finished
            setShowConfetti(true);
          }
        };

        const restart = () => {
          setQIndex(0);
          setFeedback(null);
          setShowConfetti(false);
        };

        const playSound = (type) => {
          // Placeholder for sound effect logic
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-sky-600 mb-4 mt-8 text-center drop-shadow-md">
              ğŸ« {getText("title")}
            </h1>

            {qIndex !== -1 ? (
              <div className="w-full max-w-4xl flex flex-col items-center">
                <div className="bg-white rounded-3xl p-6 shadow-xl mb-6 w-full max-w-2xl text-center border-4 border-sky-200">
                  <p className="text-slate-500 font-bold mb-2">
                    {getText("instruction")}
                  </p>
                  <h2 className="text-2xl md:text-3xl font-black text-slate-800">
                    {getText(currentQ.textKey)}
                  </h2>
                </div>

                <div className="grid grid-cols-2 md:grid-cols-3 gap-4 w-full">
                  {rooms.map((room) => (
                    <motion.button
                      key={room.id}
                      onClick={() => handleRoomClick(room.id)}
                      whileHover={{ scale: 1.05 }}
                      whileTap={{ scale: 0.95 }}
                      className={`${room.color} h-32 md:h-40 rounded-2xl shadow-lg flex items-center justify-center p-4 border-b-8 border-black/10 relative overflow-hidden`}
                    >
                      <span className="text-white font-black text-xl md:text-2xl drop-shadow-md z-10">
                        {getText(room.id)}
                      </span>
                      <div className="absolute inset-0 bg-white/10 opacity-0 hover:opacity-100 transition-opacity"></div>
                    </motion.button>
                  ))}
                </div>

                <AnimatePresence>
                  {feedback && (
                    <motion.div
                      initial={{ opacity: 0, y: 50 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: 20 }}
                      className={`fixed bottom-8 left-0 right-0 mx-auto w-[90%] max-w-md p-6 rounded-3xl shadow-2xl text-center z-50 ${
                        feedback === "correct"
                          ? "bg-green-500 text-white"
                          : "bg-red-500 text-white"
                      }`}
                    >
                      <h3 className="text-3xl font-black mb-2">
                        {feedback === "correct"
                          ? "ğŸ‰ " + getText("correct")
                          : "âŒ " + getText("tryAgain")}
                      </h3>
                      {feedback === "correct" && (
                        <button
                          onClick={nextQ}
                          className="mt-4 bg-white text-green-600 px-8 py-3 rounded-full font-black text-xl hover:scale-105 transition-transform shadow-lg"
                        >
                          {getText("next")} â¡ï¸
                        </button>
                      )}
                    </motion.div>
                  )}
                </AnimatePresence>
              </div>
            ) : (
              <div className="flex flex-col items-center justify-center mt-20">
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  className="text-6xl mb-4"
                >
                  ğŸ†
                </motion.div>
                <h2 className="text-4xl font-black text-sky-700 mb-8">
                  {getText("completed")}
                </h2>
                <button
                  onClick={restart}
                  className="bg-sky-500 text-white px-10 py-4 rounded-full font-black text-2xl hover:bg-sky-600 shadow-xl transition-transform hover:scale-105"
                >
                  {getText("restart")} ğŸ”„
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
