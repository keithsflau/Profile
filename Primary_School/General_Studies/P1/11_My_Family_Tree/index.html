<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸€å¸¸è­˜ï¼šå®¶åº­æ¨¹æ‹¼åœ– | My Family Tree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #ecfccb 0%, #a3e635 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "My Family Tree",
          zh: "å®¶åº­æ¨¹æ‹¼åœ–",
          ja: "å®¶ç³»å›³",
        },
        instruction: {
          en: "Drag the family members to the correct place!",
          zh: "æŠŠå®¶åº­æˆå“¡æ‹–åˆ°æ­£ç¢ºçš„ä½ç½®ï¼",
          ja: "å®¶æ—ã‚’æ­£ã—ã„å ´æ‰€ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„ï¼",
        },
        grandpa: { en: "Grandfather", zh: "ç¥–çˆ¶/çˆºçˆº" },
        grandma: { en: "Grandmother", zh: "ç¥–æ¯/å«²å«²" },
        father: { en: "Father", zh: "çˆ¸çˆ¸" },
        mother: { en: "Mother", zh: "åª½åª½" },
        me: { en: "Me", zh: "æˆ‘" },
        sister: { en: "Sister", zh: "å§å§/å¦¹å¦¹" },

        check: { en: "Check", zh: "æª¢æŸ¥" },
        reset: { en: "Reset", zh: "é‡ç½®" },
        correct: {
          en: "Correct! What a lovely family!",
          zh: "ç­”å°äº†ï¼çœŸå¯æ„›çš„å®¶åº­ï¼",
        },
        wrong: { en: "Some are wrong. Try again!", zh: "æœ‰äº›éŒ¯äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼" },
      };

      const members = [
        { id: "grandpa", icon: "ğŸ‘´" },
        { id: "grandma", icon: "ğŸ‘µ" },
        { id: "father", icon: "ğŸ‘¨" },
        { id: "mother", icon: "ğŸ‘©" },
        { id: "me", icon: "ğŸ‘¶" },
        { id: "sister", icon: "ğŸ‘§" },
      ];

      // Define slots layout
      // Level 1: Grandpa, Grandma
      // Level 2: Father, Mother
      // Level 3: Me, Sister
      const initialSlots = [
        { id: "slot_gp", target: "grandpa", x: -100, y: 50 },
        { id: "slot_gm", target: "grandma", x: 100, y: 50 },
        { id: "slot_fa", target: "father", x: -100, y: 200 },
        { id: "slot_mo", target: "mother", x: 100, y: 200 },
        { id: "slot_me", target: "me", x: -100, y: 350 },
        { id: "slot_sis", target: "sister", x: 100, y: 350 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [placements, setPlacements] = useState({}); // slotId -> memberId
        const [status, setStatus] = useState(null); // 'correct', 'wrong'

        const getText = (key) => t[key][lang] || t[key]["en"];

        // Simple Drag Logic: Click Slot -> Select Member? Or Drag?
        // Let's use Drag and Drop with basic "nearest slot" logic if possible,
        // OR simpler: Click Member, Click Slot.
        // Let's go with: List of members at bottom. Drag to slot.

        const [availableMembers, setAvailableMembers] = useState(
          members.map((m) => m.id)
        );

        const handleDrop = (memberId, slotId) => {
          const slot = initialSlots.find((s) => s.id === slotId);
          // Verify correct? Or allow placement anywhere and check later?
          // "Check later" is better pedagogy.

          // Remove from available
          setAvailableMembers((prev) => prev.filter((id) => id !== memberId));

          // If slot occupied, return occupant to available?
          if (placements[slotId]) {
            setAvailableMembers((prev) => [...prev, placements[slotId]]);
          }

          setPlacements((prev) => ({
            ...prev,
            [slotId]: memberId,
          }));
          setStatus(null);
        };

        const handleRemove = (slotId) => {
          const memberId = placements[slotId];
          if (!memberId) return;
          setPlacements((prev) => {
            const next = { ...prev };
            delete next[slotId];
            return next;
          });
          setAvailableMembers((prev) => [...prev, memberId]);
          setStatus(null);
        };

        const checkAnswers = () => {
          const allCorrect = initialSlots.every(
            (slot) => placements[slot.id] === slot.target
          );
          if (allCorrect) setStatus("correct");
          else setStatus("wrong");
        };

        const reset = () => {
          setPlacements({});
          setAvailableMembers(members.map((m) => m.id));
          setStatus(null);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-lime-800 mb-4 mt-8 drop-shadow-sm">
              ğŸŒ³ {getText("title")}
            </h1>
            <p className="font-bold text-lime-700 mb-4">
              {getText("instruction")}
            </p>

            {/* Tree Area */}
            <div className="relative w-full max-w-2xl h-[500px] bg-sky-100 rounded-3xl border-4 border-lime-500 overflow-hidden mb-8 shadow-inner">
              {/* Visual Tree */}
              <div className="absolute inset-x-0 bottom-0 h-1/2 bg-lime-200 rounded-t-full"></div>
              <div className="absolute w-8 h-full bg-amber-600 left-1/2 -ml-4 bottom-0"></div>
              <div className="absolute w-32 h-4 bg-amber-600 top-[100px] left-1/2 -ml-16"></div>{" "}
              {/* Branch 1 */}
              <div className="absolute w-32 h-4 bg-amber-600 top-[250px] left-1/2 -ml-16"></div>{" "}
              {/* Branch 2 */}
              {/* Connecting lines */}
              {/* Simplify: Just CSS drawing or SVG is better, but Divs work for abstract tree */}
              {/* Slots */}
              {initialSlots.map((slot) => {
                const memberId = placements[slot.id];
                const member = members.find((m) => m.id === memberId);
                return (
                  <div
                    key={slot.id}
                    className={`absolute w-32 h-24 rounded-xl border-4 flex flex-col items-center justify-center cursor-pointer transition-colors bg-white/80 ${
                      status === "correct"
                        ? "border-green-500 bg-green-100"
                        : "border-dashed border-slate-400 hover:bg-white"
                    }`}
                    style={{
                      left: `50%`,
                      top: slot.y,
                      marginLeft: slot.x - 64, // center (width/2)
                    }}
                    onClick={() => handleRemove(slot.id)}
                    onDragOver={(e) => e.preventDefault()}
                    onDrop={(e) => {
                      e.preventDefault();
                      const mid = e.dataTransfer.getData("memberId");
                      if (mid) handleDrop(mid, slot.id);
                    }}
                  >
                    {member ? (
                      <>
                        <span className="text-4xl shadow-sm">
                          {member.icon}
                        </span>
                        <span className="font-bold text-xs text-center">
                          {getText(member.id)}
                        </span>
                      </>
                    ) : (
                      <span className="text-slate-300 font-bold text-sm">
                        {getText(slot.target)}?
                      </span>
                    )}
                  </div>
                );
              })}
            </div>

            {/* Controls */}
            <div className="flex gap-4 mb-8">
              <button
                onClick={checkAnswers}
                className="bg-lime-500 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-lime-600"
              >
                {getText("check")} âœ…
              </button>
              <button
                onClick={reset}
                className="bg-white text-slate-500 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-gray-100"
              >
                {getText("reset")} ğŸ”„
              </button>
            </div>

            {status && (
              <div
                className={`text-2xl font-black mb-8 ${
                  status === "correct" ? "text-green-600" : "text-red-500"
                }`}
              >
                {getText(status)}
              </div>
            )}

            {/* Members Bank */}
            <div className="bg-white p-6 rounded-3xl shadow-xl w-full max-w-3xl flex flex-wrap gap-4 justify-center min-h-[120px]">
              {availableMembers.map((mid) => {
                const m = members.find((mem) => mem.id === mid);
                return (
                  <div
                    key={m.id}
                    draggable
                    onDragStart={(e) => {
                      e.dataTransfer.setData("memberId", m.id);
                    }}
                    className="w-24 h-24 bg-lime-50 rounded-xl border-2 border-lime-200 flex flex-col items-center justify-center cursor-grab active:cursor-grabbing hover:scale-105 transition-transform"
                  >
                    <span className="text-4xl">{m.icon}</span>
                    <span className="font-bold text-xs text-lime-800">
                      {getText(m.id)}
                    </span>
                  </div>
                );
              })}
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          ã€Œè€¶å’Œè¯ç”¨èƒ½åŠ›å‰µé€ å¤§åœ°ï¼Œç”¨æ™ºæ…§å»ºç«‹ä¸–ç•Œï¼Œç”¨è°æ˜é‹ªå¼µç©¹è’¼ã€‚ã€ è€¶åˆ©ç±³æ›¸ 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
