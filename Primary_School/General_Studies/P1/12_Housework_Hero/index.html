<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏ÄÂ∏∏Ë≠òÔºöÂÆ∂ÂãôÂ∞èÂπ´Êâã | Housework Hero</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fef08a 0%, #facc15 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Housework Hero",
          zh: "ÂÆ∂ÂãôÂ∞èÂπ´Êâã",
          ja: "ÂÆ∂‰∫ã„Éí„Éº„É≠„Éº",
        },
        menu: { en: "Select a Task", zh: "ÈÅ∏Êìá‰ªªÂãô" },
        task1: { en: "Fold Clothes", zh: "Êë∫Ë°£Êúç" },
        task2: { en: "Sweep Floor", zh: "ÊéÉÂú∞" },
        task3: { en: "Tidy Toys", zh: "Êî∂ÊãæÁé©ÂÖ∑" },
        back: { en: "Back", zh: "ËøîÂõû" },
        completed: { en: "Task Completed!", zh: "‰ªªÂãôÂÆåÊàêÔºÅ" },
        instruction1: {
          en: "Click to fold the clothes!",
          zh: "ÈªûÊìäË°£ÊúçÊääÂÆÉÊë∫Â•ΩÔºÅ",
        },
        instruction2: {
          en: "Click the trash to sweep it!",
          zh: "ÈªûÊìäÂûÉÂúæÊääÂÆÉÊéÉËµ∞ÔºÅ",
        },
        instruction3: {
          en: "Click toys to put them in the box!",
          zh: "ÈªûÊìäÁé©ÂÖ∑ÊääÂÆÉÊîæÂÖ•ÁÆ±Â≠êÔºÅ",
        },
      };

      const clothesData = [
        { id: 1, type: "üëï", color: "bg-blue-200" },
        { id: 2, type: "üëñ", color: "bg-blue-400" },
        { id: 3, type: "üëó", color: "bg-pink-300" },
        { id: 4, type: "üëö", color: "bg-purple-200" },
      ];

      const trashData = [
        { id: 1, icon: "üßÉ", x: 20, y: 30 },
        { id: 2, icon: "üìÑ", x: 60, y: 60 },
        { id: 3, icon: "üçå", x: 40, y: 80 },
        { id: 4, icon: "üçÇ", x: 80, y: 20 },
        { id: 5, icon: "üç¨", x: 30, y: 50 },
      ];

      const toysData = [
        { id: 1, icon: "ü§ñ", x: 10, y: 20 },
        { id: 2, icon: "üß∏", x: 70, y: 70 },
        { id: 3, icon: "üöó", x: 30, y: 80 },
        { id: 4, icon: "ü¶ñ", x: 80, y: 30 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [task, setTask] = useState("menu"); // menu, task1, task2, task3
        const [progress, setProgress] = useState([]); // List of completed item IDs

        const getText = (key) => t[key][lang] || t[key]["en"];

        const startTask = (taskId) => {
          setTask(taskId);
          setProgress([]);
        };

        const completeItem = (id) => {
          if (!progress.includes(id)) {
            setProgress([...progress, id]);
          }
        };

        // --- Task 1: Clothes ---
        const renderTask1 = () => {
          const allDone = progress.length === clothesData.length;
          return (
            <div className="flex flex-col items-center">
              <p className="text-xl font-bold text-amber-900 mb-8">
                {getText("instruction1")}
              </p>
              <div className="grid grid-cols-2 gap-8">
                {clothesData.map((c) => {
                  const isDone = progress.includes(c.id);
                  return (
                    <motion.button
                      key={c.id}
                      onClick={() => completeItem(c.id)}
                      className={`w-32 h-32 rounded-xl flex items-center justify-center text-6xl shadow-lg border-4 transition-colors ${
                        isDone
                          ? "bg-white border-green-400"
                          : c.color + " border-white"
                      }`}
                      whileHover={{ scale: 1.05 }}
                      whileTap={{ scale: 0.95 }}
                    >
                      <motion.span
                        animate={
                          isDone
                            ? { scale: 0.8, rotate: 0 }
                            : { rotate: Math.random() * 20 - 10 }
                        }
                      >
                        {c.type}
                      </motion.span>
                      {isDone && (
                        <span className="absolute text-green-500 text-4xl font-black">
                          ‚úì
                        </span>
                      )}
                    </motion.button>
                  );
                })}
              </div>
              {renderCompletion(allDone)}
            </div>
          );
        };

        // --- Task 2: Sweep ---
        const renderTask2 = () => {
          const allDone = progress.length === trashData.length;
          return (
            <div className="flex flex-col items-center w-full min-h-[400px] relative bg-stone-200 rounded-3xl border-8 border-stone-400 overflow-hidden shadow-inner">
              <div className="absolute top-4 left-0 w-full text-center bold text-stone-500">
                {getText("instruction2")}
              </div>
              {trashData.map(
                (item) =>
                  !progress.includes(item.id) && (
                    <motion.button
                      key={item.id}
                      onClick={() => completeItem(item.id)}
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      exit={{ scale: 0 }}
                      className="absolute text-5xl cursor-pointer hover:scale-110 active:scale-90"
                      style={{ left: `${item.x}%`, top: `${item.y}%` }}
                    >
                      {item.icon}
                    </motion.button>
                  )
              )}
              {allDone && (
                <div className="absolute inset-0 flex items-center justify-center bg-white/80">
                  {renderCompletion(true)}
                </div>
              )}
              {/* Broom Cursor logic could be added here but keeping simple click */}
            </div>
          );
        };

        // --- Task 3: Toys ---
        const renderTask3 = () => {
          const allDone = progress.length === toysData.length;
          return (
            <div className="flex flex-col items-center w-full min-h-[400px] relative bg-sky-100 rounded-3xl border-8 border-sky-300 overflow-hidden shadow-inner p-4">
              <p className="text-sky-800 font-bold mb-4">
                {getText("instruction3")}
              </p>

              {/* Toy Box */}
              <div className="absolute bottom-4 right-4 w-40 h-32 bg-yellow-400 border-4 border-yellow-600 rounded-xl flex items-end justify-center shadow-lg">
                <span className="text-4xl mb-2">üì¶</span>
              </div>

              {toysData.map((item) => {
                const isDone = progress.includes(item.id);
                return (
                  <motion.button
                    key={item.id}
                    onClick={() => completeItem(item.id)}
                    animate={
                      isDone ? { x: 200, y: 300, scale: 0, opacity: 0 } : {}
                    }
                    className="absolute text-6xl cursor-pointer"
                    style={{ left: `${item.x}%`, top: `${item.y}%` }}
                  >
                    {item.icon}
                  </motion.button>
                );
              })}

              {allDone && (
                <div className="absolute inset-0 flex items-center justify-center bg-white/80 backdrop-blur z-10">
                  {renderCompletion(true)}
                </div>
              )}
            </div>
          );
        };

        const renderCompletion = (isDone) => {
          if (!isDone) return null;
          return (
            <motion.div
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              className="mt-8 text-center bg-white p-6 rounded-2xl shadow-xl"
            >
              <h2 className="text-3xl font-black text-green-600 mb-4">
                {getText("completed")}
              </h2>
              <button
                onClick={() => setTask("menu")}
                className="bg-amber-500 text-white px-8 py-3 rounded-full font-bold hover:bg-amber-600"
              >
                {getText("back")}
              </button>
            </motion.div>
          );
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-amber-800 mb-8 mt-8 drop-shadow-sm flex items-center gap-2">
              üßπ {getText("title")}
            </h1>

            {task === "menu" ? (
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl">
                <button
                  onClick={() => startTask("task1")}
                  className="bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all flex flex-col items-center border-4 border-amber-200"
                >
                  <span className="text-8xl mb-4">üëï</span>
                  <span className="text-2xl font-black text-slate-700">
                    {getText("task1")}
                  </span>
                </button>
                <button
                  onClick={() => startTask("task2")}
                  className="bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all flex flex-col items-center border-4 border-amber-200"
                >
                  <span className="text-8xl mb-4">üßπ</span>
                  <span className="text-2xl font-black text-slate-700">
                    {getText("task2")}
                  </span>
                </button>
                <button
                  onClick={() => startTask("task3")}
                  className="bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all flex flex-col items-center border-4 border-amber-200"
                >
                  <span className="text-8xl mb-4">üß∏</span>
                  <span className="text-2xl font-black text-slate-700">
                    {getText("task3")}
                  </span>
                </button>
              </div>
            ) : (
              <div className="w-full max-w-3xl">
                <button
                  onClick={() => setTask("menu")}
                  className="mb-4 text-amber-700 font-bold hover:underline"
                >
                  ‚Üê {getText("back")}
                </button>
                <div className="bg-white/50 p-4 md:p-8 rounded-3xl">
                  {task === "task1" && renderTask1()}
                  {task === "task2" && renderTask2()}
                  {task === "task3" && renderTask3()}
                </div>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
