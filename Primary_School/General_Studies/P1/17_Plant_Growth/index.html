<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏ÄÂ∏∏Ë≠òÔºöÊ§çÁâ©ÁîüÈï∑Êó•Ë®ò | Plant Growth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Plant Growth Diary",
          zh: "Ê§çÁâ©ÁîüÈï∑Êó•Ë®ò",
          ja: "Ê§çÁâ©ÊàêÈï∑Êó•Ë®ò",
        },
        instruction: {
          en: "Put the stages in the correct order!",
          zh: "ÊåâÊ≠£Á¢∫È†ÜÂ∫èÊéíÂàóÁîüÈï∑ÈÅéÁ®ãÔºÅ",
          ja: "Ê≠£„Åó„ÅÑÈ†ÜÂ∫è„Å´‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
        },
        stage1: { en: "Seed", zh: "Á®ÆÂ≠ê" },
        stage2: { en: "Sprout", zh: "ÁôºËäΩ" },
        stage3: { en: "Leaves", zh: "Èï∑Ëëâ" },
        stage4: { en: "Flower", zh: "ÈñãËä±" },
        stage5: { en: "Fruit", zh: "ÁµêÊûú" },
        check: { en: "Check", zh: "Ê™¢Êü•" },
        reset: { en: "Reset", zh: "ÈáçÁΩÆ" },
        correct: {
          en: "Correct! The plant grew well!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅÊ§çÁâ©Èï∑ÂæóÂæàÂ•ΩÔºÅ",
        },
        wrong: {
          en: "Something is wrong. Try again!",
          zh: "Ê¨°Â∫è‰∏çÂ∞çÔºåÂÜçË©¶‰∏ÄÊ¨°ÔºÅ",
        },
      };

      const stages = [
        { id: 1, icon: "üü§", label: "stage1", correctPos: 0 },
        { id: 2, icon: "üå±", label: "stage2", correctPos: 1 },
        { id: 3, icon: "üåø", label: "stage3", correctPos: 2 },
        { id: 4, icon: "üåº", label: "stage4", correctPos: 3 },
        { id: 5, icon: "üçì", label: "stage5", correctPos: 4 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [slots, setSlots] = useState([null, null, null, null, null]);
        const [available, setAvailable] = useState([]);
        const [status, setStatus] = useState(null); // 'correct', 'wrong'

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          reset();
        }, []);

        const reset = () => {
          setSlots([null, null, null, null, null]);
          setAvailable([...stages].sort(() => Math.random() - 0.5));
          setStatus(null);
        };

        const handleSelect = (stage) => {
          // Find first empty slot
          const firstEmpty = slots.findIndex((s) => s === null);
          if (firstEmpty !== -1) {
            const newSlots = [...slots];
            newSlots[firstEmpty] = stage;
            setSlots(newSlots);
            setAvailable(available.filter((s) => s.id !== stage.id));
            setStatus(null);
          }
        };

        const handleRemove = (index) => {
          const stage = slots[index];
          if (!stage) return;
          const newSlots = [...slots];
          newSlots[index] = null;
          setSlots(newSlots);
          setAvailable([...available, stage]);
          setStatus(null);
        };

        const checkOrder = () => {
          const isFilled = slots.every((s) => s !== null);
          if (!isFilled) {
            setStatus("wrong"); // Or "Incomplete"
            return;
          }
          const isCorrect = slots.every((s, i) => s.id === stages[i].id);
          if (isCorrect) setStatus("correct");
          else setStatus("wrong");
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-green-800 mb-4 mt-8 drop-shadow-sm">
              üåª {getText("title")}
            </h1>
            <p className="font-bold text-green-700 mb-8">
              {getText("instruction")}
            </p>

            {/* Timeline Slots */}
            <div className="flex gap-2 md:gap-4 mb-8 overflow-x-auto p-4 w-full justify-center">
              {slots.map((s, i) => (
                <div key={i} className="flex items-center">
                  <div
                    onClick={() => handleRemove(i)}
                    className={`w-16 h-24 md:w-24 md:h-32 bg-white rounded-xl border-4 flex flex-col items-center justify-center shadow-inner cursor-pointer ${
                      status === "correct"
                        ? "border-green-500 bg-green-50"
                        : "border-slate-300"
                    }`}
                  >
                    {s ? (
                      <motion.div
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        className="text-center"
                      >
                        <div className="text-4xl mb-1">{s.icon}</div>
                        <div className="text-xs font-bold text-slate-500">
                          {getText(s.label)}
                        </div>
                      </motion.div>
                    ) : (
                      <div className="text-slate-300 font-bold text-xl">
                        {i + 1}
                      </div>
                    )}
                  </div>
                  {i < 4 && (
                    <div className="text-green-300 text-2xl mx-1 font-black">
                      ‚ûú
                    </div>
                  )}
                </div>
              ))}
            </div>

            <div className="flex gap-4 mb-8">
              <button
                onClick={checkOrder}
                className="bg-green-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-green-700"
              >
                {getText("check")} ‚úÖ
              </button>
              <button
                onClick={reset}
                className="bg-white text-slate-500 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-gray-100"
              >
                {getText("reset")} üîÑ
              </button>
            </div>

            {status && (
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                className={`text-2xl font-black mb-6 ${
                  status === "correct" ? "text-green-600" : "text-red-500"
                }`}
              >
                {getText(status)}
              </motion.div>
            )}

            {/* Available Staging */}
            <div className="bg-white/80 p-6 rounded-3xl shadow-xl w-full max-w-3xl flex flex-wrap gap-4 justify-center min-h-[120px]">
              {available.map((s) => (
                <motion.button
                  key={s.id}
                  layoutId={s.id}
                  onClick={() => handleSelect(s)}
                  className="w-20 h-24 bg-green-50 rounded-xl border-2 border-green-200 flex flex-col items-center justify-center hover:scale-105 active:scale-95 shadow-md"
                >
                  <div className="text-4xl mb-1">{s.icon}</div>
                  <div className="text-xs font-bold text-green-800">
                    {getText(s.label)}
                  </div>
                </motion.button>
              ))}
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
