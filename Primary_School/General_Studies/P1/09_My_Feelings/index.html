<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸€å¸¸è­˜ï¼šå¿ƒæƒ…è®Šè®Šè®Š | My Feelings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "My Feelings",
          zh: "å¿ƒæƒ…è®Šè®Šè®Š",
          ja: "ç§ã®æ°—æŒã¡",
        },
        instruction: {
          en: "How do they feel?",
          zh: "ä»–å€‘è¦ºå¾—æ€æ¨£ï¼Ÿ",
          ja: "å½¼ã‚‰ã¯ã©ã†æ„Ÿã˜ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        },
        correct: { en: "Correct!", zh: "ç­”å°äº†ï¼" },
        wrong: { en: "Try Again", zh: "å†è©¦ä¸€æ¬¡" },
        happy: { en: "Happy", zh: "é–‹å¿ƒ" },
        sad: { en: "Sad", zh: "å‚·å¿ƒ" },
        angry: { en: "Angry", zh: "ç”Ÿæ°£" },
        scared: { en: "Scared", zh: "å®³æ€•" },
        surprised: { en: "Surprised", zh: "é©šè¨" },

        q1: { en: "I got a birthday present!", zh: "æˆ‘æ”¶åˆ°äº†ç”Ÿæ—¥ç¦®ç‰©ï¼" },
        q2: { en: "I lost my favorite toy.", zh: "æˆ‘ä¸è¦‹äº†æœ€å¿ƒæ„›çš„ç©å…·ã€‚" },
        q3: { en: "Someone pushed me.", zh: "æœ‰äººæ¨æ’æˆ‘ã€‚" },
        q4: { en: "I saw a big spider!", zh: "æˆ‘çœ‹è¦‹ä¸€éš»å¤§èœ˜è››ï¼" },
        q5: { en: "Wow! A double rainbow!", zh: "å“‡ï¼æ˜¯é›™å½©è™¹ï¼" },

        completed: { en: "You know feelings well!", zh: "ä½ å¾ˆäº†è§£æƒ…ç·’ï¼" },
        restart: { en: "Play Again", zh: "å†ç©ä¸€æ¬¡" },
      };

      const questions = [
        { id: "q1", answer: "happy", emo: "ğŸ˜Š" },
        { id: "q2", answer: "sad", emo: "ğŸ˜¢" },
        { id: "q3", answer: "angry", emo: "ğŸ˜¡" },
        { id: "q4", answer: "scared", emo: "ğŸ˜±" },
        { id: "q5", answer: "surprised", emo: "ğŸ˜²" },
      ];

      const options = [
        { id: "happy", emo: "ğŸ˜Š" },
        { id: "sad", emo: "ğŸ˜¢" },
        { id: "angry", emo: "ğŸ˜¡" },
        { id: "scared", emo: "ğŸ˜±" },
        { id: "surprised", emo: "ğŸ˜²" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [idx, setIdx] = useState(0);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];
        const currentQ = questions[idx];

        const handleAnswer = (optId) => {
          if (feedback === "correct") return;
          if (optId === currentQ.answer) {
            setFeedback("correct");
            setTimeout(() => {
              setFeedback(null);
              if (idx < questions.length - 1) setIdx(idx + 1);
              else setIdx(-1);
            }, 1000);
          } else {
            setFeedback("wrong");
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        const restart = () => {
          setIdx(0);
          setFeedback(null);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-orange-900 mb-8 mt-8 drop-shadow-sm">
              ğŸ­ {getText("title")}
            </h1>

            {idx !== -1 ? (
              <div className="w-full max-w-2xl flex flex-col items-center">
                {/* Scenario Card */}
                <motion.div
                  key={currentQ.id}
                  initial={{ scale: 0.9, opacity: 0 }}
                  animate={{ scale: 1, opacity: 1 }}
                  className="bg-white rounded-3xl p-8 shadow-xl text-center border-4 border-orange-200 mb-8 w-full min-h-[200px] flex flex-col justify-center"
                >
                  <p className="text-3xl font-bold text-slate-800">
                    {getText(currentQ.id)}
                  </p>
                </motion.div>

                {/* Feedback */}
                <div className="h-12 mb-4">
                  {feedback && (
                    <motion.div
                      initial={{ y: 20, opacity: 0 }}
                      animate={{ y: 0, opacity: 1 }}
                      className={`text-3xl font-black ${
                        feedback === "correct"
                          ? "text-green-500"
                          : "text-red-500"
                      }`}
                    >
                      {getText(feedback)}
                    </motion.div>
                  )}
                </div>

                <p className="text-slate-500 font-bold mb-4">
                  {getText("instruction")}
                </p>

                {/* Options Grid */}
                <div className="grid grid-cols-3 md:grid-cols-5 gap-4 w-full">
                  {options.map((opt) => (
                    <motion.button
                      key={opt.id}
                      onClick={() => handleAnswer(opt.id)}
                      whileHover={{ scale: 1.1 }}
                      whileTap={{ scale: 0.9 }}
                      className="bg-white rounded-2xl p-4 shadow-md border-2 border-slate-100 flex flex-col items-center aspect-square justify-center hover:border-orange-300 transition-colors"
                    >
                      <span className="text-5xl mb-2">{opt.emo}</span>
                      <span className="text-xs md:text-sm font-bold text-slate-600">
                        {getText(opt.id)}
                      </span>
                    </motion.button>
                  ))}
                </div>
              </div>
            ) : (
              <div className="text-center mt-20">
                <div className="text-9xl mb-6">ğŸ’–</div>
                <h2 className="text-4xl font-black text-orange-800 mb-8">
                  {getText("completed")}
                </h2>
                <button
                  onClick={restart}
                  className="bg-orange-500 text-white px-10 py-4 rounded-full font-black text-2xl hover:bg-orange-600 shadow-xl"
                >
                  {getText("restart")} ğŸ”„
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
