<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∏ÄÂ∏∏Ë≠òÔºöÂÆ∂Â±ÖÂÆâÂÖ®ÊâæÈåØËôï | Home Safety</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Home Safety Hunt",
          zh: "ÂÆ∂Â±ÖÂÆâÂÖ®ÊâæÈåØËôï",
          ja: "ÂÆ∂Â∫≠„ÅÆÂÆâÂÖ®Êé¢„Åó",
        },
        instruction: {
          en: "Find 5 dangerous things!",
          zh: "ÊâæÂá∫ 5 ÂÄãÂç±Èö™ÁöÑÂú∞ÊñπÔºÅ",
          ja: "5„Å§„ÅÆÂç±Èô∫„Å™Â†¥ÊâÄ„ÇíË¶ã„Å§„Åë„Çà„ÅÜÔºÅ",
        },
        found: { en: "Found:", zh: "Â∑≤ÊâæÂà∞Ôºö" },
        h1: { en: "Hot Kettle (Scald)", zh: "ÁÜ±Ê∞¥Â£∫ÊîæÂæóÂ§™‰Ωé (ÁáôÂÇ∑)" },
        h2: { en: "Wet Floor (Slip)", zh: "Âú∞ÊùøÊøïÊªë (ÊªëÂÄí)" },
        h3: { en: "Knife on Edge (Cut)", zh: "ÂàÄÊîæÂú®ÈÇäÁ∑£ (Ââ≤ÂÇ∑)" },
        h4: { en: "Toys on Stairs (Trip)", zh: "Áé©ÂÖ∑ÊîæÂú®Ê®ìÊ¢Ø (ÁµÜÂÄí)" },
        h5: { en: "Overloaded Socket (Fire)", zh: "ÊèíÂ∫ßÈÅéËºâ (ÁÅ´ÁÅΩ)" },

        safe: { en: "Safe now!", zh: "ÁèæÂú®ÂÆâÂÖ®‰∫ÜÔºÅ" },
        completed: { en: "Great Job! Stay Safe!", zh: "ÂÅöÂæóÂ•ΩÔºÅÊ≥®ÊÑèÂÆâÂÖ®ÔºÅ" },
        restart: { en: "Play Again", zh: "ÂÜçÁé©‰∏ÄÊ¨°" },
      };

      const hazards = [
        {
          id: "h1",
          icon: "ü´ñ",
          dangerIcon: "üî•",
          x: 20,
          y: 60,
          explanation: "h1",
        },
        {
          id: "h2",
          icon: "üíß",
          dangerIcon: "‚ö†Ô∏è",
          x: 50,
          y: 80,
          explanation: "h2",
        },
        {
          id: "h3",
          icon: "üî™",
          dangerIcon: "ü©∏",
          x: 80,
          y: 55,
          explanation: "h3",
        },
        {
          id: "h4",
          icon: "üß∏",
          dangerIcon: "ü§ï",
          x: 10,
          y: 80,
          explanation: "h4",
        },
        {
          id: "h5",
          icon: "üîå",
          dangerIcon: "‚ö°",
          x: 90,
          y: 70,
          explanation: "h5",
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [found, setFound] = useState([]);
        const [lastMsg, setLastMsg] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        const handleFound = (id) => {
          if (found.includes(id)) return;
          setFound([...found, id]);
          setLastMsg(getText(hazards.find((h) => h.id === id).explanation));
        };

        const reset = () => {
          setFound([]);
          setLastMsg(null);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-red-800 mb-2 mt-8 drop-shadow-sm">
              üè† {getText("title")}
            </h1>

            <div className="bg-white px-8 py-3 rounded-full shadow-lg border-2 border-red-200 mb-6 font-bold text-red-600 flex gap-4">
              <span>
                {getText("found")} {found.length} / {hazards.length}
              </span>
            </div>

            {/* Scene Container */}
            <div className="relative w-full max-w-4xl h-[400px] md:h-[500px] bg-amber-50 rounded-3xl border-8 border-amber-200 shadow-2xl overflow-hidden cursor-crosshair">
              {/* Background Furniture (Abstract) */}
              <div className="absolute bottom-0 w-full h-32 bg-amber-200/50"></div>{" "}
              {/* Floor */}
              <div className="absolute top-20 left-10 w-40 h-60 bg-amber-100 border-4 border-amber-300 rounded-t-full"></div>{" "}
              {/* Window/Door */}
              <div className="absolute top-40 right-20 w-60 h-40 bg-zinc-200 rounded-xl border-4 border-zinc-300"></div>{" "}
              {/* Table */}
              <div className="absolute top-40 left-0 w-20 h-full bg-orange-100 border-r-4 border-orange-200 transform -skew-y-12 origin-bottom-left"></div>{" "}
              {/* Stairs approximation */}
              {/* Hazards */}
              {hazards.map((h) => {
                const isFix = found.includes(h.id);
                return (
                  <div
                    key={h.id}
                    onClick={() => handleFound(h.id)}
                    className="absolute cursor-pointer transition-transform hover:scale-110"
                    style={{ left: `${h.x}%`, top: `${h.y}%` }}
                  >
                    <AnimatePresence mode="wait">
                      {!isFix ? (
                        <motion.div
                          key="danger"
                          initial={{ scale: 0 }}
                          animate={{ scale: 1 }}
                          exit={{ scale: 0 }}
                          className="relative"
                        >
                          <span className="text-6xl md:text-7xl filter drop-shadow-lg">
                            {h.icon}
                          </span>
                          <motion.span
                            animate={{ opacity: [1, 0.5, 1] }}
                            transition={{ repeat: Infinity, duration: 1 }}
                            className="absolute -top-2 -right-2 text-3xl"
                          >
                            {h.dangerIcon}
                          </motion.span>
                        </motion.div>
                      ) : (
                        <motion.div
                          key="safe"
                          initial={{ scale: 0 }}
                          animate={{ scale: 1 }}
                          className="text-6xl md:text-7xl opacity-50 grayscale flex flex-col items-center"
                        >
                          {/* Fixed state */}
                          <span>{h.icon}</span>
                          <span className="text-green-500 text-3xl absolute -top-4 font-black">
                            ‚úì
                          </span>
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>
                );
              })}
              {/* Message Overlay */}
              <AnimatePresence>
                {lastMsg && (
                  <motion.div
                    key={lastMsg}
                    initial={{ y: 50, opacity: 0 }}
                    animate={{ y: 0, opacity: 1 }}
                    exit={{ y: 20, opacity: 0 }}
                    className="absolute bottom-8 left-0 right-0 mx-auto max-w-md bg-red-600 text-white p-4 rounded-xl shadow-xl text-center z-10 font-bold"
                  >
                    ‚ö†Ô∏è {lastMsg}
                  </motion.div>
                )}
              </AnimatePresence>
            </div>

            {found.length === hazards.length && (
              <div className="mt-8 text-center bg-white/50 p-8 rounded-3xl backdrop-blur">
                <div className="text-7xl mb-4">üõ°Ô∏è</div>
                <h2 className="text-3xl font-black text-red-800 mb-6">
                  {getText("completed")}
                </h2>
                <button
                  onClick={reset}
                  className="bg-red-500 text-white px-8 py-3 rounded-full font-black text-xl hover:bg-red-600 shadow-xl"
                >
                  {getText("restart")} üîÑ
                </button>
              </div>
            )}

            <p className="mt-4 text-red-400 font-bold">
              {getText("instruction")}
            </p>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
