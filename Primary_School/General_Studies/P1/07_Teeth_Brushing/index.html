<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸€å¸¸è­˜ï¼šåˆ·ç‰™ç‰¹å·¥éšŠ | Teeth Brushing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #e0f2fe 0%, #38bdf8 100%);
        cursor: none; /* Custom cursor */
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Teeth Brushing Squad",
          zh: "åˆ·ç‰™ç‰¹å·¥éšŠ",
          ja: "æ­¯ç£¨ãéšŠ",
        },
        instruction: {
          en: "Move the toothbrush to clean the germs!",
          zh: "ç§»å‹•ç‰™åˆ·æ¸…é™¤ç´°èŒï¼",
          ja: "æ­¯ãƒ–ãƒ©ã‚·ã‚’å‹•ã‹ã—ã¦ãƒã‚¤ã‚­ãƒ³ã‚’æ¶ˆãã†ï¼",
        },
        clean: { en: "Sparkling Clean!", zh: "äº®æ™¶æ™¶ï¼" },
        restart: { en: "Brush Again", zh: "å†åˆ·ä¸€æ¬¡" },
      };

      // Generate teeth positions
      const teethConfig = [
        // Top Row
        { id: 1, x: 50, y: 100 },
        { id: 2, x: 100, y: 90 },
        { id: 3, x: 150, y: 85 },
        { id: 4, x: 200, y: 85 },
        { id: 5, x: 250, y: 90 },
        { id: 6, x: 300, y: 100 },
        // Bottom Row
        { id: 7, x: 60, y: 220 },
        { id: 8, x: 100, y: 230 },
        { id: 9, x: 150, y: 240 },
        { id: 10, x: 200, y: 240 },
        { id: 11, x: 250, y: 230 },
        { id: 12, x: 290, y: 220 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [germs, setGerms] = useState([]);
        const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
        const [completed, setCompleted] = useState(false);
        const containerRef = useRef(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          resetGerms();
          const handleMouseMove = (e) => {
            setMousePos({ x: e.clientX, y: e.clientY });
            checkCollision(e.clientX, e.clientY);
          };
          const handleTouchMove = (e) => {
            if (e.touches.length > 0) {
              const t = e.touches[0];
              setMousePos({ x: t.clientX, y: t.clientY });
              checkCollision(t.clientX, t.clientY);
            }
          };
          window.addEventListener("mousemove", handleMouseMove);
          window.addEventListener("touchmove", handleTouchMove);
          return () => {
            window.removeEventListener("mousemove", handleMouseMove);
            window.removeEventListener("touchmove", handleTouchMove);
          };
        }, []); // Depend on nothing for initial binding, but checkCollision uses state... oops.

        // Fix stale closure for collision
        const germsRef = useRef(germs);
        useEffect(() => {
          germsRef.current = germs;
        }, [germs]);

        const resetGerms = () => {
          const newGerms = [];
          teethConfig.forEach((tooth) => {
            // 1-3 germs per tooth
            const count = Math.floor(Math.random() * 2) + 1;
            for (let i = 0; i < count; i++) {
              newGerms.push({
                id: `${tooth.id}_${i}`,
                x:
                  tooth.x +
                  (Math.random() * 30 - 15) +
                  (window.innerWidth > 600 ? window.innerWidth / 2 - 175 : 20), // Approx centering
                y: tooth.y + (Math.random() * 30 - 15) + 100,
                isClean: false,
              });
            }
          });
          setGerms(newGerms);
          setCompleted(false);
        };

        const checkCollision = (mx, my) => {
          // Check collision with germs
          // Assuming simplified circle collision
          let changed = false;
          const currentGerms = germsRef.current;
          const nextGerms = currentGerms.map((g) => {
            if (g.isClean) return g;
            const dist = Math.sqrt(
              Math.pow(mx - g.x, 2) + Math.pow(my - g.y, 2)
            );
            if (dist < 30) {
              // Brush radius
              changed = true;
              return { ...g, isClean: true };
            }
            return g;
          });

          if (changed) {
            setGerms(nextGerms);
            if (nextGerms.every((g) => g.isClean)) {
              setCompleted(true);
            }
          }
        };

        return (
          <div
            ref={containerRef}
            className="min-h-screen relative overflow-hidden flex flex-col items-center select-none cursor-none"
          >
            {/* Custom Cursor Brush */}
            <div
              className="fixed pointer-events-none z-50 text-6xl"
              style={{
                left: mousePos.x - 20,
                top: mousePos.y - 40,
                transform: "rotate(-45deg)",
              }}
            >
              ğŸª¥
            </div>

            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-blue-900 mb-4 mt-8 drop-shadow-sm select-auto">
              ğŸ¦· {getText("title")}
            </h1>
            <p className="text-xl font-bold text-blue-700 mb-8 select-auto">
              {getText("instruction")}
            </p>

            <div className="relative w-[360px] h-[400px] bg-red-100 rounded-full border-8 border-red-200 shadow-inner flex items-center justify-center">
              {/* Teeth Container */}
              <div className="relative w-full h-full">
                {/* Render Basic Teeth Background */}
                {teethConfig.map((t) => (
                  <div
                    key={t.id}
                    className="absolute w-12 h-14 bg-white rounded-xl border-2 border-slate-200 shadow-sm"
                    style={{
                      left:
                        t.x + (window.innerWidth > 600 ? (360 - 350) / 2 : 0), // Basic positioning logic
                      top: t.y - 50,
                    }}
                  />
                ))}

                {/* Render Germs */}
                {germs.map(
                  (g) =>
                    !g.isClean && (
                      <motion.div
                        key={g.id}
                        className="absolute text-2xl"
                        style={{
                          // Adjust back to relative coordinates of container roughly
                          left:
                            g.x -
                            (window.innerWidth > 600
                              ? window.innerWidth / 2 - 175
                              : 20),
                          top: g.y - 150,
                        }}
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        exit={{ scale: 0, opacity: 0 }}
                      >
                        ğŸ¦ 
                      </motion.div>
                    )
                )}
                {/* Overlay for Bubbles/Sparkles when clean */}
                <AnimatePresence>
                  {germs.map(
                    (g) =>
                      g.isClean && (
                        <motion.div
                          key={g.id + "clean"}
                          className="absolute text-xl pointer-events-none"
                          style={{
                            left:
                              g.x -
                              (window.innerWidth > 600
                                ? window.innerWidth / 2 - 175
                                : 20),
                            top: g.y - 150,
                          }}
                          initial={{ scale: 0, opacity: 1 }}
                          animate={{ scale: 1.5, opacity: 0, y: -20 }}
                          transition={{ duration: 0.5 }}
                        >
                          âœ¨
                        </motion.div>
                      )
                  )}
                </AnimatePresence>
              </div>
            </div>

            {completed && (
              <div className="fixed inset-0 bg-white/80 backdrop-blur z-40 flex flex-col items-center justify-center cursor-auto">
                <div className="text-8xl mb-4">ğŸ˜</div>
                <h2 className="text-4xl font-black text-blue-600 mb-8">
                  {getText("clean")}
                </h2>
                <button
                  onClick={resetGerms}
                  className="bg-blue-500 text-white px-10 py-4 rounded-full font-black text-2xl hover:bg-blue-600 shadow-xl cursor-pointer"
                >
                  {getText("restart")} ğŸ”„
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          ã€Œè€¶å’Œè¯ç”¨èƒ½åŠ›å‰µé€ å¤§åœ°ï¼Œç”¨æ™ºæ…§å»ºç«‹ä¸–ç•Œï¼Œç”¨è°æ˜é‹ªå¼µç©¹è’¼ã€‚ã€ è€¶åˆ©ç±³æ›¸ 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
