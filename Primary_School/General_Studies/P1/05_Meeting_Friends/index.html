<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ä¸€å¸¸è­˜ï¼šèªè­˜æˆ‘çš„å¥½åŒå­¸ | Meeting Friends</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Meeting Friends",
          zh: "èªè­˜æˆ‘çš„å¥½åŒå­¸",
          ja: "å‹é”ä½œã‚Š",
          ko: "ì¹œêµ¬ ë§Œë‚˜ê¸°",
          es: "Conocer amigos",
          de: "Freunde treffen",
          fi: "YstÃ¤vien tapaaminen",
          fr: "Rencontrer des amis",
          ar: "Ù„Ù‚Ø§Ø¡ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡",
          it: "Incontrare amici",
        },
        friendship: {
          en: "Friendship",
          zh: "å‹èª¼å€¼",
          es: "Amistad",
          de: "Freundschaft",
          fi: "YstÃ¤vyys",
          fr: "AmitiÃ©",
          ar: "ØµØ¯Ø§Ù‚Ø©",
          it: "Amicizia",
        },
        next: {
          en: "Next",
          zh: "ç¹¼çºŒ",
          es: "Siguiente",
          de: "Weiter",
          fi: "Seuraava",
          fr: "Suivant",
          ar: "Ø§Ù„ØªØ§Ù„ÙŠ",
          it: "Avanti",
        },
        restart: {
          en: "Play Again",
          zh: "å†ç©ä¸€æ¬¡",
          es: "Jugar de nuevo",
          de: "Nochmal spielen",
          fi: "Pelaa uudelleen",
          fr: "Rejouer",
          ar: "Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",
          it: "Gioca di nuovo",
        },
        s1_desc: {
          en: "It's morning. You see a classmate.",
          zh: "æ—©ä¸Šï¼Œä½ çœ‹è¦‹ä¸€ä½åŒå­¸ã€‚",
          es: "Es de maÃ±ana. Ves a un compaÃ±ero de clase.",
          de: "Es ist Morgen. Du siehst einen Klassenkameraden.",
          fi: "On aamu. NÃ¤et luokkatoverin.",
          fr: "C'est le matin. Vous voyez un camarade de classe.",
          ar: "Ø¥Ù†Ù‡ Ø§Ù„ØµØ¨Ø§Ø­. ØªØ±Ù‰ Ø²Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØµÙ„.",
          it: "Ãˆ mattina. Vedi un compagno di classe.",
        },
        s1_opt1: {
          en: "Say 'Good Morning!'",
          zh: "èªªã€Œæ—©æ™¨ï¼ã€",
          es: "Decir 'Â¡Buenos dÃ­as!'",
          de: "Sag 'Guten Morgen!'",
          fi: "Sano 'HyvÃ¤Ã¤ huomenta!'",
          fr: "Dire 'Bonjour !'",
          ar: "Ù‚Ù„ 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±!'",
          it: "DÃ¬ 'Buongiorno!'",
        },
        s1_opt2: {
          en: "Walk away",
          zh: "è½‰èº«èµ°é–‹",
          es: "Alejarse",
          de: "Weggehen",
          fi: "KÃ¤vele pois",
          fr: "S'Ã©loigner",
          ar: "Ø§Ø¨ØªØ¹Ø¯",
          it: "Allontanati",
        },
        s1_opt3: {
          en: "Stick out your tongue",
          zh: "å‘ä»–åšé¬¼è‡‰",
          es: "Sacar la lengua",
          de: "Zunge rausstrecken",
          fi: "NÃ¤ytÃ¤ kieltÃ¤",
          fr: "Tirer la langue",
          ar: "Ø£Ø®Ø±Ø¬ Ù„Ø³Ø§Ù†Ùƒ",
          it: "Tira fuori la lingua",
        },

        s2_desc: {
          en: "A classmate forgot their pencil.",
          zh: "æœ‰åŒå­¸å¿˜è¨˜å¸¶é‰›ç­†ã€‚",
          es: "Un compaÃ±ero de clase olvidÃ³ su lÃ¡piz.",
          de: "Ein Klassenkamerad hat seinen Bleistift vergessen.",
          fi: "Luokkatoveri unohti kynÃ¤nsÃ¤.",
          fr: "Un camarade a oubliÃ© son crayon.",
          ar: "Ù†Ø³ÙŠ Ø²Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØµÙ„ Ù‚Ù„Ù…Ù‡.",
          it: "Un compagno di classe ha dimenticato la matita.",
        },
        s2_opt1: {
          en: "Laugh at clearly",
          zh: "å˜²ç¬‘ä»–",
          es: "ReÃ­rse claramente",
          de: "Laut auslachen",
          fi: "Naurata selvÃ¤sti",
          fr: "Rire ouvertement",
          ar: "Ø§Ø¶Ø­Ùƒ Ø¨ÙˆØ¶ÙˆØ­",
          it: "Ridi chiaramente",
        },
        s2_opt2: {
          en: "Lend him a pencil",
          zh: "å€Ÿä»–ä¸€æ”¯é‰›ç­†",
          es: "Prestarle un lÃ¡piz",
          de: "Ihm einen Bleistift leihen",
          fi: "Lainaa hÃ¤nelle kynÃ¤",
          fr: "Lui prÃªter un crayon",
          ar: "Ø£Ø¹ÙŠØ±Ù‡ Ù‚Ù„Ù… Ø±ØµØ§Øµ",
          it: "Prestagli una matita",
        },
        s2_opt3: {
          en: "Ignore him",
          zh: "ä¸ç†æœƒ",
          es: "Ignorarlo",
          de: "Ihn ignorieren",
          fi: "JÃ¤tÃ¤ hÃ¤net huomiotta",
          fr: "L'ignorer",
          ar: "ØªØ¬Ø§Ù‡Ù„Ù‡",
          it: "Ignoralo",
        },

        s3_desc: {
          en: "You accidentally bumped into someone.",
          zh: "ä½ ä¸å°å¿ƒæ’åˆ°äº†åŒå­¸ã€‚",
          es: "Chocaste accidentalmente con alguien.",
          de: "Du bist versehentlich mit jemandem zusammengestoÃŸen.",
          fi: "TÃ¶rmÃ¤sit vahingossa johonkuhun.",
          fr: "Vous avez accidentellement bousculÃ© quelqu'un.",
          ar: "Ù„Ù‚Ø¯ Ø§ØµØ·Ø¯Ù…Øª Ø¨Ø´Ø®Øµ Ù…Ø§ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø®Ø·Ø£.",
          it: "Hai urtato accidentalmente qualcuno.",
        },
        s3_opt1: {
          en: "Run away fast",
          zh: "ç«‹åˆ»è·‘èµ°",
          es: "Huir rÃ¡pido",
          de: "Schnell weglaufen",
          fi: "Juokse karkuun nopeasti",
          fr: "S'enfuir vite",
          ar: "Ø§Ù‡Ø±Ø¨ Ø¨Ø³Ø±Ø¹Ø©",
          it: "Scappa velocemente",
        },
        s3_opt2: {
          en: "Say 'Watch out!'",
          zh: "èªªã€Œå°å¿ƒé»ï¼ã€",
          es: "Decir 'Â¡Cuidado!'",
          de: "Sag 'Pass auf!'",
          fi: "Sano 'Varo!'",
          fr: "Dire 'Fais attention !'",
          ar: "Ù‚Ù„ 'Ø§Ù†ØªØ¨Ù‡!'",
          it: "DÃ¬ 'Attento!'",
        },
        s3_opt3: {
          en: "Say 'Sorry!'",
          zh: "èªªã€Œå°ä¸èµ·ï¼ã€",
          es: "Decir 'Â¡Lo siento!'",
          de: "Sag 'Entschuldigung!'",
          fi: "Sano 'Anteeksi!'",
          fr: "Dire 'Pardon !'",
          ar: "Ù‚Ù„ 'Ø¢Ø³Ù!'",
          it: "DÃ¬ 'Scusa!'",
        },

        res_good: {
          en: "They are happy! (+Friendship)",
          zh: "ä»–å¾ˆé–‹å¿ƒï¼(+å‹èª¼å€¼)",
          es: "Â¡EstÃ¡n felices! (+Amistad)",
          de: "Sie sind glÃ¼cklich! (+Freundschaft)",
          fi: "He ovat onnellisia! (+YstÃ¤vyys)",
          fr: "Ils sont contents ! (+AmitiÃ©)",
          ar: "Ù‡Ù… Ø³Ø¹Ø¯Ø§Ø¡! (+ØµØ¯Ø§Ù‚Ø©)",
          it: "Sono felici! (+Amicizia)",
        },
        res_bad: {
          en: "They are sad... (-Friendship)",
          zh: "ä»–å¾ˆå‚·å¿ƒ... (-å‹èª¼å€¼)",
          es: "EstÃ¡n tristes... (-Amistad)",
          de: "Sie sind traurig... (-Freundschaft)",
          fi: "He ovat surullisia... (-YstÃ¤vyys)",
          fr: "Ils sont tristes... (-AmitiÃ©)",
          ar: "Ø¥Ù†Ù‡Ù… Ø­Ø²ÙŠÙ†ÙˆÙ†... (-ØµØ¯Ø§Ù‚Ø©)",
          it: "Sono tristi... (-Amicizia)",
        },
        res_neutral: {
          en: "Nothing happened.",
          zh: "æ²’æœ‰ç‰¹åˆ¥çš„äº‹æƒ…ç™¼ç”Ÿã€‚",
          es: "No pasÃ³ nada.",
          de: "Nichts ist passiert.",
          fi: "MitÃ¤Ã¤n ei tapahtunut.",
          fr: "Rien ne s'est passÃ©.",
          ar: "Ù„Ù… ÙŠØ­Ø¯Ø« Ø´ÙŠØ¡.",
          it: "Non Ã¨ successo niente.",
        },

        final_win: {
          en: "You made great friends!",
          zh: "ä½ çµè­˜äº†å¥½æœ‹å‹ï¼",
          es: "Â¡Hiciste grandes amigos!",
          de: "Du hast tolle Freunde gefunden!",
          fi: "Sait hyviÃ¤ ystÃ¤viÃ¤!",
          fr: "Tu t'es fait de super amis !",
          ar: "Ù„Ù‚Ø¯ ÙƒÙˆÙ†Øª Ø£ØµØ¯Ù‚Ø§Ø¡ Ø±Ø§Ø¦Ø¹ÙŠÙ†!",
          it: "Ti sei fatto dei grandi amici!",
        },
        final_lose: {
          en: "Try to be nicer next time.",
          zh: "ä¸‹æ¬¡å˜—è©¦å°äººå¥½ä¸€é»å§ã€‚",
          es: "Intenta ser mÃ¡s amable la prÃ³xima vez.",
          de: "Versuche beim nÃ¤chsten Mal netter zu sein.",
          fi: "YritÃ¤ olla mukavampi ensi kerralla.",
          fr: "Essaie d'Ãªtre plus gentil la prochaine fois.",
          ar: "Ø­Ø§ÙˆÙ„ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ù„Ø·Ù ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.",
          it: "Cerca di essere piÃ¹ gentile la prossima volta.",
        },
      };

      const scenarios = [
        {
          id: "s1",
          char: "ğŸ‘¦",
          bg: "bg-blue-100",
          options: [
            { id: "opt1", score: 20, fb: "res_good" },
            { id: "opt2", score: 0, fb: "res_neutral" },
            { id: "opt3", score: -10, fb: "res_bad" },
          ],
        },
        {
          id: "s2",
          char: "ğŸ‘§",
          bg: "bg-pink-100",
          options: [
            { id: "opt1", score: -20, fb: "res_bad" },
            { id: "opt2", score: 20, fb: "res_good" },
            { id: "opt3", score: 0, fb: "res_neutral" },
          ],
        },
        {
          id: "s3",
          char: "ğŸ§’",
          bg: "bg-green-100",
          options: [
            { id: "opt1", score: -10, fb: "res_bad" },
            { id: "opt2", score: -10, fb: "res_bad" },
            { id: "opt3", score: 20, fb: "res_good" },
          ],
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [index, setIndex] = useState(0);
        const [friendship, setFriendship] = useState(50); // Start middle
        const [showResult, setShowResult] = useState(null); // null or {score, fb}

        const getText = (key) => t[key][lang] || t[key]["en"];
        const scene = scenarios[index];

        const handleChoice = (opt) => {
          setFriendship((f) => Math.min(100, Math.max(0, f + opt.score)));
          setShowResult({ score: opt.score, fb: opt.fb });
        };

        const nextScene = () => {
          setShowResult(null);
          if (index < scenarios.length - 1) {
            setIndex(index + 1);
          } else {
            setIndex(-1); // End
          }
        };

        const restart = () => {
          setIndex(0);
          setFriendship(50);
          setShowResult(null);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />

            {/* Header Meter */}
            <div className="w-full max-w-lg bg-white rounded-full h-8 border-2 border-slate-300 relative mt-16 shadow-md overflow-hidden">
              <motion.div
                className="h-full bg-gradient-to-r from-red-400 via-yellow-400 to-green-400"
                animate={{ width: `${friendship}%` }}
              />
              <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-slate-700 shadow-white drop-shadow-md">
                {getText("friendship")}
              </div>
            </div>

            {index !== -1 ? (
              <div className="w-full max-w-lg mt-8 flex-1 flex flex-col justify-end pb-8">
                {/* Character Area */}
                <div
                  className={`flex-1 rounded-t-3xl border-x-4 border-t-4 border-slate-200 flex items-end justify-center pb-0 overflow-hidden relative ${scene.bg}`}
                >
                  <div className="absolute top-4 left-4 text-slate-400 text-6xl opacity-20">
                    ğŸ«
                  </div>
                  <motion.div
                    key={index}
                    initial={{ y: 50, opacity: 0 }}
                    animate={{ y: 0, opacity: 1 }}
                    className="text-[150px] leading-none filter drop-shadow-xl"
                  >
                    {scene.char}
                  </motion.div>
                </div>

                {/* Dialog Box */}
                <div className="bg-white rounded-b-3xl border-4 border-slate-200 p-6 shadow-xl z-10">
                  <p className="text-xl font-bold text-slate-700 mb-6 min-h-[3rem]">
                    {showResult
                      ? getText(showResult.fb)
                      : getText(`${scene.id}_desc`)}
                  </p>

                  {!showResult ? (
                    <div className="space-y-3">
                      {scene.options.map((opt) => (
                        <button
                          key={opt.id}
                          onClick={() => handleChoice(opt)}
                          className="w-full bg-sky-100 hover:bg-sky-200 text-sky-800 font-bold py-4 rounded-xl text-lg text-left px-6 border-2 border-sky-200 transition-colors"
                        >
                          {getText(`${scene.id}_${opt.id}`)}
                        </button>
                      ))}
                    </div>
                  ) : (
                    <button
                      onClick={nextScene}
                      className="w-full bg-indigo-500 text-white font-black py-4 rounded-xl text-xl hover:bg-indigo-600 shadow-lg"
                    >
                      {getText("next")} â¡ï¸
                    </button>
                  )}
                </div>
              </div>
            ) : (
              <div className="mt-20 text-center">
                <div className="text-9xl mb-6">
                  {friendship >= 60 ? "ğŸ¥°" : "ğŸ˜Ÿ"}
                </div>
                <h2 className="text-4xl font-black text-slate-800 mb-4">
                  {friendship >= 60
                    ? getText("final_win")
                    : getText("final_lose")}
                </h2>
                <div className="text-2xl font-bold text-slate-500 mb-10">
                  {getText("friendship")}: {friendship}/100
                </div>
                <button
                  onClick={restart}
                  className="bg-indigo-500 text-white px-10 py-4 rounded-full font-black text-2xl hover:bg-indigo-600 shadow-xl"
                >
                  {getText("restart")} ğŸ”„
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
