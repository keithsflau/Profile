<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Respiratory Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #fdf4ff;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Breathing Experiment",
          zh: "å‘¼å¸å¯¦é©—",
          ja: "å‘¼å¸å®Ÿé¨“",
          ko: "í˜¸í¡ ì‹¤í—˜",
          es: "Experimento de respiraciÃ³n",
          de: "Atmungsexperiment",
          fi: "Hengityskoe",
          fr: "ExpÃ©rience respiratoire",
          ar: "ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙ†ÙØ³",
          it: "Esperimento di Respirazione",
        },
        instruction: {
          en: "Pull the Diaphragm down to inhale!",
          zh: "å‘ä¸‹æ‹‰æ©«è†ˆè†œä»¥å¸æ°£ï¼",
          ja: "æ¨ªéš”è†œã‚’ä¸‹ã«å¼•ã„ã¦æ¯ã‚’å¸ã„ã¾ã™ï¼",
          ko: "íš¡ê²½ë§‰ì„ ì•„ëž˜ë¡œ ë‹¹ê²¨ ìˆ¨ì„ ë“¤ì´ë§ˆì‹œì„¸ìš”!",
          es: "Â¡Tira del diafragma hacia abajo para inhalar!",
          de: "Ziehe das Zwerchfell nach unten, um einzuatmen!",
          fi: "VedÃ¤ palleaa alas hengittÃ¤Ã¤ksesi!",
          fr: "Tirez le diaphragme vers le bas pour inspirer !",
          ar: "Ø§Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¬Ø§Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø² Ù„Ù„Ø£Ø³ÙÙ„ Ù„Ù„Ø§Ø³ØªÙ†Ø´Ø§Ù‚!",
          it: "Tira il diaframma verso il basso per inalare!",
        },
        inhale: {
          en: "Inhale (Breathe In)",
          zh: "å¸æ°£",
          ja: "å¸æ°—",
          ko: "í¡ìž…",
          es: "Inhalar",
          de: "Einatmen",
          fi: "SisÃ¤Ã¤nhengitys",
          fr: "Inspirer",
          ar: "Ø§Ø³ØªÙ†Ø´Ø§Ù‚",
          it: "Inalare",
        },
        exhale: {
          en: "Exhale (Breathe Out)",
          zh: "å‘¼æ°£",
          ja: "å‘¼æ°—",
          ko: "ë°°ì¶œ",
          es: "Exhalar",
          de: "Ausatmen",
          fi: "Uloshengitys",
          fr: "Expirer",
          ar: "Ø²ÙÙŠØ±",
          it: "Espirare",
        },
        diaphragm: {
          en: "Diaphragm",
          zh: "æ©«è†ˆè†œ",
          ja: "æ¨ªéš”è†œ",
          ko: "íš¡ê²½ë§‰",
          es: "Diafragma",
          de: "Zwerchfell",
          fi: "Pallea",
          fr: "Diaphragme",
          ar: "Ø­Ø¬Ø§Ø¨ Ø­Ø§Ø¬Ø²",
          it: "Diaframma",
        },
        lungs: {
          en: "Lungs",
          zh: "è‚ºéƒ¨",
          ja: "è‚º",
          ko: "í",
          es: "Pulmones",
          de: "Lungen",
          fi: "Keuhkot",
          fr: "Poumons",
          ar: "Ø±Ø¦ØªÙŠÙ†",
          it: "Polmoni",
        },
        status: {
          en: "Status:",
          zh: "ç‹€æ…‹ï¼š",
          ja: "çŠ¶æ…‹ï¼š",
          ko: "ìƒíƒœ:",
          es: "Estado:",
          de: "Status:",
          fi: "Tila:",
          fr: "Statut :",
          ar: "Ø§Ù„Ø­Ø§Ù„Ø©:",
          it: "Stato:",
        },
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [position, setPosition] = useState(0); // 0 (up/exhale) to 100 (down/inhale)

        const getText = (key) => t[key][lang] || t[key]["en"];

        const stateLabel = position > 50 ? "inhale" : "exhale";
        const lungScale = 1 + (position / 100) * 0.5; // Scale from 1 to 1.5

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-8 text-fuchsia-700">
              {getText("title")}
            </h1>

            <div className="w-full max-w-lg bg-white p-8 rounded-3xl shadow-xl flex flex-col items-center border-[6px] border-fuchsia-200">
              {/* Chest Cavity (Bell Jar Model) */}
              <div className="relative w-64 h-80 bg-slate-100 rounded-t-[100px] border-4 border-slate-300 overflow-hidden mb-8 shadow-inner">
                {/* Trachea (Tube) */}
                <div className="absolute top-0 left-1/2 -translate-x-1/2 w-8 h-20 bg-pink-200 border-x-2 border-pink-300 z-20"></div>

                {/* Lungs (Balloons) */}
                <div className="absolute top-16 left-1/2 -translate-x-1/2 flex justify-center gap-1 z-10 w-full px-8">
                  <motion.div
                    className="w-20 h-32 bg-pink-400 rounded-[50%] origin-top shadow-inner"
                    style={{ scale: lungScale }}
                  >
                    <div className="text-white text-center mt-10 font-bold opacity-50 text-xs">
                      {getText("lungs")}
                    </div>
                  </motion.div>
                  <motion.div
                    className="w-20 h-32 bg-pink-400 rounded-[50%] origin-top shadow-inner"
                    style={{ scale: lungScale }}
                  ></motion.div>
                </div>

                {/* Diaphragm (Rubber Sheet) */}
                {/* This moves up/down based on slider */}
                <motion.div
                  className="absolute bottom-0 w-full h-20 bg-fuchsia-600 rounded-[50%] opacity-80 cursor-grab active:cursor-grabbing border-t-4 border-fuchsia-800"
                  style={{
                    translateY: `${(position / 100) * 40}px`,
                    scaleY: 1 - position / 200, // Flatten slightly as it pulls down? Actually dome shape flattens.
                  }}
                >
                  <div className="text-white text-center mt-2 font-bold text-sm tracking-widest">
                    {getText("diaphragm")}
                  </div>
                </motion.div>

                {/* Air Particles entering */}
                {position > 20 && (
                  <div className="absolute top-0 left-1/2 -translate-x-1/2 flex flex-col items-center z-30">
                    <div className="text-cyan-400 animate-bounce text-xl">
                      ðŸ’¨
                    </div>
                  </div>
                )}
              </div>

              {/* Slider Control */}
              <div className="w-full px-8">
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={position}
                  onChange={(e) => setPosition(Number(e.target.value))}
                  className="w-full h-8 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-fuchsia-600"
                />
                <div className="flex justify-between font-bold text-slate-400 mt-2 text-sm uppercase">
                  <span>{getText("exhale")}</span>
                  <span>{getText("inhale")}</span>
                </div>
              </div>

              <div className="mt-8 text-2xl font-black text-fuchsia-800 bg-fuchsia-100 px-8 py-4 rounded-xl">
                {getText("status")} {getText(stateLabel)}
              </div>

              <div className="mt-4 text-slate-500 text-center text-sm font-bold">
                {getText("instruction")}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
