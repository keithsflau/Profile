<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Ecosystem Balance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #f0fdf4;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Ecosystem Stability",
          zh: "ÁîüÊÖãÂπ≥Ë°°",
          ja: "ÁîüÊÖãÁ≥ª„ÅÆÂÆâÂÆö",
          ko: "ÏÉùÌÉúÍ≥Ñ ÏïàÏ†ïÏÑ±",
          es: "Estabilidad del ecosistema",
          de: "√ñkosystemstabilit√§t",
          fi: "Ekosysteemin vakaus",
          fr: "Stabilit√© de l'√©cosyst√®me",
          ar: "ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ®Ÿäÿ¶Ÿä",
          it: "Stabilit√† dell'Ecosistema",
        },
        instruction: {
          en: "Balance the population of Grass, Rabbits, and Foxes!",
          zh: "Âπ≥Ë°°Ëçâ„ÄÅÂÖîÂ≠êÂíåÁãêÁã∏ÁöÑÊï∏ÈáèÔºÅ",
          ja: "Ëçâ„ÄÅ„Ç¶„Çµ„ÇÆ„ÄÅ„Ç≠„ÉÑ„Éç„ÅÆÂÄã‰ΩìÊï∞„ÅÆ„Éê„É©„É≥„Çπ„Çí„Å®„Å£„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÌíÄ, ÌÜ†ÎÅº, Ïó¨Ïö∞Ïùò Í∞úÏ≤¥Ïàò Í∑†ÌòïÏùÑ ÎßûÏ∂îÏÑ∏Ïöî!",
          es: "¬°Equilibra la poblaci√≥n de hierba, conejos y zorros!",
          de: "Gleiche die Population von Gras, Kaninchen und F√ºchsen aus!",
          fi: "Tasapainota ruohon, kanien ja kettujen populaatio!",
          fr: "√âquilibrez la population d'herbe, de lapins et de renards !",
          ar: "Ÿàÿßÿ≤ŸêŸÜ ÿ£ÿπÿØÿßÿØ ÿßŸÑÿπÿ¥ÿ® ŸàÿßŸÑÿ£ÿ±ÿßŸÜÿ® ŸàÿßŸÑÿ´ÿπÿßŸÑÿ®!",
          it: "Bilancia la popolazione di erba, conigli e volpi!",
        },
        grass: {
          en: "Grass (Producer)",
          zh: "Ëçâ (ÁîüÁî¢ËÄÖ)",
          ja: "Ëçâ (ÁîüÁî£ËÄÖ)",
          ko: "ÌíÄ (ÏÉùÏÇ∞Ïûê)",
          es: "Hierba (Productor)",
          de: "Gras (Produzent)",
          fi: "Ruoho (Tuottaja)",
          fr: "Herbe (Producteur)",
          ar: "ÿπÿ¥ÿ® (ŸÖŸÜÿ™ÿ¨)",
          it: "Erba (Produttore)",
        },
        rabbit: {
          en: "Rabbit (Consumer)",
          zh: "ÂÖîÂ≠ê (Ê∂àË≤ªËÄÖ)",
          ja: "„Ç¶„Çµ„ÇÆ (Ê∂àË≤ªËÄÖ)",
          ko: "ÌÜ†ÎÅº (ÏÜåÎπÑÏûê)",
          es: "Conejo (Consumidor)",
          de: "Kaninchen (Verbraucher)",
          fi: "Kani (Kuluttaja)",
          fr: "Lapin (Consommateur)",
          ar: "ÿ£ÿ±ŸÜÿ® (ŸÖÿ≥ÿ™ŸáŸÑŸÉ)",
          it: "Coniglio (Consumatore)",
        },
        fox: {
          en: "Fox (Predator)",
          zh: "ÁãêÁã∏ (ÊçïÈ£üËÄÖ)",
          ja: "„Ç≠„ÉÑ„Éç (ÊçïÈ£üËÄÖ)",
          ko: "Ïó¨Ïö∞ (Ìè¨ÏãùÏûê)",
          es: "Zorro (Depredador)",
          de: "Fuchs (Raubtier)",
          fi: "Kettu (Petoel√§in)",
          fr: "Renard (Pr√©dateur)",
          ar: "ÿ´ÿπŸÑÿ® (ŸÖŸÅÿ™ÿ±ÿ≥)",
          it: "Volpe (Predatore)",
        },

        status: {
          en: "Ecosystem Status:",
          zh: "ÁîüÊÖãÁ≥ªÁµ±ÁãÄÊÖãÔºö",
          ja: "ÁîüÊÖãÁ≥ª„ÅÆÁä∂ÊÖãÔºö",
          ko: "ÏÉùÌÉúÍ≥Ñ ÏÉÅÌÉú:",
          es: "Estado del ecosistema:",
          de: "√ñkosystemstatus:",
          fi: "Ekosysteemin tila:",
          fr: "√âtat de l'√©cosyst√®me :",
          ar: "ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ®Ÿäÿ¶Ÿä:",
          it: "Stato dell'Ecosistema:",
        },
        balanced: {
          en: "Balanced",
          zh: "Âπ≥Ë°°",
          ja: "„Éê„É©„É≥„Çπ„ÅåÂèñ„Çå„Å¶„ÅÑ„Çã",
          ko: "Í∑†Ìòï Ïû°Ìûò",
          es: "Equilibrado",
          de: "Ausgeglichen",
          fi: "Tasapainoinen",
          fr: "√âquilibr√©",
          ar: "ŸÖÿ™Ÿàÿßÿ≤ŸÜ",
          it: "Bilanciato",
        },
        collapse: {
          en: "Collapsing!",
          zh: "Â¥©ÊΩ∞‰∏≠ÔºÅ",
          ja: "Â¥©Â£ä‰∏≠ÔºÅ",
          ko: "Î∂ïÍ¥¥ Ï§ë!",
          es: "¬°Colapsando!",
          de: "Zusammenbruch!",
          fi: "Romahtamassa!",
          fr: "Effondrement !",
          ar: "ŸäŸÜŸáÿßÿ±!",
          it: "Collasso!",
        },
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [grass, setGrass] = useState(50);
        const [rabbits, setRabbits] = useState(10);
        const [foxes, setFoxes] = useState(2);
        const [running, setRunning] = useState(true);

        const getText = (key) => t[key][lang] || t[key]["en"];

        // Simple Simulation Interval
        useEffect(() => {
          if (!running) return;
          const timer = setInterval(() => {
            setGrass((g) => {
              let nextG = g + 5; // Regrow
              // Eaten by rabbits
              nextG -= rabbits * 0.5;
              return Math.max(0, Math.min(100, nextG));
            });

            setRabbits((r) => {
              let nextR = r;
              // Eat grass to survive/reproduce
              if (grass > r * 2) nextR += r * 0.1; // Grow
              else nextR -= r * 0.1; // Starve

              // Eaten by foxes
              nextR -= foxes * 1;

              return Math.max(0, Math.min(100, nextR));
            });

            setFoxes((f) => {
              let nextF = f;
              // Eat rabbits
              if (rabbits > f * 3) nextF += f * 0.05;
              else nextF -= f * 0.1;

              return Math.max(0, Math.min(50, nextF));
            });
          }, 500);
          return () => clearInterval(timer);
        }, [running, grass, rabbits, foxes]);

        // Determine State
        const isStable = grass > 10 && rabbits > 2 && foxes > 0 && rabbits < 80;

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-4 text-green-800">
              {getText("title")}
            </h1>

            <div className="w-full max-w-4xl bg-white p-6 rounded-3xl shadow-xl border-4 border-green-100">
              <div
                className={`text-center font-bold text-xl mb-4 p-2 rounded ${
                  isStable
                    ? "bg-green-100 text-green-800"
                    : "bg-red-100 text-red-800 animate-pulse"
                }`}
              >
                {getText("status")}{" "}
                {isStable ? getText("balanced") : getText("collapse")}
              </div>

              <div className="grid grid-cols-3 gap-4 h-[400px]">
                {/* Grass Section */}
                <div className="bg-green-100 rounded-xl relative overflow-hidden flex flex-col justify-end p-2 border-2 border-green-300">
                  <div className="absolute top-2 left-2 font-bold text-green-900 bg-white/80 px-2 rounded z-10">
                    {getText("grass")}: {Math.round(grass)}
                  </div>
                  <div className="flex flex-wrap content-end gap-1">
                    {[...Array(Math.min(50, Math.round(grass)))].map((_, i) => (
                      <div key={i} className="text-xl">
                        üåø
                      </div>
                    ))}
                  </div>
                  <button
                    onClick={() => setGrass((g) => Math.min(100, g + 10))}
                    className="absolute top-2 right-2 bg-green-500 text-white w-8 h-8 rounded-full z-20 hover:scale-110 shadow"
                  >
                    Ôºã
                  </button>
                </div>

                {/* Rabbit Section */}
                <div className="bg-orange-50 rounded-xl relative overflow-hidden flex flex-col justify-end p-2 border-2 border-orange-200">
                  <div className="absolute top-2 left-2 font-bold text-orange-900 bg-white/80 px-2 rounded z-10">
                    {getText("rabbit")}: {Math.round(rabbits)}
                  </div>
                  <div className="flex flex-wrap content-end gap-1">
                    {[...Array(Math.min(30, Math.round(rabbits)))].map(
                      (_, i) => (
                        <div key={i} className="text-xl">
                          üê∞
                        </div>
                      )
                    )}
                  </div>
                  <button
                    onClick={() => setRabbits((r) => Math.min(100, r + 5))}
                    className="absolute top-2 right-2 bg-orange-500 text-white w-8 h-8 rounded-full z-20 hover:scale-110 shadow"
                  >
                    Ôºã
                  </button>
                </div>

                {/* Fox Section */}
                <div className="bg-red-50 rounded-xl relative overflow-hidden flex flex-col justify-end p-2 border-2 border-red-200">
                  <div className="absolute top-2 left-2 font-bold text-red-900 bg-white/80 px-2 rounded z-10">
                    {getText("fox")}: {Math.round(foxes)}
                  </div>
                  <div className="flex flex-wrap content-end gap-1">
                    {[...Array(Math.min(20, Math.round(foxes)))].map((_, i) => (
                      <div key={i} className="text-xl">
                        ü¶ä
                      </div>
                    ))}
                  </div>
                  <button
                    onClick={() => setFoxes((f) => Math.min(50, f + 2))}
                    className="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full z-20 hover:scale-110 shadow"
                  >
                    Ôºã
                  </button>
                </div>
              </div>

              <div className="mt-6 text-center text-slate-500 text-sm">
                {getText("instruction")}
              </div>

              <div className="mt-4 flex justify-center">
                <button
                  onClick={() => setRunning(!running)}
                  className="bg-slate-700 text-white px-6 py-2 rounded-lg font-bold"
                >
                  {running ? "Pause" : "Resume"}
                </button>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
