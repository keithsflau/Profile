<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Circulatory Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #0f172a;
        color: white;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Circulatory System Flow",
          zh: "Âæ™Áí∞Á≥ªÁµ±ÊµÅÂãï",
          ja: "Âæ™Áí∞Âô®Á≥ª„ÅÆÊµÅ„Çå",
          ko: "ÏàúÌôòÍ≥Ñ ÌùêÎ¶Ñ",
          es: "Flujo del sistema circulatorio",
          de: "Kreislauffluss",
          fi: "Verenkiertoj√§rjestelm√§n virtaus",
          fr: "Flux du syst√®me circulatoire",
          ar: "ÿ™ÿØŸÅŸÇ ÿßŸÑÿ¨Ÿáÿßÿ≤ ÿßŸÑÿØŸàÿ±Ÿä",
          it: "Flusso del Sistema Circolatorio",
        },
        instruction: {
          en: "Pump the heart to move blood!",
          zh: "ÊåâÂ£ìÂøÉËáü‰ª•Êé®ÂãïË°ÄÊ∂≤ÔºÅ",
          ja: "ÂøÉËáì„Çí„Éù„É≥„Éó„Åó„Å¶Ë°ÄÊ∂≤„ÇíÂãï„Åã„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "Ïã¨Ïû•ÏùÑ ÌéåÌîÑÏßàÌïòÏó¨ ÌòàÏï°ÏùÑ Ïù¥ÎèôÏãúÌÇ§ÏÑ∏Ïöî!",
          es: "¬°Bombea el coraz√≥n para mover la sangre!",
          de: "Pumpe das Herz, um Blut zu bewegen!",
          fi: "Pumppaa syd√§nt√§ liikuttamaan verta!",
          fr: "Pompez le c≈ìur pour faire bouger le sang !",
          ar: "ÿ∂ÿÆ ÿßŸÑŸÇŸÑÿ® ŸÑÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑÿØŸÖ!",
          it: "Pompa il cuore per muovere il sangue!",
        },
        oxygenated: {
          en: "Oxygenated Blood (Red)",
          zh: "Âê´Ê∞ßË°Ä (Á¥Ö)",
          ja: "ÈÖ∏Á¥†ÂåñË°ÄÊ∂≤ (Ëµ§)",
          ko: "ÏÇ∞ÏÜåÌôîÎêú ÌòàÏï° (Îπ®Í∞ï)",
          es: "Sangre oxigenada (Rojo)",
          de: "Sauerstoffreiches Blut (Rot)",
          fi: "Happipitoinen veri (Punainen)",
          fr: "Sang oxyg√©n√© (Rouge)",
          ar: "ÿßŸÑÿØŸÖ ÿßŸÑŸÖÿ§ŸÉÿ≥ÿ¨ (ÿ£ÿ≠ŸÖÿ±)",
          it: "Sangue Ossigenato (Rosso)",
        },
        deoxygenated: {
          en: "Deoxygenated Blood (Blue)",
          zh: "Áº∫Ê∞ßË°Ä (Ëóç)",
          ja: "ËÑ±ÈÖ∏Á¥†ÂåñË°ÄÊ∂≤ (Èùí)",
          ko: "ÌÉàÏÇ∞ÏÜåÌôîÎêú ÌòàÏï° (ÌååÎûë)",
          es: "Sangre desoxigenada (Azul)",
          de: "Sauerstoffarmes Blut (Blau)",
          fi: "Hapeton veri (Sininen)",
          fr: "Sang d√©soxyg√©n√© (Bleu)",
          ar: "ÿØŸÖ ÿ∫Ÿäÿ± ŸÖÿ§ŸÉÿ≥ÿ¨ (ÿ£ÿ≤ÿ±ŸÇ)",
          it: "Sangue Deossigenato (Blu)",
        },
        lungs: {
          en: "Lungs: Get Oxygen",
          zh: "ËÇ∫ÈÉ®ÔºöÁç≤ÂèñÊ∞ßÊ∞£",
          ja: "ËÇ∫: ÈÖ∏Á¥†„ÇíÂæó„Çã",
          ko: "Ìèê: ÏÇ∞ÏÜå ÌöçÎìù",
          es: "Pulmones: Obtener ox√≠geno",
          de: "Lungen: Sauerstoff aufnehmen",
          fi: "Keuhkot: Hanki happea",
          fr: "Poumons : Obtenir de l'oxyg√®ne",
          ar: "ÿ±ÿ¶ÿ™ŸäŸÜ: ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÉÿ≥ÿ¨ŸäŸÜ",
          it: "Polmoni: Ottieni ossigeno",
        },
        body: {
          en: "Body: Use Oxygen",
          zh: "Ë∫´È´îÔºö‰ΩøÁî®Ê∞ßÊ∞£",
          ja: "‰Ωì: ÈÖ∏Á¥†„Çí‰Ωø„ÅÜ",
          ko: "Ïã†Ï≤¥: ÏÇ∞ÏÜå ÏÇ¨Ïö©",
          es: "Cuerpo: Usar ox√≠geno",
          de: "K√∂rper: Sauerstoff verbrauchen",
          fi: "Keho: K√§yt√§ happea",
          fr: "Corps : Utiliser l'oxyg√®ne",
          ar: "ÿ¨ÿ≥ŸÖ: ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ£ŸÉÿ≥ÿ¨ŸäŸÜ",
          it: "Corpo: Usa ossigeno",
        },
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [pumping, setPumping] = useState(false);

        const getText = (key) => t[key][lang] || t[key]["en"];

        const pump = () => {
          setPumping(true);
          setTimeout(() => setPumping(false), 300);
        };

        // Particles Animation Logic
        // We will define particles moving along a path (The "8" figure loop)
        // Upper loop: Heart -> Lungs -> Heart
        // Lower loop: Heart -> Body -> Heart
        // Path needs CSS `offset-path`. Or use simpler React state movement.
        // Let's use CSS Animation for continuous flow, controlled by "animation-play-state".

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-4 text-red-500">
              {getText("title")}
            </h1>
            <p className="mb-8 font-bold text-slate-400">
              {getText("instruction")}
            </p>

            <div className="relative w-full max-w-2xl h-[600px] border-4 border-slate-700 bg-slate-800 rounded-3xl overflow-hidden flex flex-col items-center justify-between py-10">
              {/* Lungs (Top) */}
              <div className="relative z-10 bg-cyan-200 text-cyan-900 px-6 py-3 rounded-xl font-bold shadow opacity-80 backdrop-blur">
                ü´Å {getText("lungs")}
              </div>

              {/* Heart (Center) */}
              <div className="relative z-20 my-auto">
                <button
                  onClick={pump}
                  className={`text-9xl transition-transform active:scale-90 ${
                    pumping ? "scale-110 drop-shadow-[0_0_30px_red]" : ""
                  }`}
                >
                  ‚ù§Ô∏è
                </button>
              </div>

              {/* Body (Bottom) */}
              <div className="relative z-10 bg-orange-200 text-orange-900 px-6 py-3 rounded-xl font-bold shadow opacity-80 backdrop-blur">
                ü¶æ {getText("body")}
              </div>

              {/* Flow Path SVG */}
              <svg
                className="absolute inset-0 w-full h-full z-0 pointer-events-none"
                viewBox="0 0 400 600"
              >
                {/* Upper Loop: Heart (200,300) to Lungs (200, 100) */}
                {/* Right side going UP (Blue) -> Lungs -> Left side going DOWN (Red) */}
                <path
                  id="pathLungsToHeart"
                  d="M150,100 C100,100 100,300 150,300"
                  stroke="#ef4444"
                  strokeWidth="10"
                  fill="none"
                  opacity="0.3"
                  markerEnd="url(#arrowRed)"
                />
                <path
                  id="pathHeartToLungs"
                  d="M250,300 C300,300 300,100 250,100"
                  stroke="#3b82f6"
                  strokeWidth="10"
                  fill="none"
                  opacity="0.3"
                  markerEnd="url(#arrowBlue)"
                />

                {/* Lower Loop: Heart (200,300) to Body (200, 500) */}
                {/* Left side going DOWN (Red) -> Body -> Right side going UP (Blue) */}
                {/* Wait, Arteries carry Red from heart. Veins carry Blue to heart. */}
                {/* Systemic: Left Ventricle (Red) -> Body. */}
                {/* Pulmonary: Right Ventricle (Blue) -> Lungs. */}

                {/* Let's simplify visual: Red OUT of Heart to Body. Blue IN to Heart from Body. */}
                <path
                  id="pathHeartToBody"
                  d="M150,300 C100,300 100,500 150,500"
                  stroke="#ef4444"
                  strokeWidth="10"
                  fill="none"
                  opacity="0.3"
                />
                <path
                  id="pathBodyToHeart"
                  d="M250,500 C300,500 300,300 250,300"
                  stroke="#3b82f6"
                  strokeWidth="10"
                  fill="none"
                  opacity="0.3"
                />

                <defs>
                  <marker
                    id="arrowRed"
                    markerWidth="10"
                    markerHeight="10"
                    refX="5"
                    refY="5"
                    orient="auto"
                  >
                    <path d="M0,0 L10,5 L0,10" fill="#ef4444" />
                  </marker>
                  <marker
                    id="arrowBlue"
                    markerWidth="10"
                    markerHeight="10"
                    refX="5"
                    refY="5"
                    orient="auto"
                  >
                    <path d="M0,0 L10,5 L0,10" fill="#3b82f6" />
                  </marker>
                </defs>

                {/* Particles */}
                {/* Only move if pumping is recent? or continuously but speed up on pump? Let's continuous. */}
                {/* Using React to render circles along paths is complex without a library. 
                       We will use CSS motion path if supported or simple CSS animations on fixed paths.
                       For reliability, let's use CSS @keyframes on absolute divs positioned approx on path.
                   */}
              </svg>

              {/* CSS Based Particles */}
              {/* Red Blood: Lungs -> Heart -> Body */}
              <div className="absolute inset-0 pointer-events-none">
                {/* Red Particles flowing DOWN from Lungs to Heart to Body */}
                <div
                  className={`particle-red absolute top-[100px] left-[145px] text-red-500 text-2xl ${
                    pumping ? "animate-flow-fast" : "animate-flow-slow"
                  }`}
                >
                  üî¥
                </div>
                <div
                  className={`particle-red absolute top-[200px] left-[110px] text-red-500 text-2xl ${
                    pumping ? "animate-flow-fast" : "animate-flow-slow"
                  }`}
                  style={{ animationDelay: "0.5s" }}
                >
                  üî¥
                </div>
                <div
                  className={`particle-red absolute top-[400px] left-[110px] text-red-500 text-2xl ${
                    pumping ? "animate-flow-fast" : "animate-flow-slow"
                  }`}
                  style={{ animationDelay: "1s" }}
                >
                  üî¥
                </div>

                {/* Blue Particles flowing UP from Body to Heart to Lungs */}
                <div
                  className={`particle-blue absolute top-[500px] left-[245px] text-blue-500 text-2xl ${
                    pumping ? "animate-flow-up-fast" : "animate-flow-up-slow"
                  }`}
                >
                  üîµ
                </div>
                <div
                  className={`particle-blue absolute top-[400px] left-[280px] text-blue-500 text-2xl ${
                    pumping ? "animate-flow-up-fast" : "animate-flow-up-slow"
                  }`}
                  style={{ animationDelay: "0.5s" }}
                >
                  üîµ
                </div>
                <div
                  className={`particle-blue absolute top-[200px] left-[280px] text-blue-500 text-2xl ${
                    pumping ? "animate-flow-up-fast" : "animate-flow-up-slow"
                  }`}
                  style={{ animationDelay: "1s" }}
                >
                  üîµ
                </div>
              </div>

              <style>{`
                   @keyframes flowDown {
                      0% { top: 100px; left: 150px; opacity: 0; }
                      20% { opacity: 1; }
                      40% { top: 300px; left: 150px; } /* Heart */
                      60% { top: 400px; left: 100px; }
                      100% { top: 500px; left: 150px; opacity: 0; }
                   }
                   @keyframes flowUp {
                      0% { top: 500px; left: 250px; opacity: 0; }
                      20% { opacity: 1; }
                      40% { top: 300px; left: 250px; } /* Heart */
                      60% { top: 200px; left: 300px; }
                      100% { top: 100px; left: 250px; opacity: 0; }
                   }
                   .animate-flow-slow { animation: flowDown 4s linear infinite; }
                   .animate-flow-fast { animation: flowDown 1s linear infinite; }
                   .animate-flow-up-slow { animation: flowUp 4s linear infinite; }
                   .animate-flow-up-fast { animation: flowUp 1s linear infinite; }
                `}</style>

              <div className="absolute bottom-4 flex gap-4 text-xs font-bold w-full justify-center">
                <div className="flex items-center gap-2">
                  <span className="w-4 h-4 bg-red-500 rounded-full"></span>{" "}
                  {getText("oxygenated")}
                </div>
                <div className="flex items-center gap-2">
                  <span className="w-4 h-4 bg-blue-500 rounded-full"></span>{" "}
                  {getText("deoxygenated")}
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
