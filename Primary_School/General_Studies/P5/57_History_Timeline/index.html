<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - History Timeline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #fff7ed;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "China History Timeline",
          zh: "中國歷史時間軸",
          ja: "中国歴史年表",
          ko: "중국 역사 연표",
          es: "Línea de tiempo de la historia de China",
          de: "China Geschichtszeitleiste",
          fi: "Kiinan historian aikajana",
          fr: "Chronologie de l'histoire de la Chine",
          ar: "الجدول الزمني لتاريخ الصين",
          it: "Cronologia Storia Cina",
        },
        instruction: {
          en: "Place the dynasties/events in order.",
          zh: "按順序排列朝代/事件。",
          ja: "王朝/出来事を順序に並べてください。",
          ko: "왕조/사건을 순서대로 배치하세요.",
          es: "Coloca las dinastías/eventos en orden.",
          de: "Ordne die Dynastien/Ereignisse.",
          fi: "Aseta dynastiat/tapahtumat järjestykseen.",
          fr: "Placez les dynasties/événements dans l'ordre.",
          ar: "رتب السلالات/الأحداث بالترتيب.",
          it: "Metti in ordine le dinastie/eventi.",
        },
        qin: { en: "Qin Dynasty", zh: "秦朝", ja: "秦", ko: "진나라" },
        han: { en: "Han Dynasty", zh: "漢朝", ja: "漢", ko: "한나라" },
        tang: { en: "Tang Dynasty", zh: "唐朝", ja: "唐", ko: "당나라" },
        song: { en: "Song Dynasty", zh: "宋朝", ja: "宋", ko: "송나라" },
        qing: { en: "Qing Dynasty", zh: "清朝", ja: "清", ko: "청나라" },
        modern: {
          en: "Modern China",
          zh: "現代中國",
          ja: "現代中国",
          ko: "현대 중국",
        },

        check: { en: "Check", zh: "檢查", ja: "確認", ko: "확인" },
        correct: {
          en: "Correct Order!",
          zh: "順序正確！",
          ja: "正しい順序！",
          ko: "올바른 순서!",
        },
        wrong: {
          en: "Incorrect.",
          zh: "不正確。",
          ja: "不正解。",
          ko: "틀렸습니다.",
        },
      };

      const items = [
        { id: "qin", year: -221 },
        { id: "han", year: -202 },
        { id: "tang", year: 618 },
        { id: "song", year: 960 },
        { id: "qing", year: 1644 },
        { id: "modern", year: 1949 },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [order, setOrder] = useState([]); // User's placed items
        const [pool, setPool] = useState(
          [...items].sort(() => Math.random() - 0.5)
        );
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        const handleDrop = (item) => {
          setOrder([...order, item]);
          setPool(pool.filter((i) => i.id !== item.id));
        };

        const reset = () => {
          setOrder([]);
          setPool([...items].sort(() => Math.random() - 0.5));
          setFeedback(null);
        };

        const check = () => {
          // Check order by year
          let correct = true;
          for (let i = 0; i < order.length - 1; i++) {
            if (order[i].year > order[i + 1].year) correct = false;
          }
          if (order.length !== items.length) correct = false;

          setFeedback(correct ? "correct" : "wrong");
        };

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-8 text-orange-800">
              {getText("title")}
            </h1>

            <div className="w-full max-w-5xl">
              {/* Timeline Drop Zone */}
              <div className="bg-orange-100 p-8 rounded-3xl min-h-[200px] flex items-center gap-4 overflow-x-auto border-4 border-orange-200 mb-8 relative">
                <div className="absolute top-4 left-4 text-orange-400 font-bold uppercase tracking-widest text-xs">
                  Timeline (Past ➔ Future)
                </div>

                {order.map((item, i) => (
                  <div k={item.id} className="flex items-center">
                    <motion.div
                      layoutId={item.id}
                      className="bg-white px-6 py-4 rounded-xl shadow-lg font-bold text-orange-900 border-2 border-orange-300 min-w-[120px] text-center"
                    >
                      {getText(item.id)}
                    </motion.div>
                    {i < order.length - 1 && (
                      <div className="text-orange-300 text-2xl mx-2">➔</div>
                    )}
                  </div>
                ))}

                {order.length === 0 && (
                  <div className="text-orange-300 font-bold text-xl mx-auto opacity-50">
                    {getText("instruction")}
                  </div>
                )}
              </div>

              {/* Pool */}
              <div className="flex flex-wrap gap-4 justify-center bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                {pool.map((item) => (
                  <motion.button
                    key={item.id}
                    layoutId={item.id}
                    onClick={() => handleDrop(item)}
                    className="bg-slate-100 hover:bg-slate-200 px-6 py-3 rounded-xl font-bold text-slate-700 border-2 border-slate-300"
                  >
                    {getText(item.id)}
                  </motion.button>
                ))}
              </div>

              <div className="flex justify-center gap-4 mt-8">
                <button
                  onClick={reset}
                  className="bg-slate-500 text-white px-8 py-3 rounded-full font-bold"
                >
                  Reset
                </button>
                <button
                  onClick={check}
                  className="bg-orange-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-orange-500"
                >
                  {getText("check")}
                </button>
              </div>

              {feedback && (
                <div
                  className={`mt-8 text-center text-3xl font-black ${
                    feedback === "correct" ? "text-green-600" : "text-red-500"
                  }`}
                >
                  {getText(feedback)}
                </div>
              )}
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
