<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General Studies - Respiratory Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
        background: #fefffa;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Lungs & Breathing",
          zh: "ËÇ∫ËàáÂëºÂê∏",
          ja: "ËÇ∫„Å®ÂëºÂê∏",
          ko: "ÌèêÏôÄ Ìò∏Ìù°",
          es: "Pulmones y respiraci√≥n",
          de: "Lungen & Atmung",
          fi: "Keuhkot ja hengitys",
          fr: "Poumons et respiration",
          ar: "ÿßŸÑÿ±ÿ¶ÿ™ŸäŸÜ ŸàÿßŸÑÿ™ŸÜŸÅÿ≥",
          it: "Polmoni e Respirazione",
        },
        instruction: {
          en: "Press Inhale/Exhale to see how the diaphragm works.",
          zh: "Êåâ‰∏ãÂê∏Ê∞£/ÂëºÊ∞£‰ª•ËßÄÂØüÊ©´ËÜàËÜúÂ¶Ç‰ΩïÈÅã‰Ωú„ÄÇ",
          ja: "Âê∏„ÅÜ/Âêê„Åè„ÇíÊäº„Åó„Å¶„ÄÅÊ®™ÈöîËÜú„ÅÆÂÉç„Åç„ÇíË¶ã„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
          ko: "Ïà®ÏùÑ Îì§Ïù¥ÎßàÏãúÍ≥† ÎÇ¥Ïâ¨Î©∞ Ìö°Í≤©ÎßâÏù¥ Ïñ¥ÎñªÍ≤å ÏûëÎèôÌïòÎäîÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.",
          es: "Presiona Inhalar/Exhalar para ver c√≥mo funciona el diafragma.",
          de: "Dr√ºcke Einatmen/Ausatmen, um zu sehen, wie das Zwerchfell funktioniert.",
          fi: "Paina Sis√§√§nhengitys/Uloshengitys n√§hd√§ksesi, miten pallea toimii.",
          fr: "Appuyez sur Inspirer/Expirer pour voir comment fonctionne le diaphragme.",
          ar: "ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ŸáŸäŸÇ/ÿßŸÑÿ≤ŸÅŸäÿ± ŸÑÿ±ÿ§Ÿäÿ© ŸÉŸäŸÅ ŸäÿπŸÖŸÑ ÿßŸÑÿ≠ÿ¨ÿßÿ® ÿßŸÑÿ≠ÿßÿ¨ÿ≤.",
          it: "Premi Inala/esala per vedere come funziona il diaframma.",
        },
        inhale: { en: "Inhale", zh: "Âê∏Ê∞£", ja: "Âê∏„ÅÜ", ko: "Îì§Ïà®" },
        exhale: { en: "Exhale", zh: "ÂëºÊ∞£", ja: "Âêê„Åè", ko: "ÎÇ†Ïà®" },
        diaphragm: {
          en: "Diaphragm",
          zh: "Ê©´ËÜàËÜú",
          ja: "Ê®™ÈöîËÜú",
          ko: "Ìö°Í≤©Îßâ",
        },
        oxygen: {
          en: "Oxygen (O2)",
          zh: "Ê∞ßÊ∞£ (O2)",
          ja: "ÈÖ∏Á¥† (O2)",
          ko: "ÏÇ∞ÏÜå (O2)",
        },
        co2: {
          en: "Carbon Dioxide (CO2)",
          zh: "‰∫åÊ∞ßÂåñÁ¢≥ (CO2)",
          ja: "‰∫åÈÖ∏ÂåñÁÇ≠Á¥† (CO2)",
          ko: "Ïù¥ÏÇ∞ÌôîÌÉÑÏÜå (CO2)",
        },
      };

      function App() {
        const [lang, setLang] = useState("zh");
        const [state, setState] = useState("rest"); // rest, inhale, exhale

        const getText = (key) => t[key][lang] || t[key]["en"];

        // Inhale: Diaphragm moves DOWN, Lungs EXPAND. Air comes IN.
        // Exhale: Diaphragm moves UP, Lungs SHRINK. Air goes OUT.

        return (
          <div className="min-h-screen flex flex-col items-center p-4">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl font-bold mb-8 text-sky-600">
              {getText("title")}
            </h1>

            <div className="w-full max-w-lg bg-sky-50 p-8 rounded-3xl shadow-xl flex flex-col items-center">
              {/* Visualizer */}
              <div className="relative w-[300px] h-[400px] border-4 border-slate-300 rounded-[50px] bg-white overflow-hidden mb-8">
                {/* Air Particles */}
                <motion.div
                  className="absolute top-[50px] left-[130px] w-10 h-10 text-2xl flex flex-col items-center"
                  animate={{
                    y: state === "inhale" ? 100 : state === "exhale" ? -100 : 0,
                    opacity: state === "rest" ? 0 : 1,
                  }}
                >
                  {state === "inhale" ? "üîµ" : "‚ö´"}
                </motion.div>

                {/* Trachea */}
                <div className="absolute top-0 left-[140px] w-5 h-[100px] bg-pink-200"></div>

                {/* Lungs */}
                <motion.div
                  className="absolute top-[100px] left-[50px] w-[200px] h-[200px] bg-pink-300 rounded-[4rem] opacity-80"
                  animate={{ scale: state === "inhale" ? 1.2 : 0.9 }}
                ></motion.div>

                {/* Diaphragm (Curve at bottom) */}
                <motion.div
                  className="absolute bottom-[50px] left-0 w-full h-[20px] bg-red-500 rounded-[50%]"
                  animate={{
                    y: state === "inhale" ? 40 : state === "exhale" ? -20 : 0,
                    scaleX: state === "inhale" ? 0.9 : 1.1,
                  }}
                ></motion.div>

                <div className="absolute bottom-4 left-1/2 -translate-x-1/2 text-xs font-bold text-red-600">
                  {getText("diaphragm")}
                </div>
              </div>

              <div className="flex gap-4">
                <button
                  onClick={() => setState("inhale")}
                  className={`px-8 py-4 rounded-xl font-bold text-xl shadow-lg transition-all ${
                    state === "inhale"
                      ? "bg-sky-500 text-white scale-105"
                      : "bg-white text-sky-500 border-2 border-sky-200"
                  }`}
                >
                  {getText("inhale")}
                </button>
                <button
                  onClick={() => setState("exhale")}
                  className={`px-8 py-4 rounded-xl font-bold text-xl shadow-lg transition-all ${
                    state === "exhale"
                      ? "bg-slate-500 text-white scale-105"
                      : "bg-white text-slate-500 border-2 border-slate-200"
                  }`}
                >
                  {getText("exhale")}
                </button>
              </div>

              {state !== "rest" && (
                <div className="mt-6 font-bold text-lg animate-fade-in text-center">
                  {state === "inhale" ? (
                    <span className="text-blue-500">
                      ‚¨áÔ∏è Diaphragm Down = Air In ({getText("oxygen")})
                    </span>
                  ) : (
                    <span className="text-slate-600">
                      ‚¨ÜÔ∏è Diaphragm Up = Air Out ({getText("co2")})
                    </span>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
