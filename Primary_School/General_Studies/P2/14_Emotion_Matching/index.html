<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫åÂ∏∏Ë≠òÔºöÊÉÖÁ∑íÁ¥ÖÁ∂†Ááà | Emotion Traffic Light</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Emotion Traffic Light",
          zh: "ÊÉÖÁ∑íÁ¥ÖÁ∂†Ááà",
          ja: "ÊÑüÊÉÖ„ÅÆ‰ø°Âè∑Ê©ü",
          ko: "Í∞êÏ†ï Ïã†Ìò∏Îì±",
          es: "Sem√°foro de Emociones",
          de: "Gef√ºhlsampel",
          fi: "Tunne liikennevalot",
          fr: "Feu de Circulation des √âmotions",
          ar: "ÿ•ÿ¥ÿßÿ±ÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿπÿßÿ∑ŸÅŸäÿ©",
          it: "Semaforo delle Emozioni",
        },
        instruction: {
          en: "How to handle this feeling?",
          zh: "Â¶Ç‰ΩïËôïÁêÜÈÄôÁ®ÆÊÉÖÁ∑íÔºü",
          ja: "„Åì„ÅÆÊÑüÊÉÖ„Çí„Å©„ÅÜÂá¶ÁêÜ„Åó„Åæ„Åô„ÅãÔºü",
          ko: "Ïù¥ Í∞êÏ†ïÏùÑ Ïñ¥ÎñªÍ≤å Ï≤òÎ¶¨Ìï¥Ïïº Ìï†ÍπåÏöî?",
          es: "¬øC√≥mo manejar este sentimiento?",
          de: "Wie gehe ich mit diesem Gef√ºhl um?",
          fi: "Kuinka k√§sitell√§ t√§t√§ tunnetta?",
          fr: "Comment g√©rer ce sentiment ?",
          ar: "ŸÉŸäŸÅ ÿ™ÿ™ÿπÿßŸÖŸÑ ŸÖÿπ Ÿáÿ∞ÿß ÿßŸÑÿ¥ÿπŸàÿ±ÿü",
          it: "Come gestire questa sensazione?",
        },
        red: {
          en: "Stop (Calm Down)",
          zh: "ÂÅú (ÂÜ∑Èùú)",
          ja: "Ê≠¢„Åæ„Çå (ËêΩ„Å°ÁùÄ„Åè)",
          ko: "Î©àÏ∂§ (ÏßÑÏ†ïÌïòÍ∏∞)",
          es: "Parar (Calmarse)",
          de: "Stopp (Beruhigen)",
          fi: "Seis (Rauhoitu)",
          fr: "Arr√™t (Se calmer)",
          ar: "ÿ™ŸàŸÇŸÅ (ŸáÿØÿ¶ ÿ£ÿπÿµÿßÿ®ŸÉ)",
          it: "Stop (Calmati)",
        },
        yellow: {
          en: "Think (What to do?)",
          zh: "ÊÉ≥ (ÊÄéÈ∫ºËæ¶Ôºü)",
          ja: "ËÄÉ„Åà„Çã („Å©„ÅÜ„Åô„ÇãÔºü)",
          ko: "ÏÉùÍ∞Å (Ïñ¥ÎñªÍ≤å Ìï†Íπå?)",
          es: "Pensar (¬øQu√© hacer?)",
          de: "Denken (Was tun?)",
          fi: "Mieti (Mit√§ tehd√§?)",
          fr: "Penser (Que faire ?)",
          ar: "ŸÅŸÉÿ± (ŸÖÿßÿ∞ÿß ÿ™ŸÅÿπŸÑÿü)",
          it: "Pensa (Cosa fare?)",
        },
        green: {
          en: "Go (Act)",
          zh: "Ë°å (Ë°åÂãï)",
          ja: "ÈÄ≤„ÇÄ (Ë°åÂãï)",
          ko: "ÏßÑÌñâ (ÌñâÎèô)",
          es: "Ir (Actuar)",
          de: "Los (Handeln)",
          fi: "Mene (Toimi)",
          fr: "Allez (Agir)",
          ar: "ÿßÿ∞Ÿáÿ® (ÿ™ÿµÿ±ŸÅ)",
          it: "Vai (Agisci)",
        },

        angry: {
          en: "Very Angry! Want to hit!",
          zh: "ÂæàÁîüÊ∞£ÔºÅÊÉ≥Êâì‰∫∫ÔºÅ",
          ja: "„Å®„Å¶„ÇÇÊÄí„Å£„Å¶„ÅÑ„ÇãÔºÅÊÆ¥„Çä„Åü„ÅÑÔºÅ",
          ko: "ÌôîÍ∞Ä ÎÇòÏöî! ÎïåÎ¶¨Í≥† Ïã∂Ïñ¥Ïöî!",
          es: "¬°Muy enojado! ¬°Quiero golpear!",
          de: "Sehr w√ºtend! Will schlagen!",
          fi: "Olen vihainen! Tekee mieli ly√∂d√§!",
          fr: "Tr√®s en col√®re ! Envie de frapper !",
          ar: "ÿ∫ÿßÿ∂ÿ® ÿ¨ÿØÿß! ÿ™ÿ±ŸäÿØ ÿ£ŸÜ ÿ™ÿ∂ÿ±ÿ®!",
          it: "Molto Arrabbiato! Voglio colpire!",
        },
        nervous: {
          en: "Nervous about exam...",
          zh: "ËÄÉË©¶ÂâçÂæàÁ∑äÂºµ...",
          ja: "Ë©¶È®ì„ÅßÁ∑äÂºµ„Åó„Å¶„ÅÑ„Çã...",
          ko: "ÏãúÌóò ÎïåÎ¨∏Ïóê Í∏¥Ïû•ÎèºÏöî...",
          es: "Nervioso por el examen...",
          de: "Nerv√∂s wegen Pr√ºfung...",
          fi: "J√§nnitt√§√§ koetta...",
          fr: "Nerveux pour l'examen...",
          ar: "ŸÖÿ™Ÿàÿ™ÿ± ÿ®ÿ¥ÿ£ŸÜ ÿßŸÑÿßŸÖÿ™ÿ≠ÿßŸÜ ...",
          it: "Nervoso per l'esame...",
        },
        sad: {
          en: "Sad because friend left.",
          zh: "ÊúãÂèãËµ∞‰∫ÜÂæàÂÇ∑ÂøÉ„ÄÇ",
          ja: "ÂèãÈÅî„ÅåË°å„Å£„Å¶„Åó„Åæ„Å£„Å¶ÊÇ≤„Åó„ÅÑ„ÄÇ",
          ko: "ÏπúÍµ¨Í∞Ä Îñ†ÎÇòÏÑú Ïä¨ÌçºÏöî.",
          es: "Triste porque mi amigo se fue.",
          de: "Traurig, weil Freund weg ist.",
          fi: "Surullinen koska yst√§v√§ l√§hti.",
          fr: "Triste parce que l'ami est parti.",
          ar: "ÿ≠ÿ≤ŸäŸÜ ŸÑÿ£ŸÜ ÿµÿØŸäŸÇŸä ÿ∫ÿßÿØÿ±.",
          it: "Triste perch√© l'amico se n'√® andato.",
        },
        excited: {
          en: "Too excited running around!",
          zh: "Â§™ËààÂ•Æ‰∫ÇË∑ëÔºÅ",
          ja: "ËààÂ•Æ„Åó„Å¶Ëµ∞„ÇäÂõû„Å£„Å¶„ÇãÔºÅ",
          ko: "ÎÑàÎ¨¥ Ïã†ÎÇòÏÑú Îõ∞Ïñ¥Îã§ÎÖÄÏöî!",
          es: "¬°Demasiado emocionado corriendo!",
          de: "Zu aufgeregt, renne herum!",
          fi: "Liian innoissaan juoksemassa ymp√§riins√§!",
          fr: "Trop excit√© √† courir partout !",
          ar: "ŸÖÿ™ÿ≠ŸÖÿ≥ ÿ¨ÿØÿß ŸÑŸÑÿ¨ÿ±Ÿä!",
          it: "Troppo eccitato correndo in giro!",
        },

        redAction: {
          en: "Take deep breaths. 1...2...3...",
          zh: "Ê∑±ÂëºÂê∏... 1... 2... 3...",
          ja: "Ê∑±ÂëºÂê∏„Åó„Å¶„ÄÇ1...2...3...",
          ko: "Ïã¨Ìò∏Ìù°ÏùÑ ÌïòÏÑ∏Ïöî. 1...2...3...",
          es: "Respira hondo. 1...2...3...",
          de: "Tief durchatmen. 1...2...3...",
          fi: "Hengit√§ syv√§√§n. 1...2...3...",
          fr: "Respirez profond√©ment. 1...2...3...",
          ar: "ÿÆÿ∞ ÿ£ŸÜŸÅÿßÿ≥ÿß ÿπŸÖŸäŸÇÿ©. 1... 2... 3...",
          it: "Fai respiri profondi. 1...2...3...",
        },
        yellowAction: {
          en: "Think: Hitting hurts others.",
          zh: "ÊÉ≥ÔºöÊâì‰∫∫ÊúÉ‰ª§Âà•‰∫∫ÂèóÂÇ∑„ÄÇ",
          ja: "ËÄÉ„Åà„ÇãÔºöÊÆ¥„Çã„Å®Áõ∏Êâã„ÅåÁóõ„ÅÑ„ÄÇ",
          ko: "ÏÉùÍ∞Å: ÎïåÎ¶¨Î©¥ Îã§Î•∏ ÏÇ¨ÎûåÏù¥ Îã§Ï≥êÏöî.",
          es: "Piensa: Golpear lastima a otros.",
          de: "Denke: Schlagen tut anderen weh.",
          fi: "Mieti: Ly√∂minen sattuu toisiin.",
          fr: "Pensez : Frapper fait mal aux autres.",
          ar: "ŸÅŸÉÿ±: ÿßŸÑÿ∂ÿ±ÿ® Ÿäÿ§ÿ∞Ÿä ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ.",
          it: "Pensa: Colpire fa male agli altri.",
        },
        greenAction: {
          en: "Tell teacher or draw a picture.",
          zh: "ÂëäË®¥ËÄÅÂ∏´ÊàñÁï´Áï´ÁôºÊ¥©„ÄÇ",
          ja: "ÂÖàÁîü„Å´Ë®Ä„ÅÜ„Åã„ÄÅÁµµ„ÇíÊèè„Åè„ÄÇ",
          ko: "ÏÑ†ÏÉùÎãòÍªò ÎßêÌïòÍ±∞ÎÇò Í∑∏Î¶ºÏùÑ Í∑∏Î¶¨ÏÑ∏Ïöî.",
          es: "Dile al maestro o dibuja un dibujo.",
          de: "Sag es dem Lehrer oder male ein Bild.",
          fi: "Kerro opettajalle tai piirr√§ kuva.",
          fr: "Dites-le au professeur ou dessinez une image.",
          ar: "ÿ£ÿÆÿ®ÿ± ÿßŸÑŸÖÿπŸÑŸÖ ÿ£Ÿà ÿßÿ±ÿ≥ŸÖ ÿµŸàÿ±ÿ©.",
          it: "Dillo all'insegnante o disegna un'immagine.",
        },

        next: {
          en: "Next Step",
          zh: "‰∏ã‰∏ÄÊ≠•",
          ja: "Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó",
          ko: "Îã§Ïùå Îã®Í≥Ñ",
          es: "Siguiente Paso",
          de: "N√§chster Schritt",
          fi: "Seuraava vaihe",
          fr: "√âtape Suivante",
          ar: "ÿßŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©",
          it: "Passo Successivo",
        },
        restart: {
          en: "Try Another",
          zh: "Ë©¶Ë©¶ÂÖ∂‰ªñ",
          ja: "‰ªñ„ÇíË©¶„Åô",
          ko: "Îã§Î•∏ Í≤É ÏãúÎèÑ",
          es: "Probar Otro",
          de: "Ein anderes versuchen",
          fi: "Kokeile toista",
          fr: "Essayer un autre",
          ar: "ÿ¨ÿ±ÿ® ÿ¢ÿÆÿ±",
          it: "Prova un Altro",
        },
        great: {
          en: "Great job managing emotions!",
          zh: "ËôïÁêÜÊÉÖÁ∑íÂÅöÂæóÂ•ΩÔºÅ",
          ja: "ÊÑüÊÉÖ„ÅÆ„Ç≥„É≥„Éà„É≠„Éº„É´„Åå‰∏äÊâã„Åß„Åô„Å≠ÔºÅ",
          ko: "Í∞êÏ†ï Ï°∞Ï†àÏùÑ ÏûòÌñàÏñ¥Ïöî!",
          es: "¬°Gran trabajo manejando emociones!",
          de: "Super, wie du mit Gef√ºhlen umgehst!",
          fi: "Hienoa ty√∂t√§ tunteiden hallinnassa!",
          fr: "Bravo pour la gestion des √©motions !",
          ar: "ÿπŸÖŸÑ ÿπÿ∏ŸäŸÖ ŸÅŸä ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸàÿßÿ∑ŸÅ!",
          it: "Ottimo lavoro nella gestione delle emozioni!",
        },
      };

      const scenarios = [
        {
          id: "angry",
          icon: "üò°",
          color: "bg-red-100",
          redText: "Deep Breaths... Count to 10.",
          yellowText: "Think: Breaking things is bad.",
          greenText: "Talk to an adult calmly.",
        },
        {
          id: "nervous",
          icon: "üò∞",
          color: "bg-blue-100",
          redText: "Stop and drink water.",
          yellowText: "Think: I studied hard, I can do it.",
          greenText: "Do my best!",
        },
        {
          id: "excited",
          icon: "üòÜ",
          color: "bg-yellow-100",
          redText: "Stop running!",
          yellowText: "Think: I might bump into others.",
          greenText: "Play safely.",
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [scenario, setScenario] = useState(null);
        const [step, setStep] = useState(0); // 0: Select Scenario, 1: Red, 2: Yellow, 3: Green, 4: Done

        const getText = (key) => t[key][lang] || t[key]["en"];

        const selectScenario = (s) => {
          setScenario(s);
          setStep(1);
        };

        const nextStep = () => {
          setStep((s) => s + 1);
        };

        const reset = () => {
          setScenario(null);
          setStep(0);
        };

        // Custom localized texts for steps if needed, for now simplifying to generic structure or mapping
        // In real app, would map specific texts. Let's try simple mapping:
        const getSteppedText = (s, step) => {
          // Simplified for prototype: usually would pull from language file
          // Here just return English or mock translated
          const prefix =
            step === 1 ? s.redText : step === 2 ? s.yellowText : s.greenText;
          return prefix; // In real app, put these in 't' object
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-slate-800 mb-8 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              üö• {getText("title")}
            </h1>

            {step === 0 && (
              <div className="w-full max-w-2xl grid grid-cols-1 md:grid-cols-3 gap-6">
                {scenarios.map((s) => (
                  <button
                    key={s.id}
                    onClick={() => selectScenario(s)}
                    className={`${s.color} p-6 rounded-3xl shadow-lg flex flex-col items-center justify-center gap-4 hover:scale-105 transition-transform border-4 border-white`}
                  >
                    <span className="text-6xl">{s.icon}</span>
                    <span className="font-bold text-slate-700 text-lg">
                      {getText(s.id)}
                    </span>
                  </button>
                ))}
              </div>
            )}

            {step > 0 && scenario && (
              <div className="w-full max-w-md flex flex-col items-center">
                {/* Traffic Light Visual */}
                <div className="bg-slate-800 p-4 rounded-3xl flex flex-col gap-4 shadow-2xl mb-8 border-4 border-slate-600">
                  <motion.div
                    animate={{
                      opacity: step === 1 ? 1 : 0.3,
                      scale: step === 1 ? 1.1 : 1,
                    }}
                    className="w-20 h-20 bg-red-500 rounded-full shadow-lg border-4 border-red-600"
                  />
                  <motion.div
                    animate={{
                      opacity: step === 2 ? 1 : 0.3,
                      scale: step === 2 ? 1.1 : 1,
                    }}
                    className="w-20 h-20 bg-yellow-400 rounded-full shadow-lg border-4 border-yellow-500"
                  />
                  <motion.div
                    animate={{
                      opacity: step === 3 ? 1 : 0.3,
                      scale: step === 3 ? 1.1 : 1,
                    }}
                    className="w-20 h-20 bg-green-500 rounded-full shadow-lg border-4 border-green-600"
                  />
                </div>

                <AnimatePresence mode="wait">
                  {step <= 3 ? (
                    <motion.div
                      key={step}
                      initial={{ opacity: 0, x: 50 }}
                      animate={{ opacity: 1, x: 0 }}
                      exit={{ opacity: 0, x: -50 }}
                      className="bg-white p-8 rounded-3xl shadow-xl text-center w-full min-h-[200px] flex flex-col items-center justify-center border-b-8 border-slate-200"
                    >
                      <h2
                        className={`text-4xl font-black mb-4 ${
                          step === 1
                            ? "text-red-500"
                            : step === 2
                            ? "text-yellow-500"
                            : "text-green-500"
                        }`}
                      >
                        {step === 1
                          ? getText("red")
                          : step === 2
                          ? getText("yellow")
                          : getText("green")}
                      </h2>
                      <p className="text-xl font-bold text-slate-600 mb-6">
                        {getSteppedText(scenario, step)}
                      </p>
                      <button
                        onClick={nextStep}
                        className="bg-slate-700 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-slate-800 text-lg"
                      >
                        {getText("next")} ‚û°Ô∏è
                      </button>
                    </motion.div>
                  ) : (
                    <motion.div
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      className="bg-white p-12 rounded-3xl shadow-xl text-center"
                    >
                      <div className="text-8xl mb-4">üòå</div>
                      <h2 className="text-3xl font-black text-green-600 mb-6">
                        {getText("great")}
                      </h2>
                      <button
                        onClick={reset}
                        className="bg-blue-500 text-white px-10 py-4 rounded-full font-black text-xl hover:bg-blue-600 shadow-xl"
                      >
                        {getText("restart")} üîÑ
                      </button>
                    </motion.div>
                  )}
                </AnimatePresence>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
