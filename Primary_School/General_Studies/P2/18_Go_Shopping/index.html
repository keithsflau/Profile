<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫åÂ∏∏Ë≠òÔºöÁ≤æÊòéÂ∞èÈ°ßÂÆ¢ | Go Shopping</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Go Shopping",
          zh: "Á≤æÊòéÂ∞èÈ°ßÂÆ¢",
          ja: "Ë≤∑„ÅÑÁâ©„Å´Ë°å„Åì„ÅÜ",
          ko: "ÏáºÌïëÌïòÎü¨ Í∞ÄÏöî",
          es: "Ir de Compras",
          de: "Einkaufen gehen",
          fi: "Menn√§√§n ostoksille",
          fr: "Faire les courses",
          ar: "ÿßŸÑÿ∞Ÿáÿßÿ® ŸÑŸÑÿ™ÿ≥ŸàŸÇ",
          it: "Andare a Fare Spesa",
        },
        instruction: {
          en: "Pay the exact amount!",
          zh: "Ë´ã‰ªòÊ∫ñÁ¢∫ÁöÑÈáëÈ°çÔºÅ",
          ja: "Ê≠£Á¢∫„Å™ÈáëÈ°ç„ÇíÊîØÊâï„Å£„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "Ï†ïÌôïÌïú Í∏àÏï°ÏùÑ ÏßÄÎ∂àÌïòÏÑ∏Ïöî!",
          es: "¬°Paga la cantidad exacta!",
          de: "Bezahle den genauen Betrag!",
          fi: "Maksa tarkka summa!",
          fr: "Payez le montant exact !",
          ar: "ÿßÿØŸÅÿπ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ≠ÿØÿØ!",
          it: "Paga l'importo esatto!",
        },
        price: {
          en: "Price",
          zh: "ÂÉπÈå¢",
          ja: "‰æ°Ê†º",
          ko: "Í∞ÄÍ≤©",
          es: "Precio",
          de: "Preis",
          fi: "Hinta",
          fr: "Prix",
          ar: "ÿ≥ÿπÿ±",
          it: "Prezzo",
        },
        paid: {
          en: "Paid",
          zh: "Â∑≤‰ªò",
          ja: "ÊîØÊâïÊ∏à„Åø",
          ko: "ÏßÄÎ∂àÎê®",
          es: "Pagado",
          de: "Bezahlt",
          fi: "Maksettu",
          fr: "Pay√©",
          ar: "ŸÖÿØŸÅŸàÿπ",
          it: "Pagato",
        },
        pay: {
          en: "Pay Now",
          zh: "‰ªòÊ¨æ",
          ja: "‰ªä„Åô„ÅêÊîØÊâï„ÅÜ",
          ko: "ÏßÄÍ∏à ÏßÄÎ∂à",
          es: "Pagar Ahora",
          de: "Jetzt bezahlen",
          fi: "Maksa nyt",
          fr: "Payer maintenant",
          ar: "ÿßÿØŸÅÿπ ÿßŸÑÿ¢ŸÜ",
          it: "Paga Ora",
        },
        reset: {
          en: "Reset",
          zh: "ÈáçÁΩÆ",
          ja: "„É™„Çª„ÉÉ„Éà",
          ko: "Î¶¨ÏÖã",
          es: "Reiniciar",
          de: "Zur√ºcksetzen",
          fi: "Nollaa",
          fr: "R√©initialiser",
          ar: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ",
          it: "Resetta",
        },

        correct: {
          en: "Payment Successful!",
          zh: "‰ªòÊ¨æÊàêÂäüÔºÅ",
          ja: "ÊîØÊâï„ÅÑÊàêÂäüÔºÅ",
          ko: "Í≤∞Ï†ú ÏÑ±Í≥µ!",
          es: "¬°Pago Exitoso!",
          de: "Zahlung erfolgreich!",
          fi: "Maksu onnistui!",
          fr: "Paiement r√©ussi !",
          ar: "ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ÿ®ŸÜÿ¨ÿßÿ≠!",
          it: "Pagamento Riuscito!",
        },
        wrong: {
          en: "Amount is incorrect.",
          zh: "ÈáëÈ°ç‰∏çÊ≠£Á¢∫„ÄÇ",
          ja: "ÈáëÈ°ç„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
          ko: "Í∏àÏï°Ïù¥ ÌãÄÎ†∏ÏäµÎãàÎã§.",
          es: "La cantidad es incorrecta.",
          de: "Betrag ist falsch.",
          fi: "Summa on v√§√§r√§.",
          fr: "Le montant est incorrect.",
          ar: "ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠.",
          it: "L'importo non √® corretto.",
        },
        next: {
          en: "Next Item",
          zh: "‰∏ã‰∏Ä‰ª∂Ë≤®ÂìÅ",
          ja: "Ê¨°„ÅÆ„Ç¢„Ç§„ÉÜ„É†",
          ko: "Îã§Ïùå ÏÉÅÌíà",
          es: "Siguiente Art√≠culo",
          de: "N√§chster Artikel",
          fi: "Seuraava tuote",
          fr: "Article suivant",
          ar: "ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ™ÿßŸÑŸä",
          it: "Prossimo Oggetto",
        },

        apple: {
          en: "Apple",
          zh: "ËòãÊûú",
          ja: "„Çä„Çì„Åî",
          ko: "ÏÇ¨Í≥º",
          es: "Manzana",
          de: "Apfel",
          fi: "Omena",
          fr: "Pomme",
          ar: "ÿ™ŸÅÿßÿ≠ÿ©",
          it: "Mela",
        },
        milk: {
          en: "Milk",
          zh: "ÁâõÂ•∂",
          ja: "Áâõ‰π≥",
          ko: "Ïö∞Ïú†",
          es: "Leche",
          de: "Milch",
          fi: "Maito",
          fr: "Lait",
          ar: "ÿ≠ŸÑŸäÿ®",
          it: "Latte",
        },
        bread: {
          en: "Bread",
          zh: "È∫µÂåÖ",
          ja: "„Éë„É≥",
          ko: "Îπµ",
          es: "Pan",
          de: "Brot",
          fi: "Leip√§",
          fr: "Pain",
          ar: "ÿÆÿ®ÿ≤",
          it: "Pane",
        },
        pencil: {
          en: "Pencil",
          zh: "ÈâõÁ≠Ü",
          ja: "ÈâõÁ≠Ü",
          ko: "Ïó∞ÌïÑ",
          es: "L√°piz",
          de: "Bleistift",
          fi: "Lyijykyn√§",
          fr: "Crayon",
          ar: "ŸÇŸÑŸÖ ÿ±ÿµÿßÿµ",
          it: "Matita",
        },
        toy: {
          en: "Toy Car",
          zh: "Áé©ÂÖ∑Ëªä",
          ja: "„Åä„ÇÇ„Å°„ÇÉ„ÅÆËªä",
          ko: "Ïû•ÎÇúÍ∞ê ÏûêÎèôÏ∞®",
          es: "Coche de Juguete",
          de: "Spielzeugauto",
          fi: "Leluauto",
          fr: "Voiture jouet",
          ar: "ÿ≥Ÿäÿßÿ±ÿ© ŸÑÿπÿ®ÿ©",
          it: "Macchinina",
        },
      };

      const coins = [
        {
          val: 10,
          label: "$10",
          color: "bg-yellow-600/20 border-yellow-700 text-yellow-900",
          size: "w-24 h-24",
        }, // $10 Coin logic? Usually $10 is coin in HK.
        {
          val: 5,
          label: "$5",
          color: "bg-slate-300 border-slate-400 text-slate-700",
          size: "w-20 h-20",
        },
        {
          val: 2,
          label: "$2",
          color: "bg-amber-200 border-amber-400 text-amber-800 wavy-edge",
          size: "w-16 h-16",
        },
        {
          val: 1,
          label: "$1",
          color: "bg-slate-200 border-slate-300 text-slate-600",
          size: "w-14 h-14",
        },
        {
          val: 0.5,
          label: "50¬¢",
          color: "bg-amber-700/50 border-amber-800 text-white",
          size: "w-12 h-12",
        },
        // Simplified: maybe stick to dollars first for P2? P2 learns money cents too.
        // Let's use 10, 5, 2, 1, 0.5 (50cents)
      ];

      const items = [
        { id: "apple", price: 3.5, icon: "üçé" },
        { id: "milk", price: 6.5, icon: "ü•õ" },
        { id: "bread", price: 9.0, icon: "üçû" },
        { id: "pencil", price: 2.5, icon: "‚úèÔ∏è" },
        { id: "toy", price: 15.5, icon: "üèéÔ∏è" }, // requires mixed coins
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [currentItem, setCurrentItem] = useState(items[0]);
        const [paidAmount, setPaidAmount] = useState(0);
        const [paidCoins, setPaidCoins] = useState([]);
        const [status, setStatus] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          newGame();
        }, []);

        const newGame = () => {
          const item = items[Math.floor(Math.random() * items.length)];
          setCurrentItem(item);
          setPaidAmount(0);
          setPaidCoins([]);
          setStatus(null);
        };

        const addCoin = (coin) => {
          setPaidAmount((p) => parseFloat((p + coin.val).toFixed(1))); // avoid float errors
          setPaidCoins((prev) => [...prev, coin]);
          setStatus(null);
        };

        const reset = () => {
          setPaidAmount(0);
          setPaidCoins([]);
          setStatus(null);
        };

        const pay = () => {
          if (paidAmount === currentItem.price) {
            setStatus("correct");
          } else {
            setStatus("wrong");
          }
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center select-none">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-amber-800 mb-4 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              üõí {getText("title")}
            </h1>

            <div className="flex flex-col lg:flex-row gap-8 w-full max-w-4xl items-start">
              {/* Item Display */}
              <div className="w-full lg:w-1/3 bg-white rounded-3xl p-8 shadow-xl border-4 border-amber-200 flex flex-col items-center">
                <div className="text-9xl mb-4 filter drop-shadow-lg">
                  {currentItem.icon}
                </div>
                <div className="text-2xl font-bold text-slate-700 mb-2">
                  {getText(currentItem.id)}
                </div>
                <div className="text-5xl font-black text-amber-600 bg-amber-50 px-6 py-2 rounded-xl shadow-inner mb-4">
                  ${currentItem.price.toFixed(1)}
                </div>
              </div>

              {/* Payment Area */}
              <div className="flex-1 w-full bg-slate-800 rounded-3xl p-6 shadow-2xl relative min-h-[400px]">
                {/* Screen */}
                <div className="bg-green-900 border-4 border-slate-600 rounded-xl p-4 mb-4 font-mono text-green-400 text-right text-4xl shadow-[inset_0_0_20px_black]">
                  <div className="text-sm opacity-50 mb-1">TOTAL</div>$
                  {paidAmount.toFixed(1)}
                </div>

                {/* Coin Slot / Tray Visual */}
                <div className="bg-slate-700/50 rounded-2xl h-48 mb-4 border-2 border-dashed border-slate-500 overflow-hidden relative flex flex-wrap content-start p-2 gap-2">
                  <AnimatePresence>
                    {paidCoins.map((c, i) => (
                      <motion.div
                        key={i}
                        initial={{
                          scale: 0,
                          y: -50,
                          rotate: Math.random() * 360,
                        }}
                        animate={{ scale: 1, y: 0 }}
                        className={`rounded-full flex items-center justify-center font-bold shadow-lg border-2 ${c.color} w-12 h-12 text-xs`}
                      >
                        {c.label}
                      </motion.div>
                    ))}
                  </AnimatePresence>
                  {paidCoins.length === 0 && (
                    <div className="absolute inset-0 flex items-center justify-center text-slate-500 font-bold">
                      {getText("instruction")}
                    </div>
                  )}
                </div>

                {status && (
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className={`absolute top-1/2 left-0 right-0 mx-auto w-3/4 p-4 rounded-xl text-center font-black text-2xl shadow-xl z-20 ${
                      status === "correct"
                        ? "bg-green-100 text-green-700"
                        : "bg-red-100 text-red-600"
                    }`}
                  >
                    {getText(status)}
                    {status === "correct" && (
                      <div className="mt-2">
                        <button
                          onClick={newGame}
                          className="bg-green-600 text-white px-6 py-2 rounded-full text-lg shadow"
                        >
                          {getText("next")}
                        </button>
                      </div>
                    )}
                  </motion.div>
                )}

                {/* Wallet / Coin Bank */}
                <div className="bg-amber-900/40 p-4 rounded-2xl">
                  <div className="flex flex-wrap justify-center gap-4">
                    {coins.map((c) => (
                      <button
                        key={c.label}
                        onClick={() => addCoin(c)}
                        disabled={status === "correct"}
                        className={`${c.size} ${c.color} rounded-full flex items-center justify-center font-bold shadow-lg border-b-4 active:border-b-0 active:translate-y-1 transition-all hover:brightness-110`}
                      >
                        {c.label}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Controls */}
                <div className="flex gap-4 mt-6">
                  <button
                    onClick={pay}
                    className="flex-1 bg-green-600 text-white py-4 rounded-xl font-bold shadow-xl border-b-4 border-green-800 active:border-b-0 active:translate-y-1 text-xl"
                  >
                    {getText("pay")}
                  </button>
                  <button
                    onClick={reset}
                    className="w-1/3 bg-red-500 text-white py-4 rounded-xl font-bold shadow-xl border-b-4 border-red-700 active:border-b-0 active:translate-y-1 text-xl"
                  >
                    X
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
