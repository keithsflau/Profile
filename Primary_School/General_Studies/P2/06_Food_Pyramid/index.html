<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°äºŒå¸¸è­˜ï¼šé£Ÿç‰©é‡‘å­—å¡” | Food Pyramid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fefce8 0%, #fde047 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Food Pyramid",
          zh: "é£Ÿç‰©é‡‘å­—å¡”",
          ja: "é£Ÿå“ãƒ”ãƒ©ãƒŸãƒƒãƒ‰",
        },
        instruction: {
          en: "Drag the food to the correct level!",
          zh: "æŠŠé£Ÿç‰©æ‹–åˆ°æ­£ç¢ºçš„å±¤ç´šï¼",
          ja: "é£Ÿã¹ç‰©ã‚’æ­£ã—ã„ãƒ¬ãƒ™ãƒ«ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„ï¼",
        },
        level1: { en: "Eat Most (Grains)", zh: "åƒæœ€å¤š (äº”ç©€é¡)" },
        level2: { en: "Eat More (Fruit & Veg)", zh: "åƒå¤šäº› (è”¬æœé¡)" },
        level3: { en: "Eat Moderately (Meat/Dairy)", zh: "åƒé©é‡ (è‚‰å¥¶é¡)" },
        level4: { en: "Eat Less (Fat/Sugar)", zh: "åƒæœ€å°‘ (æ²¹ç³–é¹½)" },

        check: { en: "Check", zh: "æª¢æŸ¥" },
        reset: { en: "Reset", zh: "é‡ç½®" },
        correct: { en: "Healthy Choice!", zh: "å¥åº·ä¹‹é¸ï¼" },
        wrong: { en: "Some items are misplaced.", zh: "æœ‰äº›é£Ÿç‰©æ”¾éŒ¯ä½ç½®äº†ã€‚" },

        rice: { en: "Rice", zh: "ç±³é£¯" },
        bread: { en: "Bread", zh: "éºµåŒ…" },
        noodle: { en: "Noodles", zh: "éºµæ¢" },

        apple: { en: "Apple", zh: "è˜‹æœ" },
        carrot: { en: "Carrot", zh: "ç´…è˜¿è””" },
        banana: { en: "Banana", zh: "é¦™è•‰" },

        fish: { en: "Fish", zh: "é­š" },
        egg: { en: "Egg", zh: "é›è›‹" },
        milk: { en: "Milk", zh: "ç‰›å¥¶" },

        candy: { en: "Candy", zh: "ç³–æœ" },
        cake: { en: "Cake", zh: "è›‹ç³•" },
        fries: { en: "Fries", zh: "è–¯æ¢" },
      };

      const levels = [
        {
          id: "level4",
          label: "level4",
          color: "bg-red-400 border-red-600",
          shape: "clip-path-triangle-top",
          correct: ["candy", "cake", "fries"],
        },
        {
          id: "level3",
          label: "level3",
          color: "bg-blue-400 border-blue-600",
          shape: "clip-path-trapezoid",
          correct: ["fish", "egg", "milk"],
        },
        {
          id: "level2",
          label: "level2",
          color: "bg-green-400 border-green-600",
          shape: "clip-path-trapezoid",
          correct: ["apple", "carrot", "banana"],
        },
        {
          id: "level1",
          label: "level1",
          color: "bg-yellow-400 border-yellow-600",
          shape: "clip-path-trapezoid-bottom",
          correct: ["rice", "bread", "noodle"],
        },
      ];

      const foods = [
        { id: "rice", icon: "ğŸš" },
        { id: "bread", icon: "ğŸ" },
        { id: "noodle", icon: "ğŸœ" },
        { id: "apple", icon: "ğŸ" },
        { id: "carrot", icon: "ğŸ¥•" },
        { id: "banana", icon: "ğŸŒ" },
        { id: "fish", icon: "ğŸŸ" },
        { id: "egg", icon: "ğŸ¥š" },
        { id: "milk", icon: "ğŸ¥›" },
        { id: "candy", icon: "ğŸ¬" },
        { id: "cake", icon: "ğŸ°" },
        { id: "fries", icon: "ğŸŸ" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [placements, setPlacements] = useState({}); // foodId -> levelId
        const [available, setAvailable] = useState([]);
        const [status, setStatus] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          reset();
        }, []);

        const reset = () => {
          setAvailable(foods.map((f) => f.id).sort(() => Math.random() - 0.5));
          setPlacements({});
          setStatus(null);
        };

        const handleDrop = (foodId, levelId) => {
          setPlacements((prev) => ({ ...prev, [foodId]: levelId }));
          setAvailable((prev) => prev.filter((id) => id !== foodId));
          setStatus(null);
        };

        const checkAnswers = () => {
          const allPlaced = available.length === 0;
          if (!allPlaced) {
            setStatus("wrong"); // Or prompt to finish
            // Actually allow checking anytime? No, logic needs placement.
          }

          // Check valid
          let isCorrect = true;
          Object.entries(placements).forEach(([fId, lId]) => {
            const level = levels.find((l) => l.id === lId);
            if (!level.correct.includes(fId)) isCorrect = false;
          });

          if (isCorrect && allPlaced) setStatus("correct");
          else setStatus("wrong");
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-amber-800 mb-4 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              ğŸ¥ª {getText("title")}
            </h1>
            <p className="font-bold text-amber-700 mb-6">
              {getText("instruction")}
            </p>

            <div className="flex flex-col lg:flex-row gap-8 w-full max-w-6xl items-start">
              {/* Pyramid Container */}
              <div className="flex-1 w-full flex flex-col items-center scale-90 md:scale-100 origin-top">
                {levels.map((lvl) => (
                  <div
                    key={lvl.id}
                    className={`w-full flex justify-center py-2 transition-all`}
                    onDragOver={(e) => e.preventDefault()}
                    onDrop={(e) => {
                      e.preventDefault();
                      const id = e.dataTransfer.getData("foodId");
                      if (id) handleDrop(id, lvl.id);
                    }}
                  >
                    <div
                      className={`${lvl.color} flex flex-wrap items-center justify-center gap-2 transition-colors border-4 border-dashed border-white/40 shadow-xl rounded-xl relative`}
                      style={{
                        width:
                          lvl.id === "level4"
                            ? "200px"
                            : lvl.id === "level3"
                            ? "350px"
                            : lvl.id === "level2"
                            ? "500px"
                            : "650px",
                        height: "140px",
                      }}
                    >
                      <span className="absolute top-1 left-2 bg-black/20 text-white text-xs font-bold px-2 rounded opacity-80 backdrop-blur-sm pointer-events-none">
                        {getText(lvl.label)}
                      </span>
                      {Object.entries(placements)
                        .filter(([_, l]) => l === lvl.id)
                        .map(([fId, _]) => {
                          const food = foods.find((f) => f.id === fId);
                          return (
                            <div
                              key={fId}
                              className="bg-white rounded-full p-2 text-3xl shadow-md cursor-pointer hover:scale-110 transition-transform"
                              onClick={() => {
                                const next = { ...placements };
                                delete next[fId];
                                setPlacements(next);
                                setAvailable((prev) => [...prev, fId]);
                              }}
                            >
                              {food.icon}
                            </div>
                          );
                        })}
                    </div>
                  </div>
                ))}
              </div>

              {/* Food Bank */}
              <div className="w-full lg:w-1/3 flex flex-col items-center">
                <div className="bg-white/80 p-6 rounded-3xl shadow-lg w-full min-h-[300px]">
                  <h3 className="font-bold text-slate-500 mb-4 text-center">
                    Food Items
                  </h3>
                  <div className="flex flex-wrap gap-4 justify-center">
                    {available.map((fId) => {
                      const f = foods.find((x) => x.id === fId);
                      return (
                        <div
                          key={f.id}
                          draggable
                          onDragStart={(e) =>
                            e.dataTransfer.setData("foodId", f.id)
                          }
                          className="w-16 h-16 bg-white rounded-xl shadow-md flex items-center justify-center text-4xl cursor-grab active:cursor-grabbing hover:scale-110 transition-transform border-2 border-slate-100"
                        >
                          {f.icon}
                        </div>
                      );
                    })}
                  </div>
                </div>

                {status && (
                  <div
                    className={`mt-4 p-4 rounded-2xl font-black text-center text-xl shadow w-full ${
                      status === "correct"
                        ? "bg-green-100 text-green-700"
                        : "bg-red-100 text-red-600"
                    }`}
                  >
                    {getText(status)}
                  </div>
                )}

                <div className="flex gap-4 w-full mt-4">
                  <button
                    onClick={checkAnswers}
                    className="flex-1 bg-amber-500 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-amber-600"
                  >
                    {getText("check")}
                  </button>
                  <button
                    onClick={reset}
                    className="flex-1 bg-slate-200 text-slate-600 py-3 rounded-xl font-bold shadow-lg hover:bg-slate-300"
                  >
                    {getText("reset")}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          ã€Œè€¶å’Œè¯ç”¨èƒ½åŠ›å‰µé€ å¤§åœ°ï¼Œç”¨æ™ºæ…§å»ºç«‹ä¸–ç•Œï¼Œç”¨è°æ˜é‹ªå¼µç©¹è’¼ã€‚ã€ è€¶åˆ©ç±³æ›¸ 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
