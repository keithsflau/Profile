<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫åÂ∏∏Ë≠òÔºöÈ£üÁâ©ÈáëÂ≠óÂ°î | Food Pyramid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fefce8 0%, #fde047 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Food Pyramid",
          zh: "È£üÁâ©ÈáëÂ≠óÂ°î",
          ja: "È£üÂìÅ„Éî„É©„Éü„ÉÉ„Éâ",
          ko: "ÏãùÌíà ÌîºÎùºÎØ∏Îìú",
          es: "Pir√°mide Alimenticia",
          de: "Lebensmittelpyramide",
          fi: "Ruokapyramidi",
          fr: "Pyramide Alimentaire",
          ar: "ÿßŸÑŸáÿ±ŸÖ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä",
          it: "Piramide Alimentare",
        },
        instruction: {
          en: "Drag the food to the correct level!",
          zh: "ÊääÈ£üÁâ©ÊãñÂà∞Ê≠£Á¢∫ÁöÑÂ±§Á¥öÔºÅ",
          ja: "È£ü„ÅπÁâ©„ÇíÊ≠£„Åó„ÅÑ„É¨„Éô„É´„Å´„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
          ko: "ÏùåÏãùÏùÑ Ïò¨Î∞îÎ•∏ Îã®Í≥ÑÎ°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî!",
          es: "¬°Arrastra la comida al nivel correcto!",
          de: "Zieh das Essen auf die richtige Ebene!",
          fi: "Raahaa ruoka oikealle tasolle!",
          fr: "Faites glisser les aliments au bon niveau !",
          ar: "ÿßÿ≥ÿ≠ÿ® ÿßŸÑÿ∑ÿπÿßŸÖ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿµÿ≠Ÿäÿ≠!",
          it: "Trascina il cibo al livello corretto!",
        },
        level1: {
          en: "Eat Most (Grains)",
          zh: "ÂêÉÊúÄÂ§ö (‰∫îÁ©ÄÈ°û)",
          ja: "ÊúÄ„ÇÇÈ£ü„Åπ„Çã (Á©ÄÁâ©)",
          ko: "Í∞ÄÏû• ÎßéÏù¥ ÎìúÏÑ∏Ïöî (Í≥°Î¨º)",
          es: "Comer M√°s (Granos)",
          de: "Am meisten essen (Getreide)",
          fi: "Sy√∂ eniten (Viljat)",
          fr: "Manger le plus (C√©r√©ales)",
          ar: "ÿ™ÿ£ŸÉŸÑ ÿ£ŸÉÿ´ÿ± (ÿ≠ÿ®Ÿàÿ®)",
          it: "Mangia di Pi√π (Cereali)",
        },
        level2: {
          en: "Eat More (Fruit & Veg)",
          zh: "ÂêÉÂ§ö‰∫õ (Ëî¨ÊûúÈ°û)",
          ja: "Â§ö„ÇÅ„Å´È£ü„Åπ„Çã (ÈáéËèú„ÉªÊûúÁâ©)",
          ko: "ÎßéÏù¥ ÎìúÏÑ∏Ïöî (Í≥ºÏùº Î∞è Ï±ÑÏÜå)",
          es: "Comer Mucho (Frutas/Verduras)",
          de: "Viel essen (Obst & Gem√ºse)",
          fi: "Sy√∂ paljon (Hedelm√§t & Vihannekset)",
          fr: "Manger beaucoup (Fruits et L√©gumes)",
          ar: "ÿ™ÿ£ŸÉŸÑ ŸÉÿ´Ÿäÿ±ÿß (ŸÅŸàÿßŸÉŸá ŸàÿÆÿ∂ÿ±Ÿàÿßÿ™)",
          it: "Mangia Molto (Frutta e Verdura)",
        },
        level3: {
          en: "Eat Moderately (Meat/Dairy)",
          zh: "ÂêÉÈÅ©Èáè (ËÇâÂ•∂È°û)",
          ja: "ÈÅ©Â∫¶„Å´È£ü„Åπ„Çã (ËÇâ„Éª‰π≥Ë£ΩÂìÅ)",
          ko: "Ï†ÅÎãπÌûà ÎìúÏÑ∏Ïöî (Í≥†Í∏∞/Ïú†Ï†úÌíà)",
          es: "Comer Moderadamente (Carne/L√°cteos)",
          de: "M√§√üig essen (Fleisch/Milchprodukte)",
          fi: "Sy√∂ kohtuullisesti (Liha/Maitotuotteet)",
          fr: "Manger mod√©r√©ment (Viande/Laitages)",
          ar: "ÿ™ÿ£ŸÉŸÑ ÿ®ÿßÿπÿ™ÿØÿßŸÑ (ŸÑÿ≠ŸÖ/ÿ£ŸÑÿ®ÿßŸÜ)",
          it: "Mangia Moderatamente (Carne/Latticini)",
        },
        level4: {
          en: "Eat Less (Fat/Sugar)",
          zh: "ÂêÉÊúÄÂ∞ë (Ê≤πÁ≥ñÈπΩ)",
          ja: "Â∞ë„Å™„ÅèÈ£ü„Åπ„Çã (ËÑÇËÇ™„ÉªÁ≥ñÂàÜ)",
          ko: "Ï†ÅÍ≤å ÎìúÏÑ∏Ïöî (ÏßÄÎ∞©/ÏÑ§ÌÉï)",
          es: "Comer Menos (Grasa/Az√∫car)",
          de: "Wenig essen (Fett/Zucker)",
          fi: "Sy√∂ v√§h√§n (Rasva/Sokeri)",
          fr: "Manger moins (Gras/Sucre)",
          ar: "ÿ™ÿ£ŸÉŸÑ ÿ£ŸÇŸÑ (ÿØŸáŸàŸÜ/ÿ≥ŸÉÿ±)",
          it: "Mangia Meno (Grassi/Zucchero)",
        },

        check: {
          en: "Check",
          zh: "Ê™¢Êü•",
          ja: "Á¢∫Ë™ç",
          ko: "ÌôïÏù∏",
          es: "Comprobar",
          de: "Pr√ºfen",
          fi: "Tarkista",
          fr: "V√©rifier",
          ar: "ÿ™ÿ≠ŸÇŸÇ",
          it: "Controlla",
        },
        reset: {
          en: "Reset",
          zh: "ÈáçÁΩÆ",
          ja: "„É™„Çª„ÉÉ„Éà",
          ko: "Î¶¨ÏÖã",
          es: "Reiniciar",
          de: "Zur√ºcksetzen",
          fi: "Nollaa",
          fr: "R√©initialiser",
          ar: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ",
          it: "Resetta",
        },
        correct: {
          en: "Healthy Choice!",
          zh: "ÂÅ•Â∫∑‰πãÈÅ∏ÔºÅ",
          ja: "„Éò„É´„Ç∑„Éº„Å™ÈÅ∏ÊäûÔºÅ",
          ko: "Í±¥Í∞ïÌïú ÏÑ†ÌÉù!",
          es: "¬°Elecci√≥n Saludable!",
          de: "Gesunde Wahl!",
          fi: "Terveellinen valinta!",
          fr: "Choix Sain !",
          ar: "ÿÆŸäÿßÿ± ÿµÿ≠Ÿä!",
          it: "Scelta Salutare!",
        },
        wrong: {
          en: "Some items are misplaced.",
          zh: "Êúâ‰∫õÈ£üÁâ©ÊîæÈåØ‰ΩçÁΩÆ‰∫Ü„ÄÇ",
          ja: "„ÅÑ„Åè„Å§„Åã„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
          ko: "ÏùºÎ∂Ä Ìï≠Î™©Ïù¥ ÏûòÎ™ª Î∞∞ÏπòÎêòÏóàÏäµÎãàÎã§.",
          es: "Algunos art√≠culos est√°n mal colocados.",
          de: "Einige Gegenst√§nde sind falsch platziert.",
          fi: "Jotkut tavarat ovat v√§√§r√§ss√§ paikassa.",
          fr: "Certains objets sont mal plac√©s.",
          ar: "ÿ®ÿπÿ∂ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÅŸä ÿ∫Ÿäÿ± ŸÖŸÉÿßŸÜŸáÿß.",
          it: "Alcuni oggetti sono fuori posto.",
        },

        rice: {
          en: "Rice",
          zh: "Á±≥È£Ø",
          ja: "„ÅîÈ£Ø",
          ko: "Î∞•",
          es: "Arroz",
          de: "Reis",
          fi: "Riisi",
          fr: "Riz",
          ar: "ÿ£ÿ±ÿ≤",
          it: "Riso",
        },
        bread: {
          en: "Bread",
          zh: "È∫µÂåÖ",
          ja: "„Éë„É≥",
          ko: "Îπµ",
          es: "Pan",
          de: "Brot",
          fi: "Leip√§",
          fr: "Pain",
          ar: "ÿÆÿ®ÿ≤",
          it: "Pane",
        },
        noodle: {
          en: "Noodles",
          zh: "È∫µÊ¢ù",
          ja: "È∫∫",
          ko: "Íµ≠Ïàò",
          es: "Fideos",
          de: "Nudeln",
          fi: "Nuudelit",
          fr: "Nouilles",
          ar: "ŸÖÿπŸÉÿ±ŸàŸÜÿ©",
          it: "Tagliatelle",
        },

        apple: {
          en: "Apple",
          zh: "ËòãÊûú",
          ja: "„Çä„Çì„Åî",
          ko: "ÏÇ¨Í≥º",
          es: "Manzana",
          de: "Apfel",
          fi: "Omena",
          fr: "Pomme",
          ar: "ÿ™ŸÅÿßÿ≠ÿ©",
          it: "Mela",
        },
        carrot: {
          en: "Carrot",
          zh: "Á¥ÖËòøËîî",
          ja: "‰∫∫ÂèÇ",
          ko: "ÎãπÍ∑º",
          es: "Zanahoria",
          de: "Karotte",
          fi: "Porkkana",
          fr: "Carotte",
          ar: "ÿ¨ÿ≤ÿ±ÿ©",
          it: "Carota",
        },
        banana: {
          en: "Banana",
          zh: "È¶ôËïâ",
          ja: "„Éê„Éä„Éä",
          ko: "Î∞îÎÇòÎÇò",
          es: "Pl√°tano",
          de: "Banane",
          fi: "Banaani",
          fr: "Banane",
          ar: "ŸÖŸàÿ≤",
          it: "Banana",
        },

        fish: {
          en: "Fish",
          zh: "È≠ö",
          ja: "È≠ö",
          ko: "ÏÉùÏÑ†",
          es: "Pescado",
          de: "Fisch",
          fi: "Kala",
          fr: "Poisson",
          ar: "ÿ≥ŸÖŸÉ",
          it: "Pesce",
        },
        egg: {
          en: "Egg",
          zh: "ÈõûËõã",
          ja: "Âçµ",
          ko: "Îã¨Í±Ä",
          es: "Huevo",
          de: "Ei",
          fi: "Kananmuna",
          fr: "≈íuf",
          ar: "ÿ®Ÿäÿ∂",
          it: "Uovo",
        },
        milk: {
          en: "Milk",
          zh: "ÁâõÂ•∂",
          ja: "Áâõ‰π≥",
          ko: "Ïö∞Ïú†",
          es: "Leche",
          de: "Milch",
          fi: "Maito",
          fr: "Lait",
          ar: "ÿ≠ŸÑŸäÿ®",
          it: "Latte",
        },

        candy: {
          en: "Candy",
          zh: "Á≥ñÊûú",
          ja: "„Ç≠„É£„É≥„Éá„Ç£",
          ko: "ÏÇ¨ÌÉï",
          es: "Dulces",
          de: "S√º√üigkeiten",
          fi: "Karkki",
          fr: "Bonbon",
          ar: "ÿ≠ŸÑŸàŸâ",
          it: "Caramella",
        },
        cake: {
          en: "Cake",
          zh: "ËõãÁ≥ï",
          ja: "„Ç±„Éº„Ç≠",
          ko: "ÏºÄÏù¥ÌÅ¨",
          es: "Pastel",
          de: "Kuchen",
          fi: "Kakku",
          fr: "G√¢teau",
          ar: "ŸÉÿπŸÉÿ©",
          it: "Torta",
        },
        fries: {
          en: "Fries",
          zh: "ËñØÊ¢ù",
          ja: "„Éï„É©„Ç§„Éâ„Éù„ÉÜ„Éà",
          ko: "Í∞êÏûêÌäÄÍπÄ",
          es: "Papas Fritas",
          de: "Pommes",
          fi: "Ranskalaiset",
          fr: "Frites",
          ar: "ÿ®ÿ∑ÿßÿ∑ÿ≥ ŸÖŸÇŸÑŸäÿ©",
          it: "Patatine Fritte",
        },
      };

      const levels = [
        {
          id: "level4",
          label: "level4",
          color: "bg-red-400 border-red-600",
          shape: "clip-path-triangle-top",
          correct: ["candy", "cake", "fries"],
        },
        {
          id: "level3",
          label: "level3",
          color: "bg-blue-400 border-blue-600",
          shape: "clip-path-trapezoid",
          correct: ["fish", "egg", "milk"],
        },
        {
          id: "level2",
          label: "level2",
          color: "bg-green-400 border-green-600",
          shape: "clip-path-trapezoid",
          correct: ["apple", "carrot", "banana"],
        },
        {
          id: "level1",
          label: "level1",
          color: "bg-yellow-400 border-yellow-600",
          shape: "clip-path-trapezoid-bottom",
          correct: ["rice", "bread", "noodle"],
        },
      ];

      const foods = [
        { id: "rice", icon: "üçö" },
        { id: "bread", icon: "üçû" },
        { id: "noodle", icon: "üçú" },
        { id: "apple", icon: "üçé" },
        { id: "carrot", icon: "ü•ï" },
        { id: "banana", icon: "üçå" },
        { id: "fish", icon: "üêü" },
        { id: "egg", icon: "ü•ö" },
        { id: "milk", icon: "ü•õ" },
        { id: "candy", icon: "üç¨" },
        { id: "cake", icon: "üç∞" },
        { id: "fries", icon: "üçü" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [placements, setPlacements] = useState({}); // foodId -> levelId
        const [available, setAvailable] = useState([]);
        const [status, setStatus] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          reset();
        }, []);

        const reset = () => {
          setAvailable(foods.map((f) => f.id).sort(() => Math.random() - 0.5));
          setPlacements({});
          setStatus(null);
        };

        const handleDrop = (foodId, levelId) => {
          setPlacements((prev) => ({ ...prev, [foodId]: levelId }));
          setAvailable((prev) => prev.filter((id) => id !== foodId));
          setStatus(null);
        };

        const checkAnswers = () => {
          const allPlaced = available.length === 0;
          if (!allPlaced) {
            setStatus("wrong"); // Or prompt to finish
            // Actually allow checking anytime? No, logic needs placement.
          }

          // Check valid
          let isCorrect = true;
          Object.entries(placements).forEach(([fId, lId]) => {
            const level = levels.find((l) => l.id === lId);
            if (!level.correct.includes(fId)) isCorrect = false;
          });

          if (isCorrect && allPlaced) setStatus("correct");
          else setStatus("wrong");
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-amber-800 mb-4 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              ü•™ {getText("title")}
            </h1>
            <p className="font-bold text-amber-700 mb-6">
              {getText("instruction")}
            </p>

            <div className="flex flex-col lg:flex-row gap-8 w-full max-w-6xl items-start">
              {/* Pyramid Container */}
              <div className="flex-1 w-full flex flex-col items-center scale-90 md:scale-100 origin-top">
                {levels.map((lvl) => (
                  <div
                    key={lvl.id}
                    className={`w-full flex justify-center py-2 transition-all`}
                    onDragOver={(e) => e.preventDefault()}
                    onDrop={(e) => {
                      e.preventDefault();
                      const id = e.dataTransfer.getData("foodId");
                      if (id) handleDrop(id, lvl.id);
                    }}
                  >
                    <div
                      className={`${lvl.color} flex flex-wrap items-center justify-center gap-2 transition-colors border-4 border-dashed border-white/40 shadow-xl rounded-xl relative`}
                      style={{
                        width:
                          lvl.id === "level4"
                            ? "200px"
                            : lvl.id === "level3"
                            ? "350px"
                            : lvl.id === "level2"
                            ? "500px"
                            : "650px",
                        height: "140px",
                      }}
                    >
                      <span className="absolute top-1 left-2 bg-black/20 text-white text-xs font-bold px-2 rounded opacity-80 backdrop-blur-sm pointer-events-none">
                        {getText(lvl.label)}
                      </span>
                      {Object.entries(placements)
                        .filter(([_, l]) => l === lvl.id)
                        .map(([fId, _]) => {
                          const food = foods.find((f) => f.id === fId);
                          return (
                            <div
                              key={fId}
                              className="bg-white rounded-full p-2 text-3xl shadow-md cursor-pointer hover:scale-110 transition-transform"
                              onClick={() => {
                                const next = { ...placements };
                                delete next[fId];
                                setPlacements(next);
                                setAvailable((prev) => [...prev, fId]);
                              }}
                            >
                              {food.icon}
                            </div>
                          );
                        })}
                    </div>
                  </div>
                ))}
              </div>

              {/* Food Bank */}
              <div className="w-full lg:w-1/3 flex flex-col items-center">
                <div className="bg-white/80 p-6 rounded-3xl shadow-lg w-full min-h-[300px]">
                  <h3 className="font-bold text-slate-500 mb-4 text-center">
                    Food Items
                  </h3>
                  <div className="flex flex-wrap gap-4 justify-center">
                    {available.map((fId) => {
                      const f = foods.find((x) => x.id === fId);
                      return (
                        <div
                          key={f.id}
                          draggable
                          onDragStart={(e) =>
                            e.dataTransfer.setData("foodId", f.id)
                          }
                          className="w-16 h-16 bg-white rounded-xl shadow-md flex items-center justify-center text-4xl cursor-grab active:cursor-grabbing hover:scale-110 transition-transform border-2 border-slate-100"
                        >
                          {f.icon}
                        </div>
                      );
                    })}
                  </div>
                </div>

                {status && (
                  <div
                    className={`mt-4 p-4 rounded-2xl font-black text-center text-xl shadow w-full ${
                      status === "correct"
                        ? "bg-green-100 text-green-700"
                        : "bg-red-100 text-red-600"
                    }`}
                  >
                    {getText(status)}
                  </div>
                )}

                <div className="flex gap-4 w-full mt-4">
                  <button
                    onClick={checkAnswers}
                    className="flex-1 bg-amber-500 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-amber-600"
                  >
                    {getText("check")}
                  </button>
                  <button
                    onClick={reset}
                    className="flex-1 bg-slate-200 text-slate-600 py-3 rounded-xl font-bold shadow-lg hover:bg-slate-300"
                  >
                    {getText("reset")}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
