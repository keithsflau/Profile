<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫åÂ∏∏Ë≠òÔºöÂÖâËàáÂΩ± | Light and Shadow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: radial-gradient(circle at center, #374151 0%, #111827 100%);
        color: white;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Light & Shadow",
          zh: "ÂÖâËàáÂΩ±",
          ja: "ÂÖâ„Å®ÂΩ±",
        },
        instruction: {
          en: "Match the object to its shadow!",
          zh: "Â∞áÁâ©‰ª∂ÈÖçÂ∞çÊ≠£Á¢∫ÁöÑÂΩ±Â≠êÔºÅ",
          ja: "Áâ©‰Ωì„Çí„Åù„ÅÆÂΩ±„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
        },
        correct: { en: "Correct Match!", zh: "ÈÖçÂ∞çÊ≠£Á¢∫ÔºÅ" },
        wrong: { en: "Try Again", zh: "ÂÜçË©¶‰∏ÄÊ¨°" },
        next: { en: "Next Level", zh: "‰∏ã‰∏ÄÈóú" },
        score: { en: "Score", zh: "ÂàÜÊï∏" },

        cat: { en: "Cat", zh: "Ë≤ì" },
        tree: { en: "Tree", zh: "Ê®π" },
        car: { en: "Car", zh: "Ê±ΩËªä" },
        robot: { en: "Robot", zh: "Ê©üÊ¢∞‰∫∫" },
        star: { en: "Star", zh: "ÊòüÊòü" },
        hand: { en: "Hand", zh: "Êâã" },
      };

      // Simple SVG Shapes for shadows
      const shapes = {
        cat: (color) => (
          <svg viewBox="0 0 100 100" className={`w-24 h-24 ${color}`}>
            <path
              d="M20 80 Q10 20 40 40 Q50 10 60 40 Q90 20 80 80 Z"
              fill="currentColor"
            />
          </svg>
        ),
        tree: (color) => (
          <svg viewBox="0 0 100 100" className={`w-24 h-24 ${color}`}>
            <path
              d="M45 90 L55 90 L55 70 Q90 60 50 10 Q10 60 45 70 Z"
              fill="currentColor"
            />
          </svg>
        ),
        star: (color) => (
          <svg viewBox="0 0 100 100" className={`w-24 h-24 ${color}`}>
            <path
              d="M50 10 L60 40 L90 40 L65 60 L75 90 L50 70 L25 90 L35 60 L10 40 L40 40 Z"
              fill="currentColor"
            />
          </svg>
        ),
        // Simplified or use emoji silhouettes via CSS filter contrast/brightness
      };

      const items = [
        {
          id: "cat",
          icon: "üê±",
          shadowScale: "scale-y-[0.5] skew-x-[40deg]",
          manualRender: false,
        },
        {
          id: "tree",
          icon: "üå≤",
          shadowScale: "scale-y-[1.5] -skew-x-[20deg]",
          manualRender: false,
        },
        {
          id: "car",
          icon: "üöó",
          shadowScale: "scale-y-[0.3] skew-x-[60deg]",
          manualRender: false,
        },
        {
          id: "robot",
          icon: "ü§ñ",
          shadowScale: "scale-y-[1.2] -skew-x-[10deg]",
          manualRender: false,
        },
        {
          id: "star",
          icon: "‚≠ê",
          shadowScale: "scale-y-[1.0] rotate-45",
          manualRender: false,
        },
        {
          id: "hand",
          icon: "‚úã",
          shadowScale: "scale-[1.5]",
          manualRender: false,
        },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [level, setLevel] = useState(0);
        const [score, setScore] = useState(0);
        const [selectedItem, setSelectedItem] = useState(null);
        const [feedback, setFeedback] = useState(null);

        // Pick 3 random items for current level
        const [currentRound, setCurrentRound] = useState([]);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          initLevel();
        }, [level]);

        const initLevel = () => {
          const shuffled = [...items]
            .sort(() => Math.random() - 0.5)
            .slice(0, 3);
          setCurrentRound(shuffled);
          setSelectedItem(null);
          setFeedback(null);
        };

        const handleMatch = (obj, shadowObj) => {
          if (feedback) return;
          if (obj.id === shadowObj.id) {
            setFeedback({ status: "correct", id: obj.id });
            setScore((s) => s + 10);
            setTimeout(() => {
              if (level < 5) setLevel((l) => l + 1);
              else {
                // End game or loop
                setLevel(0);
                setScore(0);
              }
            }, 1500);
          } else {
            setFeedback({ status: "wrong" });
            setTimeout(() => setFeedback(null), 1000);
          }
        };

        // For drag and drop, let's keep it simple: Click object then click shadow
        const handleClickObject = (obj) => {
          setSelectedItem(obj);
        };

        const handleClickShadow = (shadowObj) => {
          if (selectedItem) {
            handleMatch(selectedItem, shadowObj);
            setSelectedItem(null);
          }
        };

        // Randomize shadow order
        const [shadowOrder, setShadowOrder] = useState([]);
        useEffect(() => {
          setShadowOrder([...currentRound].sort(() => Math.random() - 0.5));
        }, [currentRound]);

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-yellow-300 mb-4 mt-8 drop-shadow-[0_0_10px_rgba(253,224,71,0.5)]">
              üî¶ {getText("title")}
            </h1>
            <p className="font-bold text-slate-300 mb-8">
              {getText("instruction")}
            </p>
            <div className="font-bold text-yellow-500 mb-4 border border-yellow-500 px-4 py-1 rounded-full">
              {getText("score")}: {score}
            </div>

            <div className="flex flex-col md:flex-row gap-12 w-full max-w-4xl justify-center items-center">
              {/* Objects */}
              <div className="flex flex-row md:flex-col gap-6">
                {currentRound.map((item) => {
                  const solved =
                    feedback?.status === "correct" && feedback.id === item.id;
                  return (
                    <button
                      key={item.id}
                      onClick={() => handleClickObject(item)}
                      className={`w-32 h-32 bg-white/10 rounded-2xl flex items-center justify-center text-6xl border-4 transition-all ${
                        selectedItem?.id === item.id
                          ? "border-yellow-400 shadow-[0_0_20px_yellow]"
                          : "border-white/20 hover:bg-white/20"
                      } ${solved ? "opacity-0" : "opacity-100"}`}
                    >
                      {item.icon}
                    </button>
                  );
                })}
              </div>

              {/* Light Source Visual */}
              <div className="hidden md:flex flex-col items-center justify-center opacity-50">
                <div className="text-6xl mb-2">üî¶</div>
                <div className="w-40 h-1 bg-yellow-200/50 shadow-[0_0_20px_white]"></div>
              </div>

              {/* Shadows */}
              <div className="flex flex-row md:flex-col gap-6">
                {shadowOrder.map((item) => {
                  const solved =
                    feedback?.status === "correct" && feedback.id === item.id;
                  return (
                    <button
                      key={item.id}
                      onClick={() => handleClickShadow(item)}
                      className={`w-32 h-32 bg-black/40 rounded-2xl flex items-center justify-center border-4 border-dashed transition-all ${
                        solved
                          ? "border-green-500 bg-green-900/50"
                          : "border-slate-600 hover:border-slate-400"
                      }`}
                    >
                      {solved ? (
                        <motion.div
                          initial={{ scale: 0 }}
                          animate={{ scale: 1 }}
                          className="text-6xl"
                        >
                          {item.icon}
                        </motion.div>
                      ) : (
                        <div
                          className={`text-6xl text-black transform filter blur-[1px] opacity-70 ${item.shadowScale}`}
                        >
                          {item.icon}
                        </div>
                      )}
                    </button>
                  );
                })}
              </div>
            </div>

            {feedback && (
              <div
                className={`mt-8 p-4 rounded-xl font-black text-2xl animate-bounce ${
                  feedback.status === "correct"
                    ? "text-green-400"
                    : "text-red-400"
                }`}
              >
                {getText(feedback.status === "correct" ? "correct" : "wrong")}
              </div>
            )}

            <div className="mt-8 text-xs text-slate-500 font-mono">
              Level {level + 1}
            </div>
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
