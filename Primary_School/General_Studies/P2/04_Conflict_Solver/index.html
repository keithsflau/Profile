<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫åÂ∏∏Ë≠òÔºöËß£Ê±∫Á¥õÁà≠ | Solving Conflicts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fbcfe8 0%, #f472b6 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Conflict Solver",
          zh: "Ëß£Ê±∫Á¥õÁà≠",
          ja: "‰ª≤Áõ¥„Çä„Åó„Çà„ÅÜ",
        },
        instruction: {
          en: "What should you say?",
          zh: "‰Ω†ÊáâË©≤Ë™™‰ªÄÈ∫ºÔºü",
          ja: "‰Ωï„Å®Ë®Ä„ÅÜ„Åπ„Åç„Åß„Åô„ÅãÔºü",
        },
        correct: { en: "Great! That is polite.", zh: "ÂÅöÂæóÂ•ΩÔºÅÈÄôÂæàÊúâÁ¶ÆË≤å„ÄÇ" },
        wrong: {
          en: "That might make them sad...",
          zh: "ÈÄôÊ®£ÂèØËÉΩÊúÉËÆìÂ∞çÊñπÂÇ∑ÂøÉ...",
        },
        next: { en: "Next Situation", zh: "‰∏ã‰∏ÄÂÄãÊÉÖÂ¢É" },
        score: { en: "Friendship Score", zh: "ÂèãË™ºÂàÜÊï∏" },
        completed: { en: "You are a good friend!", zh: "‰Ω†ÊòØ‰∏ÄÂÄãÂ•ΩÊúãÂèãÔºÅ" },
        restart: { en: "Play Again", zh: "ÂÜçÁé©‰∏ÄÊ¨°" },

        s1: {
          en: "You accidentally bumped into a classmate.",
          zh: "‰Ω†‰∏çÂ∞èÂøÉÊíûÂà∞‰∫ÜÂêåÂ≠∏„ÄÇ",
        },
        s1_a: { en: "Sorry! Are you okay?", zh: "Â∞ç‰∏çËµ∑ÔºÅ‰Ω†Ê≤í‰∫ãÂêßÔºü" },
        s1_b: { en: "Watch where you are going!", zh: "‰Ω†Èï∑‰∏çÈï∑ÁúºÁùõÁöÑÔºÅ" },

        s2: { en: "Your friend has a new toy.", zh: "ÊúãÂèãÊúâÊñ∞Áé©ÂÖ∑„ÄÇ" },
        s2_a: { en: "Can I play with you?", zh: "ÊàëÂèØ‰ª•Âíå‰Ω†‰∏ÄËµ∑Áé©ÂóéÔºü" },
        s2_b: { en: "Give it to me now!", zh: "Âø´ÈªûÁµ¶ÊàëÁé©ÔºÅ" },

        s3: {
          en: "You broke your friend's pencil.",
          zh: "‰Ω†ÂºÑÊñ∑‰∫ÜÊúãÂèãÁöÑÈâõÁ≠Ü„ÄÇ",
        },
        s3_a: {
          en: "I promise to buy you a new one.",
          zh: "Â∞ç‰∏çËµ∑ÔºåÊàëÊúÉË≥†‰∏ÄÊûùÊñ∞ÁöÑÁµ¶‰Ω†„ÄÇ",
        },
        s3_b: {
          en: "It was a cheap pencil anyway.",
          zh: "ÈÄôÊîØÁ≠ÜÂæà‰æøÂÆúÔºåÊ≤íÊâÄË¨ÇÂêß„ÄÇ",
        },

        s4: { en: "Your friend is sad.", zh: "ÊúãÂèãÂæà‰∏çÈñãÂøÉ„ÄÇ" },
        s4_a: {
          en: "Do you want to talk about it?",
          zh: "‰Ω†ÊÉ≥Ë™™Ë™™ÁôºÁîü‰ªÄÈ∫º‰∫ãÂóéÔºü",
        },
        s4_b: { en: "Stop crying, it's annoying.", zh: "Âà•Âì≠‰∫ÜÔºåÂæàÁÖ©„ÄÇ" },
      };

      const scenarios = [
        { id: "s1", correct: "a" },
        { id: "s2", correct: "a" },
        { id: "s3", correct: "a" },
        { id: "s4", correct: "a" }, // Keeping 'a' as correct for simplicity in data structure, but randomization in display is key
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [idx, setIdx] = useState(0);
        const [score, setScore] = useState(0);
        const [feedback, setFeedback] = useState(null);
        const [shuffledOptions, setShuffledOptions] = useState([]);

        const getText = (key) => t[key][lang] || t[key]["en"];

        useEffect(() => {
          if (idx < scenarios.length) {
            // Shuffle options
            const opts = ["a", "b"].sort(() => Math.random() - 0.5);
            setShuffledOptions(opts);
            setFeedback(null);
          }
        }, [idx]);

        const handleChoice = (opt) => {
          if (feedback) return;
          const isCorrect = opt === scenarios[idx].correct;
          if (isCorrect) {
            setScore((s) => s + 1);
            setFeedback("correct");
          } else {
            setFeedback("wrong");
          }
        };

        const next = () => {
          setIdx(idx + 1);
          setFeedback(null);
        };

        const restart = () => {
          setIdx(0);
          setScore(0);
        };

        const currentQ = scenarios[idx];

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-pink-900 mb-8 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              ü§ù {getText("title")}
            </h1>

            {idx < scenarios.length ? (
              <div className="w-full max-w-2xl bg-white rounded-3xl p-8 shadow-2xl border-4 border-pink-200">
                <p className="text-pink-600 font-bold mb-4">
                  {getText("score")}: {score}
                </p>

                {/* Scenario Bubble */}
                <motion.div
                  key={`${currentQ.id}-scen`}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="bg-pink-100 p-6 rounded-2xl mb-8 relative border-2 border-pink-300"
                >
                  <div className="absolute -top-6 left-8 text-6xl">ü§î</div>
                  <h2 className="text-2xl font-black text-slate-800 mt-4">
                    {getText(currentQ.id)}
                  </h2>
                </motion.div>

                <p className="font-bold text-slate-500 mb-4 text-center">
                  {getText("instruction")}
                </p>

                <div className="space-y-4">
                  {shuffledOptions.map((opt) => (
                    <button
                      key={opt}
                      onClick={() => handleChoice(opt)}
                      disabled={!!feedback}
                      className={`w-full p-6 rounded-2xl text-left border-4 transition-all text-xl font-bold font-fredoka flex items-center gap-4 ${
                        feedback
                          ? opt === currentQ.correct
                            ? "bg-green-100 border-green-500 text-green-800"
                            : feedback === "wrong"
                            ? "opacity-50"
                            : "bg-white border-slate-200 text-slate-400"
                          : "bg-white border-slate-200 hover:border-pink-400 hover:bg-pink-50 text-slate-700 shadow-sm"
                      }`}
                    >
                      <span className="text-3xl">
                        {opt === "a" ? "üëº" : "üëø"}
                      </span>{" "}
                      {/* Icons usually randomized too, but here linked to option letter implicitly to simplify logic. In reality, A should be consistently good in logic but shuffled in display. */}
                      {/* Wait, my shuffle logic shuffles 'a' and 'b'. 'a' is always correct in my data. So opt='a' is always good choice. */}
                      {/* Let's fix icon logic: 'a' is good/correct. 'b' is bad. */}
                      <span className="flex-1">
                        {getText(`${currentQ.id}_${opt}`)}
                      </span>
                      {feedback && opt === currentQ.correct && <span>‚úÖ</span>}
                      {feedback &&
                        opt !== currentQ.correct &&
                        feedback === "wrong" && <span>‚ùå</span>}
                    </button>
                  ))}
                </div>

                {feedback && (
                  <div className="mt-8 text-center">
                    <div
                      className={`text-2xl font-black mb-4 ${
                        feedback === "correct"
                          ? "text-green-600"
                          : "text-pink-600"
                      }`}
                    >
                      {getText(feedback)}
                    </div>
                    <button
                      onClick={next}
                      className="bg-pink-500 text-white px-10 py-3 rounded-full font-black text-xl hover:bg-pink-600 shadow-xl"
                    >
                      {getText("next")} ‚û°Ô∏è
                    </button>
                  </div>
                )}
              </div>
            ) : (
              <div className="bg-white/90 p-12 rounded-3xl shadow-xl text-center mt-12">
                <div className="text-8xl mb-4">üíñ</div>
                <h2 className="text-3xl font-black text-pink-800 mb-6">
                  {getText("completed")}
                </h2>
                <p className="text-xl mb-8 font-bold text-slate-600">
                  {getText("score")}: {score} / {scenarios.length}
                </p>
                <button
                  onClick={restart}
                  className="bg-pink-500 text-white px-10 py-4 rounded-full font-black text-xl hover:bg-pink-600 shadow-xl"
                >
                  {getText("restart")} üîÑ
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
