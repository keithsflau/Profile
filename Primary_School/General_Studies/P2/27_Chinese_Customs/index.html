<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞è‰∫åÂ∏∏Ë≠òÔºöÂÇ≥Áµ±Áøí‰øó | Chinese Customs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Customs",
          zh: "ÂÇ≥Áµ±Áøí‰øó",
          ja: "‰ºùÁµ±ÁöÑ„Å™ÁøíÊÖ£",
          ko: "ÌíçÏäµ",
          es: "Costumbres",
          de: "Br√§uche",
          fi: "Tavat",
          fr: "Coutumes",
          ar: "ÿ¨ŸÖÿßÿ±ŸÉ",
          it: "Usanze",
        },
        instruction: {
          en: "What do we do in this festival?",
          zh: "Âú®ÈÄôÂÄãÁØÄÊó•ÊàëÂÄëÊúÉÂÅö‰ªÄÈ∫ºÔºü",
          ja: "„Åì„ÅÆ„ÅäÁ•≠„Çä„Åß„ÅØ‰Ωï„Çí„Åó„Åæ„Åô„ÅãÔºü",
          ko: "Ïù¥ Ï∂ïÏ†ú Îïå Î¨¥ÏóáÏùÑ ÌïòÎÇòÏöî?",
          es: "¬øQu√© hacemos en este festival?",
          de: "Was machen wir bei diesem Fest?",
          fi: "Mit√§ teemme t√§ss√§ juhlassa?",
          fr: "Que faisons-nous lors de ce festival ?",
          ar: "ŸÖÿßÿ∞ÿß ŸÜŸÅÿπŸÑ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸÖŸáÿ±ÿ¨ÿßŸÜÿü",
          it: "Cosa facciamo in questa festa?",
        },
        correct: {
          en: "Correct!",
          zh: "Á≠îÂ∞ç‰∫ÜÔºÅ",
          ja: "Ê≠£Ëß£ÔºÅ",
          ko: "Ï†ïÎãµÏûÖÎãàÎã§!",
          es: "¬°Correcto!",
          de: "Richtig!",
          fi: "Oikein!",
          fr: "Correct !",
          ar: "ÿµÿ≠Ÿäÿ≠!",
          it: "Corretto!",
        },
        wrong: {
          en: "Try Again",
          zh: "ÂÜçË©¶‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶",
          ko: "Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî",
          es: "Int√©ntalo de Nuevo",
          de: "Versuch es nochmal",
          fi: "Yrit√§ uudelleen",
          fr: "R√©essayez",
          ar: "ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Riprova",
        },

        cny: {
          en: "Lunar New Year",
          zh: "Ëæ≤ÊõÜÊñ∞Âπ¥",
          ja: "ÊóßÊ≠£Êúà",
          ko: "ÏÑ§ÎÇ†",
          es: "A√±o Nuevo Lunar",
          de: "Mondneujahr",
          fi: "Kuun uusi vuosi",
          fr: "Nouvel An lunaire",
          ar: "ÿ±ÿ£ÿ≥ ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸÇŸÖÿ±Ÿäÿ©",
          it: "Capodanno Lunare",
        },
        mid: {
          en: "Mid-Autumn",
          zh: "‰∏≠ÁßãÁØÄ",
          ja: "‰∏≠ÁßãÁØÄ",
          ko: "Ï∂îÏÑù",
          es: "Medio Oto√±o",
          de: "Mittherbstfest",
          fi: "Keskisyksyn juhla",
          fr: "Mi-automne",
          ar: "ŸÖŸÜÿ™ÿµŸÅ ÿßŸÑÿÆÿ±ŸäŸÅ",
          it: "Met√† Autunno",
        },
        dragon: {
          en: "Dragon Boat",
          zh: "Á´ØÂçàÁØÄ",
          ja: "Á´ØÂçàÁØÄ",
          ko: "Îã®Ïò§Ï†à",
          es: "Bote del Drag√≥n",
          de: "Drachenbootfest",
          fi: "Lohik√§√§rmevene",
          fr: "Bateau-dragon",
          ar: "ŸÇÿßÿ±ÿ® ÿßŸÑÿ™ŸÜŸäŸÜ",
          it: "Barca del Drago",
        },
        grave: {
          en: "Ching Ming",
          zh: "Ê∏ÖÊòéÁØÄ",
          ja: "Ê∏ÖÊòéÁØÄ",
          ko: "Ï≤≠Î™ÖÏ†à",
          es: "Ching Ming",
          de: "Ching Ming",
          fi: "Ching Ming",
          fr: "Ching Ming",
          ar: "ÿ™ÿ¥ŸäŸÜÿ∫ ŸÖŸäŸÜÿ∫",
          it: "Ching Ming",
        },

        redpacket: {
          en: "Red Packet",
          zh: "Ê¥æÂà©ÊòØ",
          ja: "„ÅäÂπ¥Áéâ",
          ko: "ÏÑ∏Î±ÉÎèà",
          es: "Sobre Rojo",
          de: "Roter Umschlag",
          fi: "Punainen kirjekuori",
          fr: "Enveloppe rouge",
          ar: "ÿßŸÑÿ≠ÿ≤ŸÖÿ© ÿßŸÑÿ≠ŸÖÿ±ÿßÿ°",
          it: "Busta Rossa",
        },
        lantern: {
          en: "Lanterns",
          zh: "Áé©ÁáàÁ±†",
          ja: "ÊèêÁÅØ",
          ko: "Îì±Î∂à ÎÜÄÏù¥",
          es: "Linternas",
          de: "Laternen",
          fi: "Lyhdyt",
          fr: "Lanternes",
          ar: "ŸÅŸàÿßŸÜŸäÿ≥",
          it: "Lanterne",
        },
        boat: {
          en: "Dragon Boat Race",
          zh: "ÊâíÈæçËàü",
          ja: "„Éâ„É©„Ç¥„É≥„Éú„Éº„Éà„É¨„Éº„Çπ",
          ko: "Ïö©ÏÑ† Í≤ΩÏ£º",
          es: "Carrera de Botes Dr.",
          de: "Drachenbootrennen",
          fi: "Lohil√§√§rmevenekisa",
          fr: "Course bateaux-dragons",
          ar: "ÿ≥ÿ®ÿßŸÇ ŸÇŸàÿßÿ±ÿ® ÿßŸÑÿ™ŸÜŸäŸÜ",
          it: "Gara Barche Drago",
        },
        sweep: {
          en: "Sweep Graves",
          zh: "ÊéÉÂ¢ì",
          ja: "Â¢ìÂèÇ„Çä",
          ko: "ÏÑ±Î¨ò",
          es: "Barrer Tumbas",
          de: "Gr√§ber fegen",
          fi: "Hautojen lakaisu",
          fr: "Balayer les tombes",
          ar: "ŸÉŸÜÿ≥ ÿßŸÑŸÇÿ®Ÿàÿ±",
          it: "Pulire le Tombe",
        },

        candy: {
          en: "Candy Box",
          zh: "ÂÖ®Áõí",
          ja: "„ÅäËèìÂ≠ê„ÅÆÁÆ±",
          ko: "ÏÇ¨ÌÉï ÏÉÅÏûê",
          es: "Caja de Dulces",
          de: "S√º√üigkeitenbox",
          fi: "Karkkilaatikko",
          fr: "Bo√Æte √† bonbons",
          ar: "ÿπŸÑÿ®ÿ© ÿ≠ŸÑŸàŸâ",
          it: "Scatola di Dolci",
        },
        mooncake: {
          en: "Mooncake",
          zh: "ÂêÉÊúàÈ§Ö",
          ja: "ÊúàÈ§Ö",
          ko: "ÏõîÎ≥ë Î®πÍ∏∞",
          es: "Pastel de Luna",
          de: "Mondkuchen",
          fi: "Kuukakku",
          fr: "G√¢teau de lune",
          ar: "ŸÉÿπŸÉÿ© ÿßŸÑŸÇŸÖÿ±",
          it: "Torta Lunare",
        },
        dumpling: {
          en: "Rice Dumpling",
          zh: "ÂêÉÁ≤ΩÂ≠ê",
          ja: "„Å°„Åæ„Åç",
          ko: "Ï¢ÖÏØî Î®πÍ∏∞",
          es: "Bola de Arroz",
          de: "Reiskn√∂del",
          fi: "Riisi dumpling",
          fr: "Boulette de riz",
          ar: "ÿ≤ŸÑÿßÿ®Ÿäÿ© ÿßŸÑÿ£ÿ±ÿ≤",
          it: "Gnocchi di Riso",
        },

        score: {
          en: "Score",
          zh: "ÂàÜÊï∏",
          ja: "„Çπ„Ç≥„Ç¢",
          ko: "Ï†êÏàò",
          es: "Puntuaci√≥n",
          de: "Punktzahl",
          fi: "Pisteet",
          fr: "Score",
          ar: "ŸÜÿ™Ÿäÿ¨ÿ©",
          it: "Punteggio",
        },
        next: {
          en: "Next",
          zh: "‰∏ã‰∏ÄÈ°å",
          ja: "Ê¨°„Å∏",
          ko: "Îã§Ïùå",
          es: "Siguiente",
          de: "Weiter",
          fi: "Seuraava",
          fr: "Suivant",
          ar: "ÿßŸÑÿ™ÿßŸÑŸä",
          it: "Avanti",
        },
        completed: {
          en: "Festival Master!",
          zh: "ÁØÄÊó•Â∞èÈÅî‰∫∫ÔºÅ",
          ja: "„ÅäÁ•≠„Çä„Éû„Çπ„Çø„ÉºÔºÅ",
          ko: "Ï∂ïÏ†ú ÎßàÏä§ÌÑ∞!",
          es: "¬°Maestro de Festivales!",
          de: "Fest-Meister!",
          fi: "Juhlamestari!",
          fr: "Ma√Ætre des festivals !",
          ar: "ÿ≥ŸäÿØ ÿßŸÑŸÖŸáÿ±ÿ¨ÿßŸÜ!",
          it: "Maestro delle Feste!",
        },
        restart: {
          en: "Play Again",
          zh: "ÂÜçÁé©‰∏ÄÊ¨°",
          ja: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§",
          ko: "Îã§Ïãú ÌïòÍ∏∞",
          es: "Jugar de Nuevo",
          de: "Nochmal spielen",
          fi: "Pelaa uudelleen",
          fr: "Rejouer",
          ar: "ÿßŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ",
          it: "Gioca di Nuovo",
        },
      };

      const festivals = [
        { id: "cny", icon: "üßß", items: ["redpacket", "candy"] },
        { id: "mid", icon: "üåï", items: ["lantern", "mooncake"] },
        { id: "dragon", icon: "üêâ", items: ["boat", "dumpling"] },
        { id: "grave", icon: "‚õ∞Ô∏è", items: ["sweep"] },
      ];

      const allItems = [
        { id: "redpacket", icon: "üßß" },
        { id: "lantern", icon: "üèÆ" },
        { id: "boat", icon: "üö£" },
        { id: "sweep", icon: "üßπ" },
        { id: "candy", icon: "üç¨" },
        { id: "mooncake", icon: "ü•Æ" },
        { id: "dumpling", icon: "üçô" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [qIdx, setQIdx] = useState(0);
        const [score, setScore] = useState(0);
        const [shuffledOptions, setShuffledOptions] = useState([]);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];
        const currentFestival = festivals[qIdx];

        useEffect(() => {
          if (currentFestival) {
            // Prepare options: Corrext Ones + Some Distractors
            const correctItems = allItems.filter((i) =>
              currentFestival.items.includes(i.id)
            );
            const distractors = allItems
              .filter((i) => !currentFestival.items.includes(i.id))
              .sort(() => Math.random() - 0.5)
              .slice(0, 2);

            setShuffledOptions(
              [...correctItems, ...distractors].sort(() => Math.random() - 0.5)
            );
            setFeedback(null);
          }
        }, [qIdx]);

        const handleSelect = (item) => {
          if (feedback) return;
          if (currentFestival.items.includes(item.id)) {
            setFeedback("correct");
            setScore((s) => s + 10);
          } else {
            setFeedback("wrong");
          }
        };

        const next = () => {
          if (qIdx < festivals.length - 1) setQIdx(qIdx + 1);
          else setQIdx(-1); // Finished
        };

        const restart = () => {
          setQIdx(0);
          setScore(0);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-red-800 mb-4 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              üèÆ {getText("title")}
            </h1>

            {qIdx !== -1 && currentFestival ? (
              <div className="w-full max-w-lg flex flex-col items-center">
                <div className="font-bold text-red-700 mb-4 bg-white px-4 py-1 rounded-full shadow">
                  {getText("score")}: {score}
                </div>

                <div className="bg-red-50 p-8 rounded-3xl border-4 border-red-200 text-center mb-8 w-full shadow-lg">
                  <div className="text-8xl mb-4 animate-bounce-slow">
                    {currentFestival.icon}
                  </div>
                  <h2 className="text-3xl font-black text-red-900">
                    {getText(currentFestival.id)}
                  </h2>
                  <p className="mt-4 text-slate-500 font-bold">
                    {getText("instruction")}
                  </p>
                </div>

                <div className="grid grid-cols-2 gap-4 w-full">
                  {shuffledOptions.map((opt, i) => (
                    <button
                      key={i}
                      onClick={() => handleSelect(opt)}
                      disabled={!!feedback}
                      className="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center border-b-4 border-slate-200 active:border-b-0 active:translate-y-1"
                    >
                      <span className="text-5xl mb-2">{opt.icon}</span>
                      <span className="font-bold text-slate-700">
                        {getText(opt.id)}
                      </span>
                    </button>
                  ))}
                </div>

                {feedback && (
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className={`mt-6 p-4 rounded-xl font-black text-2xl text-center w-full shadow-lg ${
                      feedback === "correct"
                        ? "bg-green-100 text-green-700"
                        : "bg-red-100 text-red-600"
                    }`}
                  >
                    {getText(feedback)}
                    {feedback === "correct" && (
                      <div className="mt-2">
                        <button
                          onClick={next}
                          className="bg-green-600 text-white px-8 py-2 rounded-full text-lg shadow"
                        >
                          {getText("next")} ‚û°Ô∏è
                        </button>
                      </div>
                    )}
                  </motion.div>
                )}
              </div>
            ) : (
              <div className="bg-white/90 p-12 rounded-3xl shadow-xl text-center mt-12">
                <div className="text-8xl mb-4">üèÜ</div>
                <h2 className="text-3xl font-black text-red-800 mb-6">
                  {getText("completed")}
                </h2>
                <p className="text-xl mb-8 font-bold text-slate-600">
                  {getText("score")}: {score}
                </p>
                <button
                  onClick={restart}
                  className="bg-red-600 text-white px-10 py-4 rounded-full font-black text-xl hover:bg-red-700 shadow-xl"
                >
                  {getText("restart")} üîÑ
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
