<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°äºŒå¸¸è­˜ï¼šå‚³çµ±ç¿’ä¿— | Chinese Customs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="../../common/i18n.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", "Noto Sans TC", sans-serif;
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const { motion, AnimatePresence } = window.Motion;
      const { LanguageSelector, get } = window.MathI18n;

      const t = {
        title: {
          en: "Customs",
          zh: "å‚³çµ±ç¿’ä¿—",
          ja: "ä¼çµ±çš„ãªç¿’æ…£",
        },
        instruction: {
          en: "What do we do in this festival?",
          zh: "åœ¨é€™å€‹ç¯€æ—¥æˆ‘å€‘æœƒåšä»€éº¼ï¼Ÿ",
          ja: "ã“ã®ãŠç¥­ã‚Šã§ã¯ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ",
        },
        correct: { en: "Correct!", zh: "ç­”å°äº†ï¼" },
        wrong: { en: "Try Again", zh: "å†è©¦ä¸€æ¬¡" },

        cny: { en: "Lunar New Year", zh: "è¾²æ›†æ–°å¹´" },
        mid: { en: "Mid-Autumn", zh: "ä¸­ç§‹ç¯€" },
        dragon: { en: "Dragon Boat", zh: "ç«¯åˆç¯€" },
        grave: { en: "Ching Ming", zh: "æ¸…æ˜ç¯€" },

        redpacket: { en: "Red Packet", zh: "æ´¾åˆ©æ˜¯" },
        lantern: { en: "Lanterns", zh: "ç©ç‡ˆç± " },
        boat: { en: "Dragon Boat Race", zh: "æ‰’é¾èˆŸ" },
        sweep: { en: "Sweep Graves", zh: "æƒå¢“" },

        candy: { en: "Candy Box", zh: "å…¨ç›’" },
        mooncake: { en: "Mooncake", zh: "åƒæœˆé¤…" },
        dumpling: { en: "Rice Dumpling", zh: "åƒç²½å­" },

        score: { en: "Score", zh: "åˆ†æ•¸" },
        next: { en: "Next", zh: "ä¸‹ä¸€é¡Œ" },
        completed: { en: "Festival Master!", zh: "ç¯€æ—¥å°é”äººï¼" },
        restart: { en: "Play Again", zh: "å†ç©ä¸€æ¬¡" },
      };

      const festivals = [
        { id: "cny", icon: "ğŸ§§", items: ["redpacket", "candy"] },
        { id: "mid", icon: "ğŸŒ•", items: ["lantern", "mooncake"] },
        { id: "dragon", icon: "ğŸ‰", items: ["boat", "dumpling"] },
        { id: "grave", icon: "â›°ï¸", items: ["sweep"] },
      ];

      const allItems = [
        { id: "redpacket", icon: "ğŸ§§" },
        { id: "lantern", icon: "ğŸ®" },
        { id: "boat", icon: "ğŸš£" },
        { id: "sweep", icon: "ğŸ§¹" },
        { id: "candy", icon: "ğŸ¬" },
        { id: "mooncake", icon: "ğŸ¥®" },
        { id: "dumpling", icon: "ğŸ™" },
      ];

      function App() {
        const [lang, setLang] = useState("zh");
        const [qIdx, setQIdx] = useState(0);
        const [score, setScore] = useState(0);
        const [shuffledOptions, setShuffledOptions] = useState([]);
        const [feedback, setFeedback] = useState(null);

        const getText = (key) => t[key][lang] || t[key]["en"];
        const currentFestival = festivals[qIdx];

        useEffect(() => {
          if (currentFestival) {
            // Prepare options: Corrext Ones + Some Distractors
            const correctItems = allItems.filter((i) =>
              currentFestival.items.includes(i.id)
            );
            const distractors = allItems
              .filter((i) => !currentFestival.items.includes(i.id))
              .sort(() => Math.random() - 0.5)
              .slice(0, 2);

            setShuffledOptions(
              [...correctItems, ...distractors].sort(() => Math.random() - 0.5)
            );
            setFeedback(null);
          }
        }, [qIdx]);

        const handleSelect = (item) => {
          if (feedback) return;
          if (currentFestival.items.includes(item.id)) {
            setFeedback("correct");
            setScore((s) => s + 10);
          } else {
            setFeedback("wrong");
          }
        };

        const next = () => {
          if (qIdx < festivals.length - 1) setQIdx(qIdx + 1);
          else setQIdx(-1); // Finished
        };

        const restart = () => {
          setQIdx(0);
          setScore(0);
        };

        return (
          <div className="min-h-screen p-4 flex flex-col items-center">
            <LanguageSelector lang={lang} setLang={setLang} />
            <h1 className="text-4xl md:text-5xl font-black text-red-800 mb-4 mt-8 drop-shadow-sm bg-white/50 px-6 py-2 rounded-full">
              ğŸ® {getText("title")}
            </h1>

            {qIdx !== -1 && currentFestival ? (
              <div className="w-full max-w-lg flex flex-col items-center">
                <div className="font-bold text-red-700 mb-4 bg-white px-4 py-1 rounded-full shadow">
                  {getText("score")}: {score}
                </div>

                <div className="bg-red-50 p-8 rounded-3xl border-4 border-red-200 text-center mb-8 w-full shadow-lg">
                  <div className="text-8xl mb-4 animate-bounce-slow">
                    {currentFestival.icon}
                  </div>
                  <h2 className="text-3xl font-black text-red-900">
                    {getText(currentFestival.id)}
                  </h2>
                  <p className="mt-4 text-slate-500 font-bold">
                    {getText("instruction")}
                  </p>
                </div>

                <div className="grid grid-cols-2 gap-4 w-full">
                  {shuffledOptions.map((opt, i) => (
                    <button
                      key={i}
                      onClick={() => handleSelect(opt)}
                      disabled={!!feedback}
                      className="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center border-b-4 border-slate-200 active:border-b-0 active:translate-y-1"
                    >
                      <span className="text-5xl mb-2">{opt.icon}</span>
                      <span className="font-bold text-slate-700">
                        {getText(opt.id)}
                      </span>
                    </button>
                  ))}
                </div>

                {feedback && (
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    className={`mt-6 p-4 rounded-xl font-black text-2xl text-center w-full shadow-lg ${
                      feedback === "correct"
                        ? "bg-green-100 text-green-700"
                        : "bg-red-100 text-red-600"
                    }`}
                  >
                    {getText(feedback)}
                    {feedback === "correct" && (
                      <div className="mt-2">
                        <button
                          onClick={next}
                          className="bg-green-600 text-white px-8 py-2 rounded-full text-lg shadow"
                        >
                          {getText("next")} â¡ï¸
                        </button>
                      </div>
                    )}
                  </motion.div>
                )}
              </div>
            ) : (
              <div className="bg-white/90 p-12 rounded-3xl shadow-xl text-center mt-12">
                <div className="text-8xl mb-4">ğŸ†</div>
                <h2 className="text-3xl font-black text-red-800 mb-6">
                  {getText("completed")}
                </h2>
                <p className="text-xl mb-8 font-bold text-slate-600">
                  {getText("score")}: {score}
                </p>
                <button
                  onClick={restart}
                  className="bg-red-600 text-white px-10 py-4 rounded-full font-black text-xl hover:bg-red-700 shadow-xl"
                >
                  {getText("restart")} ğŸ”„
                </button>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  
      
      <!-- Footer -->
      <footer class="text-center py-4 text-slate-500 text-sm">
        <p class="italic mb-1">
          But God made the earth by his power; he founded the world by his wisdom and stretched out the heavens by his
          understanding. Jeremiah 10:12
        </p>
        <p class="text-xs mb-1 mt-2">
          ã€Œè€¶å’Œè¯ç”¨èƒ½åŠ›å‰µé€ å¤§åœ°ï¼Œç”¨æ™ºæ…§å»ºç«‹ä¸–ç•Œï¼Œç”¨è°æ˜é‹ªå¼µç©¹è’¼ã€‚ã€ è€¶åˆ©ç±³æ›¸ 10:12
        </p>
        <p class="text-xs mt-2 pt-2 border-t border-slate-300">
          @ 2025 Education Engineering Portfolio | Generated by Gemini Pro 3.0 | Prepared by SF Lau
        </p>
      </footer>
</body>
</html>
